This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.
The content has been processed where content has been compressed (code blocks are separated by ⋮---- delimiter).

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: src/**/*, resources/connector/**, scripts/**, electron-builder.yml, electron.vite.config.ts, tailwind.config.js, package.json
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)


================================================================
Directory Structure
================================================================
resources/
  connector/
    connector.py
scripts/
  before-pack.js
  download-probe.mjs
  download-uv.mjs
src/
  common/
    locales/
      en.json
      zh.json
    agent.ts
    api.ts
    bmad-types.ts
    bmad-workflows.ts
    tools.ts
    types.ts
    utils.ts
  main/
    agent/
      middlewares/
        extract-reasoning-middleware.ts
      tools/
        aider.ts
        approval-manager.ts
        helpers.ts
        memory.ts
        power.ts
        skills.ts
        subagents.ts
        tasks.ts
        todo.ts
      agent-profile-manager.ts
      agent.ts
      index.ts
      mcp-manager.ts
      optimizer.ts
      utils.ts
    bmad/
      context/
        code-review.json.hbs
        create-architecture.json.hbs
        create-epics-and-stories.json.hbs
        create-prd.json.hbs
        create-product-brief.json.hbs
        create-story.json.hbs
        create-ux-design.json.hbs
        dev-story.json.hbs
        quick-dev.json.hbs
        quick-spec.json.hbs
        research.json.hbs
        sprint-planning.json.hbs
      bmad-manager.ts
      context-preparer.ts
    connector/
      connector-manager.ts
      connector.ts
      index.ts
    custom-commands/
      custom-command-manager.ts
      index.ts
    data-manager/
      data-manager.ts
      index.ts
    events/
      event-manager.ts
      index.ts
    hooks/
      hook-context.ts
      hook-manager.ts
    memory/
      memory-manager.ts
    models/
      providers/
        anthropic-compatible.ts
        anthropic.ts
        azure.ts
        bedrock.ts
        cerebras.ts
        claude-agent-sdk.ts
        deepseek.ts
        default.ts
        gemini.ts
        gpustack.ts
        groq.ts
        kimi-plan.ts
        litellm.ts
        lm-studio.ts
        minimax.ts
        ollama.ts
        openai-compatible.ts
        openai.ts
        opencode.ts
        openrouter.ts
        requesty.ts
        synthetic.ts
        vertex-ai.ts
        zai-plan.ts
      index.ts
      model-manager.ts
      types.ts
    project/
      index.ts
      migrations.ts
      project-manager.ts
      project.ts
    prompts/
      helpers/
        conditional.ts
        file.ts
        formatting.ts
        index.ts
      index.ts
      prompts-manager.ts
      types.ts
    server/
      rest-api/
        agent-api.ts
        base-api.ts
        bmad-api.ts
        commands-api.ts
        context-api.ts
        index.ts
        mcp-api.ts
        memory-api.ts
        project-api.ts
        prompt-api.ts
        providers-api.ts
        settings-api.ts
        system-api.ts
        terminal-api.ts
        todo-api.ts
        usage-api.ts
        voice-api.ts
      cloudflare-tunnel-manager.ts
      index.ts
      runner.ts
      server-controller.ts
    store/
      migrations/
        v0-to-v1.ts
        v1-to-v2.ts
        v10-to-v11.ts
        v11-to-v12.ts
        v12-to-v13.ts
        v13-to-v14.ts
        v14-to-v15.ts
        v15-to-v16.ts
        v16-to-v17.ts
        v2-to-v3.ts
        v3-to-v4.ts
        v4-to-v5.ts
        v5-to-v6.ts
        v6-to-v7.ts
        v7-to-v8.ts
        v8-to-v9.ts
        v9-to-v10.ts
      index.ts
      store.ts
    task/
      migrations/
        v1-to-v2.ts
      aider-manager.ts
      context-manager.ts
      index.ts
      task.ts
    telemetry/
      index.ts
      langfuse.ts
      open-telemetry.ts
      telemetry-manager.ts
    terminal/
      index.ts
      terminal-manager.ts
    utils/
      environment.ts
      errors.ts
      file-system.ts
      index.ts
      mutex.ts
      python.ts
      shell.ts
      web-scrapper.ts
    versions/
      index.ts
      versions-manager.ts
    voice/
      index.ts
      VoiceService.ts
    worktrees/
      index.ts
      worktree-manager.ts
    app.ts
    constants.ts
    events-handler.ts
    index.ts
    ipc-handlers.ts
    logger.ts
    managers.ts
    messages.ts
    paths.ts
    progress-window.ts
    start-up.ts
  mcp-server/
    aider-desk-mcp-server.ts
  preload/
    index.d.ts
    index.ts
  renderer/
    public/
      manifest.json
      sw.js
    src/
      api/
        browser-api.ts
      components/
        AgentSelector/
          AgentSelector.tsx
          index.ts
          McpServerSelectorItem.tsx
        bmad/
          BmadInstallPrompt.tsx
          BmadTaskActions.tsx
          BmadWelcomeSection.tsx
          BmadWorkflowPage.tsx
          PathInfoCard.tsx
          SuggestedWorkflowCard.tsx
          useBmadState.ts
          WorkflowActionButton.tsx
          WorkflowItem.tsx
          WorkflowList.tsx
          WorkflowPhaseSection.tsx
        common/
          DiffViewer/
            CompactDiffViewer.tsx
            DiffViewer.scss
            DiffViewer.tsx
            index.tsx
            UDiffViewer.tsx
            utils.ts
          Accordion.tsx
          BaseDialog.tsx
          Button.tsx
          Checkbox.tsx
          Chip.tsx
          CodeBlock.tsx
          CodeInline.tsx
          CompactSelect.tsx
          ConfirmDialog.tsx
          DatePicker.css
          DatePicker.tsx
          FileChip.tsx
          HtmlInfoDialog.tsx
          IconButton.tsx
          InfoIcon.tsx
          Input.tsx
          ItemSelector.tsx
          LoadingOverlay.tsx
          LoadingText.tsx
          MarkdownInfoDialog.tsx
          MermaidDiagram.tsx
          ModalOverlayLayout.tsx
          MultiSelect.tsx
          RadioButton.tsx
          Section.tsx
          Select.tsx
          Slider.tsx
          StyledTooltip.tsx
          Table.tsx
          TaskStateChip.tsx
          TextArea.tsx
          TriStateCheckbox.tsx
          VerticalDotsMenu.tsx
          VirtualTable.tsx
          WarningIcon.tsx
        ContextFiles/
          ContextFiles.css
          ContextFiles.tsx
          index.ts
          UpdatedFilesDiffModal.tsx
        message/
          ActivateSkillToolMessage.tsx
          AssistantMessageBlock.tsx
          BashToolMessage.tsx
          CommandOutputMessageBlock.tsx
          CompactToolMessage.tsx
          CopyMessageButton.tsx
          CreateTaskToolMessage.tsx
          CustomCommandBashBlock.tsx
          DeleteMemoryToolMessage.tsx
          DeleteTaskToolMessage.tsx
          ExpandableMessageBlock.tsx
          FetchToolMessage.tsx
          FileEditToolMessage.tsx
          FileReadToolMessage.tsx
          FileWriteToolMessage.tsx
          GetTaskMessageToolMessage.tsx
          GetTaskToolMessage.tsx
          GlobToolMessage.tsx
          GrepToolMessage.tsx
          GroupMessageBlock.tsx
          index.ts
          ListMemoriesToolMessage.tsx
          ListTasksToolMessage.tsx
          LoadingMessageBlock.tsx
          LogMessageBlock.tsx
          MessageActions.tsx
          MessageBar.tsx
          MessageBlock.tsx
          Messages.tsx
          ReflectedMessageBlock.tsx
          ResponseMessageBlock.tsx
          RetrieveMemoryToolMessage.tsx
          SearchParentTaskToolMessage.tsx
          SearchTaskToolMessage.tsx
          SemanticSearchToolMessage.tsx
          StoreMemoryToolMessage.tsx
          SubagentToolMessage.tsx
          TaskInfoMessage.tsx
          TaskStateActions.tsx
          ThinkingAnswerBlock.tsx
          ToolMessageBlock.tsx
          UpdateMemoryToolMessage.tsx
          UsageInfo.tsx
          UserMessageBlock.tsx
          utils.tsx
          VirtualizedMessages.tsx
        ModelLibrary/
          providers/
            AnthropicCompatibleParameters.tsx
            AnthropicParameters.tsx
            AzureAdvancedSettings.tsx
            AzureModelOverrides.tsx
            AzureParameters.tsx
            BedrockParameters.tsx
            CerebrasParameters.tsx
            ClaudeAgentSdkParameters.tsx
            DeepseekParameters.tsx
            DefaultModelOverrides.tsx
            EnableVoiceControl.tsx
            GeminiAdvancedSettings.tsx
            GeminiModelOverrides.tsx
            GeminiParameters.tsx
            GpustackParameters.tsx
            GroqParameters.tsx
            index.ts
            KimiPlanParameters.tsx
            LitellmParameters.tsx
            LmStudioParameters.tsx
            MinimaxParameters.tsx
            OllamaParameters.tsx
            OpenAiAdvancedSettings.tsx
            OpenAiCompatibleAdvancedSettings.tsx
            OpenAiCompatibleModelOverrides.tsx
            OpenAiCompatibleParameters.tsx
            OpenAiModelOverrides.tsx
            OpenAiParameters.tsx
            OpenCodeAdvancedSettings.tsx
            OpenCodeModelOverrides.tsx
            OpenCodeParameters.tsx
            OpenRouterAdvancedSettings.tsx
            OpenRouterModelOverrides.tsx
            OpenRouterParameters.tsx
            ProviderModels.tsx
            RequestyAdvancedSettings.tsx
            RequestyModelOverrides.tsx
            RequestyParameters.tsx
            SyntheticParameters.tsx
            useArrayField.ts
            VertexAiAdvancedSettings.tsx
            VertexAiModelOverrides.tsx
            VertexAIParameters.tsx
            ZaiPlanAdvancedSettings.tsx
            ZaiPlanModelOverrides.tsx
            ZaiPlanParameters.tsx
            ZaiPlanThinkingSetting.tsx
          DisableStreaming.tsx
          index.ts
          ModelDialog.tsx
          ModelLibrary.tsx
          ModelParameterOverrides.tsx
          ModelTableSection.tsx
          ProviderCard.tsx
          ProviderHeader.tsx
          ProviderProfileCard.tsx
          ProviderProfileDialog.tsx
          ProviderProfileForm.tsx
          ProviderSelection.tsx
        onboarding/
          OnboardingProviderSetup.tsx
          OnboardingStepper.tsx
        project/
          TaskSidebar/
            TaskItem.tsx
            TaskMenuButton.tsx
            TaskSidebar.tsx
            TaskSidebarMultiSelectMenu.tsx
            TaskStatusIcon.tsx
          AddFileDialog.tsx
          FileFinder.tsx
          FilesContextInfoContent.tsx
          MobileSidebar.tsx
          NoProjectsOpen.tsx
          OpenProjectDialog.tsx
          ProjectTabs.tsx
          ProjectView.tsx
          TaskBar.tsx
          TaskView.tsx
          TodoListItem.tsx
          TodoWindow.tsx
          useSidebarWidth.ts
          WelcomeMessage.tsx
          WorktreeActionDialog.tsx
          WorktreeMergeButton.tsx
          WorktreeRevertButton.tsx
          WorktreeStatusBadges.tsx
        PromptField/
          AudioAnalyzer.tsx
          AutoApprove.tsx
          CommandSuggestion.tsx
          EditFormatSelector.tsx
          index.ts
          InputHistoryMenu.tsx
          ModeSelector.tsx
          PromptField.tsx
          TaskWorkingMode.tsx
          usePromptFieldText.ts
        settings/
          agent/
            AgentProfileItem.tsx
            AgentRules.tsx
            AgentSettings.tsx
            BashToolItem.tsx
            GenericToolGroupItem.tsx
            GenericToolItem.tsx
            McpServerForm.tsx
            McpServerItem.tsx
            McpToolItem.tsx
            SortableAgentProfileItem.tsx
          AboutSettings.tsx
          AiderSettings.tsx
          GeneralSettings.tsx
          HotkeyConfig.tsx
          HotkeysSettings.tsx
          LanguageSelector.tsx
          MemorySettings.tsx
          ServerSettings.tsx
          SettingsDialog.tsx
          SettingsPage.tsx
          TaskSettings.tsx
          VoiceSettings.tsx
        terminal/
          Terminal.scss
          Terminal.tsx
          TerminalView.tsx
        ui/
          Tooltip.tsx
        usage/
          CostBreakdownChart.tsx
          MessageBreakdownChart.tsx
          ModelUsageDistributionChart.tsx
          TokenUsageTrendChart.tsx
          UsageDashboard.tsx
          UsageTable.tsx
          utils.ts
        AutocompletionInput.tsx
        CostInfo.tsx
        ModelSelector.tsx
        TelemetryInfoDialog.tsx
        TokenUsageBar.tsx
      constants/
        keyboardKeys.ts
      contexts/
        AgentsContext.tsx
        ApiContext.tsx
        ContextMenuContext.tsx
        ModelProviderContext.tsx
        ProjectSettingsContext.tsx
        SettingsContext.tsx
        TaskContext.tsx
      fonts/
        Enriqueta.ttf
        FunnelDisplay.ttf
        GoogleSansCode.ttf
        Inter.ttf
        JetBrainsMono.ttf
        Lora.ttf
        Nunito.ttf
        Orbitron.ttf
        PlayfairDisplay.ttf
        Poppins.ttf
        Quicksand.ttf
        RobotoMono.ttf
        Sansation.ttf
        Silkscreen.ttf
        Sono.ttf
        SourceCodePro.ttf
        SpaceGrotesk.ttf
        SpaceMono.ttf
        UbuntuMono.ttf
      hooks/
        useAudioRecorder.ts
        useBooleanState.ts
        useClickOutside.ts
        useConfiguredHotkeys.ts
        useCustomCommands.ts
        useDropdownState.ts
        useEffectiveEnvironmentVariable.ts
        useIndexedDB.ts
        useLmStudioModels.ts
        useOllamaModels.ts
        useOpenRouterModels.ts
        useOS.ts
        useParsedContent.ts
        useRequestyModels.ts
        useResponsive.ts
        useScrollingPaused.ts
        useSearchText.tsx
        useTaskActions.ts
        useTaskCommandHandlers.ts
        useTaskDataHandlers.ts
        useTaskLifecycleHandlers.ts
        useTaskLogHandlers.ts
        useTaskMessageHandlers.ts
        useTaskResponseHandlers.ts
        useTaskToolHandlers.ts
        useTypingAnimation.ts
        useUserMessageNavigation.tsx
        useVersions.ts
      i18n/
        index.ts
      icons/
        AnthropicCompatibleIcon.tsx
        AnthropicIcon.tsx
        AzureIcon.tsx
        BedrockIcon.tsx
        CerebrasIcon.tsx
        ClaudeAgentSdkIcon.tsx
        DeepseekIcon.tsx
        GeminiIcon.tsx
        gpustack.png
        GpustackIcon.tsx
        GroqIcon.tsx
        index.ts
        KimiPlanIcon.tsx
        LitellmIcon.tsx
        LmStudioIcon.tsx
        MinimaxIcon.tsx
        OllamaIcon.tsx
        OpenAiCompatibleIcon.tsx
        OpenAiIcon.tsx
        OpenCodeIcon.tsx
        OpenRouterIcon.tsx
        requesty.png
        RequestyIcon.tsx
        SyntheticIcon.tsx
        VertexAiIcon.tsx
        ZaiPlanIcon.tsx
      pages/
        Home.tsx
        Onboarding.tsx
        Settings.tsx
      stores/
        projectStore.ts
        taskStore.ts
      themes/
        theme-aurora.scss
        theme-botanical-garden-dark.scss
        theme-botanical-garden.scss
        theme-bw.scss
        theme-cappuccino.scss
        theme-charcoal.scss
        theme-dark.scss
        theme-forest.scss
        theme-fresh.scss
        theme-lavender.scss
        theme-light.scss
        theme-midnight.scss
        theme-neon.scss
        theme-neopunk.scss
        theme-ocean.scss
        theme-serenity.scss
        themes.scss
      types/
        message.ts
      utils/
        agents.ts
        bmad-suggestions.ts
        browser-notifications.ts
        highlighter.tsx
        hotkeys.ts
        indexedDB.ts
        notifications.ts
        path-utils.ts
        routes.ts
        string-utils.ts
        task-utils.ts
      voice/
        gemini.ts
        index.ts
        openai.ts
        types.ts
      App.tsx
      env.d.ts
      fonts.css
      main.css
      main.tsx
    favicon.ico
    index.html
    progress.html
electron-builder.yml
electron.vite.config.ts
package.json
tailwind.config.js

================================================================
Files
================================================================

================
File: resources/connector/connector.py
================
#!/usr/bin/env python
⋮----
class PromptContext
⋮----
def __init__(self, id: str, group=None, auto_approve=False, deny_commands=False)
⋮----
confirmation_result = None
⋮----
def update_model_params(models_info, model)
⋮----
model_id = model.name
⋮----
info = models_info[model_id]
max_input_tokens = info.get("maxInputTokens")
⋮----
# skip models that don't have maxInputTokens defined
⋮----
model_info = {
⋮----
max_input_tokens = model.info.get('max_input_tokens') if model.info else None
⋮----
max_output_tokens = model.info.get('max_output_tokens') if model.info else None
⋮----
temperature = info.get('temperature')
⋮----
def wait_for_async(connector, coroutine)
⋮----
# Called from the main thread
task = connector.loop.create_task(coroutine)
result = connector.loop.run_until_complete(task)
⋮----
# Called from another thread
future = asyncio.run_coroutine_threadsafe(coroutine, connector.loop)
result = future.result()
⋮----
class PromptExecutor
⋮----
"""Manages prompt execution as concurrent asyncio tasks."""
⋮----
def __init__(self, connector)
⋮----
def get_executor(self)
⋮----
# create a new executor with 100 workers for 100 concurrent prompts
⋮----
async def run_prompt(self, prompt: str, prompt_context: PromptContext, mode=None, architect_model=None, messages=None, files=None, coder=None)
⋮----
prompt_coro = self._run_prompt_task(prompt, prompt_context, mode, architect_model, messages, files, coder)
⋮----
# Submit the coroutine to the executor, which turns it into a background Task.
# If a prompt with the same ID is already running, cancel it first.
⋮----
# Wrap the coroutine in a task that will handle its own cleanup.
task = self.connector.loop.create_task(self._execute_prompt_wrapper(prompt_context, prompt_coro))
⋮----
# This new method contains the logic that used to be in _run_prompt_sync and _run_prompt_async
async def _run_prompt_task(self, prompt: str, prompt_context: PromptContext, mode=None, architect_model=None, messages=None, files=None, coder=None)
⋮----
"""The actual prompt execution logic, designed to be run as a task."""
⋮----
# The core async logic from your old `_run_prompt_async`
# Now you can directly await async functions without any special handling.
⋮----
# This is important! The task must be allowed to handle its own cancellation.
⋮----
# Propagate the cancellation to ensure the wrapper knows about it.
⋮----
async def _stream_and_send_responses(self, coder, prompt_context, prompt_to_run, log_context, extra_response_data=None)
⋮----
extra_response_data = {}
⋮----
whole_content = ""
response_id = str(uuid.uuid4())
⋮----
queue = asyncio.Queue()
executor = self.get_executor()
⋮----
def _sync_worker()
⋮----
# Put chunk into queue, handling potential queue full
fut = asyncio.run_coroutine_threadsafe(queue.put(chunk), self.connector.loop)
fut.result() # Wait for it to be put in queue
asyncio.run_coroutine_threadsafe(queue.put(None), self.connector.loop).result() # Sentinel for end
⋮----
future = self.connector.loop.run_in_executor(executor, _sync_worker)
⋮----
chunk = await queue.get()
⋮----
response_payload = {
⋮----
async def _run_prompt_async(self, prompt: str, prompt_context: PromptContext, mode=None, architect_model=None, messages=None, files=None, coder=None)
⋮----
coder_provided = coder is not None
sequence_number = 0
⋮----
coder_model = self.connector.coder.main_model
running_model = self.connector.coder.main_model
⋮----
running_model = models.Model(architect_model, weak_model=coder_model.weak_model.name, editor_model=coder_model.name)
⋮----
# check if we have temperature info for the architect model
⋮----
sequence_number = -1
⋮----
coder = clone_coder(
⋮----
# we are sending all the additional messages after the prompt finishes
⋮----
# we need to disable auto accept as this does not work properly with AiderDesk
⋮----
# setting usage report to None to avoid no attribute error
⋮----
# if there was no content, use the partial_response_content value (case for non streaming models)
whole_content = coder.partial_response_content
⋮----
def get_usage_report()
⋮----
# Send final response with complete data
response_data = {
⋮----
# Add commit info if there was one
⋮----
# Add diff if there was a commit
commits = f"{coder.last_aider_commit_hash}~1"
⋮----
diff = coder.repo.diff_commits(
⋮----
# Check for reflections
⋮----
# send newly added context files
⋮----
current_reflection = 0
⋮----
reflection_prompt = coder.reflected_message
⋮----
# await self.connector.send_update_context_files()
⋮----
# Send prompt-finished message
⋮----
# Send command outputs as context messages
⋮----
async def _execute_prompt_wrapper(self, prompt_context: PromptContext, prompt_coro: Coroutine[Any, Any, Any])
⋮----
"""
    Wrapper that executes the prompt coroutine and handles completion or cancellation.
    """
prompt_id = prompt_context.id
⋮----
# The main logic is now simply awaiting the coroutine
⋮----
# This is the clean way to handle cancellation.
⋮----
# You could add more specific cleanup logic here if needed.
⋮----
# Potentially re-raise or handle as needed
⋮----
# Always clean up the task from the active prompts dict.
⋮----
def _cleanup_prompt(self, prompt_id: str)
⋮----
"""Clean up completed or cancelled prompt."""
⋮----
def get_coder(self, prompt_id: str) -> Optional[Coder]
⋮----
"""Retrieve the coder instance for a given prompt ID."""
⋮----
async def cancel_prompt(self, prompt_id: str) -> bool
⋮----
"""Cancel a specific prompt task."""
⋮----
# Cancel the executor future if it exists
⋮----
future = self.active_futures[prompt_id]
⋮----
# Set the coder's IO to cancelled if it exists
⋮----
coder = self.active_coders[prompt_id]
⋮----
task = self.active_prompts[prompt_id]
⋮----
# The cancel() method schedules the task to be cancelled.
# It will raise CancelledError at the next `await`.
⋮----
# You can optionally wait for it to be fully cancelled.
⋮----
pass # Expected
⋮----
async def interrupt_all_prompts(self)
⋮----
"""Interrupt all active prompts."""
# Create a copy of keys to avoid issues with modifying the dict while iterating
prompt_ids = list(self.active_prompts.keys())
⋮----
def is_prompt_interrupted(self, prompt_id: str) -> bool
⋮----
"""Check if a prompt task has been cancelled."""
⋮----
# If it's not in active_prompts, it's finished or was cancelled.
⋮----
async def shutdown(self)
⋮----
"""Shutdown the executor by cancelling all active tasks."""
⋮----
async def run_editor_coder_stream(architect_coder, connector, prompt_context)
⋮----
# Use the editor_model from the main_model if it exists, otherwise use the main_model itself
editor_model = architect_coder.main_model.editor_model or architect_coder.main_model
# Generate a prompt info for the editor coder
editor_prompt_context = PromptContext(str(uuid.uuid4()), prompt_context.group)
⋮----
editor_coder = clone_coder(
⋮----
# Start the prompt execution (non-blocking)
⋮----
# Wait for completion by awaiting the task
⋮----
task = connector.prompt_executor.active_prompts[editor_prompt_context.id]
⋮----
pass # The task was cancelled, which is an expected way for it to end.
⋮----
class ConnectorInputOutput(InputOutput)
⋮----
def __init__(self, connector=None, prompt_context=None, **kwargs)
⋮----
def add_to_input_history(self, input_text)
⋮----
# handled by AiderDesk
⋮----
def tool_output(self, *messages, log_only=False, bold=False)
⋮----
# Extract current command from "Running" messages
⋮----
async def send_use_command_output()
⋮----
def is_warning_ignored(self, message)
⋮----
def tool_warning(self, message="", strip=True)
⋮----
def is_error_ignored(self, message)
⋮----
def tool_error(self, message="", strip=True)
⋮----
result = None
⋮----
result = "y"
⋮----
result = "n"
⋮----
# Reset the result
⋮----
# Create coroutine for emitting the question
async def ask_question()
⋮----
# we are handling this in AiderDesk differently
⋮----
result = wait_for_async(self.connector, ask_question())
⋮----
# Get the specific coder for this prompt
coder_for_prompt = self.connector.prompt_executor.get_coder(self.prompt_context.id) if self.prompt_context else None
if coder_for_prompt: # Ensure we have a valid coder
# Process architect coder
⋮----
def reset_state(self, add_command_to_context=None)
⋮----
def interrupt_input(self)
⋮----
async def process_changes()
⋮----
lock_file_path = Path(self.connector.base_dir) / '.aider-desk' / 'watch-files.lock'
lock_file = None
⋮----
# Create lock file directory if it doesn't exist
⋮----
# Try to acquire lock file
lock_file = open(lock_file_path, 'w')
⋮----
# Try to acquire exclusive lock (non-blocking)
⋮----
# Successfully acquired lock, proceed with processing
⋮----
task = self.connector.prompt_executor.active_prompts[prompt_context.id]
⋮----
# Lock is held by another process, skip processing
⋮----
# Explicitly close the lock file to release the lock
⋮----
prompt = self.connector.file_watcher.process_changes()
⋮----
changed_files = ", ".join(sorted(self.connector.file_watcher.changed_files))
group = {
prompt_context = PromptContext(str(uuid.uuid4()), group)
⋮----
def clone_coder(connector, coder, prompt_context=None, messages=None, files=None, **kwargs)
⋮----
coder = Coder.create(**kwargs)
⋮----
# Set messages from the provided data
⋮----
# Set files from the provided data
⋮----
file_path = file['path']
⋮----
file_path = os.path.join(connector.task_dir, file_path)
⋮----
def create_base_coder(connector)
⋮----
coder = cli_main(return_coder=True)
⋮----
def create_io(connector, coder, prompt_context=None)
⋮----
io = ConnectorInputOutput(
⋮----
class Connector
⋮----
def __init__(self, base_dir, task_id, task_dir, watch_files=False, server_url="http://localhost:24337", reasoning_effort=None, thinking_tokens=None, confirm_before_edit=False)
⋮----
# Create initial coder for setup and non-prompt operations
⋮----
# Initialize prompt executor
⋮----
ignores = []
⋮----
def monkey_patch_coder_functions(self, coder, prompt_context=None)
⋮----
# self here is the Connector instance
# coder is the Coder instance
⋮----
original_lint_edited = coder.lint_edited
def _patched_lint_edited(coder_instance, fnames)
⋮----
# Add loading message before linting
⋮----
# Call the original Coder.lint_edited logic
result = original_lint_edited(fnames)
# Finish the loading message after linting
⋮----
# Replace the original lint_edited method with the patched version
⋮----
# Monkey patch prepare_to_edit to add confirmation if enabled
original_prepare_to_edit = coder.prepare_to_edit
def _patched_prepare_to_edit(coder_instance, edits)
⋮----
# Replace the original prepare_to_edit method with the patched version
⋮----
original_cmd_test = coder.commands.cmd_test
def _patched_cmd_test(coder_commands_instance, args)
⋮----
# coder_commands_instance is the Commands instance (coder.commands)
⋮----
result = original_cmd_test(args)
⋮----
# Replace the original run_test method with the patched version
⋮----
# Initialize command_outputs list if it doesn't exist
⋮----
original_run_shell_commands = coder.run_shell_commands
def _patched_run_shell_commands(coder_instance)
⋮----
# Call the original run_shell_commands method
result = original_run_shell_commands()
# Store the result in command_outputs list
⋮----
# Replace the original run_shell_commands method with the patched version
⋮----
def monkey_patch_repo_functions(self, repo, prompt_context=None)
⋮----
# patch repo.get_commit_message to send a loading message while generating commit message
original_get_commit_message = repo.get_commit_message
⋮----
def _patched_get_commit_message(repo_instance, diffs, context, user_language=None)
⋮----
result = original_get_commit_message(diffs, context, user_language)
⋮----
def register_events(self)
⋮----
@self.sio.event
    async def connect()
⋮----
@self.sio.on("message")
    async def on_message(data)
⋮----
@self.sio.event
    async def disconnect()
⋮----
@self.sio.event
    async def connect_error(error)
⋮----
async def on_connect(self)
⋮----
"""Handle connection event."""
⋮----
def _tokenize_files_sync(self, root, rel_fnames, addable_rel_fnames, encoding, abs_read_only_fnames)
⋮----
"""Synchronous helper function for file tokenization."""
⋮----
auto_completer = AutoCompleter(
⋮----
# Return tokenized words
⋮----
async def on_message(self, data)
⋮----
async def on_disconnect(self)
⋮----
"""Handle disconnection event."""
⋮----
# Shutdown prompt executor
⋮----
async def connect(self)
⋮----
"""Connect to the server with retry logic."""
max_retries = 10
base_delay = 0.5  # Initial delay in seconds
max_delay = 5.0   # Maximum delay in seconds
⋮----
return  # Connection successful
⋮----
# Last attempt failed, re-raise the exception
⋮----
# Calculate delay with exponential backoff
delay = min(base_delay * (2 ** attempt), max_delay)
⋮----
async def wait(self)
⋮----
"""Wait for events."""
⋮----
async def start(self)
⋮----
async def send_action(self, action, with_delay = True)
⋮----
async def send_log_message(self, level, message, finished=False, prompt_context=None)
⋮----
payload = {
⋮----
async def process_message(self, message)
⋮----
"""Process incoming message and return response"""
⋮----
action = message.get('action')
⋮----
prompt = message.get('prompt')
mode = message.get('mode')
architect_model = message.get('architectModel')
prompt_context_data = message.get('promptContext')
messages = message.get('messages', [])
files = message.get('files', [])
options = message.get('options', {})
⋮----
# Log the options with default values
auto_approve = options.get('autoApprove', False)
deny_commands = options.get('denyCommands', False)
⋮----
prompt_context = PromptContext(prompt_context_data.get('id'), prompt_context_data.get('group'), auto_approve, deny_commands)
⋮----
confirmation_result = message.get('answer')
⋮----
main_model = message.get('mainModel')
weak_model = message.get('weakModel')
edit_format = message.get('editFormat')
environment_variables = message.get('environmentVariables')
⋮----
model = models.Model(main_model, weak_model=weak_model)
⋮----
edit_format = "diff"
⋮----
command = message.get('command')
⋮----
# Interrupt all active prompts
⋮----
edits = message.get('edits')
⋮----
edit_tuples = [(edit['path'], edit['original'], edit['updated']) for edit in edits]
⋮----
main_model = models.Model(self.coder.main_model.name, weak_model=self.coder.main_model.weak_model.name)
⋮----
models_info = message.get('modelsInfo')
⋮----
messages = message.get('messages')
files = message.get('files')
⋮----
async def update_environment_variables(self, environment_variables)
⋮----
"""Update environment variables for the Aider process"""
⋮----
# Update the environment variables in the current process
⋮----
async def run_command(self, command, messages, files)
⋮----
command_coder = clone_coder(self, self.coder, messages=messages, files=files)
⋮----
repo_map = command_coder.repo_map.get_repo_map(set(), command_coder.get_all_abs_files()) if command_coder.repo_map else None
⋮----
parts = command.split()
valid_values = ['high', 'medium', 'low', 'minimal', 'none']
⋮----
# Safely remove 'reasoning_effort' if it exists
⋮----
# for /reset and /drop, we only need to send the initial context files
⋮----
# run the command
⋮----
# reset flags
⋮----
async def send_autocompletion(self, files)
⋮----
# Use all files from files parameter and convert to relative paths
rel_fnames = []
⋮----
file_path = f['path']
# Convert to relative path if it's an absolute path
⋮----
relative_path = os.path.relpath(file_path, self.task_dir)
⋮----
relative_path = os.path.relpath(file_path, self.base_dir)
⋮----
relative_path = file_path
⋮----
# Run tokenization in a separate thread
⋮----
# Cancel any previous tokenization task if it's still running
⋮----
async def tokenize_and_send()
⋮----
tokenized_words = await asyncio.to_thread(
⋮----
# Task was cancelled, do nothing.
⋮----
# else: The initial message with just filenames is sufficient if too many files
⋮----
async def send_repo_map(self)
⋮----
repo_map = self.coder.repo_map.get_repo_map(set(), self.coder.get_all_abs_files())
⋮----
# Remove the prefix before sending
prefix = self.coder.gpt_prompts.repo_content_prefix
⋮----
repo_map = repo_map[len(prefix):]
⋮----
def get_context_files(self, coder=None)
⋮----
coder = self.coder
⋮----
def get_rel_fname(fname)
⋮----
editable_files = [get_rel_fname(fname) for fname in coder.abs_fnames]
read_only_files = [get_rel_fname(fname) for fname in coder.abs_read_only_fnames]
⋮----
async def send_add_context_message(self, role, content)
⋮----
async def send_add_context_files(self, coder=None)
⋮----
context_files = self.get_context_files(coder)
⋮----
async def send_update_context_files(self, coder=None)
⋮----
async def send_current_models(self)
⋮----
error = None
info = self.coder.main_model.info
⋮----
error = "Missing keys for the model: " + ", ".join(self.coder.main_model.missing_keys)
⋮----
async def send_tokens_info(self, messages, files)
⋮----
cost_per_token = self.coder.main_model.info.get("input_cost_per_token") or 0
info = {
⋮----
# system messages
main_sys = self.coder.fmt_system_prompt(self.coder.gpt_prompts.main_system)
⋮----
msgs = [
tokens = self.coder.main_model.token_count(msgs)
⋮----
# Convert messages to the format expected by token_count
msgs = [dict(role=msg['role'], content=msg['content']) for msg in messages]
⋮----
tokens = 0
⋮----
# Convert context_files to absolute file paths like coder does
abs_fnames = set()
abs_read_only_fnames = set()
⋮----
file_path = os.path.join(self.task_dir, file_path)
⋮----
all_abs_files = self.coder.get_all_abs_files()
other_files = set(all_abs_files) - abs_fnames
⋮----
repo_content = self.coder.repo_map.get_repo_map(abs_fnames, other_files)
⋮----
tokens = self.coder.main_model.token_count(repo_content)
⋮----
fence = "`" * 3
⋮----
# Process the provided context files
⋮----
# Skip directories
⋮----
relative_fname = self.coder.get_rel_fname(file_path)
content = self.coder.io.read_text(file_path)
⋮----
tokens = self.coder.main_model.token_count_for_image(file_path)
⋮----
# approximate
content = f"{relative_fname}\n{fence}\n" + content + "{fence}\n"
tokens = self.coder.main_model.token_count(content)
⋮----
async def handle_models_info_update(self, models_info)
⋮----
"""Handle models info update event"""
⋮----
def main(argv=None)
⋮----
argv = sys.argv[1:]
⋮----
# Parse command line arguments
parser = argparse.ArgumentParser(description="AiderDesk Connector")
⋮----
args, _ = parser.parse_known_args(argv) # Use parse_known_args to ignore unknown args
⋮----
# Get environment variables
server_url = os.getenv("CONNECTOR_SERVER_URL", "http://localhost:24337")
base_dir = os.getenv("BASE_DIR", os.getcwd())
task_id = os.getenv("TASK_ID", "default")
task_dir = os.getenv("TASK_DIR", os.getcwd())
confirm_before_edit = os.getenv("CONNECTOR_CONFIRM_BEFORE_EDIT", "0") == "1"
⋮----
# Telemetry
⋮----
# Create connector instance
connector = Connector(
⋮----
# Start the connector
⋮----
def setup_telemetry()
⋮----
langfuse_public_key = os.getenv("LANGFUSE_PUBLIC_KEY")
langfuse_secret_key = os.getenv("LANGFUSE_SECRET_KEY")
langfuse_host = os.getenv("LANGFUSE_HOST", "https://cloud.langfuse.com")
⋮----
# Set OpenRouter site and app name

================
File: scripts/before-pack.js
================
// Copy all files from source directory to target directory
⋮----
// Copy all files from source directory to target directory

================
File: scripts/download-probe.mjs
================
async function downloadAndExtractProbeForPlatform(target)
⋮----
// Ensure the specific platform directory exists
⋮----
// Check if probe already exists for this platform
⋮----
strip: 0 // Do not strip any components from the file path initially
⋮----
// The probe executable might be inside a directory like probe-v0.6.0-rc128-x86_64-unknown-linux-gnu/probe-binary
⋮----
// Clean up the extracted directory
⋮----
// If not found in extractedDir, check the top level (for older releases or different structures)
⋮----
zip.extractAllTo(extractPath, true); // Overwrite existing files
⋮----
// Clean up the extracted directory
⋮----
// Do not exit on error for one platform, try others.
⋮----
// Clean up the temporary archive file
⋮----
async function downloadAllProbes()
⋮----
// Ensure the base resources directory exists
⋮----
// After downloading all, copy the correct one for the current platform if it's macOS or Linux

================
File: scripts/download-uv.mjs
================
async function downloadAndExtractUVForPlatform(target)
⋮----
// Ensure the specific platform directory exists
⋮----
// Check if uv already exists for this platform
⋮----
strip: 0 // Do not strip any components from the file path initially
⋮----
// The uv executable might be inside a directory like uv-x86_64-unknown-linux-gnu/uv
⋮----
// Clean up the extracted directory
⋮----
// If not found in extractedDir, check the top level (for older releases or different structures)
⋮----
zip.extractAllTo(extractPath, true); // Overwrite existing files
⋮----
// Do not exit on error for one platform, try others.
⋮----
// Clean up the temporary archive file
⋮----
async function downloadAllUVs()
⋮----
// Ensure the base resources directory exists
⋮----
// After downloading all, copy the correct one for the current platform if it's macOS or Linux

================
File: src/common/locales/en.json
================
{
  "languages": {
    "en": "English",
    "zh": "中文"
  },
  "common": {
    "settings": "Settings",
    "cancel": "Cancel",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit",
    "add": "Add",
    "remove": "Remove",
    "close": "Close",
    "confirm": "Confirm",
    "back": "Back",
    "next": "Next",
    "previous": "Previous",
    "of": "of",
    "finish": "Finish",
    "loading": "Loading...",
    "startingUp": "Starting up...",
    "loadingProjectSettings": "Loading project settings...",
    "loadingProject": "Loading project...",
    "loadingTask": "Loading task...",
    "loadingMessages": "Loading messages...",
    "error": "Error",
    "success": "Success",
    "warning": "Warning",
    "info": "Info",
    "yes": "Yes",
    "no": "No",
    "retry": "Retry",
    "open": "Open",
    "openProject": "Open Project",
    "lock": "Lock",
    "default": "Default",
    "suffix.billion": "B",
    "suffix.million": "M",
    "suffix.thousand": "K",
    "ok": "OK",
    "collapse": "Collapse",
    "expand": "Expand",
    "enabled": "Enabled",
    "noFiles": "No files",
    "clickToRefresh": "Click to refresh",
    "closeTasks": "Close Tasks",
    "toggleTasks": "Toggle Tasks"
  },
  "search": {
    "placeholder": "Search...",
    "previousResult": "Previous result (SHIFT + F3)",
    "nextResult": "Next result (F3)"
  },
  "onboarding": {
    "title": "Welcome to AiderDesk",
    "description": "AiderDesk is your desktop companion for AI-assisted coding. This application brings the power of Aider's AI coding assistant to a user-friendly interface, helping you:",
    "skipForNow": "Skip for now",
    "finish": "Finish Setup",
    "features": {
      "1": "Manage multiple coding projects",
      "2": "Track your AI usage and costs",
      "3": "Interact with AI models in a structured way",
      "4": "Visualize and manage your code files",
      "5": "Use agentic flow for automated coding tasks and connection to MCP servers"
    },
    "getStarted": "Let's get started by configuring your Aider settings.",
    "steps": {
      "welcome": "Welcome",
      "connectModel": "Connect AI Model",
      "language": "Language",
      "aider": "Aider",
      "agent": "AI Agent",
      "providers": "Providers",
      "finish": "Finish"
    },
    "language": {
      "title": "Choose Your Language",
      "description": "Select your preferred language for the application interface."
    },
    "aider": {
      "title": "Configure Aider",
      "description": "To get started, please configure your Aider settings. You'll need to:",
      "options": {
        "1": "Add your API keys for the LLM provider you want to use",
        "2": "Set any additional options for Aider",
        "3": ".env and .aider.conf.yaml are also read as they would with Aider"
      },
      "configureLater": "You can also do that later in the Settings.",
      "fineTuneTitle": "Fine-Tune Aider (Optional)",
      "fineTuneDescription": "Advanced users can configure additional Aider settings and environment variables. This step is completely optional and can be safely skipped.",
      "fineTuneNote": "Note: These settings are for advanced users who want to customize Aider's behavior. Most users can skip this step and configure these later in Settings if needed."
    },
    "providers": {
      "title": "Model Providers",
      "description": "Configure your LLM providers for use with both Aider and Agent modes. You can set up API keys and additional settings for various providers.",
      "configureLater": "You can configure these later in the Settings if you prefer.",
      "connectTitle": "Connect Your AI Model",
      "connectDescription": "AiderDesk supports multiple AI providers including OpenAI, Anthropic, Google Gemini, and more. Your API keys are stored securely on your local machine and never shared.",
      "advancedUsersNote": "Advanced users: You can also configure providers using environment variables in the next step's Aider configuration section.",
      "advancedSettings": "Advanced settings",
      "order": "Order",
      "orderDescription": "List of provider slugs to try in order (e.g. [\"anthropic\", \"openai\"]).",
      "allowFallbacks": "Allow Fallbacks",
      "allowFallbacksDescription": "Whether to allow backup providers when the primary is unavailable.",
      "dataCollection": "Data Collection",
      "dataCollectionDescription": "Control whether to use providers that may store data.",
      "only": "Only",
      "onlyDescription": "List of provider slugs to allow.",
      "ignore": "Ignore",
      "ignoreDescription": "List of provider slugs to skip.",
      "quantizations": "Quantizations",
      "quantizationsDescription": "List of quantization levels to filter by (e.g. [\"int4\", \"int8\"]).",
      "sort": "Sort",
      "sortDescription": "Sort providers by price or throughput.",
      "requireParameters": "Require Parameters",
      "requireParametersDescription": "Only use providers that support all parameters in your request.",
      "setupLater": "You can also configure the providers and models in Model Library later."
    },
    "agent": {
      "title": "Meet Your AI Agent",
      "description": "Discover the power of autonomous AI assistance with AiderDesk's Agent mode. Your AI agent can work independently to complete complex tasks.",
      "capabilities": "Agent Capabilities:",
      "autonomousPlanning": "Autonomous Task Planning:",
      "autonomousPlanningDesc": "Breaks down complex requests into manageable steps and executes them systematically.",
      "toolUse": "Tool Use:",
      "toolUseDesc": "Leverages various tools for file operations, web searches, and code analysis.",
      "extensible": "Extensible via MCP:",
      "extensibleDesc": "Connect to Model Context Protocol servers for enhanced capabilities.",
      "configureAgent": "Configure Agent",
      "finishLater": "Finish Setup (Configure Agent Later)",
      "configureTitle": "Configure Your Agent (Optional)",
      "configureDescription": "Customize your default agent profile to match your workflow. You can adjust settings like tool permissions, context preferences, and behavior rules."
    },
    "complete": {
      "title": "Setup Complete!",
      "description": "Congratulations! You've successfully set up AiderDesk. You're now ready to start coding with AI assistance.",
      "ready": "Click 'Finish Setup' to begin your coding journey.",
      "success": "Onboarding completed successfully! Welcome to AiderDesk."
    },
    "errors": {
      "navigationFailed": "Navigation failed. Please try again.",
      "finishFailed": "Failed to complete onboarding. Please try again."
    }
  },
  "noProjectsOpen": {
    "welcome": "Welcome to",
    "description": "To begin, open a project directory. This will enable Aider to work with your code."
  },
  "home": {
    "title": "Home",
    "noProjectsOpen": "No Projects Open",
    "openProject": "Open Project",
    "addFile": "Add File",
    "projectView": "Project View",
    "recentProjects": "Recent projects"
  },
  "tips": {
    "multipleProjects": "Tip: You can open multiple projects and switch between them using the tabs at the top (or CTRL+Tab)."
  },
  "mcpServer": {
    "addServer": "Add MCP Server",
    "editServer": "Edit MCP Server: {{name}}",
    "serverConfigJson": "Server Config JSON",
    "pasteServerAs": "Paste your server as:\n\n{{example}}\n\nor\n\n{{exampleNoParent}}\n\nor\n\n{{exampleBare}}",
    "invalidConfig": "Invalid configuration",
    "emptyConfig": "Configuration cannot be empty",
    "configHint": "You can add multiple servers at once by pasting a JSON object with multiple server configurations.\n\nYou can use ${projectDir} in env and args to reference the current project directory.",
    "viewExamples": "View Examples"
  },
  "model": {
    "label": "Model",
    "labelMultiple": "Models",
    "selectLabel": "Model",
    "placeholder": "e.g. anthropic/claude-sonnet-4-20250514",
    "chooseModelsToAdd": "Choose models to add...",
    "library": {
      "all": "All",
      "deleteMemoryTitle": "Delete Memory",
      "deleteMemoryDialogText": "Are you sure you want to delete this memory?"
    }
  },
  "modelLibrary": {
    "enableVoiceControl": "Enable Voice Control",
    "enableVoiceControlOnlyOneInfo": "Only one provider can be enabled at a time.",
    "voiceControl": "Voice control",
    "voiceControlDescription": "Use speech-to-text to dictate your prompts directly into the chat input.",
    "voiceEnabled": "Voice interaction enabled",
    "title": "Model Library",
    "selectAll": "Select All",
    "clearSelection": "Clear Selection",
    "hideSelected": "Hide Selected",
    "unhideSelected": "Unhide Selected",
    "selectedCount": "{{count}} selected",
    "bulkActions": "Actions",
    "search": "Search Models",
    "providers": "Providers",
    "all": "All",
    "refresh": "Refresh",
    "selectProvider": "Select a Provider to Configure",
    "editProvider": "Edit Provider",
    "profileForm": {
      "title": "Configure Profile for {{provider}} Provider",
      "name": "Profile Name",
      "id": "Provider ID (prefix)",
      "parameters": "Provider Parameters",
      "headers": "Custom Headers",
      "headerKey": "Header Name",
      "headerValue": "Header Value",
      "addHeader": "Add Header",
      "test": "Test & Load Models"
    },
    "noProvidersConfigured": "No providers configured yet",
    "addProvider": "Add Provider",
    "addFirstProvider": "Add Your First Provider",
    "searchPlaceholder": "Search models...",
    "showingAllModels": "Showing {{count}} models from all providers",
    "showingModelsFromProviders": "Showing {{modelCount}} models from {{providerCount}} providers",
    "noModelsMatchSearch": "No models match your search",
    "selectProvidersToViewModels": "Select provider profiles above to view their models",
    "noModelsFromSelectedProviders": "No models available from selected providers",
    "hidden": "Hidden",
    "showModel": "Show model",
    "hideModel": "Hide model",
    "showHidden": "Show hidden",
    "deleteProfileTitle": "Delete Profile",
    "deleteProfileConfirm": "Are you sure you want to delete the profile '{{name}}'?",
    "addModel": "Add Model",
    "editModel": "Edit Model",
    "provider": "Provider",
    "modelId": "Model ID",
    "modelIdPlaceholder": "e.g. custom-gpt-4-turbo",
    "maxInputTokens": "Context Window",
    "maxOutputTokens": "Max Output Tokens",
    "limit": "Limit",
    "temperature": "Temperature",
    "temperatureTooltip": "Controls the randomness of model responses. Lower values (0.0-0.3) produce more focused and deterministic outputs, while higher values (0.7-1.0) generate more creative and varied responses.",
    "cacheWrites": "Cache Writes",
    "cachedInput": "Cached Input",
    "inputCost": "Input",
    "outputCost": "Output",
    "inputTokenCost": "Input Cost per 1M Tokens",
    "outputTokenCost": "Output Cost per 1M Tokens",
    "cacheReadInputTokenCost": "Cache Read Cost per 1M Tokens",
    "cacheWriteInputTokenCost": "Cache Write Cost per 1M Tokens",
    "supportsTools": "Supports Tools",
    "errors": {
      "idRequired": "Model ID is required",
      "providerRequired": "Provider is required",
      "invalidTokenCount": "Token count must be a positive number",
      "invalidCost": "Cost must be a non-negative number",
      "invalidTemperature": "Temperature must be between 0 and 2",
      "duplicateId": "Provider ID already exists"
    },
    "claudeAgentSdkAuthRequired": "This provider requires Claude Code CLI installation and authentication. Install from https://claude.com/product/claude-code and run `claude login` to authenticate.",
    "claudeAgentSdkAgentOnly": "This provider only works in Agent mode and is not supported in Code/Ask/Architect/Context modes.",
    "overrides": {
      "title": "Provider Overrides",
      "resetToDefaults": "Clear overrides",
      "overridesProviderParameters": "Overrides some provider parameters"
    },
    "disableStreaming": "Disable streaming",
    "disableStreamingInfo": "Disables response streaming. Use this when the provider or model does not support streaming responses.",
    "disable": "Disable",
    "enable": "Enable",
    "providerDisabled": "This provider is disabled. Its models will not be available."
  },
  "openai": {
    "apiKey": "API Key",
    "baseUrl": "Base URL",
    "modelName": "Model Name",
    "baseUrlPlaceholder": "e.g. http://localhost:8080/v1",
    "useWebSearch": "Use Web Search",
    "useWebSearchTooltip": "When enabled, the model will use OpenAI's web search tool to access current information from the internet."
  },
  "ollama": {
    "baseUrl": "Base URL",
    "baseUrlPlaceholder": "e.g. http://localhost:11434/api"
  },
  "anthropic": {
    "apiKey": "API Key",
    "baseUrl": "Base URL",
    "baseUrlPlaceholder": "e.g. https://api.anthropic.com"
  },
  "minimax": {
    "apiKey": "API Key"
  },
  "gemini": {
    "apiKey": "API Key",
    "customBaseUrl": "Custom Base URL",
    "thinkingBudget": "Thinking budget (tokens)",
    "includeThoughts": "Include thoughts",
    "includeThoughtsTooltip": "When enabled, the model's internal thought process will be included in the conversation.",
    "useSearchGrounding": "Use Search grounding",
    "useSearchGroundingTooltip": "When enabled, the model will use search results to ground its responses, improving accuracy and relevance."
  },
  "groq": {
    "apiKey": "API Key",
    "modelPlaceholder": "e.g. moonshotai/kimi-k2-instruct"
  },
  "kimiPlan": {
    "apiKey": "API Key"
  },
  "deepseek": {
    "apiKey": "API Key"
  },
  "bedrock": {
    "apiKey": "API Key",
    "region": "Region",
    "regionPlaceholder": "e.g. us-east-1 or AWS_REGION env",
    "accessKeyId": "Access Key ID",
    "accessKeyIdTooltip": "AWS access key ID. Can be left empty if AWS_PROFILE is set in environment.",
    "secretAccessKey": "Secret Access Key",
    "secretAccessKeyTooltip": "AWS secret access key. Can be left empty if AWS_PROFILE is set in environment.",
    "sessionToken": "Session Token",
    "sessionTokenTooltip": "Optional session token for temporary credentials."
  },
  "cerebras": {
    "apiKey": "API Key"
  },
  "openRouter": {
    "apiKey": "API Key",
    "modelPlaceholder": "e.g. anthropic/claude-3.7-sonnet"
  },
  "opencode": {
    "apiKey": "API Key"
  },
  "requesty": {
    "apiKey": "API Key",
    "modelPlaceholder": "e.g. claude-4-sonnet",
    "autoCacheLabel": "Use Auto Cache",
    "autoCacheTooltip": "This will instruct the router to attempt to cache the response from the provider. If a similar request has been cached previously, it might be served from the cache (depending on the provider’s caching strategy and TTL)."
  },
  "lmstudio": {
    "baseUrl": "Base URL",
    "baseUrlPlaceholder": "e.g. http://localhost:1234/v1"
  },
  "gpustack": {
    "name": "GPUStack",
    "baseUrl": "Base URL",
    "baseUrlPlaceholder": "http://localhost",
    "apiKey": "API Key"
  },
  "synthetic": {
    "apiKey": "API Key"
  },
  "zaiPlan": {
    "apiKey": "API Key",
    "mcp": {
      "title": "MCP Servers",
      "infoTooltip": "Add Z.AI Coding Plan MCP servers to enable additional capabilities for the agent.",
      "vision": {
        "name": "Vision",
        "description": "Image and video analysis using GLM-4.6V model"
      },
      "zread": {
        "name": "Zread",
        "description": "Search and read GitHub repository documentation and code"
      },
      "webReader": {
        "name": "Web Reader",
        "description": "Fetch and extract content from web pages"
      },
      "webSearch": {
        "name": "Web Search",
        "description": "Search the web for real-time information"
      },
      "add": "Add",
      "adding": "Adding...",
      "configured": "Configured"
    },
    "thinkingEnabled": "Enable Thinking",
    "thinkingEnabledTooltip": "When enabled, the model will use thinking mode for deeper reasoning (default). Disable for faster responses on simple tasks."
  },
  "azure": {
    "apiKey": "API Key",
    "resourceName": "Resource Name",
    "apiVersion": "API Version",
    "addCustomModelInfo": "Models cannot be loaded automatically for Azure provider and you need to add them manually using ”+ Add Model”, ensuring the model name matches the deployment name."
  },
  "providers": {
    "anthropic": "Anthropic",
    "anthropic-compatible": "Anthropic Compatible",
    "bedrock": "Bedrock",
    "cerebras": "Cerebras",
    "claude-agent-sdk": "Claude Agent SDK",
    "deepseek": "Deepseek",
    "gemini": "Gemini",
    "groq": "Groq",
    "kimi-plan": "Kimi Coding Plan",
    "gpustack": "GPUStack",
    "lmstudio": "LM Studio",
    "litellm": "LiteLLM",
    "minimax": "MiniMax",
    "ollama": "Ollama",
    "openai": "OpenAI",
    "opencode": "OpenCode ZEN",
    "openai-compatible": "OpenAI Compatible",
    "openrouter": "OpenRouter",
    "requesty": "Requesty",
    "synthetic": "Synthetic",
    "vertex-ai": "Vertex AI",
    "zai-plan": "Z.AI Coding Plan",
    "azure": "Azure"
  },
  "select": {
    "placeholder": "Select an option"
  },
  "settings": {
    "title": "Settings",
    "tabs": {
      "general": "General",
      "aider": "Aider",
      "agents": "Agents",
      "tasks": "Tasks",
      "memory": "Memory",
      "voice": "Voice",
      "hotkeys": "Hotkeys",
      "server": "Server",
      "about": "About"
    },
    "hotkeys": {
      "projectHotkeys": "Project",
      "taskHotkeys": "Task",
      "dialogHotkeys": "Dialogs",
      "closeProject": "Close Project",
      "newProject": "New Project",
      "usageDashboard": "Usage Dashboard",
      "modelLibrary": "Model Library",
      "settings": "Settings",
      "cycleNextProject": "Cycle next project",
      "cyclePrevProject": "Cycle previous project",
      "switchProject": "Switch to Project {{number}}",
      "switchTask": "Switch to Task {{number}}",
      "focusPrompt": "Focus Prompt",
      "newTask": "New Task",
      "closeTask": "Close Task",
      "browseFolder": "Browse Folder",
      "enterHotkey": "Enter hotkey...",
      "resetToDefaults": "Reset to Defaults",
      "hotkeyFormat": "Hotkey Format:",
      "modKey": "Use 'mod' for Cmd (Mac) or Ctrl (Windows/Linux)",
      "multipleKeys": "Separate multiple key combinations with commas",
      "examples": "Examples: 'mod+w', 'ctrl+shift+t', 'alt+1,meta+1'",
      "clickToRecord": "Click to record",
      "recording": "Press keys...",
      "addShortcut": "Add shortcut",
      "editShortcut": "Edit shortcut",
      "clearShortcut": "Clear shortcut",
      "noShortcut": "No shortcut configured",
      "recordShortcutDescription": "Press the record button below and then press the key combination you want to use as a shortcut.",
      "pressKeysToRecord": "Press keys to record...",
      "startRecording": "Start Recording",
      "stopRecording": "Stop Recording"
    },
    "gui": "Appearance",
    "voice": {
      "title": "Voice",
      "providerProfile": "Provider profile",
      "model": "Model",
      "idleTimeout": "Idle timeout (seconds)",
      "idleTimeoutHelp": "Stops recording after this much silence",
      "systemInstructions": "System instructions",
      "microphone": "Microphone",
      "microphoneDefault": "Default",
      "microphoneUnknown": "Unknown microphone",
      "noSupportedProviders": "No supported voice providers configured. Configure Gemini or OpenAI via Model Library.",
      "openai": {
        "title": "OpenAI",
        "model": "Model",
        "language": "Language"
      },
      "gemini": {
        "title": "Gemini",
        "model": "Model",
        "temperature": "Temperature"
      }
    },
    "startup": {
      "title": "Start Up",
      "emptyTask": "Start with empty task",
      "lastTask": "Load last task"
    },
    "tasks": {
      "title": "Tasks",
      "smartTaskState": "Smart Task State",
      "smartTaskStateTooltip": "When enabled, the model intelligently analyzes the agent's response to classify the task as 'More Info Needed', 'Ready for Implementation', or 'Ready for Review'. When disabled, the task state will always be set to 'Ready for Review'.",
      "autoGenerateTaskName": "Auto-Generate Task Name",
      "autoGenerateTaskNameTooltip": "When enabled, the model generates a concise task name from your prompt. When disabled, the first 5 words of your prompt will be used as the task name.",
      "showTaskStateActions": "Show Task State Actions",
      "showTaskStateActionsTooltip": "When enabled, task state actions are displayed at the bottom of messages. Disable to hide these actions.",
      "contextManagement": "Context Management",
      "contextCompactingThreshold": "Auto-compact threshold",
      "contextCompactingThresholdTooltip": "When token usage exceeds this threshold, the conversation will be automatically managed according to the selected compaction type. Set to 0 to disable.",
      "contextCompactionType": "Compaction type",
      "contextCompactionTypeCompact": "Compact",
      "contextCompactionTypeHandoff": "Handoff",
      "contextCompactionTypeTooltip": "Choose how to manage conversation context when the token threshold is exceeded: Compact summarizes the conversation within the task, while Handoff creates a new task with a handoff.",
      "worktree": "Worktree",
      "worktreeSymlinkFoldersLabel": "Symlink Folders",
      "worktreeSymlinkFoldersTooltip": "These folders will be symlinked from the project root to the task worktree. Useful for large dependencies like node_modules.",
      "noSymlinkFolders": "No symlink folders configured",
      "symlinkFolderPlaceholder": "Folder name (e.g. node_modules)",
      "addSymlinkFolder": "Add",
      "removeSymlinkFolder": "Remove folder"
    },
    "language": "Language",
    "notifications": {
      "title": "Notifications"
    },
    "agent": {
      "mcpServers": "MCP Servers",
      "provider": "Provider",
      "providerSettings": "Provider Settings",
      "context": "Context",
      "runSettings": "Parameters",
      "maxIterations": "Max Iterations",
      "minTimeBetweenToolCalls": "Min Time Between Tool Calls (ms)",
      "maxTokens": "Max Tokens",
      "temperature": "Temperature",
      "customInstructions": "Additional Rules",
      "rules": "Rules",
      "rulesInfo": "You can use Rules to add specific instructions for specific MCP servers or to control flow of the agent.",
      "ruleFilesInfo": "Any file in your project's <file>.aider-desk/rules</file> directory is automatically included in the Rules. See example <a>here</a>.",
      "noServersConfigured": "No MCP servers configured.",
      "computationalResources": "Maximum number of iterations for the agent per run. Helps control computational resources.",
      "rateLimiting": "Sets the minimum time between tool calls to prevent rate limiting (e.g. for Brave or other API-constrained services).",
      "temperatureTooltip": "Controls randomness in responses. Lower values (0.0-0.3) make responses more focused and deterministic, higher values (0.7-1.0) make them more creative and varied. When not set, uses the model's Temperature.",
      "tokensPerResponse": "Maximum number of tokens the agent can use per response. When not set, uses the model's Max Output tokens.",
      "addMcpServer": "Add",
      "editConfig": "Edit Config",
      "editMcpServersConfig": "Edit MCP Servers Config",
      "reloadServers": "Reload",
      "powerToolsTooltip": "Allows the agent to use tools for direct file operations (read, write, edit), searching (glob, grep, semantic search), and executing shell commands (bash).",
      "aiderToolsTooltip": "Agent can use Aider to perform add/drop context files actions and run prompts.",
      "useAiderTools": "Use Aider tools",
      "usePowerTools": "Use Power tools",
      "useTodoTools": "Use Todo tools",
      "useTaskTools": "Use Task tools",
      "useMemoryTools": "Use Memory tools",
      "useSkillsTools": "Use Skills tools",
      "includeContextFiles": "Include context files",
      "includeFilesTooltip": "Adds content of context files into the chat of agent. This will increase token usage.",
      "includeRepoMap": "Include repository map",
      "includeRepoMapTooltip": "Include the repository map from Aider in the agent's context. This can help the agent understand the project structure, but will increase token usage.",
      "autoApprove": "Auto approve",
      "override": "Override",
      "clearOverride": "Clear Override",
      "selectOrCreateProfile": "Select or create new agent profile",
      "newProfileName": "New Profile",
      "bashToolAllowedPattern": "Allowed patterns",
      "bashToolDeniedPattern": "Denied patterns",
      "bashToolAllowedPatternPlaceholder": "e.g. 'ls .*;cat .*'",
      "bashToolDeniedPatternPlaceholder": "e.g. 'rm .*'",
      "bashToolAllowedPatternTooltip": "Commands that match these Regex patterns separated by ; can be executed without approval",
      "bashToolDeniedPatternTooltip": "Commands that match these Regex patterns separated by ; will always be denied execution",
      "envVarPlaceholder": "{{envVar}}",
      "envVarFoundPlaceholder": "Found in: {{source}}",
      "createNewProfile": "Create New",
      "genericTools": "Tools",
      "noGenericToolsConfigured": "No tools configured.",
      "todoTools": "Todo tools",
      "includeTodoToolsTooltip": "Allows the agent to manage a list of todo items, including setting, getting, updating, and clearing them.",
      "subagent": {
        "title": "Subagent",
        "enableAsSubagent": "Enable as Subagent",
        "enableAsSubagentInformation": "When enabled, this profile is available as a subagent to other agents.",
        "canUseSubagents": "Can use Subagents",
        "canUseSubagentsInformation": "When enabled, this agent can use subagents.",
        "contextMemory": "Context memory",
        "contextMemoryTooltip": "Controls how much of the previous conversation context is remembered by the subagent. 'Full Context' maintains all previous subagents history, 'Last Message' only uses the final messages from previous subagent runs, and 'Off' starts fresh each time.",
        "contextMemory.off": "Off",
        "contextMemory.fullContext": "Full Context",
        "contextMemory.lastMessage": "Last Message",
        "description": "Description",
        "descriptionPlaceholder": "Describe this subagent's purpose, capabilities, and specialization and when this subagent should be invoked",
        "systemPrompt": "System Prompt",
        "systemPromptPlaceholder": "Your subagent's system prompt goes here. This can be multiple paragraphs and should clearly define the subagent's role, capabilities, and approach to solving problems.",
        "invocationMode": "Invocation",
        "invocationModeOnDemand": "On demand",
        "invocationModeOnDemandInformation": "Subagent is only used when explicitly requested by the user.",
        "invocationModeAutomatic": "Automatic",
        "invocationModeAutomaticInformation": "Subagent can be automatically invoked when appropriate by the agent.",
        "statusDisabled": "Disabled",
        "statusOnDemand": "On-demand",
        "statusAutomatic": "Automatic",
        "descriptionRequiredForAutomatic": "Description needs to be set in order to use this subagent automatically, otherwise the subagent can only be used when explicitly requested by the user.",
        "on-demand": "Used as subagent on user demand",
        "automatic": "Used as subagent automatically"
      },
      "skills": {
        "activating": "Activating {{name}} skill...",
        "activated": "Activated {{name}} skill",
        "skill": "Skill"
      },
      "profileContext": "Profile Context",
      "globalProfiles": "Global Profiles",
      "projectProfiles": "Project Profiles: {{projectName}}",
      "global": "Global",
      "previousContext": "Previous project",
      "nextContext": "Next project",
      "noProfilesInContext": "No profiles found in this context",
      "createNewProfileInContext": "Create New Profile",
      "copyProfile": "Copy",
      "cutProfile": "Cut",
      "deleteProfile": "Delete",
      "pasteProfile": "Paste Agent",
      "resetProfileToDefaults": "Reset to Defaults",
      "resetProfileTitle": "Reset '{{name}}' to Defaults?",
      "resetProfileConfirm": "This will restore '{{name}}' to its original default settings. Any custom modifications will be lost.",
      "restoreProfile": "Restore",
      "restoreProfileTooltip": "Restore this default profile"
    },
    "aider": {
      "options": "Options",
      "optionsPlaceholder": "e.g. --no-auto-commits --cache-prompts",
      "autoCommits": "Auto commit of LLM changes",
      "cachingEnabled": "Enable prompt caching",
      "watchFiles": "Watch files for changes",
      "environmentVariables": "Environment Variables",
      "envVarsPlaceholder": "#################\n# LLM parameters:\n#\n# Include xxx_API_KEY parameters and other params needed for your LLMs.\n# See https://aider.chat/docs/llms.html for details.\n\n## OpenAI\n#OPENAI_API_KEY=\n\n## Anthropic\n#ANTHROPIC_API_KEY=",
      "optionsDocumentation": "Check the documentation for available options at",
      "envVarsDocumentation": "Check the documentation for environment variables at",
      "context": "Context",
      "addRuleFiles": "Add rule files from project's <file>.aider-desk/rules</file> directory as read-only files.",
      "confirmBeforeEdit": "Confirm before editing files"
    },
    "common": {
      "showSecrets": "Show Secrets",
      "learnMore": "Learn more"
    },
    "notificationsEnabled": "Notifications enabled",
    "zoom": "Zoom level",
    "theme": "Theme",
    "font": "Font",
    "fontSize": "Font size",
    "fontOptions": {
      "Sono": "Sono (Default)",
      "PlayfairDisplay": "Playfair Display",
      "SpaceGrotesk": "Space Grotesk",
      "GoogleSansCode": "Google Sans Code",
      "JetBrainsMono": "JetBrains Mono",
      "RobotoMono": "Roboto Mono",
      "SourceCodePro": "Source Code Pro",
      "SpaceMono": "Space Mono",
      "UbuntuMono": "Ubuntu Mono"
    },
    "themeOptions": {
      "dark": "Default (Dark)",
      "light": "Default (Light)",
      "ocean": "Ocean",
      "forest": "Forest",
      "lavender": "Lavender",
      "bw": "Black & White",
      "midnight": "Midnight",
      "neon": "Neon",
      "neopunk": "Neopunk",
      "charcoal": "Charcoal",
      "aurora": "Aurora",
      "serenity": "Serenity",
      "cappuccino": "Cappuccino",
      "fresh": "Fresh",
      "botanical-garden": "Botanical Garden",
      "botanical-garden-dark": "Botanical Garden (Dark)"
    },
    "aiderRestartConfirm": {
      "title": "Restart Required",
      "message": "Changes to Aider options or environment variables require a restart of the Aider task to take effect. Would you like to restart now?",
      "restartNow": "Restart now",
      "later": "I'll do it later"
    },
    "models": {
      "title": "Model Providers",
      "description": "Configure your LLM providers for use with both Aider and Agent modes. Click on a provider card to configure API key and additional settings.",
      "configured": "Configured",
      "notConfigured": "Not configured",
      "agentOnly": "Agent only",
      "showAllProviders": "Show All Providers",
      "additionalProvidersInfo": "You can configure additional LLM providers for Aider by setting environment variables in the <aiderTab>Aider settings</aiderTab>."
    },
    "vertexAi": {
      "project": "Project",
      "projectPlaceholder": "Enter your Google Cloud project ID",
      "location": "Location",
      "locationPlaceholder": "Enter your Google Cloud location",
      "credentials": "Google Cloud Credentials (optional)",
      "credentialsPlaceholder": "Enter your Google Cloud credentials JSON"
    },
    "about": {
      "version": "Version",
      "notAvailable": "N/A",
      "checkForUpdates": "Check for updates",
      "newAiderVersionAvailable": "New Aider version ({{version}}) is available - restart AiderDesk to install.",
      "updateAvailable": "Update is available",
      "downloadUpdate": "Download",
      "downloadingUpdate": "Downloading update",
      "newAiderDeskVersionReady": "A new version is ready. Restart AiderDesk to apply the update.",
      "downloadAutomatically": "Download update automatically",
      "releaseNotes": "Release notes",
      "openLogsDirectory": "Open logs directory",
      "openLogsError": "Error opening a log directory"
    },
    "telemetry": {
      "title": "Telemetry"
    },
    "promptBehavior": {
      "title": "Prompt Behavior",
      "showSuggestions": "Show suggestions",
      "automaticallyWhileTyping": "Automatically while typing",
      "onlyWhenTabPressed": "Only when TAB key is pressed",
      "suggestionsDelay": "Suggestions delay",
      "requireCommandConfirmation": "Require confirmation for commands",
      "addCommand": "/add",
      "readOnlyCommand": "/read-only",
      "modelCommand": "/model",
      "modeSwitchingCommands": "Mode commands (/code, /agent, ...)",
      "keyBindings": "Key bindings",
      "useVimBindings": "Use Vim bindings",
      "useVimBindingsTooltip": "Enable Vim key bindings for navigating and editing text in the prompt field.",
      "modeAtSign": "@ mention mode"
    },
    "server": {
      "description": "Enable server on port 24337 to access AiderDesk from external applications",
      "status": "Status",
      "running": "Running",
      "enableBasicAuth": "Enable Basic Authentication",
      "enableBasicAuthDescription": "Require username and password for browser access and API calls",
      "username": "Username",
      "password": "Password",
      "controlServer": "REST API Server",
      "starting": "Starting...",
      "stopping": "Stopping...",
      "start": "Start",
      "stop": "Stop",
      "stopped": "Stopped",
      "copyUrl": "Copy URL",
      "authentication": "Authentication",
      "serverControl": "Server Control",
      "tunnelManagement": "Tunnel Management",
      "tunnelDescription": "Create a Cloudflare tunnel to securely access your server from external networks. Make sure to use Authentication when exposing the server externally."
    },
    "messages": {
      "title": "Message Display",
      "display": "Display Options",
      "markdownRendering": "Markdown rendering",
      "diffViewMode": "Diff view mode",
      "viewMode": "Messages view mode",
      "viewModeFull": "Full",
      "viewModeCompact": "Compact",
      "virtualizedRendering": "Use virtualized rendering (experimental)",
      "virtualizedRenderingTooltip": "Experimental feature that can improve performance when you have many messages in your conversation history by only rendering visible messages."
    },
    "memory": {
      "configuration": "Configuration",
      "description": "Configure AI memory features to enhance conversation continuity and context retention across sessions.",
      "enabled": {
        "label": "Enable",
        "description": "Enable AI memory to remember important information across conversations and sessions."
      },
      "model": {
        "label": "Model"
      },
      "provider": {
        "label": "Embedding Provider",
        "description": "Choose the embedding provider to use for memory functionality"
      },
      "maxDistance": {
        "label": "Relevance threshold",
        "description": "Higher values retrieve more (and less relevant) memories. Lower values retrieve fewer (and more relevant) memories."
      },
      "embeddingProgress": {
        "loadingModel": "Loading embedding model: {{status}}",
        "reEmbedding": "Re-embedding memories: {{done}}/{{total}}",
        "error": "Embedding migration failed: {{error}}"
      },
      "memories": {
        "title": "Memories",
        "project": "Project",
        "allProjects": "All projects",
        "loading": "Loading memories...",
        "empty": "No memories found.",
        "delete": "Delete",
        "deleteAllForProject": "Delete all for project",
        "deleteDialogTitle": "Delete memory",
        "deleteDialogText": "Delete memory",
        "deleteProjectDialogTitle": "Delete project memories",
        "deleteProjectDialogText": "Delete all memories for project",
        "projectId": "projectId",
        "id": "id"
      }
    }
  },
  "messages": {
    "thinking": "Thinking...",
    "loading": "Loading...",
    "copy": "Copy",
    "copied": "Copied!",
    "interrupted": "Interrupted by user.",
    "taskInterrupted": "Task Interrupted",
    "taskInterruptedDescription": "The task was interrupted by the user while in progress.",
    "delete": "Delete",
    "redo": "Redo",
    "edit": "Edit",
    "forkFromHere": "Fork from here",
    "editingLastMessage": "Editing last message",
    "cancelEdit": "Cancel",
    "group": "Group",
    "scrollToBottom": "Scroll to bottom",
    "previousUserMessage": "Previous user message",
    "nextUserMessage": "Next user message",
    "messageBar": "Message Bar",
    "exportNotAvailableWithVirtualized": "Export to image is not available when using virtualized message rendering. Change to standard rendering in Settings -> General -> Message Display.",
    "execute": "Execute",
    "resume": "Resume",
    "taskReadyForReview": "Task Ready for Review",
    "taskTodo": "Task Not Started",
    "taskTodoDescription": "Task Ready to Execute.",
    "markAsDone": "Mark as done",
    "taskReadyForImplementation": "Task Ready for Implementation",
    "taskDone": "Task Completed",
    "taskDoneArchived": "Task Completed and Archived",
    "proceed": "Proceed",
    "archive": "Archive",
    "unarchive": "Unarchive",
    "confirmDelete": "Confirm Delete",
    "remove": "Remove message",
    "deleteUpToHere": "Delete up to here"
  },
  "errors": {
    "frozenTitle": "AIDER FROZEN?",
    "frozenMessage": "Aider process seems to be frozen. Would you like to restart the task?",
    "removeMessageFailed": "Failed to remove message - please try again",
    "forkTaskFailed": "Failed to fork task - please try again",
    "removeMessagesUpToFailed": "Failed to remove messages - please try again"
  },
  "dialogs": {
    "confirm": "Confirm",
    "confirmDelete": "Are you sure you want to delete this?",
    "addFile": "Add File",
    "openProject": "Open Project",
    "recentProjects": "Recent projects",
    "openProjectTitle": "OPEN PROJECT",
    "projectPathPlaceholder": "Type the path to your project or use icon to browse",
    "openButton": "Open",
    "browseFoldersTooltip": "Browse folders",
    "projectAlreadyOpenWarning": "This project is already open.",
    "cantOpenProject": "This project can not be opened."
  },
  "mode": {
    "code": "Code",
    "ask": "Ask",
    "architect": "Architect",
    "context": "Context",
    "agent": "Agent",
    "bmad": "BMAD"
  },
  "modeTooltip": {
    "code": "Direct code generation and editing with Aider AI assistant",
    "agent": "Autonomous AI agent with advanced reasoning and tool usage capabilities",
    "ask": "Ask questions about your codebase without making changes",
    "architect": "High-level project planning and architecture design",
    "context": "Search and explore your codebase context",
    "bmad": "Guided workflows for planning, spec'ing, and implementing features"
  },
  "addFileDialog": {
    "title": "Add context files",
    "browse": "Browse files",
    "readOnly": "Read-Only"
  },
  "fileFinder": {
    "addPathTooltip": "Add path",
    "browseFile": "Browse for files",
    "browseDirectory": "Browse for directories",
    "placeholder": {
      "filesOnly": "Enter file to add",
      "directoriesOnly": "Enter directory to add",
      "filesAndDirectories": "Enter file or directory to add"
    },
    "placeholderFinish": {
      "filesOnly": "Enter file or press Enter to finish",
      "directoriesOnly": "Enter directory or press Enter to finish",
      "filesAndDirectories": "Enter file or directory or press Enter to finish"
    }
  },
  "fileChip": {
    "removeFileTooltip": "Remove file"
  },
  "contextFiles": {
    "title": "Context Files",
    "updatedFiles": "Updated Files",
    "updated": "Updated",
    "add": "Add context files",
    "addFileTooltip": "Add file (use Ctrl/Cmd to add as Read-only)",
    "addFileTooltip.ctrl": "Add file (use Ctrl to add as Read-only)",
    "addFileTooltip.cmd": "Add file (use Cmd to add as Read-only)",
    "readOnly": "Read-only file",
    "showAllFiles": "Show all files",
    "hideAllFiles": "Hide all files",
    "expandAll": "Expand all",
    "collapseAll": "Collapse all",
    "dropAll": "Drop all context files",
    "globalRule": "Global rule file",
    "projectRule": "Project rule file",
    "agentRule": "Agent rule file",
    "projectFiles": "Project Files",
    "rules": "Rule Files",
    "diffViewer": {
      "file": "File"
    },
    "search": "Search files",
    "searchPlaceholder": "Search files...",
    "refresh": "Refresh",
    "useGit": "Use Git",
    "useGitEnabled": "Git enabled - Click to use filesystem",
    "useGitDisabled": "Filesystem enabled - Click to use Git",
    "empty": {
      "title": "No Context Files",
      "aiderMode": {
        "description": "Add files here that you want to read or modify. Aider can only access files that are in the context.",
        "hint": "Tip: Add related files (imports, types) for better understanding."
      },
      "agentMode": {
        "description": "The agent can access any file in your project using tools. Adding files here is optional but can speed up tasks by providing immediate context.",
        "hint": "Tip: Add files here when using Aider tools or when you want file contents included in the prompt.",
        "includeContextFiles": "When 'Include Context Files' is enabled in agent settings, file contents are embedded directly in the prompt for immediate access."
      }
    }
  },
  "modelSelector": {
    "mainModel": "Main model",
    "editorModel": "Editor model",
    "weakModel": "Weak model",
    "architectModel": "Architect model",
    "agentModel": "Agent model",
    "reasoning": "Reasoning",
    "thinkingTokens": "Thinking tokens",
    "loadingModel": "Loading model...",
    "searchPlaceholder": "Search models...",
    "searchPlaceholderOrCustom": "Search models or enter custom name...",
    "removePreferred": "Remove from preferred models",
    "invalidModelSelection": "Invalid format of the model. Expected format is 'provider/model', e.g. 'openai/gpt-4'.",
    "providerNotSupported": "Provider '{{provider}}' is not supported. Supported providers are: {{providers}}.",
    "selectModel": "Select model...",
    "weakModelLock": "Lock weak model",
    "weakModelUnlock": "Unlock weak model",
    "noModelSelected": "No model selected"
  },
  "modelInfo": {
    "noInfo": "No model information available.",
    "maxInputTokens": "Max Input Tokens",
    "maxOutputTokens": "Max Output Tokens",
    "inputCostPerMillion": "Input Cost / 1M Tokens",
    "outputCostPerMillion": "Output Cost / 1M Tokens"
  },
  "mcp": {
    "initializingServers": "Initializing MCP servers...",
    "serverToolStatus": "{{enabledCount}} of {{count}} tools enabled",
    "toolsCount_one": "{{count}} tool",
    "toolsCount_other": "{{count}} tools",
    "loadToolsError": "Failed to load MCP server tools",
    "noToolsFound": "No tools could be found. Check your configuration.",
    "servers": "MCP servers",
    "tools": "Tools"
  },
  "todo": {
    "title": "Todos",
    "addTodo": "Add Todo",
    "editTodo": "Edit Todo",
    "deleteTodo": "Delete Todo",
    "todoName": "Todo Name",
    "todoNamePlaceholder": "Enter todo name...",
    "saveTodo": "Save",
    "cancelTodo": "Cancel",
    "noTodos": "No todo items",
    "confirmDelete": "Are you sure you want to delete this todo item?",
    "clearAllTodos": "Clear all todo items",
    "handoffTodo": "Handoff to new task"
  },
  "tool": {
    "noDescription": "No description",
    "approval": {
      "never": "Never",
      "always": "Always",
      "ask": "Ask"
    }
  },
  "autocompletion": {
    "placeholder": "Type to search..."
  },
  "costInfo": {
    "files": "Files",
    "repoMap": "Repo map",
    "refreshRepoMap": "Refresh repository map",
    "messages": "Messages",
    "clearMessages": "Clear message history",
    "agent": "Agent",
    "aider": "Aider",
    "total": "Total",
    "resetTask": "Reset",
    "tokenUsage": "{{usedTokens}} of {{maxTokens}}",
    "contextCompactingThreshold": "Auto-compact threshold",
    "contextCompactingThresholdOff": "Off",
    "contextCompactingThresholdTooltip": "When token usage exceeds this threshold, the conversation will be automatically compacted to save space.",
    "thresholdTokens": "Threshold tokens"
  },
  "commandOutput": {
    "command": "Command"
  },
  "reflectedMessage": {
    "title": "Reflected Message"
  },
  "responseMessage": {
    "inputTokens": "Input Tokens",
    "outputTokens": "Output Tokens",
    "cacheWriteTokens": "Cache Write Tokens",
    "cacheReadTokens": "Cache Read Tokens"
  },
  "thinkingAnswer": {
    "thinking": "THINKING",
    "answer": "ANSWER"
  },
  "toolMessage": {
    "toolLabel": "{{server}}: {{tool}}",
    "arguments": "Arguments:",
    "executing": "Executing tool...",
    "result": "Result:",
    "error": "Error while executing tool:",
    "denied": "Denied by user.",
    "deniedByReason": "Denied by user:\n{{reason}}",
    "tasks": {
      "listTasks": "List tasks",
      "listTasksWithState": "List tasks with state: {{state}}",
      "getTask": "Get task",
      "getTaskMessage": "Get task message",
      "createTask": "Create task",
      "deleteTask": "Delete task",
      "searchTask": "Search task:",
      "inTask": "in",
      "searchTaskNoMatches": "No matches found.",
      "searchParentTask": "Search parent task:",
      "inParentTask": "in",
      "searchParentTaskNoMatches": "No matches found.",
      "name": "Name",
      "parentTaskId": "Parent Task ID",
      "execute": "Execute",
      "executeInBackground": "Execute in background",
      "yes": "Yes",
      "no": "No",
      "taskId": "Task ID",
      "messageIndex": "Message Index",
      "prompt": "Prompt",
      "agentProfile": "Agent Profile",
      "model": "Model",
      "state": "State",
      "contextFiles": "Context Files",
      "contextMessages": "Context Messages",
      "currentMode": "Current mode",
      "role": "Role",
      "usage": "Usage",
      "noTasksFound": "No tasks found",
      "taskNotFound": "Task not found",
      "messageNotFound": "Message not found",
      "taskCreatedSuccessfully": "Task created successfully",
      "taskDeletedSuccessfully": "Task deleted successfully",
      "cannotDeleteCurrentTask": "Cannot delete current task",
      "active": "Active",
      "completed": "Completed",
      "archived": "Archived",
      "user": "User",
      "assistant": "Assistant",
      "readOnly": "Read-only",
      "createdAt": "Created at",
      "updatedAt": "Updated at"
    },
    "aider": {
      "addContextFiles": "Add file(s) to Aider's context:\n{{paths}}",
      "dropContextFiles": "Drop file(s) from Aider's context:\n{{paths}}",
      "runPrompt": "Run prompt in Aider",
      "working": "Aider is working...",
      "finishedTask": "Aider finished the task.",
      "noChanges": "Aider did not make any changes."
    },
    "power": {
      "fileRead": {
        "title": "Read",
        "withLines": "With lines",
        "lineOffset": "Line offset",
        "lineLimit": "Line limit"
      },
      "fileWrite": {
        "overwrite": "Rewrite",
        "append": "Append to",
        "createOnly": "Create"
      },
      "fileEdit": {
        "title": "Edit",
        "searchTerm": "Search Term",
        "regex": "Regex",
        "replacementText": "Replacement Text",
        "replaceAll": "Replace All"
      },
      "glob": {
        "title": "Find files matching pattern:",
        "findingFiles": "Finding files...",
        "foundFiles": "Found {{count}} files",
        "noMatches": "No files found",
        "matching": "matching"
      },
      "grep": {
        "title": "Search files matching",
        "findingMatches": "Finding...",
        "in": "in",
        "for": "for",
        "foundMatches": "Found {{count}} matches",
        "noMatches": "No matches found",
        "contextLines": "({{count}} lines of context)",
        "matchesCount": "({{count}} matches)",
        "lineLabel": "Line {{lineNumber}}:",
        "contextLabel": "Context:"
      },
      "bash": {
        "title": "Run command",
        "exitCode": "Exit Code",
        "stdout": "Stdout",
        "stderr": "Stderr",
        "commandFailed": "Command failed"
      },
      "semanticSearch": {
        "title": "Semantic search:",
        "in": "in",
        "noMatches": "No matches found.",
        "foundMatches": "Found {{count}} matches",
        "score": " (score: {{score}})",
        "resultLabel": "Result {{index}}"
      },
      "fetch": {
        "title": "Fetch"
      }
    },
    "memory": {
      "group": "Memory",
      "storingMemory": "Storing memory...",
      "retrievingMemories": "Retrieving memories...",
      "deletingMemory": "Deleting memory...",
      "updatingMemory": "Updating memory...",
      "listingMemories": "Listing memories...",
      "memoryStored": "Memory stored.",
      "memoryUpdated": "Memory updated.",
      "memoryDeleted": "Memory deleted.",
      "memoryId": "Memory ID",
      "type": "Type",
      "content": "Content",
      "newContent": "New Content",
      "query": "Query",
      "limit": "Limit",
      "foundMemories": "Found {{count}} memories.",
      "noMemoriesFound": "No relevant memories have been found.",
      "noRelevantMemories": "No relevant memories have been found",
      "storedMemoryDetails": "Stored Memory Details",
      "updatedMemoryDetails": "Updated Memory Details",
      "deletedMemoryDetails": "Deleted Memory Details",
      "retrievedMemories": "Retrieved Memories",
      "memoryList": "Memory List",
      "listedMemories": "Listing {{count}} memories.",
      "ofType": "of type {{type}}",
      "noMemoriesOfType": "No memories found of type: {{type}}",
      "all": "All",
      "delete": "Delete",
      "memoryNotFound": "Not found",
      "deleteDialogTitle": "Delete memory",
      "deleteDialogText": "Are you sure you want to delete this memory?"
    },
    "subagents": {
      "groupRunning": "{{name}}: Subagent is working...",
      "groupCompleted": "{{name}}: Subagent finished the task.",
      "running": "Subagent is working...",
      "completed": "Subagent finished the task.",
      "prompt": "Prompt",
      "error": "Error running the subagent"
    },
    "errors": {
      "noSuchTool": "Attempted to use unknown tool: {{toolName}}",
      "invalidToolArguments": "Invalid arguments for tool: {{toolName}}"
    }
  },
  "codeBlock": {
    "revertChanges": "Revert changes"
  },
  "diffViewer": {
    "sideBySide": "Side by Side",
    "unified": "Unified",
    "compact": "Compact",
    "noChanges": "No changes have been made. Content is identical."
  },
  "promptField": {
    "startRecording": "Start listening",
    "stopRecording": "Stop listening",
    "savePrompt": "Save Prompt",
    "savePromptDescription": "Save prompt without executing",
    "saveError": "Failed to save prompt: {{error}}",
    "autoApprove": "Auto Approve",
    "autoApproveTooltip": "When enabled, automatically approve tool executions without asking for confirmation",
    "autoApproveLockTooltip": "Locking keeps Auto Approve enabled for newly created tasks",
    "placeholders": {
      "0": "Update the UserValidator class to add email format validation...",
      "1": "Fix the memory leak in DataProcessor.processBatch() by closing...",
      "2": "Add error handling to PaymentService.chargeCard() with proper...",
      "3": "Create a React component UserProfileCard with props interface...",
      "4": "Optimize the SQL query in UserRepository.findByEmail() by adding...",
      "5": "Add unit tests for AuthController.login() using Jest and...",
      "6": "Implement the missing handleResize() method in ChartComponent...",
      "7": "Update package.json to add TypeScript dependency and configure...",
      "8": "Add input validation to ContactForm's handleSubmit function...",
      "9": "Fix the bug in calculateTotal() where decimal values are being...",
      "10": "Add logging to API middleware using Winston for request...",
      "11": "Create a Dockerfile for Node.js application with multi-stage...",
      "12": "Add rate limiting middleware to /api/users endpoint using...",
      "13": "Implement the missing deleteTodo() function in TodoService...",
      "14": "Add TypeScript interfaces for API response objects in...",
      "15": "Fix the CSS issue where mobile menu is not displaying...",
      "16": "Add environment variable validation using dotenv and...",
      "17": "Create database migration to add 'last_login' column to...",
      "18": "Add error boundaries to React app to catch component...",
      "19": "Implement pagination logic in ProductList's fetchProducts..."
    },
    "questionPlaceholder": "...or suggest something else",
    "answers": {
      "yes": "(Y)es",
      "no": "(N)o",
      "always": "(A)lways",
      "dontAsk": "(D)on't ask again"
    },
    "invalidCommand": "Invalid command",
    "stopResponse": "Stop response",
    "sendMessage": "Send message (Enter)",
    "clearChat": "Clear chat",
    "agentModeOnly": "Available in Agent mode only",
    "handoffError": "Handoff failed: {{error}}",
    "taskInfo": "Show task information"
  },
  "agentProfiles": {
    "title": "Agents",
    "profileSettings": "Agent Profile: {{profileName}}",
    "newProfileName": "New Profile",
    "manageProfiles": "Manage Profiles",
    "createNew": "New Profile",
    "profileName": "Name",
    "profileDescription": "Description",
    "profileDescriptionPlaceholder": "Describe this agent profile (purpose, tools, etc.)",
    "tools": "Tools",
    "model": "Model",
    "selectProfile": "Select...",
    "saveAsProjectDefault": "Save as project default"
  },
  "projectBar": {
    "editFormatTooltip": "This is the format used for editing code. Changing it might cause the model to not perform as expected.",
    "aider": "Aider",
    "toggleSidebar": "Toggle sidebar",
    "modelLibrary": "Model Library",
    "worktree": "Worktree",
    "worktreeTooltip": "Toggle worktree for this task"
  },
  "workingMode": {
    "local": "Local",
    "worktree": "Worktree",
    "switching": "Switching...",
    "confirmLocalTitle": "Switch to Local Mode",
    "confirmLocalMessage": "Warning: This worktree has unsaved work:\n{{warnings}}\n\nRemoving the worktree will delete this work. If you want to keep this work, use Merge action to merge it to the main branch first.\n\nAre you sure you want to continue and remove the worktree?",
    "confirmLocalAction": "Remove and switch"
  },
  "workingModeTooltip": {
    "local": "Make changes directly in the local project directory for this task",
    "worktree": "Use git worktree to make isolated changes for this task"
  },
  "reasoningEffort": {
    "label": "Reasoning effort",
    "tooltip": "Reasoning effort determines how much the model will think before taking action. High reasoning effort means the model will think more before taking action, but will also take longer to respond.",
    "none": "None",
    "minimal": "Minimal",
    "low": "Low",
    "medium": "Medium",
    "high": "High",
    "max": "Max"
  },
  "commands": {
    "add": "Add files to the context",
    "agent": "Switch to agent mode. If already in agent mode, opens the agent model selector. Any text after the command is used as a prompt",
    "architect": "Switch to architect mode. Architect mode is used to plan changes to the code base and execute them",
    "ask": "Switch to ask mode. Ask questions about the code base without editing any files",
    "clear": "Clear the chat history",
    "clear-logs": "Remove only log messages from chat",
    "code": "Switch to code mode. Ask for changes to your code",
    "commit": "Commit unstaged changes to the repo",
    "context": "Switch to context mode. Ask for changes and Aider will add relevant files to the context",
    "compact": "Summarize the conversation",
    "copy-context": "Copy the current chat context as markdown, suitable to paste into a web UI",
    "drop": "Remove files from the context to free up context space",
    "edit-last": "Edits the last user message",
    "init": "Initializes AGENTS.md rule file with project information",
    "agentModeOnly": "Agent mode only",
    "map": "Print out the current repository map",
    "map-refresh": "Force a refresh of the repository map",
    "model": "Open the model selector",
    "read-only": "Add files to the chat that are for reference only, or turn added files to read-only",
    "redo": "Redoes the last user prompt.",
    "resolve-conflicts": "Resolve merge conflicts using AI",
    "reasoning-effort": "Set the reasoning effort level (values: minimal/low/medium/high depending on model)",
    "reset": "Drop all files and clear the chat history",
    "run": "Run a shell command and optionally add the output to the chat",
    "task-info": "Show task information",
    "test": "Run a predefined test command and add the output to the chat on non-zero exit code",
    "think-tokens": "Set the thinking token budget (supports formats like 8096, 8k, 10.5k, 0.5M)",
    "tokens": "Report on the number of tokens used by the current chat context",
    "undo": "Undo the last git commit if it was done by Aider",
    "web": "Scrape a webpage and save it to a file. Use /web url [file] with optional [file].",
    "handoff": "Handoff conversation to new task with focus"
  },
  "telemetry": {
    "title": "Telemetry Information",
    "message": "To help us improve AiderDesk, anonymous telemetry data is collected. This includes information like mode usage (agent, code, ask...) and some specifics when Agent mode is used. No personal data or prompts are ever collected.",
    "fullInfo": "Full information about what is collected can be found <a>here</a>.",
    "enabledLabel": "Enable anonymous telemetry"
  },
  "multiselect": {
    "noneSelected": "None selected",
    "allSelected": "All selected",
    "someSelected": "{{count}} selected",
    "selectAll": "Select All"
  },
  "usageDashboard": {
    "title": "Usage Dashboard",
    "refresh": "Refresh",
    "projects": "Projects",
    "models": "Models",
    "dateRange": "Date Range",
    "total": "Total",
    "thisMonth": "This month",
    "today": "Today",
    "all": "All",
    "groupBy": "Group by",
    "periods": {
      "hour": "Hour",
      "day": "Day",
      "month": "Month",
      "year": "Year"
    },
    "tabs": {
      "table": "Table View",
      "charts": "Charts View"
    },
    "charts": {
      "tokenUsageTrend": "Token Usage Trend",
      "costBreakdown": "Cost Breakdown",
      "messageBreakdown": "Message Breakdown",
      "modelUsageDistribution": "Model Usage Distribution",
      "inputTokens": "Input Tokens",
      "outputTokens": "Output Tokens",
      "noData": "No data available for the selected period",
      "tokens": "Tokens",
      "cost": "Cost",
      "share": "Share",
      "moreItems": "+{{count}} more"
    },
    "error": {
      "fetch": "Failed to fetch usage data."
    },
    "table": {
      "date": "Date",
      "project": "Project",
      "model": "Model",
      "input": "Input",
      "output": "Output",
      "cacheRead": "Cache Read",
      "cacheWrite": "Cache Write",
      "totalTokens": "Total Tokens",
      "cost": "Cost"
    }
  },
  "terminal": {
    "copyOutput": "Copy terminal output to prompt",
    "minimize": "Minimize terminal",
    "addTerminal": "Add new terminal"
  },
  "contextMenu": {
    "copy": "Copy",
    "paste": "Paste",
    "close": "Close",
    "closeOtherTabs": "Close other tabs",
    "closeAllTabs": "Close all tabs"
  },
  "taskSidebar": {
    "title": "Tasks",
    "noTasks": "No tasks available",
    "deleteTask": "Delete task",
    "deleteConfirm": "Are you sure you want to delete this task?",
    "createTask": "Create new task",
    "rename": "Rename",
    "pinTask": "Pin task",
    "unpinTask": "Unpin task",
    "taskNamePlaceholder": "Enter task name...",
    "untitled": "[Untitled]",
    "exportAsMarkdown": "Export as markdown",
    "exportAsImage": "Export as image",
    "taskIdCopied": "Task ID {{taskId}} copied to clipboard",
    "duplicateTask": "Duplicate Task",
    "search": "Search tasks",
    "searchPlaceholder": "Search tasks...",
    "archiveTask": "Archive Task",
    "unarchiveTask": "Unarchive Task",
    "showArchived": "Show archived",
    "hideArchived": "Hide archived",
    "archived": "Archived",
    "multiselectMode": "Multiselect Mode",
    "selectedCount": "{{count}} selected",
    "closeMultiselect": "Exit multiselect",
    "deleteSelected": "Delete selected",
    "archiveSelected": "Archive selected",
    "unarchiveSelected": "Unarchive selected",
    "deleteSelectedConfirm": "Are you sure you want to delete {{count}} selected tasks?",
    "archiveSelectedConfirm": "Are you sure you want to archive {{count}} selected tasks?",
    "unarchiveSelectedConfirm": "Are you sure you want to unarchive {{count}} selected tasks?",
    "generatingName": "Generating name...",
    "changeState": "Change State",
    "createSubtask": "Create subtask",
    "deleteConfirmWithSubtasks": "This task has {{count}} subtask(s). Delete anyway?"
  },
  "taskInfo": {
    "createdAt": "Created at",
    "updatedAt": "Updated at",
    "worktreeDirectory": "Worktree Directory",
    "baseBranch": "Base Branch",
    "baseCommit": "Base Commit",
    "targetBranch": "Target Branch",
    "lastMergeState": "Last Merge State",
    "beforeMergeCommit": "Before Merge Commit",
    "mergeTimestamp": "Merge Timestamp",
    "openFolder": "Open Folder",
    "taskId": "Task ID",
    "state": "State",
    "messageCount": "Message count"
  },
  "taskState": {
    "TODO": "Todo",
    "IN_PROGRESS": "In Progress",
    "INTERRUPTED": "Interrupted",
    "MORE_INFO_NEEDED": "More Info Needed",
    "READY_FOR_REVIEW": "Ready for Review",
    "READY_FOR_IMPLEMENTATION": "Ready for Implementation",
    "DONE": "Done"
  },
  "worktree": {
    "aheadCommits": "↑ {{count}} commits",
    "uncommittedFiles": "{{count}} files",
    "conflicts": "conflicts",
    "conflictsPredicted": "Conflicts predicted",
    "conflictsPresent": "Conflicts present",
    "merge": "Merge",
    "squash": "Squash & Merge",
    "onlyUncommitted": "Only uncommitted",
    "rebaseFromBranch": "Rebase from branch",
    "abortRebase": "Abort rebase",
    "continueRebase": "Continue rebase",
    "rebaseConflicts": "Rebase failed due to conflicts. Please resolve them manually or use the AI agent to help.",
    "confirmRebaseTitle": "Rebase worktree",
    "confirmRebaseMessage": "This will rebase your worktree onto the selected branch. If there are conflicts, you will need to resolve them.",
    "confirmAbortRebaseTitle": "Abort rebase",
    "confirmAbortRebaseMessage": "This will abort the in-progress rebase and restore the worktree to its pre-rebase state.",
    "confirmContinueRebaseTitle": "Continue rebase",
    "confirmContinueRebaseMessage": "This will try to continue the rebase. Make sure all conflicts are resolved and staged.",
    "resolveConflictsWithAgent": "Resolve conflicts with agent",
    "confirmResolveConflictsWithAgentTitle": "Resolve conflicts with agent",
    "confirmResolveConflictsWithAgentMessage": "This will try to automatically resolve all conflicted files and stage them. Review results carefully before continuing the rebase.",
    "commitMessage": "Commit message",
    "commitMessagePlaceholder": "Enter commit message...",
    "selectBranch": "Select branch",
    "selectTargetBranchTitle": "Select target branch",
    "selectSourceBranchTitle": "Select source branch",
    "branchHasWorktree": "has worktree",
    "mergeTooltip": "Merge worktree changes to a branch",
    "revertTooltip": "Revert the last merged changes",
    "confirmMerge": "Are you sure you want to {{action}} the worktree changes to the main branch? This will include any uncommitted changes.",
    "confirmRevert": "Are you sure you want to revert the last merge? This will reset the main branch to its previous state.",
    "confirmMergeTitle": "Confirm Merge",
    "confirmSquashTitle": "Confirm Squash",
    "confirmOnlyUncommittedTitle": "Confirm Apply Uncommitted Changes",
    "confirmMergeMessage": "Are you sure you want to merge the worktree changes to the selected branch?",
    "confirmSquashMessage": "Are you sure you want to squash and merge the worktree changes to the selected branch?",
    "confirmOnlyUncommittedMessage": "Are you sure you want to apply uncommitted changes from worktree to the selected branch? No git merge will be performed.",
    "mergeConflicts": "Merge failed due to conflicts between your worktree and the target branch. Please rebase your worktree first to resolve them.",
    "applyUncommittedConflicts": "Failed to apply uncommitted changes due to conflicts with the target branch. Please rebase your worktree first to align your changes.",
    "dontAskAgain": "Don't ask me again",
    "confirmRevertTitle": "Confirm Revert",
    "confirmRevertMessage": "Are you sure you want to revert the last merge? This will undo the changes that were merged from the worktree back to the main branch.",
    "revert": "Revert",
    "noChanges": "No changes"
  },
  "welcomeMessage": {
    "title": "AiderDesk",
    "subtitle": "Your AI-powered coding assistant",
    "features": {
      "title": "What you can do:",
      "aiCoding": "Generate and modify code with AI assistance",
      "contextManagement": "Add files to context for better results",
      "multiModel": "Choose from multiple AI models and providers",
      "commands": "Execute commands and run tests"
    },
    "tips": {
      "title": "Getting started:",
      "addFiles": "Add files to context using the sidebar or /add command",
      "askQuestion": "Type your request in the prompt field below",
      "useCommands": "Use / commands for quick actions",
      "switchMode": "Switch between modes using the mode selector below"
    },
    "modes": {
      "title": "Choosing the Right Mode",
      "agent": {
        "title": "Agent Mode",
        "description": "Use for autonomous tasks, complex workflows, and multi-step operations. The agent plans and executes tasks independently using available tools."
      },
      "code": {
        "title": "Code Mode",
        "description": "Use for direct code changes and specific tasks. Important: Add files to context to ensure the AI works on the right files."
      }
    }
  },
  "bmad": {
    "welcome": {
      "title": "Welcome to BMAD Mode (Preview)",
      "subtitle": "Guided workflows for planning, spec'ing, and implementing features"
    },
    "workflows": {
      "phaseProgress": "{{completed}}/{{total}} completed",
      "installedVersion": "BMAD Library installed (v{{version}})",
      "comingSoon": "Workflow list coming in Story 2.4",
      "loading": "Loading workflows...",
      "errorLoading": "Failed to load workflows: {{error}}",
      "noWorkflows": "No workflows available",
      "execute": "Execute",
      "executing": "Executing...",
      "workflowCompleted": "Workflow completed successfully",
      "workflowError": "Workflow execution failed",
      "retryExecution": "Retry",
      "research": {
        "name": "Research",
        "description": "Conduct comprehensive research across multiple domains using current web data and verified sources"
      },
      "product-brief": {
        "name": "Create Product Brief",
        "description": "Define product vision and target users"
      },
      "prd": {
        "name": "Create PRD",
        "description": "Create comprehensive requirements document"
      },
      "architecture": {
        "name": "Architecture",
        "description": "Design technical architecture and system structure"
      },
      "ux-design": {
        "name": "UX Design",
        "description": "Create UX design documentation for product interface"
      },
      "quick-spec": {
        "name": "Quick Spec",
        "description": "Create focused specifications for well-defined features"
      },
      "quick-dev": {
        "name": "Quick Dev",
        "description": "Rapid spec-to-implementation for small features"
      },
      "epics-stories": {
        "name": "Epics/Stories",
        "description": "Break down requirements into implementation-ready epics and stories"
      },
      "implementation": {
        "name": "Implementation",
        "description": "Guided development for implementing stories and features"
      }
    },
    "phase": {
      "analysis": "Analysis",
      "planning": "Planning",
      "solutioning": "Solutioning",
      "implementation": "Implementation",
      "quick-flow": "Quick Flow"
    },
    "resume": {
      "sectionTitle": "Resume Workflows",
      "button": "Resume",
      "stepIndicator": "Step {{current}} of {{total}}",
      "lastModified": "Modified {{time}}",
      "resuming": "Resuming...",
      "unavailable": "Resume unavailable - workflow file corrupted",
      "noSteps": "No progress recorded",
      "corrupted": "Corrupted",
      "corruptedDescription": "Artifact frontmatter is unreadable. Restart from beginning to recover.",
      "restartFromBeginning": "Restart from Beginning",
      "restarting": "Restarting..."
    },
    "errors": {
      "npmInstallFailed": "NPM installation failed",
      "workflowNotFound": "Workflow not found",
      "artifactMissing": "Required artifact is missing"
    },
    "hierarchy": {
      "expand": "Expand",
      "collapse": "Collapse",
      "expandAll": "Expand All",
      "collapseAll": "Collapse All",
      "workflowProgress": "Workflow Progress",
      "subtasksCompleted": "{{completed}} of {{total}} subtasks completed",
      "noSubtasks": "No subtasks"
    },
    "progress": {
      "completed": "Completed",
      "inProgress": "In Progress",
      "notStarted": "Not Started",
      "percentage": "{{percentage}}% complete"
    },
    "install": {
      "button": "Install BMAD",
      "installing": "Installing...",
      "success": "BMAD installed successfully",
      "error": "BMAD installation failed",
      "autoInstallNote": "Click the button above to automatically install BMAD for the current project.",
      "manualInstallTitle": "Manual Installation",
      "manualInstallNote": "For advanced customization, you can also install BMAD manually by running this command in your terminal.",
      "terminalPrompt": "Install BMAD to access guided workflows for planning, spec'ing, and implementing features.",
      "commandLabel": "Command that will be executed:",
      "openTerminal": "Open Terminal & Install",
      "opening": "Opening Terminal...",
      "terminalError": "Failed to open terminal",
      "autoCheckNote": "This page will automatically detect when BMAD installation is complete.",
      "benefits": [
        "Structured workflows from brainstorming to implementation",
        "Automatic context preparation (50-80% cost savings)",
        "No context-switching between tools",
        "Smart next-step recommendations"
      ]
    },
    "tabs": {
      "fullWorkflow": "Full Workflow",
      "quickFlow": "Quick Flow"
    },
    "pathInfo": {
      "fullWorkflow": {
        "title": "Full Workflow",
        "description": "Use for new projects, complex features, or when requirements need exploration. Guides you through analysis, planning, solutioning, and implementation phases.",
        "whenToUse": "When to use:",
        "useCases": {
          "newProject": "New project from scratch",
          "complexFeature": "Complex feature development",
          "unclearRequirements": "Unclear or evolving requirements",
          "teamCollaboration": "Team collaboration needed"
        }
      },
      "quickFlow": {
        "title": "Quick Flow",
        "description": "Skip planning phases for small, well-understood work. Create a quick spec and go directly to implementation.",
        "whenToUse": "When to use:",
        "useCases": {
          "bugFixes": "Bug fixes",
          "smallFeatures": "Small feature additions",
          "refactoring": "Refactoring tasks",
          "wellDefined": "Well-defined changes"
        }
      }
    },
    "artifact": {
      "openFile": "Open file",
      "notCreated": "Not created yet"
    },
    "taskActions": {
      "loading": "Loading BMAD workflows...",
      "error": "Failed to load BMAD status",
      "resumeSection": "Resume Workflows",
      "workflowsSection": "Follow-up workflows",
      "noWorkflows": "No workflows available",
      "execute": "Execute",
      "entryPoint": "Entry point - start your project here",
      "recommendedAfter": "Recommended after completing"
    },
    "reset": {
      "bannerTitle": "Reset Workflow Progress",
      "bannerDescription": "This will permanently delete all files in the _bmad-output folder. If you have a completed workflow or want to preserve your progress, backup the files from _bmad-output/ to docs/ or another location first.",
      "button": "Reset",
      "resetting": "Resetting...",
      "confirmTitle": "Reset Workflow Progress?",
      "confirmDescription": "This action will permanently delete all generated artifacts and workflow progress in the _bmad-output folder. This cannot be undone.",
      "confirmButton": "Reset All Progress",
      "success": "Workflow progress has been reset",
      "error": "Failed to reset workflow progress"
    }
  }
}

================
File: src/common/locales/zh.json
================
{
  "languages": {
    "en": "English",
    "zh": "中文"
  },
  "common": {
    "settings": "设置",
    "cancel": "取消",
    "save": "保存",
    "delete": "删除",
    "edit": "编辑",
    "add": "添加",
    "remove": "移除",
    "close": "关闭",
    "confirm": "确认",
    "back": "返回",
    "next": "下一步",
    "previous": "上一个",
    "of": "共",
    "finish": "完成",
    "loading": "加载中...",
    "startingUp": "正在启动...",
    "loadingProjectSettings": "正在加载项目设置...",
    "loadingProject": "加载项目中...",
    "loadingTask": "正在加载任务...",
    "loadingMessages": "正在加载消息...",
    "error": "错误",
    "success": "成功",
    "warning": "警告",
    "info": "信息",
    "yes": "是",
    "no": "否",
    "retry": "重试",
    "open": "打开",
    "openProject": "打开项目",
    "lock": "锁定",
    "default": "默认",
    "suffix.billion": "十亿",
    "suffix.million": "百万",
    "suffix.thousand": "千",
    "ok": "确定",
    "collapse": "收起",
    "expand": "展开",
    "enabled": "已启用",
    "noFiles": "没有找到文件",
    "clickToRefresh": "点击刷新",
    "closeTasks": "关闭任务",
    "toggleTasks": "切换任务"
  },
  "search": {
    "placeholder": "查找...",
    "previousResult": "上一个结果 (SHIFT + F3)",
    "nextResult": "下一个结果 (F3)"
  },
  "onboarding": {
    "title": "欢迎使用 AiderDesk",
    "description": "AiderDesk 是您的 AI 辅助编程桌面伴侣。本应用将 Aider 的 AI 编程助手功能带到用户友好的界面中，帮助您：",
    "skipForNow": "暂时跳过",
    "finish": "完成设置",
    "features": {
      "1": "管理多个编程项目",
      "2": "跟踪您的 AI 使用情况和成本",
      "3": "以结构化方式与 AI 模型交互",
      "4": "可视化和管理您的代码文件",
      "5": "使用代理流程进行自动化编码任务并连接到 MCP 服务器"
    },
    "getStarted": "让我们从配置您的 Aider 设置开始。",
    "steps": {
      "welcome": "欢迎",
      "connectModel": "连接AI模型",
      "language": "语言",
      "aider": "Aider",
      "agent": "AI代理",
      "providers": "提供商",
      "finish": "完成"
    },
    "language": {
      "title": "选择您的语言",
      "description": "为应用程序界面选择您的首选语言。"
    },
    "aider": {
      "title": "配置 Aider",
      "description": "要开始使用，请配置您的 Aider 设置。您需要：",
      "options": {
        "1": "添加您想要使用的 LLM 提供商的 API 密钥",
        "2": "为 Aider 设置任何其他选项",
        "3": ".env 和 .aider.conf.yaml 文件也会像使用 Aider 一样被读取"
      },
      "configureLater": "您也可以稍后在设置中进行配置。",
      "fineTuneTitle": "微调 Aider（可选）",
      "fineTuneDescription": "高级用户可以配置额外的 Aider 设置和环境变量。此步骤完全可选，可以安全跳过。",
      "fineTuneNote": "注意：这些设置适用于想要自定义 Aider 行为的高级用户。大多数用户可以跳过此步骤，如需要可稍后在设置中配置。"
    },
    "providers": {
      "title": "模型提供商",
      "description": "配置您的 LLM 提供商以在 Aider 和 Agent 模式中使用。您可以为各种提供商设置 API 密钥和其他设置。",
      "configureLater": "如果您愿意，可以稍后在设置中配置这些。",
      "connectTitle": "连接您的AI模型",
      "connectDescription": "AiderDesk 支持多个AI提供商，包括OpenAI、Anthropic、Google Gemini等。您的API密钥安全存储在本地机器上，绝不会被共享。",
      "advancedUsersNote": "高级用户：您也可以在下一步的Aider配置部分使用环境变量配置提供商。",
      "advancedSettings": "高级设置",
      "order": "排序",
      "orderDescription": "按顺序尝试的提供商列表（例如 [\"anthropic\", \"openai\"]）",
      "allowFallbacks": "允许备用选项",
      "allowFallbacksDescription": "当主提供商不可用时是否允许使用备用提供商",
      "dataCollection": "数据收集",
      "dataCollectionDescription": "控制是否使用可能存储数据的提供商",
      "only": "仅限",
      "onlyDescription": "仅允许用于此请求的提供商列表",
      "ignore": "忽略",
      "ignoreDescription": "为此请求跳过的提供商列表",
      "quantizations": "量化",
      "quantizationsDescription": "按量化级别过滤的列表（例如 [\"int4\", \"int8\"]）",
      "sort": "排序",
      "sortDescription": "按价格或吞吐量对提供商进行排序",
      "requireParameters": "要求参数",
      "requireParametersDescription": "是否要求提供商支持模型参数。",
      "setupLater": "您也可以稍后在设置中配置这些。"
    },
    "agent": {
      "title": "认识您的AI代理",
      "description": "通过 AiderDesk 的代理模式发现自主AI辅助的强大功能。您的AI代理可以独立工作来完成复杂任务。",
      "capabilities": "代理功能：",
      "autonomousPlanning": "自主任务规划：",
      "autonomousPlanningDesc": "将复杂请求分解为可管理的步骤并系统性地执行它们。",
      "toolUse": "工具使用：",
      "toolUseDesc": "利用各种工具进行文件操作、网络搜索和代码分析。",
      "extensible": "通过MCP扩展：",
      "extensibleDesc": "连接到模型上下文协议服务器以增强功能。",
      "configureAgent": "配置代理",
      "finishLater": "完成设置（稍后配置代理）",
      "configureTitle": "配置您的代理（可选）",
      "configureDescription": "自定义您的默认代理配置以匹配您的工作流程。您可以调整工具权限、上下文偏好和行为规则等设置。"
    },
    "complete": {
      "title": "设置完成！",
      "description": "恭喜！您已成功设置 AiderDesk。现在您可以开始使用 AI 辅助编程了。",
      "ready": "点击'完成设置'开始您的编程之旅。",
      "success": "引导完成成功！欢迎使用 AiderDesk。"
    },
    "errors": {
      "navigationFailed": "导航失败。请重试。",
      "finishFailed": "完成引导失败。请重试。"
    }
  },
  "noProjectsOpen": {
    "welcome": "欢迎使用",
    "description": "要开始使用，请打开一个项目目录。这将允许您熟悉和喜爱的 Aider 与您的代码一起工作。"
  },
  "home": {
    "title": "首页",
    "noProjectsOpen": "没有打开的项目",
    "openProject": "打开项目",
    "addFile": "添加文件",
    "projectView": "项目视图",
    "recentProjects": "最近的项目"
  },
  "tips": {
    "multipleProjects": "提示：您可以打开多个项目并使用顶部的标签页(或 CTRL+Tab)在它们之间切换。"
  },
  "mcpServer": {
    "addServer": "添加 MCP 服务器",
    "editServer": "编辑 MCP 服务器: {{name}}",
    "serverConfigJson": "服务器配置 JSON",
    "pasteServerAs": "粘贴您的服务器配置为:\n\n{{example}}\n\n或\n\n{{exampleNoParent}}\n\n或\n\n{{exampleBare}}",
    "invalidConfig": "无效配置",
    "emptyConfig": "配置不能为空",
    "configHint": "您可以一次添加多个服务器，方法是粘贴包含多个服务器配置的 JSON 对象。您还可以在 env 和 args 中使用 ${projectDir} 来引用当前项目目录。",
    "viewExamples": "查看示例"
  },
  "model": {
    "label": "模型",
    "selectLabel": "模型",
    "placeholder": "输入模型名称",
    "chooseModelsToAdd": "选择要添加的模型...",
    "library": {
      "all": "全部",
      "deleteMemoryTitle": "删除记忆",
      "deleteMemoryDialogText": "您确定要删除此记忆吗？"
    }
  },
  "modelLibrary": {
    "enableVoiceControl": "启用语音控制",
    "enableVoiceControlOnlyOneInfo": "为此提供商启用语音控制。一次只能启用一个提供商。",
    "voiceControl": "语音控制",
    "voiceControlDescription": "使用语音转文本功能直接将您的提示语音输入到聊天输入框中。",
    "voiceEnabled": "语音交互已启用",
    "title": "模型库",
    "selectAll": "全选",
    "clearSelection": "清除选择",
    "hideSelected": "隐藏选中",
    "unhideSelected": "显示选中",
    "selectedCount": "已选择 {{count}} 个",
    "bulkActions": "操作",
    "search": "搜索模型",
    "providers": "提供商",
    "all": "全部",
    "refresh": "刷新",
    "selectProvider": "选择要配置的提供商",
    "editProvider": "编辑提供商",
    "profileForm": {
      "title": "配置 {{provider}} 提供商的配置文件",
      "name": "配置文件名称",
      "id": "提供商 ID 前缀",
      "parameters": "提供商参数",
      "headers": "自定义头部",
      "headerKey": "头部名称",
      "headerValue": "头部值",
      "addHeader": "添加头部",
      "test": "测试并加载模型"
    },
    "noProvidersConfigured": "尚未配置任何提供商",
    "addProvider": "添加提供商",
    "addFirstProvider": "添加您的第一个提供商",
    "searchPlaceholder": "搜索模型...",
    "showingAllModels": "显示来自所有提供商的 {{count}} 个模型",
    "showingModelsFromProviders": "显示来自 {{providerCount}} 个提供商的 {{modelCount}} 个模型",
    "noModelsMatchSearch": "没有模型匹配您的搜索",
    "selectProvidersToViewModels": "选择上面的提供商配置文件以查看其模型",
    "noModelsFromSelectedProviders": "所选提供商没有可用的模型",
    "addModel": "添加模型",
    "editModel": "编辑模型",
    "provider": "提供商",
    "modelId": "模型 ID",
    "modelIdPlaceholder": "例如 custom-gpt-4-turbo",
    "maxInputTokens": "上下文窗口",
    "maxOutputTokens": "最大输出令牌数",
    "limit": "限制",
    "temperature": "温度",
    "temperatureTooltip": "控制模型响应的随机性。较低的值（0.0-0.3）产生更专注和确定性的输出，而较高的值（0.7-1.0）生成更有创意和多样化的响应。当未设置时，使用模型的默认温度。",
    "cacheWrites": "缓存写入",
    "cachedInput": "缓存输入",
    "inputCost": "输入",
    "outputCost": "输出",
    "inputTokenCost": "每百万令牌输入成本",
    "outputTokenCost": "每百万令牌输出成本",
    "cacheReadInputTokenCost": "缓存读取成本 / 每百万令牌",
    "cacheWriteInputTokenCost": "缓存写入成本 / 每百万令牌",
    "supportsTools": "支持工具",
    "deleteProfileTitle": "删除配置文件",
    "deleteProfileConfirm": "您确定要删除配置文件 '{{name}}' 吗？",
    "hidden": "隐藏",
    "showModel": "显示模型",
    "hideModel": "隐藏模型",
    "showHidden": "显示隐藏",
    "errors": {
      "idRequired": "模型 ID 必填",
      "providerRequired": "提供商必填",
      "invalidTokenCount": "令牌数必须为正数",
      "invalidCost": "成本必须为非负数",
      "invalidTemperature": "温度必须在 0 到 2 之间",
      "duplicateId": "提供商 ID 已存在"
    },
    "claudeAgentSdkAuthRequired": "此提供商需要安装和认证 Claude Code CLI。请从 https://claude.com/product/claude-code 安装并运行 `claude login` 进行认证。",
    "claudeAgentSdkAgentOnly": "此提供商仅在代理模式下工作，不支持代码/询问/架构/上下文模式。",
    "overrides": {
      "title": "提供商覆盖",
      "resetToDefaults": "清除覆盖",
      "overridesProviderParameters": "覆盖一些提供商参数"
    },
    "disableStreaming": "禁用流式传输",
    "disableStreamingInfo": "禁用响应流式传输。当提供商或模型不支持流式传输时使用此选项。",
    "disable": "禁用",
    "enable": "启用",
    "providerDisabled": "此提供商已被禁用。其模型将不可用。"
  },
  "openai": {
    "apiKey": "API 密钥",
    "baseUrl": "基础 URL",
    "modelName": "模型",
    "baseUrlPlaceholder": "例如 http://localhost:8080/v1",
    "useWebSearch": "使用网络搜索",
    "useWebSearchTooltip": "启用后，模型将使用 OpenAI 的网络搜索工具来访问互联网上的当前信息。"
  },
  "ollama": {
    "baseUrl": "基础 URL",
    "baseUrlPlaceholder": "例如 http://localhost:11434/api"
  },
  "lmstudio": {
    "baseUrl": "基础 URL",
    "baseUrlPlaceholder": "例如 http://localhost:1234/v1"
  },
  "gpustack": {
    "name": "GPUStack",
    "baseUrl": "基础 URL",
    "baseUrlPlaceholder": "http://localhost",
    "apiKey": "API 密钥"
  },
  "zaiPlan": {
    "apiKey": "API 密钥",
    "mcp": {
      "title": "MCP 服务器",
      "infoTooltip": "添加 Z.AI Coding Plan MCP 服务器以为智能体启用更多功能。",
      "vision": {
        "name": "视觉",
        "description": "使用 GLM-4.6V 模型进行图像和视频分析"
      },
      "zread": {
        "name": "Zread",
        "description": "搜索和阅读 GitHub 仓库文档和代码"
      },
      "webReader": {
        "name": "网页阅读器",
        "description": "获取和提取网页内容"
      },
      "webSearch": {
        "name": "网页搜索",
        "description": "搜索网络获取实时信息"
      },
      "add": "添加",
      "adding": "添加中...",
      "configured": "已配置"
    },
    "thinkingEnabled": "启用思考",
    "thinkingEnabledTooltip": "启用时，模型将使用思考模式进行更深入的推理（默认）。对于简单任务，可以禁用以获得更快的响应速度。"
  },
  "anthropic": {
    "apiKey": "API 密钥",
    "baseUrl": "基础 URL",
    "baseUrlPlaceholder": "例如 https://api.anthropic.com"
  },
  "minimax": {
    "apiKey": "API 密钥"
  },
  "synthetic": {
    "apiKey": "API 密钥"
  },
  "gemini": {
    "apiKey": "API 密钥",
    "customBaseUrl": "自定义基础 URL",
    "thinkingBudget": "思考预算 (令牌)",
    "includeThoughts": "包含思考过程",
    "includeThoughtsTooltip": "启用后，代理的内部思考过程将包含在对话历史中，这有助于调试或理解其决策。",
    "useSearchGrounding": "使用搜索基础",
    "useSearchGroundingTooltip": "启用后，代理将使用搜索结果作为其响应的基础，从而提高准确性和相关性。"
  },
  "groq": {
    "apiKey": "API 密钥",
    "modelPlaceholder": "例如 moonshotai/kimi-k2-instruct"
  },
  "kimiPlan": {
    "apiKey": "API 密钥"
  },
  "deepseek": {
    "apiKey": "API 密钥"
  },
  "bedrock": {
    "apiKey": "API 密钥",
    "region": "区域",
    "regionPlaceholder": "例如 us-east-1",
    "accessKeyId": "访问密钥 ID",
    "accessKeyIdTooltip": "AWS 访问密钥 ID。如果设置了 AWS_PROFILE 环境变量，可以留空。",
    "secretAccessKey": "秘密访问密钥",
    "secretAccessKeyTooltip": "AWS 秘密访问密钥。如果设置了 AWS_PROFILE 环境变量，可以留空。",
    "sessionToken": "会话令牌",
    "sessionTokenTooltip": "临时凭证的可选会话令牌。"
  },
  "cerebras": {
    "apiKey": "API 密钥"
  },
  "openRouter": {
    "apiKey": "API 密钥",
    "modelPlaceholder": "例如 anthropic/claude-3.7-sonnet"
  },
  "opencode": {
    "apiKey": "API 密钥"
  },
  "requesty": {
    "apiKey": "API 密钥",
    "modelPlaceholder": "例如 claude-4-sonnet"
  },
  "azure": {
    "apiKey": "API 密钥",
    "resourceName": "资源名称",
    "apiVersion": "API 版本",
    "addCustomModelInfo": "Azure 提供商的模型无法自动加载，您需要手动使用“+ 添加模型”添加它们，并确保模型名称与部署名称匹配。"
  },
  "providers": {
    "anthropic": "Anthropic",
    "anthropic-compatible": "Anthropic 兼容",
    "bedrock": "Bedrock",
    "cerebras": "Cerebras",
    "claude-agent-sdk": "Claude Agent SDK",
    "deepseek": "Deepseek",
    "gemini": "Gemini",
    "groq": "Groq",
    "kimi-plan": "Kimi Coding Plan",
    "gpustack": "GPUStack",
    "lmstudio": "LM Studio",
    "litellm": "LiteLLM",
    "minimax": "Minimax",
    "ollama": "Ollama",
    "openai": "OpenAI",
    "opencode": "OpenCode ZEN",
    "openai-compatible": "OpenAI Compatible",
    "openrouter": "OpenRouter",
    "requesty": "Requesty",
    "synthetic": "Synthetic",
    "vertex-ai": "Vertex AI",
    "zai-plan": "Z.AI Coding Plan",
    "azure": "Azure"
  },
  "select": {
    "placeholder": "选择选项",
    "loadingTasks": "正在加载任务..."
  },
  "settings": {
    "title": "设置",
    "tabs": {
      "general": "通用",
      "providers": "模型提供者",
      "aider": "Aider",
      "agents": "代理",
      "hotkeys": "快捷键",
      "server": "服务器",
      "memory": "记忆",
      "tasks": "任务",
      "voice": "语音",
      "about": "关于"
    },
    "hotkeys": {
      "projectHotkeys": "项目快捷键",
      "taskHotkeys": "任务快捷键",
      "dialogHotkeys": "对话框快捷键",
      "closeProject": "关闭项目",
      "newProject": "新建项目",
      "usageDashboard": "使用情况面板",
      "modelLibrary": "模型库",
      "settings": "设置",
      "cycleNextProject": "切换到下一个项目",
      "cyclePrevProject": "切换到上一个项目",
      "switchProject": "切换到项目 {{number}}",
      "switchTask": "切换到任务 {{number}}",
      "focusPrompt": "聚焦提示框",
      "newTask": "新建任务",
      "closeTask": "关闭任务",
      "browseFolder": "浏览文件夹",
      "enterHotkey": "输入快捷键...",
      "resetToDefaults": "重置为默认值",
      "hotkeyFormat": "快捷键格式：",
      "modKey": "使用 'mod' 表示 Cmd (Mac) 或 Ctrl (Windows/Linux)",
      "multipleKeys": "用逗号分隔多个按键组合",
      "examples": "示例：'mod+w'、'ctrl+shift+t'、'alt+1,meta+1'",
      "clickToRecord": "点击录制",
      "recording": "按下按键...",
      "addShortcut": "添加快捷键",
      "editShortcut": "编辑快捷键",
      "clearShortcut": "清除快捷键",
      "noShortcut": "未配置快捷键",
      "recordShortcutDescription": "点击下方的录制按钮，然后按下您想要用作快捷键的组合键。",
      "pressKeysToRecord": "按键录制中...",
      "startRecording": "开始录制",
      "stopRecording": "停止录制"
    },
    "gui": "GUI",
    "voice": {
      "title": "语音",
      "providerProfile": "提供者配置",
      "model": "模型",
      "idleTimeout": "空闲超时（秒）",
      "idleTimeoutHelp": "静音达到该时间后自动停止录音",
      "systemInstructions": "系统指令",
      "microphone": "麦克风",
      "microphoneDefault": "默认",
      "microphoneUnknown": "未知麦克风",
      "noSupportedProviders": "未配置支持的语音提供者。请通过模型库配置 Gemini 或 OpenAI。",
      "openai": {
        "title": "OpenAI",
        "model": "模型",
        "language": "语言"
      },
      "gemini": {
        "title": "Gemini",
        "model": "模型",
        "temperature": "温度"
      }
    },
    "startup": {
      "title": "启动",
      "emptyTask": "启动时创建新任务",
      "lastTask": "加载上次任务"
    },
    "tasks": {
      "title": "任务",
      "smartTaskState": "智能任务状态",
      "smartTaskStateTooltip": "启用后，模型会智能分析代理的响应，将任务分类为'需要更多信息'、'准备实施'或'准备审查'。禁用时，任务状态将始终设置为'准备审查'。",
      "autoGenerateTaskName": "自动生成任务名称",
      "autoGenerateTaskNameTooltip": "启用后，模型会根据您的提示生成简洁的任务名称。禁用时，将使用提示的前5个词作为任务名称。",
      "showTaskStateActions": "显示任务状态操作",
      "showTaskStateActionsTooltip": "启用后，任务状态操作将显示在消息底部。禁用以隐藏这些操作。",
      "contextManagement": "上下文管理",
      "contextCompactingThreshold": "自动压缩阈值",
      "contextCompactingThresholdTooltip": "当令牌使用量超过此阈值时，将根据所选的压缩类型自动管理对话。设置为 0 可禁用。",
      "contextCompactionType": "压缩类型",
      "contextCompactionTypeCompact": "压缩",
      "contextCompactionTypeHandoff": "交接",
      "contextCompactionTypeTooltip": "选择当令牌阈值超出时如何管理对话上下文：压缩在任务内总结对话，交接则创建一个带有交接的新任务。",
      "worktree": "工作树",
      "worktreeSymlinkFoldersLabel": "符号链接文件夹",
      "worktreeSymlinkFoldersTooltip": "这些文件夹将从项目根目录符号链接到任务工作树。适用于像 node_modules 这样的大型依赖。",
      "noSymlinkFolders": "未配置符号链接文件夹",
      "symlinkFolderPlaceholder": "文件夹名称（例如 node_modules）",
      "addSymlinkFolder": "添加",
      "removeSymlinkFolder": "移除文件夹"
    },
    "language": "语言",
    "notifications": {
      "title": "通知"
    },
    "agent": {
      "mcpServers": "MCP 服务器",
      "provider": "提供商",
      "providerSettings": "提供商设置",
      "context": "上下文",
      "addRuleFiles": "将项目中的 `.aider-desk/rules` 目录下的规则文件添加为只读文件。",
      "runSettings": "运行参数",
      "maxIterations": "最大迭代次数",
      "minTimeBetweenToolCalls": "工具调用最小间隔时间(毫秒)",
      "maxTokens": "最大令牌数",
      "temperature": "温度",
      "rules": "自定义指令",
      "rulesInfo": "您可以使用自定义指令为特定的 MCP 服务器添加特定指令，或控制代理的流程。",
      "noServersConfigured": "未配置 MCP 服务器。",
      "computationalResources": "代理每次运行的最大迭代次数。有助于控制计算资源。",
      "rateLimiting": "设置工具调用之间的最小时间以防止速率限制(例如对于 Brave 或其他 API 受限的服务)。",
      "temperatureTooltip": "控制响应的随机性。较低的值（0.0-0.3）使响应更专注和确定性，较高的值（0.7-1.0）使响应更有创意和变化性。当未设置时，使用模型的默认温度。",
      "tokensPerResponse": "代理每次响应可以使用的最大令牌数。当未设置时，使用模型的默认最大输出令牌数。",
      "addMcpServer": "添加",
      "editConfig": "编辑配置",
      "editMcpServersConfig": "编辑 MCP 服务器配置",
      "reloadServers": "重新加载",
      "powerToolsTooltip": "允许代理使用强大的工具进行直接文件操作（读、写、编辑）、搜索（glob、grep、语义搜索）和执行 shell 命令（bash）。",
      "aiderToolsTooltip": "代理可以使用Aider执行添加/删除上下文文件操作和运行提示。",
      "useAiderTools": "使用Aider工具",
      "usePowerTools": "使用 Power 工具",
      "useTodoTools": "使用 Todo 工具",
      "useTaskTools": "使用任务工具",
      "useMemoryTools": "使用记忆工具",
      "useSkillsTools": "使用 Skills 工具",
      "includeContextFiles": "包含上下文文件",
      "includeFilesTooltip": "将上下文文件内容添加到代理的聊天中。这将增加令牌使用量。",
      "includeRepoMap": "包含仓库地图",
      "includeRepoMapTooltip": "在代理的上下文中包含仓库地图。这有助于代理理解项目结构，但可能会增加token使用量。",
      "autoApprove": "自动批准",
      "override": "覆盖",
      "clearOverride": "清除覆盖",
      "selectOrCreateProfile": "选择或创建新的代理配置",
      "newProfileName": "新配置",
      "bashToolAllowedPattern": "始终允许的模式",
      "bashToolDeniedPattern": "拒绝的模式",
      "bashToolAllowedPatternPlaceholder": "例如: 'ls .*;cat .*'",
      "bashToolDeniedPatternPlaceholder": "例如: 'rm .*'",
      "bashToolAllowedPatternTooltip": "匹配这些用 ; 分隔的正则表达式模式的命令无需批准即可执行",
      "bashToolDeniedPatternTooltip": "匹配这些用 ; 分隔的正则表达式模式的命令将始终被拒绝执行",
      "envVarPlaceholder": "{{envVar}}",
      "envVarFoundPlaceholder": "找到于: {{source}}",
      "createNewProfile": "创建新配置",
      "genericTools": "工具",
      "noGenericToolsConfigured": "未配置工具。",
      "todoTools": "待办工具",
      "includeTodoToolsTooltip": "允许代理管理待办事项列表，包括设置、获取、更新和清除它们。",
      "subagent": {
        "title": "子代理",
        "enableAsSubagent": "启用为子代理",
        "enableAsSubagentInformation": "启用后，此配置可被其他代理用作子代理。",
        "canUseSubagents": "可以使用子代理",
        "canUseSubagentsInformation": "启用后，此代理可以使用其他代理作为子代理。",
        "contextMemory": "上下文记忆",
        "contextMemoryTooltip": "控制子代理记住多少之前的对话上下文。'完整上下文' 保持所有历史记录，'最后消息' 仅使用最近的互动，'关闭' 每次重新开始。",
        "contextMemory.off": "关闭",
        "contextMemory.fullContext": "完整上下文",
        "contextMemory.lastMessage": "最后消息",
        "description": "描述",
        "descriptionPlaceholder": "描述此子代理的目的、能力和专长...",
        "systemPrompt": "系统提示",
        "systemPromptPlaceholder": "输入此配置用作子代理时的自定义系统提示指令...",
        "invocationMode": "调用方式",
        "invocationModeOnDemand": "按需",
        "invocationModeOnDemandInformation": "子代理仅在父代理明确请求时才使用。",
        "invocationModeAutomatic": "自动",
        "invocationModeAutomaticInformation": "子代理可由父代理在适当时自动调用。",
        "statusDisabled": "已禁用",
        "statusOnDemand": "按需",
        "statusAutomatic": "自动",
        "descriptionRequiredForAutomatic": "需要设置描述才能自动使用此子代理，否则只能在用户明确请求时使用该子代理。",
        "on-demand": "仅在明确请求时按需使用",
        "automatic": "在适当时自动使用"
      },
      "skills": {
        "activating": "正在激活 {{name}} 技能...",
        "activated": "已激活 {{name}} 技能",
        "skill": "技能"
      },
      "profileContext": "配置上下文",
      "globalProfiles": "全局配置",
      "projectProfiles": "项目配置: {{projectName}}",
      "global": "全局",
      "previousContext": "上一个项目",
      "nextContext": "下一个项目",
      "noProfilesInContext": "此上下文中没有配置",
      "createNewProfileInContext": "创建新配置",
      "copyProfile": "复制",
      "cutProfile": "剪切",
      "deleteProfile": "删除",
      "pasteProfile": "粘贴代理",
      "resetProfileToDefaults": "重置为默认值",
      "resetProfileTitle": "将 '{{name}}' 重置为默认值？",
      "resetProfileConfirm": "这将把 '{{name}}' 恢复到原始默认设置。任何自定义修改都将丢失。",
      "restoreProfile": "恢复",
      "restoreProfileTooltip": "恢复此默认配置"
    },
    "aider": {
      "options": "选项",
      "optionsPlaceholder": "例如 --no-auto-commits --cache-prompts",
      "autoCommits": "启用自动提交",
      "cachingEnabled": "启用提示缓存",
      "watchFiles": "监视文件变化",
      "environmentVariables": "环境变量",
      "envVarsPlaceholder": "#################\n# LLM 参数:\n#\n# 包含 xxx_API_KEY 参数和您的 LLM 所需的其他参数。\n# 详情请见 https://aider.chat/docs/llms.html\n\n## OpenAI\n#OPENAI_API_KEY=\n\n## Anthropic\n#ANTHROPIC_API_KEY=",
      "optionsDocumentation": "查看文档了解可用选项：https://aider.chat/docs/faq.html#how-can-i-pass-command-line-options-to-aider",
      "envVarsDocumentation": "查看文档了解环境变量：https://aider.chat/docs/llms.html",
      "addRuleFiles": "将项目中的 `.aider-desk/rules` 目录下的规则文件添加为只读文件。",
      "confirmBeforeEdit": "编辑文件前确认"
    },
    "common": {
      "showSecrets": "显示密钥",
      "learnMore": "了解更多"
    },
    "notificationsEnabled": "通知已启用",
    "zoom": "缩放级别",
    "theme": "主题",
    "font": "字体",
    "fontSize": "字体大小",
    "fontOptions": {
      "sono": "Sono (色)",
      "poppins": "Poppins ",
      "nunito": "Nunito",
      "quicksand": "Quicksand",
      "playfairDisplay": "Playfair Display",
      "lora": "Lora",
      "merriweather": "Merriweather",
      "spaceGrotesk": "Space Grotesk",
      "orbitron": "Orbitron"
    },
    "themeOptions": {
      "dark": "深色",
      "light": "浅色",
      "ocean": "海洋",
      "forest": "森林",
      "lavender": "薰衣草",
      "bw": "黑白",
      "midnight": "午夜",
      "neon": "霓虹",
      "neopunk": "赛博朋克",
      "charcoal": "炭灰",
      "aurora": "极光",
      "serenity": "宁静",
      "fresh": "清新",
      "botanical-garden": "植物园",
      "botanical-garden-dark": "植物园（深色）"
    },
    "aiderRestartConfirm": {
      "title": "需要重启",
      "message": "对 Aider 选项或环境变量的更改需要重新启动 Aider 任务才能生效。您想现在重新启动吗？",
      "restartNow": "立即重启",
      "later": "稍后处理"
    },
    "models": {
      "title": "模型提供商",
      "description": "配置您的 LLM 提供商以在 Aider 和 Agent 模式中使用。点击提供商卡片来配置其设置。",
      "configured": "已配置",
      "notConfigured": "未配置",
      "agentOnly": "仅代理",
      "showAllProviders": "显示所有提供商",
      "additionalProvidersInfo": "需要更多提供商？您可以在<aiderTab>Aider 设置</aiderTab>中通过设置环境变量来配置更多 LLM 提供商。"
    },
    "vertexAi": {
      "project": "项目",
      "projectPlaceholder": "输入您的 Google Cloud 项目 ID",
      "location": "位置",
      "locationPlaceholder": "输入您的 Google Cloud 位置",
      "credentials": "Google Cloud 凭据 (可选)",
      "credentialsPlaceholder": "输入您的 Google Cloud 凭据 JSON"
    },
    "about": {
      "version": "版本",
      "notAvailable": "不可用",
      "checkForUpdates": "检查更新",
      "newAiderVersionAvailable": "新的 Aider 版本可用 ({{version}}) - 重启 AiderDesk 以安装。",
      "updateAvailable": "有可用更新",
      "downloadUpdate": "下载",
      "downloadingUpdate": "正在下载更新",
      "newAiderDeskVersionReady": "新版本已准备好。重启 AiderDesk 以应用更新。",
      "downloadAutomatically": "自动下载更新",
      "releaseNotes": "发行说明",
      "openLogsDirectory": "打开日志目录",
      "openLogsError": "打开日志目录出错"
    },
    "messages": {
      "title": "消息显示",
      "display": "显示选项",
      "markdownRendering": "启用 Markdown 渲染",
      "diffViewMode": "差异视图模式",
      "viewMode": "消息视图模式",
      "viewModeFull": "完整",
      "viewModeCompact": "紧凑",
      "virtualizedRendering": "使用虚拟化渲染（实验性）",
      "virtualizedRenderingTooltip": "实验性功能，当您在对话历史中有大量消息时可以通过仅渲染可见消息来提高性能。"
    },
    "memory": {
      "configuration": "配置",
      "description": "配置 AI 记忆功能以增强对话连续性和跨会话的上下文保留能力。",
      "enabled": {
        "label": "启用",
        "description": "启用 AI 记忆功能以在对话和会话之间记住重要信息。"
      },
      "model": {
        "label": "模型"
      },
      "provider": {
        "label": "嵌入提供商",
        "description": "选择用于记忆功能的嵌入提供商"
      },
      "maxDistance": {
        "label": "相关性阈值",
        "description": "值越高会检索到更多（但相关性更低）的记忆。值越低会检索到更少（但相关性更高）的记忆。"
      },
      "embeddingProgress": {
        "loadingModel": "正在加载嵌入模型：{{status}}",
        "reEmbedding": "正在重新嵌入记忆：{{done}}/{{total}}",
        "error": "嵌入迁移失败：{{error}}"
      },
      "memories": {
        "title": "记忆",
        "project": "项目",
        "allProjects": "所有项目",
        "loading": "正在加载记忆...",
        "empty": "未找到记忆。",
        "delete": "删除",
        "deleteAllForProject": "删除该项目的全部记忆",
        "deleteDialogTitle": "删除记忆",
        "deleteDialogText": "删除记忆",
        "deleteProjectDialogTitle": "删除项目记忆",
        "deleteProjectDialogText": "删除该项目的所有记忆",
        "projectId": "projectId",
        "id": "id"
      }
    }
  },
  "messages": {
    "thinking": "思考中...",
    "loading": "加载中...",
    "copy": "复制",
    "copied": "已复制!",
    "interrupted": "被用户中断。",
    "taskInterrupted": "任务中断",
    "taskInterruptedDescription": "任务在进行过程中被用户中断。",
    "delete": "删除",
    "redo": "重做",
    "edit": "编辑",
    "forkFromHere": "从这里创建子任务",
    "editingLastMessage": "正在编辑最后一条消息",
    "cancelEdit": "取消编辑",
    "group": "分组",
    "scrollToBottom": "滚动到底部",
    "previousUserMessage": "上一条用户消息",
    "nextUserMessage": "下一条用户消息",
    "messageBar": "消息栏",
    "exportNotAvailableWithVirtualized": "使用虚拟化消息渲染时无法导出为图片。请在 设置 -> 常规 -> 消息显示 中更改为标准渲染。",
    "execute": "执行",
    "resume": "继续",
    "taskReadyForReview": "任务准备就绪，待审查",
    "taskTodo": "任务未开始",
    "taskTodoDescription": "任务尚未开始。点击执行开始。",
    "markAsDone": "标记为完成",
    "taskReadyForImplementation": "任务准备就绪，待实施",
    "taskDone": "任务已完成",
    "taskDoneArchived": "任务已完成并已归档",
    "proceed": "继续",
    "archive": "归档",
    "unarchive": "取消归档",
    "confirmDelete": "确认删除",
    "remove": "移除消息",
    "deleteUpToHere": "删除到此为止"
  },
  "errors": {
    "frozenTitle": "AIDER冻结了?",
    "frozenMessage": "Aider进程似乎已冻结。您想重启任务吗?",
    "removeMessageFailed": "删除消息失败 - 请重试",
    "forkTaskFailed": "从消息分叉任务失败 - 请重试",
    "removeMessagesUpToFailed": "删除到此为止的消息失败 - 请重试"
  },
  "dialogs": {
    "confirm": "确认",
    "confirmDelete": "确定要删除吗?",
    "addFile": "添加文件",
    "openProject": "打开项目",
    "recentProjects": "最近的项目",
    "openProjectTitle": "打开项目",
    "projectPathPlaceholder": "输入项目路径或使用图标浏览",
    "openButton": "打开",
    "browseFoldersTooltip": "浏览文件夹",
    "projectAlreadyOpenWarning": "此项目已打开。",
    "cantOpenProject": "无法打开此项目。"
  },
  "mode": {
    "code": "代码",
    "ask": "提问",
    "architect": "架构",
    "context": "上下文",
    "agent": "代理",
    "bmad": "BMAD"
  },
  "modeTooltip": {
    "code": "使用 Aider AI 助手进行直接代码生成和编辑",
    "agent": "具有高级推理和工具使用能力的自主 AI 代理",
    "ask": "询问有关代码库的问题而不进行更改",
    "architect": "高级项目规划和架构设计",
    "context": "搜索和探索代码库上下文",
    "bmad": "用于规划、规范和实现功能的引导式工作流程"
  },
  "addFileDialog": {
    "title": "添加上下文文件",
    "browse": "浏览文件",
    "readOnly": "只读"
  },
  "fileFinder": {
    "addPathTooltip": "添加路径",
    "browseFile": "浏览文件",
    "browseDirectory": "浏览目录",
    "placeholder": {
      "filesOnly": "输入要添加的文件",
      "directoriesOnly": "输入要添加的目录",
      "filesAndDirectories": "输入要添加的文件或目录"
    },
    "placeholderFinish": {
      "filesOnly": "输入文件或按 Enter 键完成",
      "directoriesOnly": "输入目录或按 Enter 键完成",
      "filesAndDirectories": "输入文件或目录，或按 Enter 键完成"
    }
  },
  "fileChip": {
    "removeFileTooltip": "移除文件"
  },
  "contextFiles": {
    "title": "上下文文件",
    "updatedFiles": "已更新文件",
    "updated": "已更新",
    "add": "添加上下文文件",
    "addFileTooltip": "添加文件 (按 Ctrl/Cmd 键添加为只读)",
    "addFileTooltip.ctrl": "添加文件 (按 Ctrl 键添加为只读)",
    "addFileTooltip.cmd": "添加文件 (按 Cmd 键添加为只读)",
    "readOnly": "只读文件",
    "showAllFiles": "显示所有文件",
    "hideAllFiles": "隐藏所有文件",
    "expandAll": "全部展开",
    "collapseAll": "全部折叠",
    "dropAll": "删除所有上下文文件",
    "globalRule": "全局规则文件",
    "projectRule": "项目规则文件",
    "agentRule": "代理规则文件",
    "projectFiles": "项目文件",
    "rules": "规则文件",
    "diffViewer": {
      "file": "文件"
    },
    "search": "搜索文件",
    "searchPlaceholder": "搜索文件...",
    "refresh": "刷新",
    "useGit": "使用 Git",
    "useGitEnabled": "Git 已启用 - 点击使用文件系统",
    "useGitDisabled": "文件系统已启用 - 点击使用 Git",
    "empty": {
      "title": "没有上下文文件",
      "aiderMode": {
        "description": "在此处添加您想要读取或修改的文件。Aider 只能访问上下文中的文件。",
        "hint": "提示：添加相关文件（导入、类型）以获得更好的理解。"
      },
      "agentMode": {
        "description": "代理可以使用工具访问项目中的任何文件。在此处添加文件是可选的，但可以通过提供即时上下文来加快任务速度。",
        "hint": "提示：使用 Aider 工具时或希望将文件内容包含在提示中时，在此处添加文件。",
        "includeContextFiles": "当在代理设置中启用'包含上下文文件'时，文件内容会直接嵌入到提示中以便立即访问。"
      }
    }
  },
  "modelSelector": {
    "mainModel": "主模型",
    "editorModel": "编辑器模型",
    "weakModel": "弱模型:",
    "architectModel": "架构模型",
    "agentModel": "代理模型",
    "reasoning": "推理",
    "thinkingTokens": "思考令牌",
    "loadingModel": "加载模型中...",
    "searchPlaceholder": "搜索模型...",
    "searchPlaceholderOrCustom": "搜索模型或输入自定义名称...",
    "removePreferred": "从首选模型中移除",
    "selectModel": "选择模型...",
    "weakModelLock": "锁定弱模型",
    "weakModelUnlock": "解锁弱模型",
    "noModelSelected": "未选择模型"
  },
  "modelInfo": {
    "noInfo": "无模型信息可用。",
    "maxInputTokens": "最大输入令牌数",
    "maxOutputTokens": "最大输出令牌数",
    "inputCostPerMillion": "每百万输入令牌成本",
    "outputCostPerMillion": "每百万输出令牌成本"
  },
  "mcp": {
    "noDescription": "无描述",
    "initializingServers": "正在初始化 MCP 服务器...",
    "serverToolStatus": "已启用{{enabledCount}}个工具，共{{count}}个",
    "loading": "加载中...",
    "toolsCount_one": "{{count}}个工具",
    "toolsCount_other": "{{count}}个工具",
    "loadToolsError": "加载MCP服务器工具失败",
    "noToolsFound": "未找到工具。请检查您的配置。",
    "server_one": "服务器",
    "server_other": "服务器",
    "aider": "aider",
    "aiderOnly": "仅aider",
    "withFiles": "包含文件",
    "useAiderTools": "使用Aider工具",
    "usePowerTools": "使用 Power 工具",
    "powerToolsTooltip": "允许代理使用强大的工具进行直接文件操作（读、写、编辑）、搜索（glob、grep、语义搜索）和执行 shell 命令（bash）。",
    "aiderToolsTooltip": "代理可以使用Aider执行添加/删除上下文文件操作和运行提示。",
    "includeContextFiles": "包含上下文文件",
    "includeFilesTooltip": "将上下文文件内容添加到代理的聊天中。这将增加令牌使用量。",
    "includeRepoMap": "包含仓库地图",
    "includeRepoMapTooltip": "在代理的上下文中包含仓库地图。这有助于代理理解项目结构，但可能会增加token使用量。",
    "servers": "MCP服务器",
    "configureServers": "配置服务器",
    "approval": {
      "never": "从不",
      "always": "总是",
      "ask": "询问"
    },
    "tools": "工具"
  },
  "todo": {
    "title": "任务",
    "addTodo": "添加待办",
    "editTodo": "编辑待办",
    "deleteTodo": "删除待办",
    "todoName": "待办名称",
    "todoNamePlaceholder": "输入待办名称...",
    "saveTodo": "保存",
    "cancelTodo": "取消",
    "noTodos": "没有待办事项",
    "confirmDelete": "确定要删除这个待办事项吗？",
    "clearAllTodos": "清除所有任务",
    "handoffTodo": "交接到新任务"
  },
  "tool": {
    "noDescription": "无描述",
    "approval": {
      "never": "从不",
      "always": "总是",
      "ask": "询问"
    }
  },
  "autocompletion": {
    "placeholder": "输入以搜索..."
  },
  "costInfo": {
    "files": "文件",
    "repoMap": "仓库地图",
    "refreshRepoMap": "刷新仓库地图",
    "messages": "消息",
    "clearMessages": "清除消息历史",
    "agent": "代理",
    "aider": "Aider",
    "total": "全部的",
    "resetTask": "重置",
    "tokenUsage": "{{usedTokens}} / {{maxTokens}}",
    "contextCompactingThreshold": "自动压缩上下文阈值",
    "contextCompactingThresholdOff": "关闭",
    "contextCompactingThresholdTooltip": "当令牌使用量超过此阈值时，对话将自动压缩以节省空间。",
    "thresholdTokens": "阈值令牌数"
  },
  "commandOutput": {
    "command": "命令"
  },
  "reflectedMessage": {
    "title": "反射消息"
  },
  "responseMessage": {
    "inputTokens": "输入令牌",
    "outputTokens": "输出令牌",
    "cacheWriteTokens": "缓存写入令牌",
    "cacheReadTokens": "缓存读取令牌"
  },
  "thinkingAnswer": {
    "thinking": "思考中",
    "answer": "回答"
  },
  "toolMessage": {
    "toolLabel": "工具: {{server}}/{{tool}}",
    "arguments": "参数:",
    "executing": "执行工具...",
    "result": "结果:",
    "error": "执行工具时出错:",
    "denied": "拒绝访问",
    "deniedByReason": "用户拒绝: {{reason}}",
    "tasks": {
      "listTasks": "列出任务",
      "listTasksWithState": "列出状态为 {{state}} 的任务",
      "getTask": "获取任务",
      "getTaskMessage": "获取任务消息",
      "createTask": "创建任务",
      "deleteTask": "删除任务",
      "searchTask": "搜索任务:",
      "inTask": "在",
      "searchTaskNoMatches": "未找到匹配项。",
      "searchParentTask": "搜索父任务:",
      "inParentTask": "在",
      "searchParentTaskNoMatches": "未找到匹配项。",
      "name": "名称",
      "parentTaskId": "父任务ID",
      "execute": "执行",
      "executeInBackground": "在后台执行",
      "yes": "是",
      "no": "否",
      "taskId": "任务ID",
      "messageIndex": "消息索引",
      "prompt": "提示",
      "agentProfile": "代理配置",
      "model": "模型",
      "state": "状态",
      "contextFiles": "上下文文件",
      "contextMessages": "上下文消息",
      "currentMode": "当前模式",
      "role": "角色",
      "usage": "使用量",
      "noTasksFound": "未找到任务",
      "taskNotFound": "未找到任务",
      "messageNotFound": "未找到消息",
      "taskCreatedSuccessfully": "任务创建成功",
      "taskDeletedSuccessfully": "任务删除成功",
      "cannotDeleteCurrentTask": "无法删除当前任务",
      "active": "活跃",
      "completed": "已完成",
      "archived": "已归档",
      "user": "用户",
      "assistant": "助手",
      "readOnly": "只读",
      "createdAt": "创建于",
      "updatedAt": "更新于"
    },
    "aider": {
      "addContextFiles": "添加文件到Aider上下文:\n{{paths}}",
      "dropContextFiles": "从Aider上下文删除文件:\n{{paths}}",
      "runPrompt": "在Aider中运行提示",
      "working": "Aider 正在工作中...",
      "finishedTask": "Aider 完成了任务。",
      "noChanges": "Aider 未进行任何更改。"
    },
    "power": {
      "fileRead": {
        "title": "读取文件",
        "withLines": "带行号",
        "lineOffset": "行偏移",
        "lineLimit": "行限制"
      },
      "fileWrite": {
        "overwrite": "覆盖文件",
        "append": "追加到文件",
        "createOnly": "仅创建文件"
      },
      "fileEdit": {
        "title": "编辑文件",
        "searchTerm": "搜索词",
        "regex": "正则表达式",
        "replacementText": "替换文本",
        "replaceAll": "替换所有"
      },
      "glob": {
        "title": "查找匹配模式的文件:",
        "findingFiles": "正在查找文件...",
        "foundFiles": "找到 {{count}} 文件",
        "noMatches": "未找到文件",
        "matching": "匹配"
      },
      "grep": {
        "title": "在",
        "findingMatches": "正在查找...",
        "in": "中",

        "foundMatches": "找到 {{count}} 个匹配项",
        "noMatches": "未找到匹配项",
        "contextLines": "({{count}} 行上下文)",
        "matchesCount": "({{count}} 个匹配)",
        "lineLabel": "第 {{lineNumber}} 行:",
        "contextLabel": "上下文:"
      },
      "bash": {
        "title": "执行 shell 命令",
        "exitCode": "退出码",
        "stdout": "标准输出",
        "stderr": "标准错误",
        "commandFailed": "命令失败"
      },
      "semanticSearch": {
        "title": "语义搜索:",
        "in": "在",
        "noMatches": "未找到匹配项。",
        "foundMatches": "找到 {{count}} 个匹配项",
        "score": " (得分: {{score}})",
        "resultLabel": "结果 {{index}}"
      },
      "fetch": {
        "title": "抓取网页内容"
      }
    },
    "memory": {
      "group": "记忆",
      "storingMemory": "正在存储记忆...",
      "retrievingMemories": "正在检索记忆...",
      "deletingMemory": "正在删除记忆...",
      "updatingMemory": "正在更新记忆...",
      "listingMemories": "正在列出记忆...",
      "memoryStored": "记忆已存储。",
      "memoryUpdated": "记忆已更新。",
      "memoryDeleted": "记忆已删除。",
      "memoryId": "记忆ID",
      "type": "类型",
      "content": "内容",
      "newContent": "新内容",
      "query": "查询",
      "limit": "限制",
      "foundMemories": "找到 {{count}} 条记忆。",
      "noMemoriesFound": "未找到相关记忆。",
      "noRelevantMemories": "未找到相关记忆",
      "storedMemoryDetails": "存储的记忆详情",
      "updatedMemoryDetails": "更新的记忆详情",
      "deletedMemoryDetails": "删除的记忆详情",
      "retrievedMemories": "检索到的记忆",
      "memoryList": "记忆列表",
      "listedMemories": "正在列出记忆。",
      "ofType": "类型为 {{type}}",
      "noMemoriesOfType": "未找到类型为 {{type}} 的记忆",
      "all": "全部",
      "delete": "删除",
      "memoryNotFound": "未找到",
      "deleteDialogTitle": "删除记忆",
      "deleteDialogText": "确定要删除这条记忆吗？"
    },
    "subagents": {
      "groupRunning": "{{name}}: 子代理正在工作...",
      "groupCompleted": "{{name}}: 子代理已完成任务。",
      "running": "正在运行子代理...",
      "completed": "子代理执行了以下查询:",
      "prompt": "提示",
      "error": "运行子代理"
    },
    "errors": {
      "noSuchTool": "尝试使用未知工具: {{toolName}}",
      "invalidToolArguments": "工具参数无效: {{toolName}}"
    }
  },
  "codeBlock": {
    "revertChanges": "撤销更改"
  },
  "diffViewer": {
    "sideBySide": "并排",
    "unified": "统一",
    "compact": "紧凑",
    "noChanges": "没有进行任何更改。内容相同。"
  },
  "promptField": {
    "savePrompt": "保存提示",
    "savePromptDescription": "保存提示而不执行",
    "saveError": "保存提示失败: {{error}}",
    "autoApprove": "自动批准",
    "autoApproveTooltip": "启用后，自动批准工具执行而无需请求确认",
    "autoApproveLockTooltip": "锁定后，新建任务将保持自动批准开启",
    "placeholders": {
      "0": "更新 UserValidator 类以添加邮箱格式验证...",
      "1": "修复 DataProcessor.processBatch() 中的内存泄漏，通过关闭...",
      "2": "为 PaymentService.chargeCard() 添加错误处理，使用适当的...",
      "3": "创建 React 组件 UserProfileCard，包含 props 接口...",
      "4": "通过添加索引来优化 UserRepository.findByEmail() 中的 SQL 查询...",
      "5": "使用 Jest 和模拟为 AuthController.login() 添加单元测试...",
      "6": "在 ChartComponent 中实现缺失的 handleResize() 方法...",
      "7": "更新 package.json 添加 TypeScript 依赖并配置...",
      "8": "为 ContactForm 的 handleSubmit 函数添加输入验证...",
      "9": "修复 calculateTotal() 中小数值被错误处理的 bug...",
      "10": "使用 Winston 为 API 中间件添加请求日志记录...",
      "11": "为 Node.js 应用创建多阶段构建的 Dockerfile...",
      "12": "使用 express-rate-limit 为 /api/users 端点添加限流中间件...",
      "13": "在 TodoService 中实现缺失的 deleteTodo() 函数...",
      "14": "为 API 响应对象添加 TypeScript 接口...",
      "15": "修复移动端菜单显示不正确的 CSS 问题...",
      "16": "使用 dotenv 和 zod 添加环境变量验证...",
      "17": "创建数据库迁移，为 users 表添加 'last_login' 列...",
      "18": "为 React 应用添加错误边界以捕获组件错误...",
      "19": "在 ProductList 的 fetchProducts 方法中实现分页逻辑..."
    },
    "questionPlaceholder": "...或建议其他内容",
    "answers": {
      "yes": "(Y)是",
      "no": "(N)否",
      "always": "(A)总是",
      "dontAsk": "(D)不再询问"
    },
    "invalidCommand": "无效命令",
    "stopResponse": "停止响应",
    "sendMessage": "发送消息(Enter)",
    "clearChat": "清除聊天",
    "agentModeOnly": "仅在代理模式下可用",
    "handoffError": "交接失败：{{error}}",
    "taskInfo": "任务信息"
  },
  "agentProfiles": {
    "title": "代理配置",
    "profileSettings": "代理配置: {{profileName}}",
    "newProfileName": "新配置",
    "manageProfiles": "管理配置",
    "createNew": "创建新配置",
    "profileName": "名称",
    "profileDescription": "描述",
    "profileDescriptionPlaceholder": "描述此代理配置（用途、工具等）",
    "tools": "工具",
    "model": "模型",
    "selectProfile": "选择...",
    "saveAsProjectDefault": "保存为项目默认"
  },
  "projectBar": {
    "editFormatTooltip": "这是用于编辑代码的格式。更改它可能会导致模型表现不如预期。",
    "aider": "Aider",
    "toggleSidebar": "切换侧边栏",
    "modelLibrary": "模型库",
    "worktree": "工作树",
    "worktreeTooltip": "切换此任务的工作树"
  },
  "workingMode": {
    "local": "本地",
    "worktree": "工作树",
    "switching": "切换中...",
    "confirmLocalTitle": "切换到本地模式",
    "confirmLocalMessage": "警告：此工作树有未保存的工作：\n{{warnings}}\n\n删除工作树将删除这些工作。如果您想保留这些工作，请先使用合并操作将其合并到主分支。\n\n您确定要继续并删除工作树吗？",
    "confirmLocalAction": "删除并切换"
  },
  "workingModeTooltip": {
    "local": "在此任务中直接在本地项目目录中进行更改",
    "worktree": "使用 git 工作树为此任务进行隔离的更改"
  },
  "reasoningEffort": {
    "label": "推理工作量",
    "tooltip": "推理工作量决定模型在采取行动前的思考程度。高推理工作量意味着模型会在采取行动前思考更多，但响应时间也会更长。",
    "none": "无",
    "minimal": "最小",
    "low": "低",
    "medium": "中",
    "high": "高",
    "max": "最大"
  },
  "commands": {
    "add": "将文件添加到上下文。",
    "agent": "切换到代理模式。如果已在代理模式下，则打开代理模型选择器。命令后的任何文本都将用作提示。",
    "architect": "切换到架构师模式。架构师模式用于规划和执行代码库的更改。",
    "ask": "切换到提问模式。在不编辑任何文件的情况下询问有关代码库的问题。",
    "clear": "清除聊天历史记录",
    "clear-logs": "从聊天中移除日志消息",
    "code": "切换到代码模式。请求更改您的代码。",
    "commit": "提交仓库中未暂存的更改",
    "context": "切换到上下文模式。请求更改，Aider 将添加相关文件到上下文。",
    "compact": "总结对话",
    "copy-context": "将当前聊天上下文复制为 Markdown 格式，适合粘贴到 Web UI 中。",
    "drop": "从上下文中删除文件以释放上下文空间。",
    "edit-last": "编辑最后一条用户消息",
    "init": "使用项目信息初始化 AGENTS.md 规则文件",
    "agentModeOnly": "仅在代理模式下可用",
    "map": "打印当前仓库地图",
    "map-refresh": "强制刷新仓库地图",
    "model": "打开模型选择器",
    "read-only": "将文件添加到聊天中，这些文件仅供参考，或将添加的文件设为只读。",
    "redo": "重做上一个用户提示。",
    "resolve-conflicts": "使用 AI 解决合并冲突",
    "reasoning-effort": "设置推理工作量级别（值：数字或低/中/高，取决于模型）",
    "reset": "删除所有文件并清除聊天历史记录",
    "run": "运行 shell 命令并可选地将输出添加到聊天中",
    "test": "运行预定义的测试命令，并在非零退出代码时将输出添加到聊天中",
    "think-tokens": "设置思考令牌预算（支持 8096、8k、10.5k、0.5M 等格式）",
    "tokens": "报告当前聊天上下文使用的令牌数量",
    "undo": "撤消 Aider 完成的最后一次 git 提交",
    "task-info": "显示任务信息",
    "web": "抓取网页内容并保存到文件。使用 /web url [文件] 格式，其中 [文件] 为可选参数",
    "handoff": "交接对话到新任务并聚焦"
  },
  "telemetry": {
    "title": "遥测信息",
    "message": "为了帮助我们改进 AiderDesk，我们会收集匿名遥测数据。这包括功能使用情况和性能指标等信息。绝不会收集个人数据或代码。",
    "enabledLabel": "启用匿名遥测"
  },
  "promptBehavior": {
    "title": "提示行为",
    "showSuggestions": "显示建议",
    "automaticallyWhileTyping": "输入时自动显示",
    "onlyWhenTabPressed": "仅在按 TAB 键时显示",
    "suggestionsDelay": "建议延迟",
    "requireCommandConfirmation": "需要命令确认",
    "addCommand": "/add",
    "readOnlyCommand": "/read-only",
    "modelCommand": "/model",
    "modeSwitchingCommands": "模式切换命令 (/code, /agent, ...)",
    "modeAtSign": "@ 提及模式"
  },
  "server": {
    "description": "启用 服务器，允许您通过浏览器在端口 24337 访问 AiderDesk",
    "serverStatus": "服务器状态",
    "running": "运行中",
    "enableBasicAuth": "启用基本身份验证",
    "enableBasicAuthDescription": "需要用户名和密码用于浏览器访问和 API 调用",
    "username": "用户名",
    "password": "密码",
    "controlServer": "REST API 服务器",
    "starting": "正在启动...",
    "stopping": "正在停止...",
    "start": "启动",
    "stop": "停止",
    "stopped": "已停止",
    "tunnelStatus": "隧道状态",
    "tunnelRunning": "运行中",
    "tunnelStopped": "已停止",
    "tunnelStarting": "正在启动...",
    "tunnelStopping": "正在停止...",
    "copyUrl": "复制 URL",
    "authentication": "身份验证",
    "serverControl": "服务器控制",
    "tunnelManagement": "隧道管理",
    "tunnelDescription": "创建 Cloudflare 隧道以安全地从外部网络访问您的服务器。当对外暴露服务器时，请务必使用身份验证。"
  },
  "multiselect": {
    "noneSelected": "未选择",
    "allSelected": "已全选",
    "someSelected": "已选择 {{count}} 个",
    "selectAll": "全选"
  },
  "usageDashboard": {
    "title": "使用情况",
    "refresh": "刷新",
    "projects": "项目",
    "models": "模型",
    "dateRange": "日期范围",
    "total": "总计",
    "thisMonth": "本月",
    "today": "今天",
    "all": "全部",
    "groupBy": "分组方式",
    "periods": {
      "hour": "小时",
      "day": "天",
      "month": "月",
      "year": "年"
    },
    "tabs": {
      "table": "表格视图",
      "charts": "图表视图"
    },
    "charts": {
      "tokenUsageTrend": "令牌使用趋势",
      "costBreakdown": "成本明细",
      "messageBreakdown": "消息明细",
      "modelUsageDistribution": "模型使用分布",
      "inputTokens": "输入令牌",
      "outputTokens": "输出令牌",
      "noData": "所选时间段内无数据",
      "tokens": "令牌",
      "cost": "成本",
      "share": "份额",
      "moreItems": "+{{count}} 更多"
    },
    "error": {
      "fetch": "获取使用数据失败。"
    },
    "table": {
      "date": "日期",
      "project": "项目",
      "model": "模型",
      "input": "输入",
      "output": "输出",
      "cacheRead": "缓存读取",
      "cacheWrite": "缓存写入",
      "totalTokens": "总令牌数",
      "cost": "成本"
    }
  },
  "terminal": {
    "copyOutput": "复制终端输出到提示",
    "minimize": "最小化终端",
    "addTerminal": "添加新终端"
  },
  "contextMenu": {
    "copy": "复制",
    "paste": "粘贴",
    "close": "关闭",
    "closeOtherTabs": "关闭其他标签页",
    "closeAllTabs": "关闭所有标签页"
  },
  "taskSidebar": {
    "title": "任务",
    "noTasks": "没有可用的任务",
    "deleteTask": "删除任务",
    "deleteConfirm": "您确定要删除这个任务吗？",
    "createTask": "创建新任务",
    "rename": "重命名",
    "pinTask": "固定任务",
    "unpinTask": "取消固定任务",
    "taskNamePlaceholder": "输入任务名称...",
    "untitled": "[未命名]",
    "exportAsMarkdown": "导出为 Markdown",
    "exportAsImage": "导出为图片",
    "taskIdCopied": "任务 ID {{taskId}} 已复制到剪贴板",
    "duplicateTask": "复制任务",
    "search": "搜索任务",
    "searchPlaceholder": "搜索任务...",
    "archiveTask": "归档任务",
    "unarchiveTask": "取消归档任务",
    "showArchived": "显示已归档",
    "hideArchived": "隐藏已归档",
    "archived": "已归档",
    "multiselectMode": "多选模式",
    "selectedCount": "已选择 {{count}} 个",
    "closeMultiselect": "退出多选",
    "deleteSelected": "删除选中项",
    "archiveSelected": "归档选中项",
    "unarchiveSelected": "取消归档选中项",
    "deleteSelectedConfirm": "您确定要删除 {{count}} 个选中的任务吗？",
    "archiveSelectedConfirm": "您确定要归档 {{count}} 个选中的任务吗？",
    "unarchiveSelectedConfirm": "您确定要取消归档 {{count}} 个选中的任务吗？",
    "generatingName": "正在生成名称...",
    "changeState": "更改状态",
    "createSubtask": "创建子任务",
    "deleteConfirmWithSubtasks": "此任务有 {{count}} 个子任务。仍然要删除吗？"
  },
  "taskInfo": {
    "createdAt": "创建于",
    "updatedAt": "更新于",
    "worktreeDirectory": "工作树目录",
    "baseBranch": "基础分支",
    "baseCommit": "基础提交",
    "targetBranch": "目标分支",
    "lastMergeState": "最后合并状态",
    "beforeMergeCommit": "合并前提交",
    "mergeTimestamp": "合并时间戳",
    "openFolder": "在文件夹中打开",
    "taskId": "任务 ID",
    "state": "状态",
    "messageCount": "消息数量"
  },
  "taskState": {
    "TODO": "待办",
    "IN_PROGRESS": "进行中",
    "INTERRUPTED": "已中断",
    "MORE_INFO_NEEDED": "需要更多信息",
    "READY_FOR_REVIEW": "待审核",
    "READY_FOR_IMPLEMENTATION": "待实现",
    "DONE": "已完成"
  },
  "worktree": {
    "aheadCommits": "↑ {{count}} 次提交",
    "uncommittedFiles": "{{count}} 个文件",
    "conflicts": "冲突",
    "conflictsPredicted": "预计会发生冲突",
    "conflictsPresent": "存在冲突",
    "merge": "合并",
    "squash": "压缩合并",
    "onlyUncommitted": "仅未提交的更改",
    "rebaseFromBranch": "从分支变基",
    "abortRebase": "中止变基",
    "continueRebase": "继续变基",
    "rebaseConflicts": "变基由于冲突失败。请手动解决冲突或使用 AI 代理协助。",
    "confirmRebaseTitle": "变基工作树",
    "confirmRebaseMessage": "这将把工作树变基到所选分支上。如有冲突，需要你进行解决。",
    "confirmAbortRebaseTitle": "中止变基",
    "confirmAbortRebaseMessage": "这将中止正在进行的变基并把工作树恢复到变基前的状态。",
    "confirmContinueRebaseTitle": "继续变基",
    "confirmContinueRebaseMessage": "这将尝试继续变基。请确保所有冲突已解决并已暂存。",
    "resolveConflictsWithAgent": "使用智能体解决冲突",
    "confirmResolveConflictsWithAgentTitle": "使用智能体解决冲突",
    "confirmResolveConflictsWithAgentMessage": "这将尝试自动解决所有冲突文件并将其暂存。继续变基前请仔细检查结果。",
    "commitMessage": "提交说明",
    "commitMessagePlaceholder": "输入提交说明...",
    "selectBranch": "选择分支",
    "selectTargetBranchTitle": "选择目标分支",
    "selectSourceBranchTitle": "选择源分支",
    "branchHasWorktree": "已有工作树",
    "mergeTooltip": "将工作树更改合并到分支",
    "revertTooltip": "撤销最后一次合并的更改",
    "confirmMerge": "您确定要{{action}}工作树更改到主分支吗？这将包含任何未提交的更改。",
    "confirmRevert": "您确定要撤销最后一次合并吗？这将把主分支重置到之前的状态。",
    "confirmMergeTitle": "确认合并",
    "confirmSquashTitle": "确认压缩合并",
    "confirmOnlyUncommittedTitle": "确认应用未提交的更改",
    "confirmMergeMessage": "您确定要将工作树更改合并到所选分支吗？",
    "confirmSquashMessage": "您确定要压缩并合并工作树更改到所选分支吗？",
    "confirmOnlyUncommittedMessage": "您确定要将工作树中的未提交更改应用到所选分支吗？不会执行 git 合并操作。",
    "mergeConflicts": "由于工作树与目标分支之间存在冲突，合并失败。请先对工作树进行变基以解决冲突。",
    "applyUncommittedConflicts": "由于与目标分支存在冲突，无法应用未提交的更改。请先对工作树进行变基以对齐您的更改。",
    "dontAskAgain": "不再询问",
    "confirmRevertTitle": "确认撤销",
    "confirmRevertMessage": "您确定要撤销最后一次合并吗？这将撤销从工作树合并回主分支的更改。",
    "revert": "撤销",
    "noChanges": "没有更改"
  },
  "welcomeMessage": {
    "title": "AiderDesk",
    "subtitle": "您的 AI 驱动编程助手",
    "features": {
      "title": "您可以做什么：",
      "aiCoding": "使用 AI 辅助生成和修改代码",
      "contextManagement": "添加文件到上下文以获得更好的结果",
      "multiModel": "选择多种 AI 模型和提供商",
      "commands": "执行命令和运行测试"
    },
    "tips": {
      "title": "入门指南：",
      "addFiles": "使用侧边栏或 /add 命令添加文件到上下文",
      "askQuestion": "在下方的提示字段中输入您的请求",
      "useCommands": "使用 / 命令进行快速操作",
      "switchMode": "使用下方的模式选择器在模式之间切换"
    },
    "modes": {
      "title": "选择正确的模式",
      "agent": {
        "title": "代理模式",
        "description": "用于自主任务、复杂工作流程和多步骤操作。代理会使用可用工具独立规划和执行任务。"
      },
      "code": {
        "title": "代码模式",
        "description": "用于直接代码更改和特定任务。重要提示：将文件添加到上下文以确保 AI 处理正确的文件。"
      }
    }
  },
  "bmad": {
    "welcome": {
      "title": "欢迎使用 BMAD 模式 (预览)",
      "subtitle": "用于规划、规范和实现功能的引导式工作流"
    },
    "workflows": {
      "phaseProgress": "{{completed}}/{{total}} 已完成",
      "installedVersion": "已安装 BMAD 库（v{{version}}）",
      "comingSoon": "工作流列表将在 Story 2.4 中提供",
      "loading": "正在加载工作流...",
      "errorLoading": "加载工作流失败：{{error}}",
      "noWorkflows": "没有可用的工作流",
      "execute": "执行",
      "executing": "正在执行...",
      "workflowCompleted": "工作流执行成功",
      "workflowError": "工作流执行失败",
      "retryExecution": "重试",
      "research": {
        "name": "研究",
        "description": "利用当前网络数据和可靠来源进行多领域综合研究"
      },
      "product-brief": {
        "name": "产品简介",
        "description": "定义产品愿景和目标用户"
      },
      "prd": {
        "name": "创建 PRD",
        "description": "创建全面的需求文档"
      },
      "architecture": {
        "name": "架构",
        "description": "设计技术架构和系统结构"
      },
      "ux-design": {
        "name": "用户体验设计",
        "description": "为产品界面创建用户体验设计文档"
      },
      "quick-spec": {
        "name": "快速规范",
        "description": "为明确定义的功能创建专注的规范"
      },
      "quick-dev": {
        "name": "快速开发",
        "description": "小型功能的快速规范到实现"
      },
      "epics-stories": {
        "name": "史诗/故事",
        "description": "将需求分解为可实施的史诗和故事"
      },
      "implementation": {
        "name": "实施",
        "description": "故事和功能实现的引导式开发"
      }
    },
    "phase": {
      "analysis": "分析",
      "planning": "规划",
      "solutioning": "解决方案",
      "implementation": "实施",
      "quick-flow": "快速流程"
    },
    "resume": {
      "sectionTitle": "恢复工作流",
      "button": "恢复",
      "stepIndicator": "第 {{current}} 步，共 {{total}} 步",
      "lastModified": "修改于 {{time}}",
      "resuming": "恢复中...",
      "unavailable": "无法恢复 - 工作流文件已损坏",
      "noSteps": "未记录进度",
      "corrupted": "已损坏",
      "corruptedDescription": "工件前置信息无法读取。从头开始重启以恢复。",
      "restartFromBeginning": "从头开始重启",
      "restarting": "重启中..."
    },
    "errors": {
      "npmInstallFailed": "NPM 安装失败",
      "workflowNotFound": "未找到工作流",
      "artifactMissing": "缺少必需的工件"
    },
    "hierarchy": {
      "expand": "展开",
      "collapse": "折叠",
      "expandAll": "全部展开",
      "collapseAll": "全部折叠",
      "workflowProgress": "工作流进度",
      "subtasksCompleted": "已完成 {{completed}}/{{total}} 个子任务",
      "noSubtasks": "没有子任务"
    },
    "progress": {
      "completed": "已完成",
      "inProgress": "进行中",
      "notStarted": "未开始",
      "percentage": "完成 {{percentage}}%"
    },
    "install": {
      "button": "安装 BMAD",
      "installing": "安装中...",
      "success": "BMAD 安装成功",
      "error": "BMAD 安装失败",
      "autoInstallNote": "点击上方按钮为当前项目自动安装 BMAD。",
      "manualInstallTitle": "手动安装",
      "manualInstallNote": "对于高级自定义，您也可以在终端中运行以下命令手动安装 BMAD。",
      "terminalPrompt": "安装 BMAD 以访问用于规划、规范和实现功能的引导式工作流程。",
      "commandLabel": "将要执行的命令：",
      "openTerminal": "打开终端并安装",
      "opening": "正在打开终端...",
      "terminalError": "无法打开终端",
      "autoCheckNote": "此页面将自动检测 BMAD 安装何时完成。",
      "benefits": [
        "从头脑风暴到实现的结构化工作流程",
        "自动上下文准备（节省50-80%成本）",
        "工具间无需上下文切换",
        "智能下一步建议"
      ]
    },
    "tabs": {
      "fullWorkflow": "完整工作流",
      "quickFlow": "快速流程"
    },
    "pathInfo": {
      "fullWorkflow": {
        "title": "完整工作流",
        "description": "用于新项目、复杂功能或需要探索需求的情况。指导您完成分析、规划、解决方案和实施阶段。",
        "whenToUse": "何时使用：",
        "useCases": {
          "newProject": "从零开始的新项目",
          "complexFeature": "复杂功能开发",
          "unclearRequirements": "需求不明确或不断变化",
          "teamCollaboration": "需要团队协作"
        }
      },
      "quickFlow": {
        "title": "快速流程",
        "description": "对于小型、易于理解的工作，跳过规划阶段。创建快速规范并直接进入实施。",
        "whenToUse": "何时使用：",
        "useCases": {
          "bugFixes": "错误修复",
          "smallFeatures": "小型功能添加",
          "refactoring": "重构任务",
          "wellDefined": "明确定义的变更"
        }
      }
    },
    "artifact": {
      "openFile": "打开文件",
      "notCreated": "尚未创建"
    },
    "taskActions": {
      "loading": "正在加载 BMAD 工作流...",
      "error": "加载 BMAD 状态失败",
      "resumeSection": "恢复工作流",
      "workflowsSection": "可用工作流",
      "noWorkflows": "没有可用的工作流",
      "execute": "执行",
      "entryPoint": "入口点 - 从这里开始您的项目",
      "recommendedAfter": "完成后推荐"
    },
    "reset": {
      "bannerTitle": "重置工作流进度",
      "bannerDescription": "这将永久删除 _bmad-output 文件夹中的所有文件。如果您有已完成的工作流或想保留进度，请先将 _bmad-output/ 中的文件备份到 docs/ 或其他位置。",
      "button": "重置",
      "resetting": "正在重置...",
      "confirmTitle": "重置工作流进度？",
      "confirmDescription": "此操作将永久删除 _bmad-output 文件夹中的所有生成的工件和工作流进度。此操作无法撤消。",
      "confirmButton": "重置所有进度",
      "success": "工作流进度已重置",
      "error": "重置工作流进度失败"
    }
  }
}

================
File: src/common/agent.ts
================
import { AgentProfile, ContextMemoryMode, InvocationMode, Model, ReasoningEffort, ToolApprovalState } from '@common/types';
import {
  AIDER_TOOL_ADD_CONTEXT_FILES,
  AIDER_TOOL_DROP_CONTEXT_FILES,
  AIDER_TOOL_GET_CONTEXT_FILES,
  AIDER_TOOL_GROUP_NAME,
  AIDER_TOOL_RUN_PROMPT,
  POWER_TOOL_BASH,
  POWER_TOOL_FETCH,
  POWER_TOOL_FILE_EDIT,
  POWER_TOOL_FILE_READ,
  POWER_TOOL_FILE_WRITE,
  POWER_TOOL_GLOB,
  POWER_TOOL_GREP,
  POWER_TOOL_GROUP_NAME,
  POWER_TOOL_SEMANTIC_SEARCH,
  SUBAGENTS_TOOL_GROUP_NAME,
  SUBAGENTS_TOOL_RUN_TASK,
  SKILLS_TOOL_ACTIVATE_SKILL,
  SKILLS_TOOL_GROUP_NAME,
  TASKS_TOOL_CREATE_TASK,
  TASKS_TOOL_DELETE_TASK,
  TASKS_TOOL_GET_TASK,
  TASKS_TOOL_GET_TASK_MESSAGE,
  TASKS_TOOL_GROUP_NAME,
  TASKS_TOOL_LIST_TASKS,
  TOOL_GROUP_NAME_SEPARATOR,
  MEMORY_TOOL_DELETE,
  MEMORY_TOOL_GROUP_NAME,
  MEMORY_TOOL_LIST,
  MEMORY_TOOL_RETRIEVE,
  MEMORY_TOOL_STORE,
  MEMORY_TOOL_UPDATE,
} from '@common/tools';
⋮----
export type LlmProviderName =
  | 'anthropic'
  | 'anthropic-compatible'
  | 'azure'
  | 'bedrock'
  | 'cerebras'
  | 'claude-agent-sdk'
  | 'deepseek'
  | 'gemini'
  | 'gpustack'
  | 'groq'
  | 'kimi-plan'
  | 'litellm'
  | 'lmstudio'
  | 'minimax'
  | 'ollama'
  | 'openai'
  | 'openai-compatible'
  | 'opencode'
  | 'openrouter'
  | 'requesty'
  | 'synthetic'
  | 'vertex-ai'
  | 'zai-plan';
⋮----
export interface LlmProviderBase {
  name: LlmProviderName;
  disableStreaming?: boolean;
  voiceEnabled?: boolean;
}
⋮----
export interface VoiceControlSettings {
  idleTimeoutMs: number;
  systemInstructions: string;
}
⋮----
export interface OllamaProvider extends LlmProviderBase {
  name: 'ollama';
  baseUrl: string;
}
⋮----
export enum OpenAiVoiceModel {
  Gpt4oMiniTranscribe = 'gpt-4o-mini-transcribe',
  Gpt4oTranscribe = 'gpt-4o-transcribe',
}
⋮----
export interface OpenAiVoiceControlSettings extends VoiceControlSettings {
  model: OpenAiVoiceModel;
  language: string;
}
⋮----
export interface OpenAiProvider extends LlmProviderBase {
  name: 'openai';
  apiKey: string;
  reasoningEffort?: ReasoningEffort;
  useWebSearch: boolean;
  voice?: Partial<OpenAiVoiceControlSettings>;
}
export const isOpenAiProvider = (provider: LlmProviderBase): provider is OpenAiProvider
⋮----
export interface AzureProvider extends LlmProviderBase {
  name: 'azure';
  apiKey: string;
  resourceName: string;
  apiVersion?: string;
  reasoningEffort?: ReasoningEffort;
}
export const isAzureProvider = (provider: LlmProviderBase): provider is AzureProvider
⋮----
export interface AnthropicProvider extends LlmProviderBase {
  name: 'anthropic';
  apiKey: string;
}
export const isAnthropicProvider = (provider: LlmProviderBase): provider is AnthropicProvider
⋮----
export interface AnthropicCompatibleProvider extends LlmProviderBase {
  name: 'anthropic-compatible';
  apiKey: string;
  baseUrl?: string;
}
export const isAnthropicCompatibleProvider = (provider: LlmProviderBase): provider is AnthropicCompatibleProvider
⋮----
export interface KimiPlanProvider extends LlmProviderBase {
  name: 'kimi-plan';
  apiKey: string;
}
export const isKimiPlanProvider = (provider: LlmProviderBase): provider is KimiPlanProvider
⋮----
export enum GeminiVoiceModel {
  GeminiLive25FlashNativeAudio = 'gemini-2.5-flash-native-audio-preview-12-2025',
}
⋮----
export interface GeminiVoiceControlSettings extends VoiceControlSettings {
  model: GeminiVoiceModel;
  temperature: number;
}
⋮----
export interface GeminiProvider extends LlmProviderBase {
  name: 'gemini';
  apiKey: string;
  customBaseUrl?: string;
  includeThoughts: boolean;
  thinkingBudget: number;
  useSearchGrounding: boolean;
  voice?: Partial<GeminiVoiceControlSettings>;
}
⋮----
export const isGeminiProvider = (provider: LlmProviderBase): provider is GeminiProvider
⋮----
export interface VertexAiProvider extends LlmProviderBase {
  name: 'vertex-ai';
  project: string;
  location: string;
  googleCloudCredentialsJson?: string;
  includeThoughts: boolean;
  thinkingBudget: number;
}
⋮----
export const isVertexAiProvider = (provider: LlmProviderBase): provider is VertexAiProvider
⋮----
export interface LmStudioProvider extends LlmProviderBase {
  name: 'lmstudio';
  baseUrl: string;
}
export const isLmStudioProvider = (provider: LlmProviderBase): provider is LmStudioProvider
⋮----
export interface DeepseekProvider extends LlmProviderBase {
  name: 'deepseek';
  apiKey: string;
}
export const isDeepseekProvider = (provider: LlmProviderBase): provider is DeepseekProvider
⋮----
export interface GroqProvider extends LlmProviderBase {
  name: 'groq';
  apiKey: string;
}
export const isGroqProvider = (provider: LlmProviderBase): provider is GroqProvider
⋮----
export interface CerebrasProvider extends LlmProviderBase {
  name: 'cerebras';
  apiKey: string;
}
export const isCerebrasProvider = (provider: LlmProviderBase): provider is CerebrasProvider
⋮----
export interface ClaudeAgentSdkProvider extends LlmProviderBase {
  name: 'claude-agent-sdk';
  systemPrompt?: string;
  mcpServers?: Record<string, unknown>;
}
export const isClaudeAgentSdkProvider = (provider: LlmProviderBase): provider is ClaudeAgentSdkProvider
⋮----
export interface BedrockProvider extends LlmProviderBase {
  name: 'bedrock';
  accessKeyId: string;
  secretAccessKey: string;
  region: string;
  sessionToken?: string;
}
export const isBedrockProvider = (provider: LlmProviderBase): provider is BedrockProvider
⋮----
export interface OpenAiCompatibleProvider extends LlmProviderBase {
  name: 'openai-compatible';
  apiKey: string;
  baseUrl?: string;
  reasoningEffort?: ReasoningEffort;
}
export const isOpenAiCompatibleProvider = (provider: LlmProviderBase): provider is OpenAiCompatibleProvider
⋮----
export interface LitellmProvider extends LlmProviderBase {
  name: 'litellm';
  apiKey: string;
  baseUrl: string;
}
export const isLitellmProvider = (provider: LlmProviderBase): provider is LitellmProvider
⋮----
export const isOllamaProvider = (provider: LlmProviderBase): provider is OllamaProvider
⋮----
export interface GpustackProvider extends LlmProviderBase {
  name: 'gpustack';
  apiKey?: string;
  baseUrl?: string;
}
export const isGpustackProvider = (provider: LlmProviderBase): provider is GpustackProvider
⋮----
export interface OpenRouterProvider extends LlmProviderBase {
  name: 'openrouter';
  apiKey: string;
  // Advanced routing options
  requireParameters: boolean;
  order: string[];
  only: string[];
  ignore: string[];
  allowFallbacks: boolean;
  dataCollection: 'allow' | 'deny';
  quantizations: string[];
  sort: 'price' | 'throughput' | null;
}
⋮----
// Advanced routing options
⋮----
export const isOpenRouterProvider = (provider: LlmProviderBase): provider is OpenRouterProvider
⋮----
export interface RequestyProvider extends LlmProviderBase {
  name: 'requesty';
  apiKey: string;
  useAutoCache: boolean;
  reasoningEffort: ReasoningEffort;
}
export const isRequestyProvider = (provider: LlmProviderBase): provider is RequestyProvider
⋮----
export interface OpenCodeProvider extends LlmProviderBase {
  name: 'opencode';
  apiKey: string;
}
export const isOpenCodeProvider = (provider: LlmProviderBase): provider is OpenCodeProvider
⋮----
export interface ZaiPlanProvider extends LlmProviderBase {
  name: 'zai-plan';
  apiKey: string;
  thinkingEnabled?: boolean;
}
export const isZaiPlanProvider = (provider: LlmProviderBase): provider is ZaiPlanProvider
⋮----
export interface MinimaxProvider extends LlmProviderBase {
  name: 'minimax';
  apiKey: string;
}
export const isMinimaxProvider = (provider: LlmProviderBase): provider is MinimaxProvider
⋮----
export interface SyntheticProvider extends LlmProviderBase {
  name: 'synthetic';
  apiKey: string;
}
export const isSyntheticProvider = (provider: LlmProviderBase): provider is SyntheticProvider
⋮----
export type LlmProvider =
  | OpenAiProvider
  | AnthropicProvider
  | AnthropicCompatibleProvider
  | AzureProvider
  | GeminiProvider
  | VertexAiProvider
  | LmStudioProvider
  | BedrockProvider
  | ClaudeAgentSdkProvider
  | DeepseekProvider
  | GroqProvider
  | GpustackProvider
  | CerebrasProvider
  | KimiPlanProvider
  | OpenAiCompatibleProvider
  | LitellmProvider
  | OllamaProvider
  | OpenCodeProvider
  | OpenRouterProvider
  | RequestyProvider
  | SyntheticProvider
  | ZaiPlanProvider
  | MinimaxProvider;
⋮----
// aider tools
⋮----
// power tools
⋮----
// subagent tools
⋮----
// skills tools
⋮----
// task tools
⋮----
// memory tools
⋮----
// Power tools
⋮----
// Aider
⋮----
// Aider with Power Search
⋮----
export const getDefaultProviderParams = <T extends LlmProvider>(providerName: LlmProviderName): T =>
⋮----
region: 'us-east-1', // Default region
⋮----
// For any other provider, create a base structure. This might need more specific handling if new providers are added.
⋮----
export const isSubagentEnabled = (agentProfile: AgentProfile, currentProfileId?: string): boolean =>
⋮----
export const getProviderModelId = (model: Model): string =>

================
File: src/common/api.ts
================
import {
  AgentProfile,
  AgentProfilesUpdatedData,
  AutocompletionData,
  BmadStatus,
  BranchInfo,
  ClearTaskData,
  CloudflareTunnelStatus,
  CommandOutputData,
  ContextFilesUpdatedData,
  CreateTaskParams,
  CustomCommand,
  CustomCommandsUpdatedData,
  EditFormat,
  EnvironmentVariable,
  FileEdit,
  InputHistoryData,
  LogData,
  McpServerConfig,
  McpTool,
  MemoryEmbeddingProgress,
  MemoryEntry,
  MessageRemovedData,
  Mode,
  Model,
  ModelsData,
  NotificationData,
  OS,
  ProjectData,
  ProjectSettings,
  ProjectStartedData,
  ProviderModelsData,
  ProviderProfile,
  ProvidersUpdatedData,
  QuestionAnsweredData,
  QuestionData,
  ResponseChunkData,
  ResponseCompletedData,
  SettingsData,
  TaskCreatedData,
  TaskData,
  TaskStateData,
  TerminalData,
  TerminalExitData,
  TodoItem,
  TokensInfoData,
  ToolData,
  UsageDataRow,
  UserMessageData,
  VersionsInfo,
  VoiceSession,
  WorkflowExecutionResult,
  WorktreeIntegrationStatus,
  WorktreeIntegrationStatusUpdatedData,
  UpdatedFile,
  UpdatedFilesUpdatedData,
} from '@common/types';
⋮----
export interface ApplicationAPI {
  isOpenLogsDirectorySupported: () => boolean;
  openLogsDirectory: () => Promise<boolean>;
  loadSettings: () => Promise<SettingsData>;
  saveSettings: (settings: SettingsData) => Promise<SettingsData>;
  isManageServerSupported: () => boolean;
  startServer: (username?: string, password?: string) => Promise<boolean>;
  stopServer: () => Promise<boolean>;
  startCloudflareTunnel: () => Promise<boolean>;
  stopCloudflareTunnel: () => Promise<void>;
  getCloudflareTunnelStatus: () => Promise<CloudflareTunnelStatus>;
  startProject: (baseDir: string) => Promise<void>;
  stopProject: (baseDir: string) => void;
  restartProject: (baseDir: string) => void;
  resetTask: (baseDir: string, taskId: string) => void;
  runPrompt: (baseDir: string, taskId: string, prompt: string, mode?: Mode) => void;
  savePrompt: (baseDir: string, taskId: string, prompt: string) => Promise<void>;
  redoLastUserPrompt: (baseDir: string, taskId: string, mode: Mode, updatedPrompt?: string) => void;
  resumeTask: (baseDir: string, taskId: string) => void;
  answerQuestion: (baseDir: string, taskId: string, answer: string) => void;
  loadInputHistory: (baseDir: string) => Promise<string[]>;
  isOpenDialogSupported: () => boolean;
  showOpenDialog: (options: Electron.OpenDialogSyncOptions) => Promise<Electron.OpenDialogReturnValue>;
  getPathForFile: (file: File) => string;
  getOpenProjects: () => Promise<ProjectData[]>;
  addOpenProject: (baseDir: string) => Promise<ProjectData[]>;
  setActiveProject: (baseDir: string) => Promise<ProjectData[]>;
  removeOpenProject: (baseDir: string) => Promise<ProjectData[]>;
  updateOpenProjectsOrder: (baseDirs: string[]) => Promise<ProjectData[]>;
  updateMainModel: (baseDir: string, taskId: string, model: string) => void;
  updateWeakModel: (baseDir: string, taskId: string, model: string) => void;
  updateArchitectModel: (baseDir: string, taskId: string, model: string) => void;
  updateEditFormats: (baseDir: string, editFormats: Record<string, EditFormat>) => void;
  getProjectSettings: (baseDir: string) => Promise<ProjectSettings>;
  patchProjectSettings: (baseDir: string, settings: Partial<ProjectSettings>) => Promise<ProjectSettings>;
  getFilePathSuggestions: (currentPath: string, directoriesOnly?: boolean) => Promise<string[]>;
  getAddableFiles: (baseDir: string, taskId: string) => Promise<string[]>;
  getAllFiles: (baseDir: string, taskId: string, useGit?: boolean) => Promise<string[]>;
  getUpdatedFiles: (baseDir: string, taskId: string) => Promise<UpdatedFile[]>;
  addFile: (baseDir: string, taskId: string, filePath: string, readOnly?: boolean) => void;
  isValidPath: (baseDir: string, path: string) => Promise<boolean>;
  isProjectPath: (path: string) => Promise<boolean>;
  dropFile: (baseDir: string, taskId: string, path: string) => void;
  runCommand: (baseDir: string, taskId: string, command: string) => void;
  pasteImage: (baseDir: string, taskId: string, imageBuffer?: ArrayBuffer) => void;
  scrapeWeb: (baseDir: string, taskId: string, url: string, filePath?: string) => Promise<void>;
  initProjectRulesFile: (baseDir: string, taskId: string) => Promise<void>;

  // Todo operations
  getTodos: (baseDir: string, taskId: string) => Promise<TodoItem[]>;
  addTodo: (baseDir: string, taskId: string, name: string) => Promise<TodoItem[]>;
  updateTodo: (baseDir: string, taskId: string, name: string, updates: Partial<TodoItem>) => Promise<TodoItem[]>;
  deleteTodo: (baseDir: string, taskId: string, name: string) => Promise<TodoItem[]>;
  clearAllTodos: (baseDir: string, taskId: string) => Promise<TodoItem[]>;

  loadMcpServerTools: (serverName: string, config?: McpServerConfig) => Promise<McpTool[] | null>;
  reloadMcpServers: (mcpServers: Record<string, McpServerConfig>, force?: boolean) => Promise<void>;
  reloadMcpServer: (serverName: string, config: McpServerConfig) => Promise<McpTool[]>;

  createNewTask: (baseDir: string, params?: CreateTaskParams) => Promise<TaskData>;
  updateTask: (baseDir: string, id: string, updates: Partial<TaskData>) => Promise<boolean>;
  deleteTask: (baseDir: string, id: string) => Promise<boolean>;
  duplicateTask: (baseDir: string, taskId: string) => Promise<TaskData>;
  forkTask: (baseDir: string, taskId: string, messageId: string) => Promise<TaskData>;
  getTasks: (baseDir: string) => Promise<TaskData[]>;
  loadTask: (baseDir: string, taskId: string) => Promise<TaskStateData>;
  exportTaskToMarkdown: (baseDir: string, taskId: string) => Promise<void>;
  getRecentProjects: () => Promise<string[]>;
  addRecentProject: (baseDir: string) => Promise<void>;
  removeRecentProject: (baseDir: string) => Promise<void>;
  interruptResponse: (baseDir: string, taskId: string, interruptId?: string) => void;
  applyEdits: (baseDir: string, taskId: string, edits: FileEdit[]) => void;
  clearContext: (baseDir: string, taskId: string) => void;
  removeLastMessage: (baseDir: string, taskId: string) => void;
  removeMessage: (baseDir: string, taskId: string, messageId: string) => Promise<void>;
  removeMessagesUpTo: (baseDir: string, taskId: string, messageId: string) => Promise<void>;
  compactConversation: (baseDir: string, taskId: string, mode: Mode, customInstructions?: string) => void;
  handoffConversation: (baseDir: string, taskId: string, focus?: string) => Promise<void>;
  setZoomLevel: (level: number) => Promise<void>;

  getVersions: (forceRefresh?: boolean) => Promise<VersionsInfo | null>;
  downloadLatestAiderDesk: () => Promise<void>;

  getReleaseNotes: () => Promise<string | null>;
  clearReleaseNotes: () => Promise<void>;
  getOS: () => Promise<OS>;
  queryUsageData: (from: string, to: string) => Promise<UsageDataRow[]>;
  getEffectiveEnvironmentVariable: (key: string, baseDir?: string) => Promise<EnvironmentVariable | undefined>;

  // Voice API
  createVoiceSession: (provider: ProviderProfile) => Promise<VoiceSession>;

  getProviderModels: (reload?: boolean) => Promise<ProviderModelsData>;
  getProviders: () => Promise<ProviderProfile[]>;
  updateProviders: (providers: ProviderProfile[]) => Promise<ProviderProfile[]>;
  upsertModel: (providerId: string, modelId: string, model: Model) => Promise<ProviderModelsData>;
  deleteModel: (providerId: string, modelId: string) => Promise<ProviderModelsData>;
  updateModels: (modelUpdates: Array<{ providerId: string; modelId: string; model: Model }>) => Promise<ProviderModelsData>;

  addSettingsUpdatedListener: (callback: (data: SettingsData) => void) => () => void;
  addResponseChunkListener: (baseDir: string, taskId: string, callback: (data: ResponseChunkData) => void) => () => void;
  addResponseCompletedListener: (baseDir: string, taskId: string, callback: (data: ResponseCompletedData) => void) => () => void;
  addLogListener: (baseDir: string, taskId: string, callback: (data: LogData) => void) => () => void;
  addContextFilesUpdatedListener: (baseDir: string, taskId: string, callback: (data: ContextFilesUpdatedData) => void) => () => void;
  addUpdatedFilesUpdatedListener: (baseDir: string, taskId: string, callback: (data: UpdatedFilesUpdatedData) => void) => () => void;
  addCustomCommandsUpdatedListener: (baseDir: string, callback: (data: CustomCommandsUpdatedData) => void) => () => void;
  addUpdateAutocompletionListener: (baseDir: string, taskId: string, callback: (data: AutocompletionData) => void) => () => void;
  addAskQuestionListener: (baseDir: string, taskId: string, callback: (data: QuestionData) => void) => () => void;
  addQuestionAnsweredListener: (baseDir: string, taskId: string, callback: (data: QuestionAnsweredData) => void) => () => void;
  addUpdateAiderModelsListener: (baseDir: string, taskId: string, callback: (data: ModelsData) => void) => () => void;
  addCommandOutputListener: (baseDir: string, taskId: string, callback: (data: CommandOutputData) => void) => () => void;
  addTokensInfoListener: (baseDir: string, taskId: string, callback: (data: TokensInfoData) => void) => () => void;
  addToolListener: (baseDir: string, taskId: string, callback: (data: ToolData) => void) => () => void;
  addUserMessageListener: (baseDir: string, taskId: string, callback: (data: UserMessageData) => void) => () => void;
  addInputHistoryUpdatedListener: (baseDir: string, callback: (data: InputHistoryData) => void) => () => void;
  addClearTaskListener: (baseDir: string, taskId: string, callback: (data: ClearTaskData) => void) => () => void;
  addMessageRemovedListener: (baseDir: string, taskId: string, callback: (data: MessageRemovedData) => void) => () => void;
  addProjectStartedListener: (baseDir: string, callback: (data: ProjectStartedData) => void) => () => void;
  addVersionsInfoUpdatedListener: (callback: (data: VersionsInfo) => void) => () => void;
  addProviderModelsUpdatedListener: (callback: (data: ProviderModelsData) => void) => () => void;
  addProvidersUpdatedListener: (callback: (data: ProvidersUpdatedData) => void) => () => void;
  addAgentProfilesUpdatedListener: (callback: (data: AgentProfilesUpdatedData) => void) => () => void;
  addProjectSettingsUpdatedListener: (baseDir: string, callback: (data: { baseDir: string; settings: ProjectSettings }) => void) => () => void;
  addWorktreeIntegrationStatusUpdatedListener: (baseDir: string, taskId: string, callback: (data: WorktreeIntegrationStatusUpdatedData) => void) => () => void;
  addTerminalDataListener: (baseDir: string, callback: (data: TerminalData) => void) => () => void;
  addTerminalExitListener: (baseDir: string, callback: (data: TerminalExitData) => void) => () => void;
  addContextMenuListener: (callback: (params: Electron.ContextMenuParams) => void) => () => void;
  addOpenSettingsListener: (callback: (pageId: string) => void) => () => void;

  // Task lifecycle event listeners
  addTaskCreatedListener: (baseDir: string, callback: (data: TaskCreatedData) => void) => () => void;
  addTaskInitializedListener: (baseDir: string, callback: (data: TaskData) => void) => () => void;
  addTaskUpdatedListener: (baseDir: string, callback: (data: TaskData) => void) => () => void;
  addTaskStartedListener: (baseDir: string, callback: (data: TaskData) => void) => () => void;
  addTaskCompletedListener: (baseDir: string, callback: (data: TaskData) => void) => () => void;
  addTaskCancelledListener: (baseDir: string, callback: (data: TaskData) => void) => () => void;
  addTaskDeletedListener: (baseDir: string, callback: (data: TaskData) => void) => () => void;

  getCustomCommands: (baseDir: string) => Promise<CustomCommand[]>;
  runCustomCommand: (baseDir: string, taskId: string, commandName: string, args: string[], mode: Mode) => Promise<void>;

  // Terminal operations
  isTerminalSupported: () => boolean;
  createTerminal: (baseDir: string, taskId: string, cols?: number, rows?: number) => Promise<string>;
  writeToTerminal: (terminalId: string, data: string) => Promise<boolean>;
  resizeTerminal: (terminalId: string, cols: number, rows: number) => Promise<boolean>;
  closeTerminal: (terminalId: string) => Promise<boolean>;
  getTerminalForTask: (taskId: string) => Promise<string | null>;
  getAllTerminalsForTask: (taskId: string) => Promise<Array<{ id: string; taskId: string; cols: number; rows: number }>>;

  // Worktree merge operations
  mergeWorktreeToMain: (baseDir: string, taskId: string, squash: boolean, targetBranch?: string, commitMessage?: string) => Promise<void>;
  applyUncommittedChanges: (baseDir: string, taskId: string, targetBranch?: string) => Promise<void>;
  revertLastMerge: (baseDir: string, taskId: string) => Promise<void>;
  listBranches: (baseDir: string) => Promise<BranchInfo[]>;
  getWorktreeIntegrationStatus: (baseDir: string, taskId: string, targetBranch?: string) => Promise<WorktreeIntegrationStatus | null>;
  rebaseWorktreeFromBranch: (baseDir: string, taskId: string, fromBranch?: string) => Promise<void>;
  abortWorktreeRebase: (baseDir: string, taskId: string) => Promise<void>;
  continueWorktreeRebase: (baseDir: string, taskId: string) => Promise<void>;
  resolveWorktreeConflictsWithAgent: (baseDir: string, taskId: string) => Promise<void>;
  resolveConflictsWithAgent: (baseDir: string, taskId: string) => Promise<void>;

  // Agent profile operations
  getAllAgentProfiles: () => Promise<AgentProfile[]>;
  createAgentProfile: (profile: AgentProfile, projectDir?: string) => Promise<AgentProfile[]>;
  updateAgentProfile: (profile: AgentProfile, baseDir?: string) => Promise<AgentProfile[]>;
  deleteAgentProfile: (profileId: string, baseDir?: string) => Promise<AgentProfile[]>;
  updateAgentProfilesOrder: (agentProfiles: AgentProfile[]) => Promise<void>;

  // Memory operations
  listAllMemories: () => Promise<MemoryEntry[]>;
  deleteMemory: (id: string) => Promise<boolean>;
  deleteProjectMemories: (projectId: string) => Promise<number>;
  getMemoryEmbeddingProgress: () => Promise<MemoryEmbeddingProgress>;

  // Clipboard operations
  writeToClipboard: (text: string) => Promise<void>;
  openPath: (path: string) => Promise<boolean>;

  addNotificationListener: (baseDir: string, callback: (data: NotificationData) => void) => () => void;

  // BMAD operations
  installBmad: (projectDir: string) => Promise<{ success: boolean; message?: string }>;
  getBmadStatus: (projectDir: string) => Promise<BmadStatus>;
  executeWorkflow: (projectDir: string, taskId: string, workflowId: string, asSubtask?: boolean) => Promise<WorkflowExecutionResult>;
  resetBmadWorkflow: (projectDir: string) => Promise<{ success: boolean; message?: string }>;
  addBmadStatusChangedListener: (baseDir: string, callback: (status: BmadStatus) => void) => () => void;
}
⋮----
// Todo operations
⋮----
// Voice API
⋮----
// Task lifecycle event listeners
⋮----
// Terminal operations
⋮----
// Worktree merge operations
⋮----
// Agent profile operations
⋮----
// Memory operations
⋮----
// Clipboard operations
⋮----
// BMAD operations

================
File: src/common/bmad-types.ts
================
/**
 * BMAD workflow execution phases
 */
export enum WorkflowPhase {
  Analysis = 'analysis',
  Planning = 'planning',
  Solutioning = 'solutioning',
  Implementation = 'implementation',
  QuickFlow = 'quick-flow',
}
⋮----
/**
 * Metadata for a BMAD workflow
 */
export interface WorkflowMetadata {
  id: string;
  name: string;
  phase: WorkflowPhase;
  description: string;
  workflowPath: string;
  outputArtifact: string;
  totalSteps: number;
  requiredArtifacts?: string[];
  followUps?: string[];
}
⋮----
/**
 * Incomplete workflow metadata
 */
export interface IncompleteWorkflowMetadata {
  workflowId: string;
  artifactPath: string;
  stepsCompleted: number[];
  nextStep: number;
  lastModified: Date;
  corrupted?: boolean; // True if artifact frontmatter is corrupted/unreadable
  corruptionError?: string; // Error message explaining corruption
}
⋮----
corrupted?: boolean; // True if artifact frontmatter is corrupted/unreadable
corruptionError?: string; // Error message explaining corruption
⋮----
/**
 * Story status values in sprint-status.yaml
 */
export enum StoryStatus {
  Backlog = 'backlog',
  ReadyForDev = 'ready-for-dev',
  InProgress = 'in-progress',
  Review = 'review',
  Done = 'done',
}
⋮----
/**
 * Sprint status data parsed from sprint-status.yaml
 */
export interface SprintStatusData {
  storyStatuses: StoryStatus[];
  completedWorkflows: string[];
}
⋮----
export type DetectedArtifact = {
  path: string;
  stepsCompleted?: string[];
  status?: string;
  error?: string;
};
⋮----
export type DetectedArtifacts = {
  [workflowId: string]: DetectedArtifact;
};
⋮----
/**
 * Workflow artifacts detection result
 */
export interface WorkflowArtifacts {
  completedWorkflows: string[];
  inProgressWorkflows: string[];
  incompleteWorkflows?: IncompleteWorkflowMetadata[];
  detectedArtifacts: DetectedArtifacts;
  sprintStatus?: SprintStatusData;
}
⋮----
/**
 * BMAD Mode status
 */
export interface BmadStatus {
  projectDir: string;
  installed: boolean;
  version?: string;
  availableWorkflows: WorkflowMetadata[];
  completedWorkflows: string[];
  inProgressWorkflows: string[];
  incompleteWorkflows?: IncompleteWorkflowMetadata[];
  detectedArtifacts: DetectedArtifacts;
  sprintStatus?: SprintStatusData;
}
⋮----
/**
 * BMAD installation result
 */
export interface InstallResult {
  success: boolean;
  version?: string;
  message?: string;
}
⋮----
/**
 * BMAD error with recovery action
 */
export interface BmadError {
  errorCode: string;
  message: string;
  recoveryAction?: string;
  details?: string;
}
⋮----
/**
 * Workflow execution result
 */
export interface WorkflowExecutionResult {
  success: boolean;
  artifactPath?: string;
  error?: {
    message: string;
    errorCode?: string;
    recoveryAction?: string;
  };
}

================
File: src/common/bmad-workflows.ts
================
import { WorkflowMetadata, WorkflowPhase } from './bmad-types';
⋮----
/**
 * Registry of all BMAD workflows with metadata
 * This is a hardcoded registry as per architecture decision
 * (Source: planning-artifacts/architecture.md#Workflow Discovery & Registry)
 */
⋮----
// Analysis Phase
⋮----
// Planning Phase
⋮----
// Solutioning Phase
⋮----
// Implementation Phase
⋮----
// Quick Phase

================
File: src/common/tools.ts
================


================
File: src/common/types.ts
================
import {
  AnthropicProvider,
  BedrockProvider,
  DeepseekProvider,
  GeminiProvider,
  GroqProvider,
  LlmProvider,
  LmStudioProvider,
  MinimaxProvider,
  OllamaProvider,
  OpenAiCompatibleProvider,
  OpenAiProvider,
  OpenCodeProvider,
  OpenRouterProvider,
  RequestyProvider,
  VertexAiProvider,
  SyntheticProvider,
} from '@common/agent';
import { z } from 'zod';
⋮----
import type { JSONSchema7Definition } from '@ai-sdk/provider';
import type { AssistantContent, ToolContent, UserContent } from 'ai';
⋮----
// Worktree schema definition
⋮----
export type Worktree = z.infer<typeof WorktreeSchema>;
⋮----
// Merge state for tracking merge operations and enabling revert
⋮----
export type MergeState = z.infer<typeof MergeStateSchema>;
⋮----
export interface WorktreeAheadCommits {
  count: number;
  commits: string[];
}
⋮----
export interface WorktreeUncommittedFiles {
  count: number;
  files: string[];
}
⋮----
export interface RebaseState {
  inProgress: boolean;
  hasUnmergedPaths: boolean;
  unmergedFiles?: string[];
}
⋮----
export interface ConflictResolutionFileContext {
  filePath: string;
  base?: string | null;
  ours?: string | null;
  theirs?: string | null;
  current?: string;
}
⋮----
export interface WorktreeIntegrationStatus {
  targetBranch: string;
  aheadCommits: WorktreeAheadCommits;
  uncommittedFiles: WorktreeUncommittedFiles;
  predictedConflicts: {
    hasConflicts: boolean;
    conflictingFiles?: string[];
    conflictingCommits?: {
      ours: string[];
      theirs: string[];
    };
    canAutoMerge?: boolean;
  };
  rebaseState: RebaseState;
}
⋮----
export interface WorktreeIntegrationStatusUpdatedData {
  baseDir: string;
  taskId: string;
  status: WorktreeIntegrationStatus | null;
}
⋮----
export interface LocalizedString {
  key: string;
  params?: Record<string, unknown>;
}
⋮----
export type Mode = 'code' | 'ask' | 'architect' | 'context' | 'agent' | 'bmad';
⋮----
export interface AiderRunOptions {
  autoApprove?: boolean;
  denyCommands?: boolean;
}
⋮----
export type EditFormat = 'diff' | 'diff-fenced' | 'whole' | 'udiff' | 'udiff-simple' | 'patch';
⋮----
export enum DiffViewMode {
  SideBySide = 'side-by-side',
  Unified = 'unified',
  Compact = 'compact',
}
⋮----
export enum MessageViewMode {
  Full = 'full',
  Compact = 'compact',
}
⋮----
export enum ReasoningEffort {
  High = 'high',
  Medium = 'medium',
  Low = 'low',
  Minimal = 'minimal',
  None = 'none',
}
⋮----
export enum ContextMemoryMode {
  Off = 'off',
  FullContext = 'full-context',
  LastMessage = 'last-message',
}
⋮----
export interface ResponseChunkData {
  messageId: string;
  baseDir: string;
  taskId: string;
  chunk: string;
  reflectedMessage?: string;
  promptContext?: PromptContext;
}
⋮----
export interface ResponseCompletedData {
  type: 'response-completed';
  messageId: string;
  baseDir: string;
  taskId: string;
  content: string;
  reflectedMessage?: string;
  editedFiles?: string[];
  commitHash?: string;
  commitMessage?: string;
  diff?: string;
  usageReport?: UsageReportData;
  sequenceNumber?: number;
  promptContext?: PromptContext;
}
⋮----
export interface CommandOutputData {
  baseDir: string;
  taskId: string;
  command: string;
  output: string;
}
⋮----
export type LogLevel = 'info' | 'warning' | 'error' | 'loading';
⋮----
export interface LogData {
  baseDir: string;
  taskId: string;
  level: LogLevel;
  message?: string;
  finished?: boolean;
  promptContext?: PromptContext;
  actionIds?: string[];
}
⋮----
export interface ToolData {
  type: 'tool';
  baseDir: string;
  taskId: string;
  id: string;
  serverName: string;
  toolName: string;
  args?: unknown;
  response?: string;
  usageReport?: UsageReportData;
  promptContext?: PromptContext;
  finished?: boolean;
}
⋮----
export interface ContextFilesUpdatedData {
  baseDir: string;
  taskId: string;
  files: ContextFile[];
}
⋮----
export interface UpdatedFile {
  path: string;
  additions: number;
  deletions: number;
  diff?: string;
}
⋮----
export interface UpdatedFilesUpdatedData {
  baseDir: string;
  taskId: string;
  files: UpdatedFile[];
}
⋮----
export interface CustomCommandsUpdatedData {
  baseDir: string;
  taskId: string;
  commands: CustomCommand[];
}
⋮----
export interface AutocompletionData {
  baseDir: string;
  taskId: string;
  words?: string[];
  allFiles?: string[];
}
⋮----
export interface Answer {
  text: string;
  shortkey: string;
}
⋮----
export interface QuestionData {
  baseDir: string;
  taskId: string;
  text: string;
  subject?: string;
  isGroupQuestion?: boolean;
  answers?: Answer[];
  defaultAnswer: string;
  internal?: boolean;
  key?: string;
}
⋮----
export interface QuestionAnsweredData {
  baseDir: string;
  taskId: string;
  question: QuestionData;
  answer: string;
  userInput?: string;
}
⋮----
export type ContextFileSourceType = 'companion' | 'aider' | 'app' | string;
⋮----
export enum OS {
  Windows = 'windows',
  Linux = 'linux',
  MacOS = 'macos',
}
⋮----
export interface CloudflareTunnelStatus {
  isRunning: boolean;
  url?: string;
}
⋮----
export enum MessageRole {
  User = 'user',
  Assistant = 'assistant',
}
⋮----
// Base interface for all context messages with usage reporting
interface BaseContextMessage {
  id: string;
  usageReport?: UsageReportData;
  promptContext?: PromptContext;
}
⋮----
// User message with usage report
export interface ContextUserMessage extends BaseContextMessage {
  role: 'user';
  content: UserContent;
}
⋮----
// Assistant message with full response metadata
export interface ContextAssistantMessage extends BaseContextMessage {
  role: 'assistant';
  content: AssistantContent;
  reflectedMessage?: string;
  editedFiles?: string[];
  commitHash?: string;
  commitMessage?: string;
  diff?: string;
}
⋮----
// Tool message with usage report
export interface ContextToolMessage extends BaseContextMessage {
  role: 'tool';
  content: ToolContent;
}
⋮----
// Union type for enhanced context messages
export type ContextMessage = ContextUserMessage | ContextAssistantMessage | ContextToolMessage;
⋮----
export interface ContextFile {
  path: string;
  readOnly?: boolean;
  source?: 'global-rule' | 'project-rule' | 'agent-rule';
}
⋮----
export interface WindowState {
  width: number;
  height: number;
  x: number | undefined;
  y: number | undefined;
  isMaximized: boolean;
}
⋮----
// @deprecated: These properties are deprecated in favor of task-level settings
// They are kept for backward compatibility and as defaults for new tasks
⋮----
export type ProjectSettings = z.infer<typeof ProjectSettingsSchema>;
⋮----
export interface ProjectData {
  active: boolean;
  baseDir: string;
  settings: ProjectSettings;
}
⋮----
export interface RawModelInfo {
  max_input_tokens: number;
  max_output_tokens: number;
  input_cost_per_token: number;
  output_cost_per_token: number;
  supports_function_calling: boolean;
  supports_tool_choice: boolean;
  litellm_provider: string;
}
⋮----
export interface ModelsData {
  baseDir: string;
  taskId: string;
  mainModel: string;
  weakModel?: string | null;
  architectModel?: string | null;
  reasoningEffort?: string;
  thinkingTokens?: string;
  editFormat?: EditFormat;
  info?: RawModelInfo;
  error?: string;
}
⋮----
export enum ToolApprovalState {
  Always = 'always',
  Never = 'never',
  Ask = 'ask',
}
⋮----
export enum ProjectStartMode {
  Empty = 'empty',
  Last = 'last',
  Remote = 'remote',
}
⋮----
export enum SuggestionMode {
  Automatically = 'automatically',
  OnTab = 'onTab',
  MentionAtSign = 'mentionAtSign',
}
⋮----
export interface PromptBehavior {
  suggestionMode: SuggestionMode;
  suggestionDelay: number;
  requireCommandConfirmation: {
    add: boolean;
    readOnly: boolean;
    model: boolean;
    modeSwitching: boolean;
  };
  useVimBindings: boolean;
}
⋮----
export enum InvocationMode {
  OnDemand = 'on-demand',
  Automatic = 'automatic',
}
⋮----
export interface SubagentConfig {
  enabled: boolean;
  contextMemory: ContextMemoryMode;
  systemPrompt: string;
  invocationMode: InvocationMode;
  color: string;
  description: string;
}
⋮----
export interface BashToolSettings {
  allowedPattern: string;
  deniedPattern: string;
}
⋮----
export type ToolSettings = BashToolSettings;
⋮----
export interface AgentProfile {
  id: string;
  projectDir?: string; // If specified, it's a project-level profile, otherwise global
  name: string;
  provider: string;
  model: string;
  maxIterations: number;
  maxTokens?: number; // Optional: overrides model maxOutputTokens when set
  minTimeBetweenToolCalls: number; // in milliseconds
  temperature?: number; // Optional: overrides model temperature when set
  enabledServers: string[];
  toolApprovals: Record<string, ToolApprovalState>;
  toolSettings: Record<string, ToolSettings>;
  includeContextFiles: boolean;
  includeRepoMap: boolean;
  usePowerTools: boolean;
  useAiderTools: boolean;
  useTodoTools: boolean;
  useSubagents: boolean;
  useTaskTools: boolean;
  useMemoryTools: boolean;
  useSkillsTools: boolean;
  customInstructions: string;
  subagent: SubagentConfig;
  isSubagent?: boolean; // flag to indicate if this profile is being used as a subagent
  ruleFiles?: string[]; // Array of absolute paths to rule files for this agent profile
}
⋮----
projectDir?: string; // If specified, it's a project-level profile, otherwise global
⋮----
maxTokens?: number; // Optional: overrides model maxOutputTokens when set
minTimeBetweenToolCalls: number; // in milliseconds
temperature?: number; // Optional: overrides model temperature when set
⋮----
isSubagent?: boolean; // flag to indicate if this profile is being used as a subagent
ruleFiles?: string[]; // Array of absolute paths to rule files for this agent profile
⋮----
export interface EnvironmentVariable {
  value: string;
  source: string;
}
⋮----
export type Theme = (typeof THEMES)[number];
⋮----
export type Font = (typeof FONTS)[number];
⋮----
export interface HotkeyConfig {
  projectHotkeys: {
    closeProject: string;
    newProject: string;
    usageDashboard: string;
    modelLibrary: string;
    settings: string;
    cycleNextProject: string;
    cyclePrevProject: string;
    switchProject1: string;
    switchProject2: string;
    switchProject3: string;
    switchProject4: string;
    switchProject5: string;
    switchProject6: string;
    switchProject7: string;
    switchProject8: string;
    switchProject9: string;
  };
  taskHotkeys: {
    switchTask1: string;
    switchTask2: string;
    switchTask3: string;
    switchTask4: string;
    switchTask5: string;
    switchTask6: string;
    switchTask7: string;
    switchTask8: string;
    switchTask9: string;
    focusPrompt: string;
    newTask: string;
    closeTask: string;
  };
  dialogHotkeys: {
    browseFolder: string;
  };
}
⋮----
export enum MemoryEmbeddingProvider {
  SentenceTransformers = 'sentence-transformers',
}
⋮----
export enum ContextCompactionType {
  Compact = 'compact',
  Handoff = 'handoff',
}
⋮----
export interface TaskSettings {
  smartTaskState: boolean;
  autoGenerateTaskName: boolean;
  showTaskStateActions: boolean;
  worktreeSymlinkFolders: string[];
  contextCompactingThreshold: number;
  contextCompactionType: ContextCompactionType;
}
⋮----
export interface MemoryConfig {
  enabled: boolean;
  provider: MemoryEmbeddingProvider;
  model: string;
  maxDistance: number;
}
⋮----
export enum MemoryEmbeddingProgressPhase {
  Idle = 'idle',
  LoadingModel = 'loading-model',
  ReEmbedding = 're-embedding',
  Done = 'done',
  Error = 'error',
}
⋮----
export interface MemoryEmbeddingProgress {
  phase: MemoryEmbeddingProgressPhase;
  status: string | null;
  done: number;
  total: number;
  finished: boolean;
  error?: string;
}
⋮----
export interface SettingsData {
  onboardingFinished?: boolean;
  language: string;
  startupMode?: ProjectStartMode;
  zoomLevel?: number;
  notificationsEnabled?: boolean;
  theme?: Theme;
  font?: Font;
  fontSize?: number;
  renderMarkdown: boolean;
  virtualizedRendering: boolean;
  aiderDeskAutoUpdate: boolean;
  diffViewMode?: DiffViewMode;
  messageViewMode?: MessageViewMode;
  aider: {
    options: string;
    environmentVariables: string;
    addRuleFiles: boolean;
    autoCommits: boolean;
    cachingEnabled: boolean;
    watchFiles: boolean;
    confirmBeforeEdit: boolean;
  };
  preferredModels: string[];

  mcpServers: Record<string, McpServerConfig>;
  llmProviders: {
    openai?: OpenAiProvider;
    anthropic?: AnthropicProvider;
    gemini?: GeminiProvider;
    groq?: GroqProvider;
    bedrock?: BedrockProvider;
    deepseek?: DeepseekProvider;
    ollama?: OllamaProvider;
    lmstudio?: LmStudioProvider;
    minimax?: MinimaxProvider;
    'openai-compatible'?: OpenAiCompatibleProvider;
    opencode?: OpenCodeProvider;
    openrouter?: OpenRouterProvider;
    requesty?: RequestyProvider;
    synthetic?: SyntheticProvider;
    'vertex-ai'?: VertexAiProvider;
  };
  telemetryEnabled: boolean;
  telemetryInformed?: boolean;
  promptBehavior: PromptBehavior;
  server: {
    enabled: boolean;
    basicAuth: {
      enabled: boolean;
      username: string;
      password: string;
    };
  };
  memory: MemoryConfig;
  taskSettings: TaskSettings;
  hotkeyConfig?: HotkeyConfig;
}
⋮----
export interface ProviderProfile {
  id: string;
  name?: string;
  provider: LlmProvider;
  headers?: Record<string, string>;
  disabled?: boolean;
}
⋮----
export interface ProvidersUpdatedData {
  providers: ProviderProfile[];
}
⋮----
export interface AgentProfilesUpdatedData {
  profiles: AgentProfile[];
}
⋮----
export interface VoiceSession {
  ephemeralToken: string;
  model: string;
  idleTimeoutMs: number;
}
⋮----
export interface Group {
  id: string;
  name?: string | LocalizedString;
  color?: string;
  finished?: boolean;
  interruptId?: string;
}
⋮----
export interface PromptContext {
  id: string;
  group?: Group;
}
⋮----
export interface ProjectStartedData {
  baseDir: string;
}
⋮----
export interface ClearTaskData {
  baseDir: string;
  taskId: string;
  clearMessages: boolean;
  clearSession: boolean;
}
⋮----
export interface UsageReportData {
  model: string;
  sentTokens: number;
  receivedTokens: number;
  messageCost: number;
  cacheWriteTokens?: number;
  cacheReadTokens?: number;
  aiderTotalCost?: number;
  agentTotalCost?: number;
}
⋮----
export interface TokensCost {
  tokens: number;
  tokensEstimated?: boolean;
  cost: number;
}
⋮----
export interface TokensInfoData {
  baseDir: string;
  taskId: string;
  chatHistory: TokensCost;
  files: Record<string, TokensCost>;
  repoMap: TokensCost;
  systemMessages: TokensCost;
  agent?: TokensCost;
}
⋮----
export interface InputHistoryData {
  baseDir: string;
  taskId: string;
  inputHistory: string[];
}
⋮----
export interface UserMessageData {
  type: 'user';
  id: string;
  baseDir: string;
  taskId: string;
  content: string;
  promptContext?: PromptContext;
}
⋮----
export interface MessageRemovedData {
  baseDir: string;
  taskId: string;
  messageIds: string[];
}
⋮----
export interface FileEdit {
  path: string;
  original: string;
  updated: string;
}
⋮----
export interface GenericTool {
  groupName: string;
  name: string;
  description: string;
}
⋮----
export interface McpToolInputSchema {
  type: 'object';
  properties: Record<string, JSONSchema7Definition>;
}
⋮----
export interface McpTool {
  serverName: string;
  name: string;
  description?: string;
  inputSchema: McpToolInputSchema;
}
⋮----
export interface McpServerConfig {
  command?: string;
  args?: string[];
  env?: Readonly<Record<string, string>>;
  url?: string;
  headers?: Readonly<Record<string, string>>;
}
⋮----
export interface VersionsInfo {
  aiderDeskCurrentVersion?: string | null;
  aiderCurrentVersion?: string | null;
  aiderDeskAvailableVersion?: string | null;
  aiderAvailableVersion?: string | null;
  aiderDeskDownloadProgress?: number;
  aiderDeskNewVersionReady?: boolean;
  releaseNotes?: string | null;
}
⋮----
export enum FileWriteMode {
  Overwrite = 'overwrite',
  Append = 'append',
  CreateOnly = 'create_only',
}
⋮----
export interface ModelInfo {
  maxInputTokens?: number;
  maxOutputTokens?: number;
  inputCostPerToken?: number;
  outputCostPerToken?: number;
  cacheWriteInputTokenCost?: number;
  cacheReadInputTokenCost?: number;
  useTemperature?: boolean;
  temperature?: number;
}
⋮----
export interface TaskContext {
  version?: number;
  contextMessages: ContextMessage[];
  contextFiles: ContextFile[];
}
⋮----
export interface TaskStateData {
  messages: (ResponseCompletedData | UserMessageData | ToolData)[];
  files: ContextFile[];
  todoItems: TodoItem[];
  question: QuestionData | null;
  workingMode: WorkingMode;
}
⋮----
export type WorkingMode = z.infer<typeof WorkingModeSchema>;
⋮----
export type TaskData = z.infer<typeof TaskDataSchema>;
⋮----
export interface CreateTaskParams {
  parentId?: string | null;
  name?: string;
  autoApprove?: boolean;
  activate?: boolean;
  handoff?: boolean;
  sendEvent?: boolean;
}
⋮----
export interface TaskCreatedData {
  baseDir: string;
  task: TaskData;
  activate?: boolean;
  editLast?: boolean;
}
⋮----
export enum DefaultTaskState {
  Todo = 'TODO',
  InProgress = 'IN_PROGRESS',
  Interrupted = 'INTERRUPTED',
  MoreInfoNeeded = 'MORE_INFO_NEEDED',
  ReadyForReview = 'READY_FOR_REVIEW',
  ReadyForImplementation = 'READY_FOR_IMPLEMENTATION',
  Done = 'DONE',
}
⋮----
export interface TodoItem {
  name: string;
  completed: boolean;
}
⋮----
export interface UsageDataRow {
  timestamp: string;
  project: string;
  model: string;
  input_tokens: number;
  output_tokens: number;
  cache_read_tokens: number;
  cache_write_tokens: number;
  cost: number;
}
⋮----
export interface Model {
  id: string;
  providerId: string;
  maxInputTokens?: number;
  maxOutputTokens?: number;
  maxOutputTokensLimit?: number;
  temperature?: number;
  inputCostPerToken?: number;
  outputCostPerToken?: number;
  cacheWriteInputTokenCost?: number;
  cacheReadInputTokenCost?: number;
  supportsTools?: boolean;
  isCustom?: boolean;
  isHidden?: boolean;
  hasModelOverrides?: boolean;
  providerOverrides?: Record<string, unknown>;
}
⋮----
export interface ProviderModelsData {
  models?: Model[];
  loading?: boolean;
  errors?: Record<string, string>;
}
⋮----
export interface ModelOverrides {
  version: number;
  models: Model[];
}
⋮----
export interface CustomCommandArgument {
  description: string;
  required?: boolean;
}
⋮----
export interface CustomCommand {
  name: string;
  description: string;
  arguments: CustomCommandArgument[];
  template: string;
  includeContext?: boolean;
  autoApprove?: boolean;
}
⋮----
export interface TerminalData {
  terminalId: string;
  baseDir: string;
  taskId: string;
  data: string;
}
⋮----
export interface TerminalExitData {
  terminalId: string;
  baseDir: string;
  taskId: string;
  exitCode: number;
  signal?: number;
}
⋮----
export enum MemoryEntryType {
  Task = 'task',
  UserPreference = 'user-preference',
  CodePattern = 'code-pattern',
}
⋮----
export interface MemoryEntry {
  id: string;
  content: string;
  type: MemoryEntryType;
  taskId?: string;
  projectId?: string;
  timestamp: number;
}
⋮----
export interface BranchInfo {
  name: string;
  isCurrent: boolean;
  hasWorktree: boolean;
}
export interface NotificationData {
  baseDir: string;
  title: string;
  body: string;
}

================
File: src/common/utils.ts
================
import fs from 'fs/promises';
⋮----
import { TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
⋮----
import { OS, UsageReportData } from './types';
⋮----
type TextContent =
  | string
  | {
      type: 'text';
      text: string;
    };
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
export const isTextContent = (content: any): content is TextContent
⋮----
export const extractTextContent = (content: unknown): string =>
⋮----
export const delay = (ms: number): Promise<void>
⋮----
export const parseUsageReport = (model: string, report: string): UsageReportData =>
⋮----
const parseTokens = (tokenStr: string): number =>
⋮----
export const normalizeBaseDir = (
  baseDir: string,
  os: OS = process.platform === 'win32' ? OS.Windows : process.platform === 'darwin' ? OS.MacOS : OS.Linux,
): string =>
⋮----
// On Windows, paths are case-insensitive so we normalize to lowercase
⋮----
// Handle WSL paths like \\wsl.localhost\Ubuntu\home\user\...
⋮----
// Find the third backslash which marks the end of the distro name
⋮----
// Extract the path after \\wsl.localhost\<distro_name>\
⋮----
// Replace backslashes with forward slashes
⋮----
// Otherwise, return the path as is
⋮----
export const compareBaseDirs = (baseDir1: string, baseDir2: string, os?: OS): boolean =>
⋮----
/**
 * Extracts the inner error message from Electron IPC errors.
 * Electron wraps errors with format: "Error invoking remote method 'METHOD_NAME': InnerError"
 * This function extracts just the "InnerError" part.
 *
 * @param error - The error object or string
 * @returns The extracted error message without Electron's wrapper
 */
export const extractIpcErrorMessage = (error: unknown): string =>
⋮----
// Check for Electron IPC error format: "Error invoking remote method 'METHOD_NAME': ..."
⋮----
// Find the colon after the method name
⋮----
// Return everything after the colon and space
⋮----
// If no IPC error format found, return the original message
⋮----
export const fileExists = async (fileName: string): Promise<boolean> =>
⋮----
export const extractServerNameToolName = (toolCallName: string): [string, string] =>
⋮----
export const isMessageEmpty = (content: unknown): boolean =>
⋮----
// JavaScript/TypeScript
⋮----
// Web
⋮----
// Python
⋮----
// Java/JVM
⋮----
// C/C++
⋮----
// C#/.NET
⋮----
// Rust
⋮----
// Go
⋮----
// Ruby
⋮----
// PHP
⋮----
// Shell
⋮----
// Data formats
⋮----
// Markdown/Docs
⋮----
// Swift/Objective-C
⋮----
// SQL
⋮----
// Other languages
⋮----
// Config files
⋮----
// Other
⋮----
export const getLanguageFromPath = (path: string | undefined): string =>
⋮----
export const isURL = (url: string): boolean =>
⋮----
export const extractProviderModel = (modelId: string): [string, string] =>

================
File: src/main/agent/middlewares/extract-reasoning-middleware.ts
================
import type { LanguageModelV2StreamPart, LanguageModelV2Middleware } from '@ai-sdk/provider';
⋮----
import logger from '@/logger';
⋮----
/**
 * Extract an XML-tagged reasoning section from the generated text and exposes it
 * as a `reasoning` property on the result.
 *
 * @param tagName - The name of the XML tag to extract reasoning from.
 * @param separator - The separator to use between reasoning and text sections.
 */
⋮----
// check for additional character at the end, e.g. `
// if not found, continue with the next chunk
⋮----
// if there is a backtick before the closing tag and after, publish the buffer, as this is not ending
⋮----
// this should not happen
⋮----
// set and publish the rest of the buffer as non reasoning
⋮----
/**
 * Returns the index of the start of the searchedText in the text, or null if it
 * is not found.
 */
⋮----
// Return null immediately if searchedText is empty.
⋮----
// Check if the searchedText exists as a direct substring of text.
⋮----
// Otherwise, look for the largest suffix of "text" that matches
// a prefix of "searchedText". We go from the end of text inward.

================
File: src/main/agent/tools/aider.ts
================
import fs from 'fs/promises';
import path from 'path';
⋮----
import { tool } from 'ai';
import { z } from 'zod';
import { v4 as uuidv4 } from 'uuid';
import {
  TOOL_GROUP_NAME_SEPARATOR,
  AIDER_TOOL_GROUP_NAME as TOOL_GROUP_NAME,
  AIDER_TOOL_GET_CONTEXT_FILES as TOOL_GET_CONTEXT_FILES,
  AIDER_TOOL_ADD_CONTEXT_FILES as TOOL_ADD_CONTEXT_FILES,
  AIDER_TOOL_DROP_CONTEXT_FILES as TOOL_DROP_CONTEXT_FILES,
  AIDER_TOOL_RUN_PROMPT as TOOL_RUN_PROMPT,
  AIDER_TOOL_DESCRIPTIONS,
} from '@common/tools';
import { AgentProfile, PromptContext, ToolApprovalState } from '@common/types';
⋮----
import { ApprovalManager } from './approval-manager';
⋮----
import type { ToolSet } from 'ai';
⋮----
import { Task } from '@/task';
⋮----
export const createAiderToolset = (task: Task, profile: AgentProfile, promptContext?: PromptContext): ToolSet =>
⋮----
// This condition is now met if the file initially existed or was just created
⋮----
// Only add to results if it wasn't handled by the creation logic above
⋮----
// Ask the question and wait for the answer
⋮----
// Notify that we are still processing after aider finishes
⋮----
// Filter out tools that are set to Never in toolApprovals

================
File: src/main/agent/tools/approval-manager.ts
================
import { AgentProfile, QuestionData, ToolApprovalState } from '@common/types';
⋮----
import { Task } from '@/task';
⋮----
export class ApprovalManager
⋮----
constructor(
⋮----
public async handleApproval(key: string, text: string, subject?: string): Promise<[boolean, string | undefined]>
⋮----
return [true, undefined]; // Auto-approve
⋮----
return [true, undefined]; // Pre-approved
⋮----
return [true, undefined]; // Approved and remember for this run
⋮----
return [true, undefined]; // Approved for this instance
⋮----
return [false, userInput]; // Not approved

================
File: src/main/agent/tools/helpers.ts
================
import { tool } from 'ai';
import { z } from 'zod';
import {
  TOOL_GROUP_NAME_SEPARATOR,
  HELPERS_TOOL_GROUP_NAME as TOOL_GROUP_NAME,
  HELPERS_TOOL_NO_SUCH_TOOL as TOOL_NO_SUCH_TOOL,
  HELPERS_TOOL_INVALID_TOOL_ARGUMENTS as TOOL_INVALID_TOOL_ARGUMENTS,
} from '@common/tools';
⋮----
import type { ToolSet } from 'ai';
⋮----
export const createHelpersToolset = (): ToolSet =>
⋮----
// This tool's result is primarily for the LLM's internal reasoning,
// informing it that its previous attempt failed because the tool was invalid.
⋮----
// This tool informs the LLM about the argument validation error.

================
File: src/main/agent/tools/memory.ts
================
import { tool, type ToolSet } from 'ai';
import { z } from 'zod';
import { AgentProfile, MemoryEntryType, PromptContext, ToolApprovalState } from '@common/types';
import {
  MEMORY_TOOL_DELETE as TOOL_DELETE,
  MEMORY_TOOL_DESCRIPTIONS,
  MEMORY_TOOL_LIST as TOOL_LIST,
  MEMORY_TOOL_RETRIEVE as TOOL_RETRIEVE,
  MEMORY_TOOL_STORE as TOOL_STORE,
  MEMORY_TOOL_UPDATE as TOOL_UPDATE,
  MEMORY_TOOL_GROUP_NAME as TOOL_GROUP_NAME,
  TOOL_GROUP_NAME_SEPARATOR,
} from '@common/tools';
⋮----
import { ApprovalManager } from './approval-manager';
⋮----
import { MemoryManager } from '@/memory/memory-manager';
import { Task } from '@/task';
import logger from '@/logger';
⋮----
export const createMemoryToolset = (task: Task, profile: AgentProfile, memoryManager: MemoryManager, promptContext?: PromptContext): ToolSet =>
⋮----
// Get the memory to show its content in the approval question
⋮----
// Filter by project and type if specified
⋮----
// Get the memory to show its content in the approval question
⋮----
// Filter out tools that are set to Never in toolApprovals

================
File: src/main/agent/tools/power.ts
================
import fs from 'fs/promises';
import os from 'os';
import path from 'path';
import { spawn } from 'child_process';
⋮----
import { tool, type ToolSet } from 'ai';
import { z } from 'zod';
import { glob } from 'glob';
import { AgentProfile, BashToolSettings, FileWriteMode, PromptContext, ToolApprovalState } from '@common/types';
import {
  POWER_TOOL_BASH as TOOL_BASH,
  POWER_TOOL_DESCRIPTIONS,
  POWER_TOOL_FETCH as TOOL_FETCH,
  POWER_TOOL_FILE_EDIT as TOOL_FILE_EDIT,
  POWER_TOOL_FILE_READ as TOOL_FILE_READ,
  POWER_TOOL_FILE_WRITE as TOOL_FILE_WRITE,
  POWER_TOOL_GLOB as TOOL_GLOB,
  POWER_TOOL_GREP as TOOL_GREP,
  POWER_TOOL_GROUP_NAME as TOOL_GROUP_NAME,
  POWER_TOOL_SEMANTIC_SEARCH as TOOL_SEMANTIC_SEARCH,
  TOOL_GROUP_NAME_SEPARATOR,
} from '@common/tools';
// @ts-expect-error istextorbinary is not typed properly
import { isBinary } from 'istextorbinary';
import { isURL } from '@common/utils';
import { search } from '@probelabs/probe';
⋮----
import { ApprovalManager } from './approval-manager';
⋮----
import { PROBE_BINARY_PATH } from '@/constants';
import { Task } from '@/task';
import logger from '@/logger';
import { filterIgnoredFiles, scrapeWeb } from '@/utils';
import { isAbortError, isFileNotFoundError } from '@/utils/errors';
⋮----
/**
 * Expands a tilde (~) at the beginning of a path to the user's home directory.
 * @param filePath - The file path to expand
 * @returns The expanded path with ~ replaced by the home directory
 */
const expandTilde = (filePath: string): string =>
⋮----
/**
 * Reads a file and returns its content with optional line numbering and line range.
 * @param absolutePath - The absolute path to the file
 * @param withLines - Whether to return the file content with line numbers in format "lineNumber|content"
 * @param lineOffset - The starting line number (0-based) to begin reading from
 * @param lineLimit - The maximum number of lines to read
 * @returns The file content as a string, formatted according to the parameters
 * @throws Error if the file is binary or cannot be read
 */
export const readFileContent = async (absolutePath: string, withLines = false, lineOffset = 0, lineLimit = 1000): Promise<string> =>
⋮----
export const createPowerToolset = (task: Task, profile: AgentProfile, promptContext?: PromptContext, abortSignal?: AbortSignal): ToolSet =>
⋮----
// Sanitize escape characters from searchTerm and replacementText
const sanitize = (str: string) =>
⋮----
// Check if string contains single escaped backslashes (like \n, \t, etc.)
⋮----
// Only sanitize if no single escaped backslashes are found
⋮----
// Remove leading backslash
⋮----
// Remove escaped newlines, quotes, tabs, etc. only when they have double backslashes
⋮----
absolute: false, // Keep paths relative to cwd for easier processing
⋮----
// Convert to absolute paths for filtering, then back to relative
⋮----
// Ensure paths are relative to task.getTaskDir()
⋮----
// Filter out ignored files in batch
⋮----
const searchRegex = new RegExp(searchTerm, caseSensitive ? undefined : 'i'); // Simpler for line-by-line test
⋮----
false, // not finished yet
⋮----
// Pattern validation
⋮----
// Check denied patterns first
⋮----
// Check allowed patterns - if matches, skip approval and execute directly
⋮----
const cleanup = () =>
⋮----
const resolveWithResult = () =>
⋮----
const abortListener = () =>
⋮----
// Listen for abort signal
⋮----
// Set timeout
⋮----
// Send streaming update
⋮----
false, // not finished yet
⋮----
// Send streaming update
⋮----
false, // not finished yet
⋮----
exitCode = 124; // Timeout exit code
⋮----
// Use parameter maxTokens if provided, otherwise use the default
⋮----
// Check if it's a dependency path (format: language:rest)
⋮----
// If path is relative (including "." and "./"), resolve it relative to task.getTaskDir()
⋮----
// List of supported languages by the probe binary
⋮----
// Only include language parameter if it's supported
⋮----
// @ts-expect-error probe is not typed properly
⋮----
// Filter out tools that are set to Never in toolApprovals

================
File: src/main/agent/tools/skills.ts
================
import fs from 'fs/promises';
import path from 'path';
import { homedir } from 'os';
⋮----
import { tool, type ToolSet } from 'ai';
import { loadFront } from 'yaml-front-matter';
import { z } from 'zod';
import { SKILLS_TOOL_ACTIVATE_SKILL, SKILLS_TOOL_GROUP_NAME, TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
import { AgentProfile, PromptContext, ToolApprovalState } from '@common/types';
⋮----
import { ApprovalManager } from './approval-manager';
⋮----
import { AIDER_DESK_DIR } from '@/constants';
import { Task } from '@/task';
⋮----
type SkillLocation = 'global' | 'project';
⋮----
type Skill = {
  name: string;
  description: string;
  location: SkillLocation;
  dirPath: string;
};
⋮----
const parseSkillFrontMatter = (markdown: string):
⋮----
const safeReadDir = async (dirPath: string): Promise<string[]> =>
⋮----
const safeStat = async (filePath: string): Promise<import('fs').Stats | null> =>
⋮----
const loadSkillsFromDir = async (skillsRootDir: string, location: SkillLocation): Promise<Skill[]> =>
⋮----
const getActivateSkillDescription = (skills: Skill[]): string =>
⋮----
export const createSkillsToolset = async (task: Task, profile: AgentProfile, promptContext?: PromptContext): Promise<ToolSet> =>
⋮----
const generateActivateSkillDescription = async (): Promise<string> =>

================
File: src/main/agent/tools/subagents.ts
================
import { tool, type ToolSet } from 'ai';
import { z } from 'zod';
import { AgentProfile, ContextMemoryMode, ContextMessage, InvocationMode, PromptContext, SettingsData } from '@common/types';
import { v4 as uuidv4 } from 'uuid';
import { SUBAGENTS_TOOL_GROUP_NAME, SUBAGENTS_TOOL_RUN_TASK, TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
import { DEFAULT_AGENT_PROFILE, isSubagentEnabled } from '@common/agent';
import { extractServerNameToolName } from '@common/utils';
⋮----
import { AgentProfileManager } from '@/agent/agent-profile-manager';
import { Task } from '@/task';
import logger from '@/logger';
⋮----
export const getSubagentId = (subagent: AgentProfile): string =>
⋮----
export const createSubagentsToolset = async (
  _settings: SettingsData,
  task: Task,
  agentProfileManager: AgentProfileManager,
  mainAgentProfile: AgentProfile,
  abortSignal?: AbortSignal,
  contextMessages: ContextMessage[] = [],
  currentMessages: ContextMessage[] = [],
): Promise<ToolSet> =>
⋮----
const generateSubagentsRunTaskDescription = (): string =>
⋮----
// Create a subagent profile based on the selected subagent
⋮----
useTodoTools: false, // Disable todo tools for simplicity,
useSubagents: false, // Disable nested subagents
useMemoryTools: targetSubagent.useMemoryTools ?? false, // Use memory tools if enabled, false by default
⋮----
// Create promptContext with working group
⋮----
const getSubagentContextMessages = (contextMemory: ContextMemoryMode) =>
⋮----
const findMessagesForToolCallId = (toolCallId: string) =>
⋮----
// @ts-expect-error part.output.value is expected to be in the output
⋮----
// @ts-expect-error subagentId is expected to be in the input
⋮----
// @ts-expect-error prompt is expected to be in the input
⋮----
// Run the subagent with the focused context
⋮----
// Update promptContext to finished state with success
⋮----
// Update promptContext to finished state with error

================
File: src/main/agent/tools/tasks.ts
================
import path from 'path';
⋮----
import { type Tool, tool, type ToolSet } from 'ai';
import { z } from 'zod';
import {
  TASKS_TOOL_CREATE_TASK,
  TASKS_TOOL_DELETE_TASK,
  TASKS_TOOL_DESCRIPTIONS,
  TASKS_TOOL_GET_TASK,
  TASKS_TOOL_GET_TASK_MESSAGE,
  TASKS_TOOL_GROUP_NAME,
  TASKS_TOOL_LIST_TASKS,
  TASKS_TOOL_SEARCH_PARENT_TASK,
  TASKS_TOOL_SEARCH_TASK,
  TOOL_GROUP_NAME_SEPARATOR,
} from '@common/tools';
import { AgentProfile, PromptContext, SettingsData, TaskData, ToolApprovalState } from '@common/types';
import { search } from '@probelabs/probe';
import { fileExists } from '@common/utils';
⋮----
import { ApprovalManager } from './approval-manager';
⋮----
import { AIDER_DESK_TASKS_DIR, PROBE_BINARY_PATH } from '@/constants';
import logger from '@/logger';
import { isAbortError } from '@/utils/errors';
import { Task } from '@/task';
⋮----
export const createTasksToolset = (settings: SettingsData, task: Task, profile: AgentProfile, promptContext?: PromptContext): ToolSet =>
⋮----
// Filter by state if provided
⋮----
// Apply pagination
⋮----
// Count subtasks for this task
⋮----
// Find subtasks of this task
⋮----
// Handle negative indexing
⋮----
actualIndex = contextMessages.length + messageIndex; // e.g., -1 becomes length-1
⋮----
// Determine if parentTaskId should be available (only for top-level tasks)
⋮----
// Parse modelId to extract provider and model
⋮----
// createNewTask returns TaskData, not Task instance
// We need to get the actual Task instance to call methods on it
⋮----
// Prevent deleting the current task
⋮----
// @ts-expect-error probe is not typed properly
⋮----
/**
 * Creates the search parent task tool for subtasks.
 * This tool is not included in the default toolset and should be added
 * directly in agent.ts's getAvailableTools method when task is a subtask.
 */
export const createSearchParentTaskTool = (task: Task, promptContext?: PromptContext): Tool =>
⋮----
// Always use parent task ID
⋮----
// No approval required for parent task search
⋮----
// @ts-expect-error probe is not typed properly

================
File: src/main/agent/tools/todo.ts
================
import { tool, type ToolSet } from 'ai';
import { z } from 'zod';
import {
  TODO_TOOL_CLEAR_ITEMS,
  TODO_TOOL_DESCRIPTIONS,
  TODO_TOOL_GET_ITEMS,
  TODO_TOOL_GROUP_NAME,
  TODO_TOOL_SET_ITEMS,
  TODO_TOOL_UPDATE_ITEM_COMPLETION,
  TOOL_GROUP_NAME_SEPARATOR,
} from '@common/tools';
import { AgentProfile, PromptContext, ToolApprovalState } from '@common/types';
⋮----
import { ApprovalManager } from './approval-manager';
⋮----
import { Task } from '@/task';
⋮----
export const createTodoToolset = (task: Task, profile: AgentProfile, promptContext?: PromptContext): ToolSet =>

================
File: src/main/agent/agent-profile-manager.ts
================
import fs from 'fs/promises';
import path from 'path';
import { homedir } from 'os';
⋮----
import { FSWatcher, watch } from 'chokidar';
import debounce from 'lodash/debounce';
import { DEFAULT_AGENT_PROFILE, DEFAULT_AGENT_PROFILES } from '@common/agent';
import { fileExists } from '@common/utils';
import { v4 as uuidv4 } from 'uuid';
⋮----
import type { AgentProfile } from '@common/types';
⋮----
import { AIDER_DESK_AGENTS_DIR, AIDER_DESK_RULES_DIR } from '@/constants';
import logger from '@/logger';
import { EventManager } from '@/events';
import { deriveDirName } from '@/utils';
⋮----
// Helper methods for directory management
const getGlobalAgentsDir = (): string
const getProjectAgentsDir = (projectDir: string): string
const getAgentsDirForProfile = (profile: AgentProfile): string
⋮----
// Helper methods for rule file discovery
const getAgentRulesDir = (agentsDir: string, agentDirName: string): string
⋮----
const getRuleFilesForAgent = async (agentDirName: string, agentsDir: string): Promise<string[]> =>
⋮----
// Rules directory doesn't exist or can't be read
⋮----
const getAllRuleFilesForProfile = async (profile: AgentProfile, dirName: string): Promise<string[]> =>
⋮----
// Get rule files from the profile's own directory
⋮----
// If this is a project-level profile, also check for global profile with same ID
⋮----
interface AgentProfileContext {
  dirName: string;
  order: number;
  agentProfile: AgentProfile;
}
⋮----
export class AgentProfileManager
⋮----
// Single profiles map - the core simplification
⋮----
// Directory watching (one watcher per directory)
private directoryWatchers: Map<string, FSWatcher> = new Map(); // agentsDir → watcher
⋮----
constructor(private readonly eventManager: EventManager)
⋮----
public async start(): Promise<void>
⋮----
public async initializeForProject(projectDir: string): Promise<void>
⋮----
// Load project-specific profiles
⋮----
// Setup file watcher for project directory
⋮----
public removeProject(projectDir: string): void
⋮----
// Remove project profiles from the main profiles map
⋮----
// Clean up directory watcher
⋮----
private notifyListeners(): void
⋮----
private async initializeProfiles(ensureDefaults = true): Promise<void>
⋮----
// Ensure default profiles exist in global directory
⋮----
// Load global profiles
⋮----
private async ensureDefaultProfiles(globalAgentsDir: string): Promise<void>
⋮----
// Only create default profiles if the directory is empty
⋮----
// Config file doesn't exist, create it
⋮----
private async setupGlobalFileWatcher(): Promise<void>
⋮----
// Clean up existing global watcher
⋮----
// Watch global agents directory
⋮----
private async setupWatcherForDirectory(agentsDir: string): Promise<void>
⋮----
// Create directory if it doesn't exist
⋮----
// Close existing watcher for this directory if any
⋮----
// Also watch rules subdirectories within each agent directory
⋮----
const reloadFunction = ()
⋮----
// Set up rules watcher event handlers
⋮----
private async reloadProfiles(agentsDir: string): Promise<void>
⋮----
// Clear existing profiles from this directory
⋮----
// Reload profiles from directory
⋮----
// Notify listeners
⋮----
private async getExistingDirNames(agentsDir: string): Promise<Set<string>>
⋮----
// Directory doesn't exist or can't be read
⋮----
private async isAgentsDirectoryEmpty(agentsDir: string): Promise<boolean>
⋮----
// Check if there are any directories (profiles)
⋮----
return false; // Found at least one profile directory
⋮----
return true; // No profile directories found
⋮----
// Directory doesn't exist or can't be read, treat as empty
⋮----
private async loadProfilesFromDirectory(agentsDir: string): Promise<void>
⋮----
// Load order first
⋮----
order: 0, // Will be set by order file
⋮----
// If no config.json exists, check if this is a project-level directory
// and if there's a corresponding global profile, merge project-level rule files
⋮----
// Apply order to profiles
⋮----
// If no order file exists, create one based on current order
⋮----
// Add profiles to the main profiles map
⋮----
private sanitizeAgentProfile(loadedProfile: AgentProfile, agentDirName: string): AgentProfile
⋮----
private async loadProfileFile(filePath: string, dirName: string): Promise<AgentProfile | null>
⋮----
// Sanitize profile with defaults
⋮----
// Discover and load rule files for this profile
⋮----
private async saveProfileToFile(profile: AgentProfile, filePath: string): Promise<void>
⋮----
// Create a copy of the profile without ruleFiles since they are dynamically discovered
⋮----
private async loadOrderFile(agentsDir: string): Promise<Map<string, number>>
⋮----
private async saveOrderFile(agentsDir: string, order: Map<string, number>): Promise<void>
⋮----
private applyOrderToProfiles(profilesMap: Map<string, AgentProfileContext>, order: Map<string, number>): Map<string, AgentProfileContext>
⋮----
// If both have order, use it
⋮----
// If only one has order, the one with order comes first
⋮----
// If neither has order, maintain original order (by name as fallback)
⋮----
private async createDefaultOrderFromProfiles(profilesMap: Map<string, AgentProfileContext>, agentsDir: string): Promise<void>
⋮----
public async createProfile(profile: AgentProfile, projectDir?: string): Promise<void>
⋮----
// Get existing directory names for collision handling
⋮----
// Derive unique directory name
⋮----
// Create directory and save config.json
⋮----
// Reload profiles to update the cache
⋮----
public async updateProfile(profile: AgentProfile): Promise<void>
⋮----
public async deleteProfile(profileId: string): Promise<void>
⋮----
// Reload profiles to update the cache
⋮----
public getProfile(profileId: string): AgentProfile | undefined
⋮----
private getOrderedProfiles(profileContexts: AgentProfileContext[]): AgentProfile[]
⋮----
// First, prioritize project profiles over global profiles
⋮----
// Then sort by order within the same scope
⋮----
private getGlobalProfiles(): AgentProfile[]
⋮----
public getAllProfiles(): AgentProfile[]
⋮----
public getProjectProfiles(projectDir: string, includeGlobal = true): AgentProfile[]
⋮----
public async updateAgentProfilesOrder(agentProfiles: AgentProfile[]): Promise<void>
⋮----
// Group profiles by their projectDir (undefined/null = global)
⋮----
// Process each group separately
⋮----
// Create order map for this group
⋮----
// Determine the agents directory for this group
⋮----
// Save the order file for this group
⋮----
// Update the in-memory profiles for this group
⋮----
// Notify listeners
⋮----
private async mergeProjectRuleFilesIntoGlobalProfile(agentDirName: string, projectAgentsDir: string): Promise<void>
⋮----
// Check if there are project-level rule files
⋮----
return; // No project-level rule files to merge
⋮----
// Find the corresponding global profile by directory name
⋮----
return; // No global profile found with matching directory name
⋮----
// Create a new profile object with merged rule files
⋮----
// Update the profile context
⋮----
async dispose(): Promise<void>
⋮----
// Clean up all directory watchers
⋮----
// Clear profiles
⋮----
getDefaultAgentProfileId()

================
File: src/main/agent/agent.ts
================
import fs from 'fs/promises';
import path from 'path';
⋮----
import { v4 as uuidv4 } from 'uuid';
import {
  AgentProfile,
  ContextCompactionType,
  ContextFile,
  ContextMessage,
  ContextUserMessage,
  DefaultTaskState,
  McpTool,
  McpToolInputSchema,
  PromptContext,
  ProviderProfile,
  ToolApprovalState,
  UsageReportData,
} from '@common/types';
import {
  APICallError,
  type FinishReason,
  generateText,
  type ImagePart,
  InvalidToolInputError,
  jsonSchema,
  type ModelMessage,
  NoSuchToolError,
  smoothStream,
  type StepResult,
  streamText,
  type Tool,
  type ToolCallOptions,
  type ToolSet,
  type TypedToolResult,
  wrapLanguageModel,
} from 'ai';
import { delay, extractServerNameToolName } from '@common/utils';
import { LlmProviderName } from '@common/agent';
import { countTokens } from 'gpt-tokenizer/model/gpt-4o';
import { Client as McpSdkClient } from '@modelcontextprotocol/sdk/client/index.js';
// @ts-expect-error istextorbinary is not typed properly
import { isBinary } from 'istextorbinary';
import { fileTypeFromBuffer } from 'file-type';
import {
  HELPERS_TOOL_GROUP_NAME,
  POWER_TOOL_FILE_READ,
  POWER_TOOL_GROUP_NAME,
  TASKS_TOOL_GROUP_NAME,
  TASKS_TOOL_SEARCH_PARENT_TASK,
  TOOL_GROUP_NAME_SEPARATOR,
} from '@common/tools';
⋮----
import { createPowerToolset, readFileContent } from './tools/power';
import { createTodoToolset } from './tools/todo';
import { createSearchParentTaskTool, createTasksToolset } from './tools/tasks';
import { createAiderToolset } from './tools/aider';
import { createHelpersToolset } from './tools/helpers';
import { createMemoryToolset } from './tools/memory';
import { createSkillsToolset } from './tools/skills';
import { MCP_CLIENT_TIMEOUT, McpConnector, McpManager } from './mcp-manager';
import { ApprovalManager } from './tools/approval-manager';
import { ANSWER_RESPONSE_START_TAG, extractPromptContextFromToolResult, findLastUserMessage, THINKING_RESPONSE_STAR_TAG } from './utils';
import { extractReasoningMiddleware } from './middlewares/extract-reasoning-middleware';
⋮----
import { MemoryManager } from '@/memory/memory-manager';
import { PromptsManager } from '@/prompts';
import { AIDER_DESK_PROJECT_RULES_DIR } from '@/constants';
import { Task } from '@/task';
import { Store } from '@/store';
import logger from '@/logger';
import { optimizeMessages } from '@/agent/optimizer';
import { ModelManager } from '@/models/model-manager';
import { TelemetryManager } from '@/telemetry/telemetry-manager';
import { ResponseMessage } from '@/messages';
import { createSubagentsToolset } from '@/agent/tools/subagents';
import { AgentProfileManager } from '@/agent/agent-profile-manager';
⋮----
export class Agent
⋮----
constructor(
⋮----
private async getFilesContentForPrompt(files: ContextFile[], task: Task): Promise<
⋮----
// If binary, try to detect if it's an image using image-type and return base64
⋮----
// Read file as text
⋮----
// Add line numbers to content
⋮----
// Process the results and separate text files from images
⋮----
// Add to imageParts array
⋮----
// Add to textFileContents array
⋮----
private async getContextFilesMessages(task: Task, profile: AgentProfile, contextFiles: ContextFile[]): Promise<ModelMessage[]>
⋮----
// Filter out rule files as they are already included in the system prompt
⋮----
// Check if the file is within the rules directory
⋮----
// Separate readonly and editable files
⋮----
// Process readonly files first
⋮----
// Process editable files
⋮----
private async getWorkingFilesMessages(task: Task, contextFiles: ContextFile[]): Promise<ModelMessage[]>
⋮----
// Separate image files from non-image files
⋮----
// Add file list for non-image files
⋮----
// Add images as separate messages
⋮----
private async getAvailableTools(
    task: Task,
    profile: AgentProfile,
    provider: ProviderProfile,
    mcpConnectors: McpConnector[] = [],
    messages?: ContextMessage[],
    resultMessages?: ContextMessage[],
    abortSignal?: AbortSignal,
    promptContext?: PromptContext,
): Promise<ToolSet>
⋮----
// Build the toolSet directly from enabled clients and tools
⋮----
// Skip if serverName is not in the profile's enabledServers
⋮----
// Process tools for this enabled server
⋮----
// Check approval state first from the profile
⋮----
// Skip tools marked as 'Never' approved
⋮----
return; // Do not add the tool if it's never approved
⋮----
// Add search parent task tool for subtasks
⋮----
// Add helper tools
⋮----
// Add provider-specific tools
⋮----
private wrapToolsWithHooks(task: Task, toolSet: ToolSet): ToolSet
⋮----
private convertMpcToolToAiSdkTool(
    providerName: LlmProviderName,
    serverName: string,
    task: Task,
    profile: AgentProfile,
    mcpClient: McpSdkClient,
    toolDef: McpTool,
    approvalManager: ApprovalManager,
    promptContext?: PromptContext,
): Tool
⋮----
const execute = async (args:
⋮----
// --- Tool Approval Logic ---
⋮----
// --- End Tool Approval Logic ---
⋮----
// Enforce minimum time between tool calls
⋮----
// Update last tool call time
⋮----
// Update last tool call time even if there's an error
⋮----
// Return an error message string to the agent
⋮----
/**
   * Fixes the input schema for various providers.
   */
private fixInputSchema(provider: LlmProviderName, inputSchema: McpToolInputSchema): McpToolInputSchema
⋮----
// Deep clone to avoid modifying the original schema
⋮----
// gemini does not like "default" in the schema
⋮----
// gemini requires at least one property in the schema
⋮----
async runAgent(
    task: Task,
    profile: AgentProfile,
    prompt: string | null,
    promptContext?: PromptContext,
    initialContextMessages?: ContextMessage[],
    initialContextFiles?: ContextFile[],
    systemPrompt?: string,
    includeInContext = true,
    abortSignal?: AbortSignal,
): Promise<ContextMessage[]>
⋮----
// Set default values inside function body since await can't be used in parameter initializers
⋮----
// Create new abort controller for this run only if abortSignal is not provided
⋮----
// add user message
⋮----
// Lazily initialize MCP clients for the current task
⋮----
// repairToolCall function that attempts to repair tool calls
const repairToolCall = async (
⋮----
// If the tool doesn't exist, return a call to the helper tool
// to inform the LLM about the missing tool.
⋮----
// If the arguments are invalid, return a call to the helper tool
// to inform the LLM about the argument error.
⋮----
toolInput: JSON.stringify(error.toolInput), // Pass the problematic input
error: error.message, // Pass the validation error message
⋮----
// Attempt generic repair for other types of errors
⋮----
// Ensure args are stringified for the AI SDK tool call format
⋮----
: null; // Return null if the LLM couldn't repair the call
⋮----
// Get the model to use its temperature and max output tokens settings
⋮----
const getBaseModelCallParams = () =>
⋮----
const onStepFinish = async (stepResult: StepResult<typeof toolSet>) =>
⋮----
// @ts-expect-error checking keys in error
⋮----
// try again
⋮----
// stop
⋮----
// Persist new messages incrementally after each iteration
⋮----
// Check for 'stop' with trailing tool message
⋮----
// Clean up abort controller only if we created it
⋮----
private filterResultMessages(resultMessages: ContextMessage[])
⋮----
private async getContextFilesAsToolCallMessages(task: Task, profile: AgentProfile, contextFiles: ContextFile[]): Promise<ModelMessage[]>
⋮----
// Check if power file_read tool is available (not 'Never')
⋮----
// Filter out rule files as they are already included in the system prompt
⋮----
// Separate readonly and editable files
⋮----
// If tool call format is not available, fall back to the old user message format
⋮----
// Use tool call format
const createToolCallAndResult = async (files: ContextFile[], readOnlyFile: boolean): Promise<ModelMessage[]> =>
⋮----
// Read all files and categorize them
⋮----
// If binary, try to detect if it's an image
⋮----
// Process non-binary files: each file gets its own assistant message with tool-call and tool-result
⋮----
// Process image files: keep current behavior
⋮----
// Process read-only files
⋮----
// Process editable files
⋮----
private async prepareMessages(task: Task, profile: AgentProfile, contextMessages: ModelMessage[], contextFiles: ContextFile[]): Promise<ModelMessage[]>
⋮----
// Add repo map if enabled
⋮----
// Add context files with content or just list of working files
⋮----
// Add message history before context files
⋮----
// Add message history after working files
⋮----
async generateText(
    agentProfile: AgentProfile,
    systemPrompt: string,
    prompt: string,
    projectDir: string,
    messages: ContextMessage[] = [],
    abortable = true,
    abortSignal?: AbortSignal,
): Promise<string | undefined>
⋮----
async estimateTokens(task: Task, profile: AgentProfile): Promise<number>
⋮----
// Format tools for the prompt
⋮----
inputSchema: tool.inputSchema ? tool.inputSchema : '', // Get Zod schema description
⋮----
// Add tool definitions and system prompt to the beginning
⋮----
role: msg.role === 'tool' ? 'user' : msg.role, // Map 'tool' role to user message as gpt-tokenizer does not support tool messages
content: typeof msg.content === 'string' ? msg.content : JSON.stringify(msg.content), // Handle potential non-string content if necessary
⋮----
interrupt()
⋮----
isRunning()
⋮----
private async processStep<TOOLS extends ToolSet>(
    currentResponseId: string,
    { content, reasoningText, text, toolCalls, toolResults, finishReason, usage, providerMetadata, response, reasoning, files }: StepResult<TOOLS>,
    task: Task,
    profile: AgentProfile,
    provider: ProviderProfile,
    promptContext?: PromptContext,
    abortSignal?: AbortSignal,
): Promise<ContextMessage[]>
⋮----
reasoningText: reasoningText?.substring(0, 100), // Log truncated reasoning
text: text?.substring(0, 100), // Log truncated text
⋮----
const processToolResult = (toolResult: TypedToolResult<TOOLS>, isLast = true) =>
⋮----
// Update the existing tool message with the result
⋮----
isLast ? usageReport : undefined, // Only add usage report to the last tool message
⋮----
// move to the next one right away
⋮----
// Process successful tool results *after* sending text/reasoning and handling errors
⋮----
// @ts-expect-error the id is there
⋮----
private async compactMessagesIfNeeded(
    task: Task,
    profile: AgentProfile,
    userRequestMessage: ContextUserMessage,
    contextMessages: ContextMessage[],
    contextFiles: ContextFile[],
    messages: ModelMessage[],
    resultMessages: ContextMessage[],
    promptContext?: PromptContext,
    abortSignal?: AbortSignal,
)
⋮----
// Check for context compacting
⋮----
// reload messages after compacting
⋮----
// Perform handoff

================
File: src/main/agent/index.ts
================


================
File: src/main/agent/mcp-manager.ts
================
import path from 'path';
import fs from 'fs/promises';
⋮----
import { v4 as uuidv4 } from 'uuid';
import { McpServerConfig, McpTool } from '@common/types';
import { Client as McpSdkClient } from '@modelcontextprotocol/sdk/client/index.js';
import { StdioClientTransport } from '@modelcontextprotocol/sdk/client/stdio.js';
import { StreamableHTTPClientTransport } from '@modelcontextprotocol/sdk/client/streamableHttp.js';
import { SSEClientTransport } from '@modelcontextprotocol/sdk/client/sse.js';
⋮----
import logger from '@/logger';
import { AIDER_DESK_CACHE_DIR } from '@/constants';
⋮----
export interface McpToolsCacheEntry {
  tools: McpTool[];
  cachedAt: number;
}
⋮----
export interface McpToolsCache {
  version: number;
  servers: Record<string, McpToolsCacheEntry>;
}
⋮----
// increasing timeout for MCP client requests
⋮----
export interface McpConnector {
  client: McpSdkClient;
  serverName: string;
  tools: McpTool[];
  serverConfig: McpServerConfig;
}
⋮----
export class McpManager
⋮----
async init()
⋮----
async initMcpConnectors(
    mcpServers: Record<string, McpServerConfig>,
    projectDir: string | null,
    taskDir: string | null,
    forceReload = false,
    enabledServers?: string[],
): Promise<McpConnector[]>
⋮----
// close old connector
⋮----
// Wait for initialization and update cache
⋮----
// Save cache to disk after initialization
⋮----
// Ensure index is within bounds for serverNames, though it should be if Object.values and Object.keys maintain order
⋮----
private async initMcpConnector(
    projectDir: string | null,
    taskDir: string | null,
    serverName: string,
    config: McpServerConfig,
    forceReload = false,
    initId?: string,
    scope: string = 'global',
): Promise<McpConnector>
⋮----
oldConnector = null; // Clear the old client reference
⋮----
async close(): Promise<void>
⋮----
private interpolateServerConfig(serverConfig: McpServerConfig, projectDir: string | null, taskDir: string | null): McpServerConfig
⋮----
const interpolateValue = (value: string): string =>
⋮----
// Replace ${projectDir} with the project root directory
⋮----
// Replace ${taskDir} with the task directory (worktree dir or project root)
⋮----
private hasInterpolation(value: string, pattern: string): boolean
⋮----
private configHasInterpolation(serverConfig: McpServerConfig, pattern: string): boolean
⋮----
private calculateServerScope(serverConfig: McpServerConfig, projectDir: string | null, taskDir: string | null, serverName: string): string
⋮----
// No interpolation: scope = ${taskDir || projectDir || 'global'}
⋮----
// Has ${projectDir} only: scope = ${projectDir || 'global'}
⋮----
// Has both ${projectDir} and ${taskDir}: scope = ${projectDir}:${taskDir}
⋮----
private async createMcpConnector(serverName: string, config: McpServerConfig, projectDir: string | null, taskDir: string | null): Promise<McpConnector>
⋮----
// Handle npx command on Windows
⋮----
// If command is 'docker', ensure '--init' is present after 'run'
// so the container properly handles SIGINT and SIGTERM
⋮----
// Find the index of 'run'. This handles both 'docker run' and 'docker container run'.
⋮----
// Verify it's likely the actual 'run' subcommand
// e.g., 'run' is the first arg, or it follows 'container'
⋮----
// Check if '--init' already exists anywhere in the arguments
// (Docker might tolerate duplicates, but it's cleaner not to add it if present)
⋮----
// Insert '--init' immediately after the 'run' subcommand
⋮----
// Log a warning if we couldn't confidently find the 'run' command
// This might happen with unusual docker commands defined in the config
⋮----
// Get tools from this server using the SDK client
⋮----
})) as unknown as { tools: McpTool[] }; // Cast back to expected structure
⋮----
async getMcpServerTools(serverName: string, config?: McpServerConfig): Promise<McpTool[] | null>
⋮----
private compareServerConfig(config: McpServerConfig, otherConfig: McpServerConfig)
⋮----
private async loadToolsCache(): Promise<void>
⋮----
async saveToolsCache(): Promise<void>
⋮----
getCachedTools(serverName: string): McpTool[] | null
⋮----
updateToolsCache(serverName: string, tools: McpTool[]): void
⋮----
// Pool methods
private getPoolKey(scope: string, serverName: string): string
⋮----
private getPooledConnector(scope: string, serverName: string): Promise<McpConnector> | undefined
⋮----
private setPooledConnector(scope: string, serverName: string, connector: Promise<McpConnector>): void
⋮----
private async closeAllPooledConnectors(): Promise<void>
⋮----
async reloadAllServers(mcpServers: Record<string, McpServerConfig>, force: boolean): Promise<void>
⋮----
async reloadSingleServer(serverName: string, config: McpServerConfig): Promise<McpTool[]>

================
File: src/main/agent/optimizer.ts
================
import { type AgentProfile, InvocationMode, ToolApprovalState } from '@common/types';
import { isSubagentEnabled } from '@common/agent';
import { cloneDeep } from 'lodash';
import { type ModelMessage, type ToolContent, type ToolResultPart, type UserModelMessage } from 'ai';
import {
  AIDER_TOOL_GROUP_NAME,
  AIDER_TOOL_RUN_PROMPT,
  MEMORY_TOOL_GROUP_NAME,
  MEMORY_TOOL_RETRIEVE,
  MEMORY_TOOL_STORE,
  SUBAGENTS_TOOL_GROUP_NAME,
  SUBAGENTS_TOOL_RUN_TASK,
  TODO_TOOL_GET_ITEMS,
  TODO_TOOL_GROUP_NAME,
  TOOL_GROUP_NAME_SEPARATOR,
} from '@common/tools';
import { extractTextContent } from '@common/utils';
⋮----
import logger from '@/logger';
import { type CacheControl } from '@/models';
import { Task } from '@/task';
import { getSubagentId } from '@/agent/tools/subagents';
⋮----
/**
 * Optimizes the messages before sending them to the LLM. This should reduce the token count and improve the performance.
 */
export const optimizeMessages = (
  messages: ModelMessage[],
  cacheControl?: CacheControl,
  task: Task | null = null,
  profile: AgentProfile | null = null,
  projectProfiles: AgentProfile[] = [],
  userRequestMessageIndex: number = -1,
) =>
⋮----
const addImportantReminders = (
  task: Task,
  profile: AgentProfile,
  projectProfiles: AgentProfile[],
  userRequestMessageIndex: number,
  messages: ModelMessage[],
): ModelMessage[] =>
⋮----
// Add reminder about automatic subagents
⋮----
// Add reminder about worktree mode
⋮----
/**
 * For run_prompt tool, which returns `responses` array, we should replace this array with empty array.
 */
const optimizeAiderMessages = (messages: ModelMessage[]): ModelMessage[] =>
⋮----
// @ts-expect-error result is expected to have responses
⋮----
// @ts-expect-error result is expected to have promptContext
⋮----
// ignore
⋮----
/**
 * For subagent tool, which now returns an array of messages, we should replace this array with only the last message for LLM processing.
 */
const optimizeSubagentMessages = (messages: ModelMessage[]): ModelMessage[] =>
⋮----
// @ts-expect-error result is expected to have messages
⋮----
// ignore
⋮----
/**
 * Converts tool results containing images into a separate user message containing the image.
 */
const convertImageToolResults = (messages: ModelMessage[]): ModelMessage[] =>
⋮----
// If result is not valid JSON, or doesn't match the image format,
// just keep the original toolResultPart as is.
⋮----
// Push the modified tool message
⋮----
// Push the user message if it was created
⋮----
// For non-tool messages, just push them as is
⋮----
/**
 * Some models (Gemini Flash) are trying to call the same tool multiple times in a row.
 * This function detects this pattern (assistant tool call -> tool result -> same assistant tool call)
 * and modifies the result of the second tool call to return an error, preventing a loop.
 */
const removeDuplicateToolCalls = (messages: ModelMessage[]): ModelMessage[] =>
⋮----
// Need at least 4 messages for the pattern: assistant, tool, assistant, tool
⋮----
const newMessages = [...messages]; // Create a mutable copy
⋮----
// Iterate up to the point where the pattern can start
⋮----
// Check for the pattern: assistant(call) -> tool(result) -> assistant(call) -> tool(result)
⋮----
// Ensure both assistant messages contain tool calls
⋮----
// Compare the tool calls
⋮----
// This is a duplicate call. Modify the fourth message (the result of the duplicate call).
⋮----
// Match the tool result part to the duplicate tool call id
⋮----
// Replace the old tool message with the modified one
⋮----
// To prevent overlapping checks and unnecessary work, we can advance the index.
// Since we've processed a block of 4, we can safely jump ahead.

================
File: src/main/agent/utils.ts
================
import { ContextMessage, ContextUserMessage, MessageRole, PromptContext } from '@common/types';
⋮----
/**
 * Extracts PromptContext from a tool result if available.
 * @param toolResult - The tool result object to extract PromptContext from
 * @returns PromptContext if found, undefined otherwise
 */
export const extractPromptContextFromToolResult = (toolResult: unknown): PromptContext | undefined =>
⋮----
export const findLastUserMessage = (messages: ContextMessage[]): ContextUserMessage | undefined =>

================
File: src/main/bmad/context/code-review.json.hbs
================
[
  {
    "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
    "role": "user",
    "content": "Execute the code-review workflow by following these steps:\n\nIT IS CRITICAL THAT YOU FOLLOW THESE STEPS - while staying in character as the current agent persona you may have loaded:\n\n<steps CRITICAL=\"TRUE\">\n1. Always LOAD the FULL _bmad/core/tasks/workflow.xml\n2. READ its entire contents - this is the CORE OS for EXECUTING the specific workflow-config _bmad/bmm/workflows/4-implementation/code-review/workflow.yaml\n3. Pass the yaml path _bmad/bmm/workflows/4-implementation/code-review/workflow.yaml as 'workflow-config' parameter to the workflow.xml instructions\n4. Follow workflow.xml instructions EXACTLY as written to process and follow the specific workflow config and its instructions\n5. Save outputs after EACH section when generating any documents from templates\n</steps>",
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "4b780c0c-755c-48bd-9bfc-cc497e41fcf1",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll execute the code-review workflow by following the steps exactly as specified. Let me start by loading the core workflow XML file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_829ff7d160e1452d88564f83",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/core/tasks/workflow.xml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "817a084c-dd0e-4ab7-9b2a-9fabf9b90898",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_829ff7d160e1452d88564f83",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/core/tasks/workflow.xml"}}
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "4fd86cf5-c6ef-472a-ae2f-ed8619bc8cb6",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to load the specific workflow configuration file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_252abf7c68f64e2dafe7dd6f",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/code-review/workflow.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "629e7b1b-5e0b-4f8c-b97d-7408f736e785",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_252abf7c68f64e2dafe7dd6f",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/code-review/workflow.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "a2516c2b-65be-4720-b5b4-244816ec7e69",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to load the instructions.xml file to understand the specific steps for the code review workflow."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_72c9df046fa44138ae5a2069",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/code-review/instructions.xml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "b7531d9b-2b50-4a3e-8aa4-ea27026ea627",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_72c9df046fa44138ae5a2069",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/code-review/instructions.xml"}}
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "462a52d7-eccd-4dbe-917b-aa32bd8addbc",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll execute the code-review workflow. Let me start by following Step 1 of the workflow instructions.\n\n## Step 1: Load Configuration and Discover Changes\n\nFirst, let me load the configuration file to resolve variables:"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_00b31c026ec348da8415bd5d",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "00245163-1aa9-4a08-8099-35a2cca5872e",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_00b31c026ec348da8415bd5d",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8"
      }
    }
  },
  {
    "id": "321b2573-60c6-410c-99ca-c25579085de8",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Good! Now I have the config. Let me first check if there's a project context file:"
      }
    ],
    "promptContext": {
      "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
      "group": {
        "id": "e9019b26-4a71-4ed8-88f4-04848cd2bfd8",
        "name": "Code Review",
        "color": "#ef4444",
        "finished": true
      }
    }
  }
]

================
File: src/main/bmad/context/create-architecture.json.hbs
================
[
  {
    "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/3-solutioning/create-architecture/workflow.md, READ its entire contents and follow its directions exactly!",
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5"
      }
    }
  },
  {
    "id": "57b450ba-352f-4b17-b78e-f330d57cf5ec",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll load and read the workflow.md file to understand the directions."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_993caf92aa5541a2bbc7a46f",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/3-solutioning/create-architecture/workflow.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5"
      }
    }
  },
  {
    "id": "b56d5987-cfe3-4921-8c07-884ca134c356",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_993caf92aa5541a2bbc7a46f",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/3-solutioning/create-architecture/workflow.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5"
      }
    }
  },
  {
    "id": "442937e1-b80e-4b32-8898-a7f22bf3e67d",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "The workflow.md file has instructed me to load and follow `steps/step-01-init.md`."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_ae6a2abea3fa4f728915f279",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/3-solutioning/create-architecture/steps/step-01-init.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5"
      }
    }
  },
  {
    "id": "3e741176-b9bf-4e22-a43e-c6d78cc6573d",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_ae6a2abea3fa4f728915f279",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/3-solutioning/create-architecture/steps/step-01-init.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5"
      }
    }
  },
  {
    "id": "5427f682-81d0-4e92-8a30-c781e57e49da",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to follow the step-01-init.md instructions."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_604bf4169d964ef390316531",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5"
      }
    }
  },
  {
    "id": "c18ec548-6bb2-4d63-96f2-e58e2448f3d2",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_604bf4169d964ef390316531",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5"
      }
    }
  },
  {
    "id": "fd4dbf48-4f1d-43fe-b62e-4505ae39b057",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to:\n1. Check for existing workflow by looking for architecture.md in the planning artifacts folder\n2. Handle continuation if exists\n3. If fresh workflow, discover input documents\n\nLet me first check for existing workflow."
      }
    ],
    "promptContext": {
      "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
      "group": {
        "id": "46989d4b-9e99-4b21-9a21-690d6adb37b5",
        "name": "Create Architecture",
        "color": "#eab308",
        "finished": true
      }
    }
  }
]

================
File: src/main/bmad/context/create-epics-and-stories.json.hbs
================
[
  {
    "id": "ae185f3a-a746-4205-8045-27c3977e5378",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/3-solutioning/create-epics-and-stories/workflow.md, READ its entire contents and follow its directions exactly!",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378",
      "group": {
        "id": "ae185f3a-a746-4205-8045-27c3977e5378"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "The user wants me to load and read the full workflow.md file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_335aa2849d964595b5417078",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/3-solutioning/create-epics-and-stories/workflow.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "13eb49b0-906f-47ae-81ac-d5c0c9558124",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378",
      "group": {
        "id": "ae185f3a-a746-4205-8045-27c3977e5378"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_335aa2849d964595b5417078",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/3-solutioning/create-epics-and-stories/workflow.md"}}
        }
      }
    ],
    "id": "e64c387c-f1ef-47a4-abb0-6e6584e0560b",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378",
      "group": {
        "id": "ae185f3a-a746-4205-8045-27c3977e5378"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "The workflow.md file has been loaded. Now I need to:\n\n1. Load the config from _bmad/bmm/config.yaml\n2. Follow the initialization sequence\n\nLet me first load the config file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_e4ffb59fa9654ca9973ddb8d",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "caf5cdd3-5a41-414a-b38f-9ed34f292c76",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378",
      "group": {
        "id": "ae185f3a-a746-4205-8045-27c3977e5378"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_e4ffb59fa9654ca9973ddb8d",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "id": "8f787651-d831-433d-933a-1583cd2fac71",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378",
      "group": {
        "id": "ae185f3a-a746-4205-8045-27c3977e5378"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Configuration loaded. Now I need to load the first step file as directed."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_8ad76c2a28bb441c8fb139ca",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/3-solutioning/create-epics-and-stories/steps/step-01-validate-prerequisites.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "2c572c39-5d2a-4f86-b51b-47b98d259956",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378",
      "group": {
        "id": "ae185f3a-a746-4205-8045-27c3977e5378"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_8ad76c2a28bb441c8fb139ca",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/3-solutioning/create-epics-and-stories/steps/step-01-validate-prerequisites.md"}}
        }
      }
    ],
    "id": "2b9c6499-1c6b-49e8-8de0-bdbc78e114b2",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378",
      "group": {
        "id": "ae185f3a-a746-4205-8045-27c3977e5378",
        "name": "Create Epics and Stories",
        "color": "#eab308",
        "finished": true
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Welcome, Wlad! I'm here to help you transform your PRD requirements and Architecture decisions into comprehensive stories organized by user value.\n\nLet me start by validating the required prerequisite documents for epic and story creation."
      }
    ],
    "id": "198d2498-988e-4dbc-bd2a-9ba321e5fa06",
    "promptContext": {
      "id": "ae185f3a-a746-4205-8045-27c3977e5378"
    }
  }
]

================
File: src/main/bmad/context/create-prd.json.hbs
================
[
  {
    "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/2-plan-workflows/create-prd/workflow.md, READ its entire contents and follow its directions exactly!\n\nCreate PRD.",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool-call",
        "toolCallId": "tool_FXeLRrXqGuYA8P4OOWOTeHrD",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/2-plan-workflows/create-prd/workflow-create-prd.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "d7cfdd71-3513-4223-9b10-b4c995f028a4",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "tool_FXeLRrXqGuYA8P4OOWOTeHrD",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/2-plan-workflows/create-prd/workflow-create-prd.md"}}
        }
      }
    ],
    "id": "d4d14230-9f22-4ca5-aa7c-cef9c4e36c5e",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool-call",
        "toolCallId": "tool_LgMFbKXOMN0ZMoCCyREaOgSw",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "59fb3854-d6af-427e-8ad5-c73ba5a6d028",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "tool_LgMFbKXOMN0ZMoCCyREaOgSw",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "id": "6a609d18-116e-4227-98f3-5154d2b99bde",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "tool-call",
        "toolCallId": "tool_6NQsKIO7dYij9H2aIX6ffEiD",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/2-plan-workflows/create-prd/steps-c/step-01-init.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "9726f399-f671-4b02-baa2-3e517ad92562",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "tool_6NQsKIO7dYij9H2aIX6ffEiD",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/2-plan-workflows/create-prd/steps-c/step-01-init.md"}}
        }
      }
    ],
    "id": "84eb696f-4a5e-4534-960b-91630c5fabd6",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
      "group": {
        "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd",
        "name": "Create PRD",
        "color": "#22c55e",
        "finished": true
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "**Create Mode: Creating a new PRD from scratch.**\n\nLet me check for existing workflow state and discover input documents."
      }
    ],
    "id": "335abfa5-f996-4663-a67b-798e5894acad",
    "promptContext": {
      "id": "c42c921e-d283-40fd-bfc9-e9431f5ae7bd"
    }
  }
]

================
File: src/main/bmad/context/create-product-brief.json.hbs
================
[
  {
    "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/1-analysis/create-product-brief/workflow.md, READ its entire contents and follow its directions exactly!",
    "promptContext": {
      "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
      "group": {
        "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll load the workflow file and read its contents to understand what needs to be done."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_dc58c5d11ff7463a9371d444",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/1-analysis/create-product-brief/workflow.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "c59ccf91-7e25-4452-938d-b62f37020aad",
    "promptContext": {
      "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
      "group": {
        "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_dc58c5d11ff7463a9371d444",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/1-analysis/create-product-brief/workflow.md"}}
        }
      }
    ],
    "id": "0920dd00-1c2a-4c53-b846-f428d78794e5",
    "promptContext": {
      "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
      "group": {
        "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll load the configuration file and then read the first step."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_606166eb19774ef7884180e0",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "8b5aaecc-b244-450f-b836-1483557ecc56",
    "promptContext": {
      "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
      "group": {
        "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_606166eb19774ef7884180e0",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "id": "807a662e-bdc1-4e2e-9a2c-dab192f168a0",
    "promptContext": {
      "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
      "group": {
        "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Good, I have the configuration. Now I need to read the first step file: step-01-init.md"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_8ddcb389cfb441e684ccbca2",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/1-analysis/create-product-brief/steps/step-01-init.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "bfba2eb4-3372-425b-b5fa-27b4ae225f18",
    "promptContext": {
      "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
      "group": {
        "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_8ddcb389cfb441e684ccbca2",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/1-analysis/create-product-brief/steps/step-01-init.md"}}
        }
      }
    ],
    "id": "db15a641-d8d6-472d-b973-7802d1932690",
    "promptContext": {
      "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
      "group": {
        "id": "7d9c0e52-d7c7-44ca-bb3b-aba76fc85a04",
        "name": "Create Product Brief",
        "color": "#0ea5e9",
        "finished": true
      }
    }
  }
]

================
File: src/main/bmad/context/create-story.json.hbs
================
[
  {
    "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THESE STEPS - while staying in character as the current agent persona you may have loaded:\n\n<steps CRITICAL=\"TRUE\">\n1. Always LOAD the FULL _bmad/core/tasks/workflow.xml\n2. READ its entire contents - this is the CORE OS for EXECUTING the specific workflow-config _bmad/bmm/workflows/4-implementation/create-story/workflow.yaml\n3. Pass the yaml path _bmad/bmm/workflows/4-implementation/create-story/workflow.yaml as 'workflow-config' parameter to the workflow.xml instructions\n4. Follow workflow.xml instructions EXACTLY as written to process and follow the specific workflow config and its instructions\n5. Save outputs after EACH section when generating any documents from templates\n</steps>",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll follow the workflow instructions exactly. Let me start by loading the core workflow.xml file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_24d81fe46da94b1d90a4c6f0",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/core/tasks/workflow.xml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "9b58373d-ad9d-4f70-b0ce-670643a3ac3b",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_24d81fe46da94b1d90a4c6f0",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/core/tasks/workflow.xml"}}
        }
      }
    ],
    "id": "794c1252-f1f3-4b2d-ab4f-2b48fd6bef58",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I'll load the workflow configuration file:"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_ae82af1f1d514301bc4d53d0",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/create-story/workflow.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "ab8fe106-c4a4-44ed-b025-07a2d8a7d1d2",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_ae82af1f1d514301bc4d53d0",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/create-story/workflow.yaml"}}
        }
      }
    ],
    "id": "ec47f4c9-fde2-451c-a449-63894482a42b",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now loading the config file to resolve variables:"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_5e245f153a9e4444940e5a70",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "0a394e78-9ab7-4e57-ad1b-b905feed9a9b",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_5e245f153a9e4444940e5a70",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "id": "ae3485f8-fa8e-40af-a97b-3c2a6ea51044",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll continue gathering the necessary workflow components, noting that the context context might require additional investigation."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_74e9cfbfe9f24120be207544",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/create-story/instructions.xml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "5b0fb6f6-bf1b-4f26-a3f6-a984e90d1951",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_74e9cfbfe9f24120be207544",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/create-story/instructions.xml"}}
        }
      }
    ],
    "id": "ee6ca852-f6fe-442d-a47a-b529037fb26c",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to load the template file to understand the output structure. Let me also check the sprint status file to see if we have stories to work with."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_da9c634d8c80444e857373ee",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/create-story/template.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "ba9c4be9-4048-43b6-a572-6ec4e03c4963",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_da9c634d8c80444e857373ee",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/create-story/template.md"}}
        }
      }
    ],
    "id": "a7d8bbd6-c8fe-4034-8f3e-d99f22ca1997",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Let's check for the sprint status file next."
      }
    ],
    "id": "82984431-f757-45d1-a611-9bf295e85acf",
    "promptContext": {
      "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
      "group": {
        "id": "ef51632b-19ef-4a45-9bfc-b9604a76a4ae",
        "name": "Create Story",
        "color": "#ef4444",
        "finished": true
      }
    }
  }
]

================
File: src/main/bmad/context/create-ux-design.json.hbs
================
[
  {
    "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/2-plan-workflows/create-ux-design/workflow.md, READ its entire contents and follow its directions exactly!",
    "promptContext": {
      "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
      "group": {
        "id": "26b1fd31-c522-4d8d-815b-a7524623beaa"
      }
    }
  },
  {
    "id": "e5ab394b-6f63-49dd-a64d-86e81f5fb148",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Let me start by reading this file to understand what needs to be done."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_6cd573b3ba43492daf6614e1",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/2-plan-workflows/create-ux-design/workflow.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
      "group": {
        "id": "26b1fd31-c522-4d8d-815b-a7524623beaa"
      }
    }
  },
  {
    "id": "f46e2afb-65e6-45cd-bc80-25d2ece29718",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_6cd573b3ba43492daf6614e1",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/2-plan-workflows/create-ux-design/workflow.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
      "group": {
        "id": "26b1fd31-c522-4d8d-815b-a7524623beaa"
      }
    }
  },
  {
    "id": "0fc864bc-3311-445e-80e3-18aa78d788f9",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "The workflow.md file has been loaded. Let me first load the config file, then read step-01-init.md."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_8afd474249c24ebdb01b0e70",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      },
      {
        "type": "tool-call",
        "toolCallId": "call_617e95379e27427592c59a82",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/2-plan-workflows/create-ux-design/steps/step-01-init.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
      "group": {
        "id": "26b1fd31-c522-4d8d-815b-a7524623beaa"
      }
    }
  },
  {
    "id": "fe52c642-c3af-4e8f-a948-349d31a43412",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_8afd474249c24ebdb01b0e70",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      },
      {
        "type": "tool-result",
        "toolCallId": "call_617e95379e27427592c59a82",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/2-plan-workflows/create-ux-design/steps/step-01-init.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
      "group": {
        "id": "26b1fd31-c522-4d8d-815b-a7524623beaa"
      }
    }
  },
  {
    "id": "a7b4683d-7036-4812-8b73-d7a6fd9b5de9",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll initialize the UX design workflow for aider-desk.\n\n**My Analysis:**\n- This is a fresh workflow initialization\n- Need to discover input documents (PRD, Product Brief, Research, Project Context)\n- Will use smart discovery with sharded-folder logic\n- Must create document from template and set up frontmatter\n\n---\n\n**Step 1: Checking for Existing Workflow**"
      }
    ],
    "promptContext": {
      "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
      "group": {
        "id": "26b1fd31-c522-4d8d-815b-a7524623beaa",
        "name": "Create UX Design",
        "color": "#22c55e",
        "finished": true
      }
    }
  }
]

================
File: src/main/bmad/context/dev-story.json.hbs
================
[
  {
    "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
    "role": "user",
    "content": "Execute the dev-story workflow by following these steps:\n\nIT IS CRITICAL THAT YOU FOLLOW THESE STEPS - while staying in character as the current agent persona you may have loaded:\n\n<steps CRITICAL=\"TRUE\">\n1. Always LOAD the FULL _bmad/core/tasks/workflow.xml\n2. READ its entire contents - this is the CORE OS for EXECUTING the specific workflow-config _bmad/bmm/workflows/4-implementation/dev-story/workflow.yaml\n3. Pass the yaml path _bmad/bmm/workflows/4-implementation/dev-story/workflow.yaml as 'workflow-config' parameter to the workflow.xml instructions\n4. Follow workflow.xml instructions EXACTLY as written to process and follow the specific workflow config and its instructions\n5. Save outputs after EACH section when generating any documents from templates\n</steps>",
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "e8186906-f6fe-426b-a02a-a47c6e37db15",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll execute the dev-story workflow as specified. Let me start by loading the core workflow.xml file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_31863b7d35f64776843fac55",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/core/tasks/workflow.xml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "84c756b7-5fd3-4ec6-addb-aac952ef9b57",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_31863b7d35f64776843fac55",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/core/tasks/workflow.xml"}}
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "e0637286-7801-4b02-8736-001b0de85e53",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now let me load the dev-story workflow configuration:"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_716b567f703e432ba386dab8",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/dev-story/workflow.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "cb7fbd5e-e088-418a-ad4a-0e7b14559117",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_716b567f703e432ba386dab8",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/dev-story/workflow.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "6ae8fe1a-3cfd-4131-bd9d-eae4100794b6",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now let me load the configuration file to resolve variables:"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_f166056f22b24dedbc7305a1",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "09cb6b94-c948-41c0-b8a8-b49fc62f11b7",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_f166056f22b24dedbc7305a1",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "3e048fa6-e96d-4c46-a822-cf51938c3e04",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now let me load the instructions file:"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_f05ecf0bba524944b654a722",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/dev-story/instructions.xml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "3faccaa3-48d5-422c-8a5b-f5c08b702fbf",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_f05ecf0bba524944b654a722",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/dev-story/instructions.xml"}}
        }
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff"
      }
    }
  },
  {
    "id": "3426cc4c-6134-4d3a-a411-43193a26a924",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I'll follow the workflow.xml instructions to execute the dev-story workflow. Let me check if the sprint status file exists:"
      }
    ],
    "promptContext": {
      "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
      "group": {
        "id": "26004f23-5282-4b46-8f83-481ccbc298ff",
        "name": "Dev Story",
        "color": "#ef4444",
        "finished": true
      }
    }
  }
]

================
File: src/main/bmad/context/quick-dev.json.hbs
================
[
  {
    "id": "32d0288c-1e8e-482d-9de2-7c5ee6c9bd48",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/bmad-quick-flow/quick-dev/workflow.md, READ its entire contents and follow its directions exactly!",
    "promptContext": {
      "id": "quick-dev",
      "group": {
        "id": "quick-dev",
        "name": "Quick Dev",
        "color": "#f59e0b",
        "finished": true
      }
    }
  },
  {
    "id": "15431701-25ca-4bdb-928e-581df8cce9d5",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Let me do read the workflow file and follow its directions."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_6e8249cca8124cd7a75e6806",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/bmad-quick-flow/quick-dev/workflow.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "quick-dev",
      "group": {
        "id": "quick-dev"
      }
    }
  },
  {
    "id": "0023abb9-0e85-48c2-86e1-4d3b8b80c99e",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_6e8249cca8124cd7a75e6806",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/bmad-quick-flow/quick-dev/workflow.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "quick-dev",
      "group": {
        "id": "quick-dev"
      }
    }
  },
  {
    "id": "268bbd09-88da-4242-afca-93c236ee9eff",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I need to start with step-01-mode-detection.md.\n\nLet me load that file next."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_72d364b530904335a61e8fe3",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/bmad-quick-flow/quick-dev/steps/step-01-mode-detection.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "quick-dev",
      "group": {
        "id": "quick-dev"
      }
    }
  },
  {
    "id": "7ccf6c94-2d28-4844-a08c-20586969026b",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_72d364b530904335a61e8fe3",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/bmad-quick-flow/quick-dev/steps/step-01-mode-detection.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "quick-dev",
      "group": {
        "id": "quick-dev"
      }
    }
  },
  {
    "id": "fb182d70-6d3f-48e1-8ed5-75ec1c9a73c0",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to execute Step 1: Mode Detection. Let me follow the workflow:\n\n1. First, capture baseline - check if Git repo exists\n2. Load project context if exists\n3. Parse user input to determine mode\n4. Evaluate escalation threshold if Mode B"
      }
    ],
    "promptContext": {
      "id": "quick-dev",
      "group": {
        "id": "quick-dev"
      }
    }
  }
]

================
File: src/main/bmad/context/quick-spec.json.hbs
================
[
  {
    "id": "6e4d6097-e57c-47cb-ba30-3543a53d0c1f",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/bmad-quick-flow/quick-spec/workflow.md, READ its entire contents and follow its directions exactly!",
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec",
        "name": "Quick Spec",
        "color": "#f59e0b",
        "finished": true
      }
    }
  },
  {
    "id": "98b720cb-0f65-49d9-adf9-a0f57bba79e1",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I will load the workflow.md file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_286662d2eff1474fbe8b36d3",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/bmad-quick-flow/quick-spec/workflow.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec"
      }
    }
  },
  {
    "id": "e74cb529-2642-43fd-822e-59673ebe36f5",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_286662d2eff1474fbe8b36d3",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/bmad-quick-flow/quick-spec/workflow.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec"
      }
    }
  },
  {
    "id": "eb5469cb-7eef-4835-b94a-fe76e76981a3",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "The workflow.md file is loaded. Let me load the config file next."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_8b9c6667ffd944bfb428818e",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec"
      }
    }
  },
  {
    "id": "a0e58df1-26c1-4919-9503-b929dc373465",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_8b9c6667ffd944bfb428818e",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec"
      }
    }
  },
  {
    "id": "a4f90420-1757-4548-985a-f87f6aba7b6f",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Good, I have the config. Now I need to read step-01-understand.md and follow its instructions exactly."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_3c9bc115b16b4788a7efe618",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/bmad-quick-flow/quick-spec/steps/step-01-understand.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec"
      }
    }
  },
  {
    "id": "c71e8e2e-4212-4b0a-9c4a-a277ddd07387",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_3c9bc115b16b4788a7efe618",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/bmad-quick-flow/quick-spec/steps/step-01-understand.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec"
      }
    }
  },
  {
    "id": "12f2051f-4e97-4cd7-adba-6b504ecfa0fe",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Let me follow the step-01-understand.md instructions exactly.\n\nFirst, I need to check if there's a WIP file. Let me check the path.\n\nFrom the config:\n- implementation_artifacts: \"{project-root}/_bmad-output/implementation-artifacts\"\n- output_folder: \"{project-root}/_bmad-output\"\n\nSo the wipFile should be: `{project-root}/_bmad-output/implementation-artifacts/tech-spec-wip.md`\n\nLet me check if this file exists."
      }
    ],
    "promptContext": {
      "id": "quick-spec",
      "group": {
        "id": "quick-spec"
      }
    }
  }
]

================
File: src/main/bmad/context/research.json.hbs
================
[
  {
    "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438",
    "role": "user",
    "content": "IT IS CRITICAL THAT YOU FOLLOW THIS COMMAND: LOAD the FULL _bmad/bmm/workflows/1-analysis/research/workflow.md, READ its entire contents and follow its directions exactly!",
    "promptContext": {
      "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438",
      "group": {
        "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll load and read the workflow file you specified."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_e0310bde7e0945fd91fe05f9",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/1-analysis/research/workflow-technical-research.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "05b3477d-146d-4e10-8cd5-aa6c9ccc4947",
    "promptContext": {
      "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438",
      "group": {
        "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_e0310bde7e0945fd91fe05f9",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/1-analysis/research/workflow-technical-research.md"}}
        }
      }
    ],
    "id": "9b81ab90-6d41-4672-ac75-e6fdee8816db",
    "promptContext": {
      "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438",
      "group": {
        "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438"
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I've loaded the research workflow. Let me now initialize the workflow by loading the configuration file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_d0798312c69d493c8565bd92",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "id": "63cd3f8b-7d72-4b40-a834-a6ca5126f6bd",
    "promptContext": {
      "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438",
      "group": {
        "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438"
      }
    }
  },
  {
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_d0798312c69d493c8565bd92",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "id": "de419579-792c-4339-92de-26c97aef1705",
    "promptContext": {
      "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438",
      "group": {
        "id": "6c97db1e-297f-491b-b65c-eaac1bbb6438",
        "name": "BMAD Method: Research",
        "color": "#0ea5e9",
        "finished": true
      }
    }
  },
  {
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Welcome! I'm excited to work with you as your research partner. I bring web research capabilities with rigorous source verification, while you bring the domain expertise and research direction.\n\n**Let me help you clarify what you'd like to research.**\n\n**First, tell me: What specific topic, problem, or area do you want to research?**\n\nFor example:\n- 'The electric vehicle market in Europe'\n- 'Cloud migration strategies for healthcare'\n- 'AI implementation in financial services'\n- 'Sustainable packaging regulations'\n- 'Or anything else you have in mind...'"
      }
    ],
    "id": "45b4980f-c7da-4c03-95de-18d4ee695171",
    "promptContext": {
      "id": "45b4980f-c7da-4c03-95de-18d4ee695171"
    }
  }
]

================
File: src/main/bmad/context/sprint-planning.json.hbs
================
[
  {
    "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
    "role": "user",
    "content": "Execute the sprint-planning workflow by following these steps:\n\nIT IS CRITICAL THAT YOU FOLLOW THESE STEPS - while staying in character as the current agent persona you may have loaded:\n\n<steps CRITICAL=\"TRUE\">\n1. Always LOAD the FULL _bmad/core/tasks/workflow.xml\n2. READ its entire contents - this is the CORE OS for EXECUTING the specific workflow-config _bmad/bmm/workflows/4-implementation/sprint-planning/workflow.yaml\n3. Pass the yaml path _bmad/bmm/workflows/4-implementation/sprint-planning/workflow.yaml as 'workflow-config' parameter to the workflow.xml instructions\n4. Follow workflow.xml instructions EXACTLY as written to process and follow the specific workflow config and its instructions\n5. Save outputs after EACH section when generating any documents from templates\n</steps>",
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "5c6f2b07-7d39-477e-9a15-055b09570d1d",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "I'll execute the sprint-planning workflow by first loading and reading the core workflow.xml file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_858dffedf58c481da3a2f02e",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/core/tasks/workflow.xml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "95336b76-dddc-45e6-8223-947fcc5439bf",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_858dffedf58c481da3a2f02e",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/core/tasks/workflow.xml"}}
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "66768efb-3e0f-4abe-9236-a04446a26735",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to read the sprint-planning workflow configuration file."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_0150077582404a738a8474eb",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/sprint-planning/workflow.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "9b23bc7a-6861-4889-8e3a-acbee8cb7595",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_0150077582404a738a8474eb",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/sprint-planning/workflow.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "c9bc4884-1a84-46b6-81ed-8f51cea9894f",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Good, I have loaded the workflow.xml and the workflow.yaml for sprint-planning. Now let me proceed according to the workflow.xml instructions:\n\nStep 1: Load and Initialize Workflow\n1a: Load Configuration and Resolve Variables\n- Need to load config from {project-root}/_bmad/bmm/config.yaml\n- Resolve all {config_source}: references\n- Resolve system variables and paths\n- Ask user for any unknown variables\n\nLet me first load the config.yaml file:"
      },
      {
        "type": "tool-call",
        "toolCallId": "call_85970354dc7946b2b2458067",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/config.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "67e04834-6077-46c2-aef8-db3b9202d5d4",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_85970354dc7946b2b2458067",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/config.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "36521712-e47f-4b72-8147-b73cbd91f337",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I need to load the instructions file and the template file to understand what the workflow requires me to do."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_1d1b1301020f41b4bdb56a63",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/sprint-planning/instructions.md",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "0ba4572e-ad7a-4531-a5da-193b977cb520",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_1d1b1301020f41b4bdb56a63",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/sprint-planning/instructions.md"}}
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "6898960f-8cfc-435b-a6bf-c6c64926b1ea",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now let me read the template file to understand the structure I need to create."
      },
      {
        "type": "tool-call",
        "toolCallId": "call_d364c25eafd046bea01378e5",
        "toolName": "power---file_read",
        "input": {
          "filePath": "_bmad/bmm/workflows/4-implementation/sprint-planning/sprint-status-template.yaml",
          "withLines": false,
          "lineOffset": 0,
          "lineLimit": 1000
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "09cbb098-96a5-447b-b1b0-27cadb38f5d9",
    "role": "tool",
    "content": [
      {
        "type": "tool-result",
        "toolCallId": "call_d364c25eafd046bea01378e5",
        "toolName": "power---file_read",
        "output": {
          "type": "text",
          "value": {{fileContent "_bmad/bmm/workflows/4-implementation/sprint-planning/sprint-status-template.yaml"}}
        }
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4"
      }
    }
  },
  {
    "id": "dbc09378-d534-473b-9e1e-df992b539dcb",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "Now I'll execute Step 0.5: Discover and load project documents using the discover_inputs protocol.\n\n**Step 0.5: Document Discovery - Loading Epic Files**\n\nI'll search for epic files in the implementation artifacts directory."
      }
    ],
    "promptContext": {
      "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
      "group": {
        "id": "01cd2110-d039-4854-9b50-49220ddac2d4",
        "name": "Sprint Planning",
        "color": "#ef4444",
        "finished": true
      }
    }
  }
]

================
File: src/main/bmad/bmad-manager.ts
================
import { exec } from 'child_process';
import { promisify } from 'util';
⋮----
import { v4 as uuidv4 } from 'uuid';
import { BMAD_WORKFLOWS } from '@common/bmad-workflows';
import { StoryStatus } from '@common/bmad-types';
import { glob } from 'glob';
⋮----
import { ContextPreparer } from './context-preparer';
⋮----
import type {
  BmadError,
  BmadStatus,
  InstallResult,
  WorkflowExecutionResult,
  IncompleteWorkflowMetadata,
  SprintStatusData,
  WorkflowArtifacts,
} from '@common/bmad-types';
import type { Task } from '@/task';
import type { ContextFile } from '@common/types';
⋮----
import logger from '@/logger';
⋮----
export class BmadManager
⋮----
constructor(private readonly projectDir: string)
⋮----
checkInstallation(): boolean
⋮----
getVersion(): string | undefined
⋮----
/**
   * Parses a step identifier to extract the step number.
   * Handles formats:
   * - Pure numbers: '1', '5', '12'
   * - Prefixed step IDs: 'step-01-document-discovery', 'step-5-analysis'
   * - Falls back to index + 1 for unrecognized formats
   *
   * @param stepId - The step identifier string
   * @param index - The index of the step in the array (used as fallback)
   * @returns The extracted step number
   */
⋮----
// Try pure number first
⋮----
// Try to extract number from patterns like 'step-01-...' or 'step-1-...'
⋮----
// Fallback to index + 1
⋮----
/**
   * Parses sprint-status.yaml and extracts story statuses (excluding epics and retrospectives)
   * Also determines which workflows are completed based on story statuses:
   * - 'dev-story' and 'code-review' are completed if all stories are 'done' (non-empty)
   * - 'create-story' is completed if there are no 'backlog' stories
   * @param projectRoot - Absolute path to the project root directory
   * @returns SprintStatusData with array of story statuses and completed workflows, or undefined if file doesn't exist
   */
private async parseSprintStatus(projectRoot: string): Promise<SprintStatusData | undefined>
⋮----
/**
   * Scans for completed workflow artifacts in the project
   * Uses a hybrid two-tier detection strategy:
   * - Tier 1: Fast file existence check using glob patterns
   * - Tier 2: Detailed state parsing via YAML frontmatter for resume capability
   * @param projectRoot - Absolute path to the project root directory
   * @returns Workflow artifacts with completed workflows and artifact details
   */
private async scanWorkflows(projectRoot: string): Promise<WorkflowArtifacts>
⋮----
// Check if _bmad-output directory exists
⋮----
// Directory doesn't exist or permission denied - return greenfield state
⋮----
// Scan for artifacts using glob patterns from workflow registry
⋮----
// Track workflows with non-completing status for quick-dev (same artifact pattern as quick-spec)
⋮----
// Resolve glob pattern relative to project root
⋮----
// Use glob to find matching files
⋮----
// Try to parse YAML frontmatter for stepsCompleted and status
⋮----
// File read or YAML parse error - track corruption
⋮----
// Artifact is still detected (file existence), just no detailed state
⋮----
// Store artifact details
⋮----
// Track quick-dev workflows with non-completing status
⋮----
// Determine completion status using workflow.totalSteps from registry
⋮----
// Workflow is complete if:
// 1. No stepsCompleted in frontmatter (legacy/simple artifact) - assume complete
// 2. stepsCompleted exists and max step >= totalSteps from registry
// 3. For quick-spec workflow: status is 'ready-for-dev'
// 4. For quick-dev workflow: status (lowercase) contains 'complete' or 'done'
⋮----
// quick-dev uses status field only for completion, ignores stepsCompleted
⋮----
// quick-dev is not in progress if quick-spec is ready-for-dev
⋮----
// Workflow is in progress
⋮----
// Also add to incompleteWorkflows for resume functionality
⋮----
// Failed to get file stats - still mark as in progress but skip incompleteWorkflows entry
⋮----
// Glob error - continue scanning other workflows
⋮----
// Remove workflows with non-completing status from completedWorkflows
// This ensures quick-dev with status like 'ready-for-dev' is not marked as completed
⋮----
async getBmadStatus(): Promise<BmadStatus>
⋮----
// Scan for workflow artifacts
⋮----
async install(): Promise<InstallResult>
⋮----
// Check for legacy BMAD v4 folder (.bmad-method)
⋮----
// Get safe username for config
⋮----
// Determine if this is a reinstall/update
⋮----
// Build npx command with non-interactive flags
⋮----
'-y', // Auto-confirm npx
⋮----
// Add action flag if updating
⋮----
commandParts.push('--yes'); // Accept all defaults and skip prompts
⋮----
// Execute the npx command
⋮----
// Verify installation
⋮----
private getRecoveryAction(error: unknown): string
⋮----
/**
   * Execute a BMAD workflow via Agent Mode
   * @param workflowId - ID of the workflow to execute
   * @param task - Task instance for Agent Mode execution
   * @returns Workflow execution result with success status
   */
/**
   * Reset BMAD workflow state by clearing the _bmad-output directory
   * @returns Promise resolving to success status
   */
async resetWorkflow(): Promise<
⋮----
// Check if directory exists
⋮----
// Remove the directory recursively
⋮----
async executeWorkflow(workflowId: string, task: Task): Promise<WorkflowExecutionResult>
⋮----
// 1. Get current BMAD status
⋮----
// 2. Prepare context using ContextPreparer
⋮----
// 3. Execute workflow via Agent Mode
⋮----
// Store prepared context messages in task context and send to UI
⋮----
// Store workflow ID in task metadata
⋮----
null, // No user prompt - workflow is system-driven
⋮----
// 4. Return success
⋮----
// Determine error code based on error type

================
File: src/main/bmad/context-preparer.ts
================
import path from 'path';
⋮----
import Handlebars from 'handlebars';
import { v4 as uuidv4 } from 'uuid';
import { glob } from 'glob';
import { ContextMessage, ContextUserMessage } from '@common/types';
import { fileExists } from '@common/utils';
⋮----
import type { BmadStatus } from '@common/bmad-types';
⋮----
import logger from '@/logger';
import { execWithShellPath } from '@/utils';
⋮----
export interface PreparedContext {
  contextMessages: ContextMessage[];
  contextFiles: string[];
  execute: boolean;
}
⋮----
/**
 * ContextPreparer prepares context for workflow execution based on current BMAD status
 */
export class ContextPreparer
⋮----
constructor(private readonly projectDir: string)
⋮----
/**
   * Prepare context for workflow execution
   * @param workflowId - ID of the workflow to prepare context for
   * @param status - Current BMAD status with workflow and artifact information
   * @returns Prepared context with messages and file paths
   */
async prepare(workflowId: string, status: BmadStatus): Promise<PreparedContext>
⋮----
// Inject context messages based on workflow ID
⋮----
private async injectContextMessages(workflowId: string, context: PreparedContext, status: BmadStatus)
⋮----
private async injectTemplate(workflowId: string, context: PreparedContext): Promise<boolean>
⋮----
// Special case: research workflow doesn't auto-execute
⋮----
private async injectQuickDevContext(context: PreparedContext, status: BmadStatus): Promise<void>
⋮----
// 1. Get git baseline
⋮----
// 2. Find project-context.md
⋮----
// 3. Check for ready-for-dev tech-spec from quick-spec workflow
⋮----
// 4. Build user message content
⋮----
// Git baseline info
⋮----
// Project context info
⋮----
// Mode determination
⋮----
// Mode A: Tech-spec provided
⋮----
// Mode B: No tech-spec, ask user for instructions
⋮----
// Create and add user message
⋮----
private async injectQuickSpecContext(context: PreparedContext, status: BmadStatus): Promise<void>

================
File: src/main/connector/connector-manager.ts
================
import { Server as HttpServer } from 'http';
⋮----
import { ModelsData, QuestionData, TokensInfoData } from '@common/types';
import { Server, Socket } from 'socket.io';
⋮----
import logger from '@/logger';
import {
  isAddFileMessage,
  isAskQuestionMessage,
  isDropFileMessage,
  isInitMessage,
  isPromptFinishedMessage,
  isResponseMessage,
  isSetModelsMessage,
  isTokensInfoMessage,
  isUpdateAutocompletionMessage,
  isUpdateContextFilesMessage,
  isUpdateRepoMapMessage,
  isUseCommandOutputMessage,
  LogMessage,
  Message,
  isAddMessageMessage,
  isSubscribeEventsMessage,
  isUnsubscribeEventsMessage,
} from '@/messages';
import { Connector } from '@/connector/connector';
import { ProjectManager } from '@/project';
import { EventManager } from '@/events';
⋮----
export class ConnectorManager
⋮----
constructor(
    httpServer: HttpServer,
    private readonly projectManager: ProjectManager,
    private readonly eventManager: EventManager,
)
⋮----
public init(httpServer: HttpServer): void
⋮----
// Create Socket.IO server
⋮----
pingTimeout: 600_000, // 10 minutes
maxHttpBufferSize: 1e8, // Increase payload size to 100 MB
⋮----
public async close()
⋮----
// Handle the case where taskId is not available, e.g., log an error or apply to all tasks

================
File: src/main/connector/connector.ts
================
import path from 'path';
⋮----
import { AiderRunOptions, ContextFile, EditFormat, FileEdit, MessageRole, Mode, ModelInfo, PromptContext } from '@common/types';
import { Socket } from 'socket.io';
⋮----
import logger from '@/logger';
import {
  AddFileMessage,
  AddMessageMessage,
  AnswerQuestionMessage,
  ApplyEditsMessage,
  CompactConversationMessage,
  DropFileMessage,
  InterruptResponseMessage,
  Message,
  MessageAction,
  PromptMessage,
  RequestContextInfoMessage,
  RunCommandMessage,
  SetModelsMessage,
  UpdateEnvVarsMessage,
  UpdateModelsInfoMessage,
} from '@/messages';
⋮----
export class Connector
⋮----
constructor(
⋮----
public sendPromptMessage(
    prompt: string,
    promptContext: PromptContext,
    mode: Mode | null = null,
    architectModel: string | null = null,
    messages: { role: MessageRole; content: string }[] = [],
    files: ContextFile[] = [],
    options?: AiderRunOptions,
): void
⋮----
public sendSetModelsMessage(mainModel: string, weakModel: string | null, editFormat: EditFormat, environmentVariables?: Record<string, string>): void
⋮----
public sendRunCommandMessage(command: string, messages:
⋮----
public sendAddMessageMessage(role: MessageRole = MessageRole.User, content: string, acknowledge = true)
⋮----
public sendInterruptResponseMessage()
⋮----
public sendApplyEditsMessage(edits: FileEdit[])
⋮----
public sendCompactConversationMessage(customInstructions?: string)
⋮----
public sendUpdateEnvVarsMessage(environmentVariables: Record<string, unknown>)
⋮----
public sendRequestTokensInfoMessage(messages:
⋮----
public sendUpdateModelsInfoMessage(modelsInfo: Record<string, ModelInfo>)

================
File: src/main/connector/index.ts
================


================
File: src/main/custom-commands/custom-command-manager.ts
================
import fs from 'fs/promises';
import path from 'path';
import { homedir } from 'os';
import { exec } from 'child_process';
import { promisify } from 'util';
⋮----
import { watch, FSWatcher } from 'chokidar';
import { loadFront } from 'yaml-front-matter';
import debounce from 'lodash/debounce';
⋮----
import type { CustomCommand } from '@common/types';
⋮----
import { AIDER_DESK_COMMANDS_DIR } from '@/constants';
import logger from '@/logger';
import { Project } from '@/project/project';
⋮----
// Constants for shell command formatting
⋮----
const SHELL_COMMAND_TIMEOUT = 30000; // 30 seconds
⋮----
export class ShellCommandError extends Error
⋮----
constructor(
    message: string,
    public readonly command: string,
    public readonly stderr: string,
    public readonly exitCode?: number,
)
⋮----
interface ExecError extends Error {
  stdout?: string;
  stderr?: string;
  code?: number;
}
⋮----
export class CustomCommandManager
⋮----
constructor(private readonly project: Project)
⋮----
public async start(): Promise<void>
⋮----
private async initializeCommands(): Promise<void>
⋮----
// Load project-specific commands (these will overwrite global ones with same name)
⋮----
private async setupFileWatchers(): Promise<void>
⋮----
// Clean up existing watchers
⋮----
// Watch global commands directory
⋮----
// Watch project-specific commands directory
⋮----
private async setupWatcherForDirectory(commandsDir: string): Promise<void>
⋮----
// Create directory if it doesn't exist
⋮----
private async reloadCommands(): Promise<void>
⋮----
private notifyCommandsUpdated(): void
⋮----
private async loadCommandsFromDir(commandsDir: string, commands: Map<string, CustomCommand>): Promise<void>
⋮----
private async loadCommandsRecursively(dir: string, commands: Map<string, CustomCommand>, baseDir: string, prefix = ''): Promise<void>
⋮----
private async loadCommandFile(filePath: string, name: string, commands: Map<string, CustomCommand>): Promise<void>
⋮----
// Optionally: send error to chat window via IPC or callback
⋮----
getCommand(name: string): CustomCommand | undefined
⋮----
getAllCommands(): CustomCommand[]
⋮----
async processCommandTemplate(command: CustomCommand, args: string[]): Promise<string>
⋮----
private substituteArguments(template: string, args: string[], commandArgs: CustomCommand['arguments']): string
⋮----
// First, substitute {{ARGUMENTS}} placeholder with all arguments joined by spaces
⋮----
// Then, substitute provided arguments
⋮----
// Handle any remaining placeholders that weren't substituted
⋮----
// Replace unreplaced placeholders with empty strings for optional arguments
⋮----
private findUnreplacedPlaceholders(template: string, argsLength: number): number[]
⋮----
private async executeShellCommands(prompt: string): Promise<string>
⋮----
private async processShellCommandLine(line: string): Promise<string | string[]>
⋮----
// Handle edge case: line with just '!' or '! ' (space after)
⋮----
maxBuffer: 10 * 1024 * 1024, // 10 MB
⋮----
private extractErrorDetails(error: unknown):
⋮----
private isExecError(error: unknown): error is ExecError
⋮----
private formatShellOutput(command: string, output: string): string[]
⋮----
dispose(): void

================
File: src/main/custom-commands/index.ts
================


================
File: src/main/data-manager/data-manager.ts
================
import { UsageReportData, UsageDataRow } from '@common/types';
import Database from 'better-sqlite3';
⋮----
import logger from '@/logger';
import { DB_FILE_PATH } from '@/constants';
⋮----
/**
 * Manages the application's database connection and structure.
 * This class is responsible for initializing the database, creating necessary tables,
 * and providing a method to close the connection.
 */
export class DataManager
⋮----
/**
   * Constructs a new DataManager instance, opening a database connection
   * and ensuring the necessary 'messages' table exists.
   */
constructor()
⋮----
// Initialize the database connection.
// The verbose option logs all SQL statements to the console, which is useful for debugging.
⋮----
public init()
⋮----
// SQL statement to create the 'messages' table if it doesn't already exist.
// This table stores information about messages, including their content, token usage, and cost.
⋮----
// Execute the SQL statement to ensure the table is ready for use.
⋮----
/**
   * Saves a message to the database.
   * @param id The unique identifier for the message.
   * @param type The type of the message ('tool' or 'assistant').
   * @param project The project's base directory.
   * @param model The model used for the message.
   * @param usageReport The usage report data.
   * @param content The content of the message.
   */
public saveMessage(id: string, type: 'tool' | 'assistant', project: string, model: string, usageReport: UsageReportData | undefined, content: unknown): void
⋮----
/**
   * Closes the database connection.
   * It's important to call this method when the application is shutting down
   * to ensure that all data is saved correctly and resources are released.
   */
public close(): void
⋮----
public queryUsageData(from: Date, to: Date): UsageDataRow[]

================
File: src/main/data-manager/index.ts
================


================
File: src/main/events/event-manager.ts
================
import { Socket } from 'socket.io';
import {
  ContextFile,
  CustomCommand,
  InputHistoryData,
  ProviderProfile,
  LogData,
  ModelsData,
  NotificationData,
  QuestionData,
  QuestionAnsweredData,
  ResponseChunkData,
  ResponseCompletedData,
  TerminalData,
  TerminalExitData,
  ToolData,
  TokensInfoData,
  UserMessageData,
  MessageRemovedData,
  VersionsInfo,
  AutocompletionData,
  ProviderModelsData,
  ProvidersUpdatedData,
  SettingsData,
  TaskData,
  ClearTaskData,
  ProjectSettings,
  AgentProfile,
  AgentProfilesUpdatedData,
  WorktreeIntegrationStatus,
  WorktreeIntegrationStatusUpdatedData,
  TaskCreatedData,
  UpdatedFile,
  UpdatedFilesUpdatedData,
} from '@common/types';
⋮----
import type { BmadStatus } from '@common/bmad-types';
import type { BrowserWindow } from 'electron';
⋮----
import logger from '@/logger';
⋮----
export interface EventsConnectorConfig {
  eventTypes?: string[];
  baseDirs?: string[];
}
⋮----
export interface EventsConnector extends EventsConnectorConfig {
  socket: Socket;
}
⋮----
export class EventManager
⋮----
constructor(private readonly mainWindow: BrowserWindow | null)
⋮----
// Project lifecycle events
sendProjectStarted(baseDir: string): void
⋮----
sendClearTask(baseDir: string, taskId: string, clearMessages: boolean, clearFiles: boolean): void
⋮----
// File management events
sendFileAdded(baseDir: string, taskId: string, file: ContextFile): void
⋮----
sendContextFilesUpdated(baseDir: string, taskId: string, files: ContextFile[]): void
⋮----
sendUpdatedFilesUpdated(baseDir: string, taskId: string, files: UpdatedFile[]): void
⋮----
// Response events
sendResponseChunk(data: ResponseChunkData): void
⋮----
sendResponseCompleted(data: ResponseCompletedData): void
⋮----
// Question events
sendAskQuestion(questionData: QuestionData): void
⋮----
sendQuestionAnswered(baseDir: string, taskId: string, question: QuestionData, answer: string, userInput?: string): void
⋮----
// Autocompletion events
sendUpdateAutocompletion(baseDir: string, taskId: string, words?: string[], allFiles?: string[]): void
⋮----
// Aider models events
sendUpdateAiderModels(_baseDir: string, _taskId: string, modelsData: ModelsData): void
⋮----
// Command events
sendCommandOutput(baseDir: string, taskId: string, command: string, output: string): void
⋮----
// Log events
sendLog(data: LogData): void
⋮----
// Tool events
sendTool(data: ToolData): void
⋮----
// User message events
sendUserMessage(data: UserMessageData): void
⋮----
// Tokens info events
sendUpdateTokensInfo(tokensInfo: TokensInfoData): void
⋮----
// Input history events
sendInputHistoryUpdated(baseDir: string, taskId: string, inputHistory: string[]): void
⋮----
// Custom commands events
sendCustomCommandsUpdated(baseDir: string, taskId: string, commands: CustomCommand[]): void
⋮----
sendCustomCommandError(baseDir: string, taskId: string, error: string): void
⋮----
sendWorktreeIntegrationStatusUpdated(baseDir: string, taskId: string, status: WorktreeIntegrationStatus | null): void
⋮----
// Terminal events
sendTerminalData(data: TerminalData): void
⋮----
sendTerminalExit(data: TerminalExitData): void
⋮----
// Versions events
sendVersionsInfoUpdated(versionsInfo: VersionsInfo): void
⋮----
sendSettingsUpdated(settings: SettingsData): void
⋮----
// Provider events
sendProvidersUpdated(providers: ProviderProfile[]): void
⋮----
sendProviderModelsUpdated(data: ProviderModelsData): void
⋮----
sendProjectSettingsUpdated(baseDir: string, settings: ProjectSettings): void
⋮----
// Agent profile events
sendAgentProfilesUpdated(profiles: AgentProfile[]): void
⋮----
// Task lifecycle events
sendTaskCreated(task: TaskData, activate?: boolean): void
⋮----
sendTaskInitialized(task: TaskData): void
⋮----
sendTaskUpdated(task: TaskData): void
⋮----
sendTaskStarted(task: TaskData): void
⋮----
sendTaskCompleted(task: TaskData): void
⋮----
sendTaskCancelled(task: TaskData): void
⋮----
sendTaskDeleted(task: TaskData): void
⋮----
sendTaskMessageRemoved(baseDir: string, taskId: string, messageIds: string[]): void
⋮----
sendNotification(baseDir: string, title: string, body: string): void
⋮----
subscribe(socket: Socket, config: EventsConnectorConfig): void
⋮----
unsubscribe(socket: Socket): void
⋮----
private sendToMainWindow(eventType: string, data: unknown): void
⋮----
private broadcastToEventConnectors(eventType: string, data: unknown): void
⋮----
// Filter by event types if specified
⋮----
// Filter by base directories if specified
⋮----
// Remove disconnected sockets
⋮----
// BMAD events
sendBmadStatusChanged(status: BmadStatus): void

================
File: src/main/events/index.ts
================


================
File: src/main/hooks/hook-context.ts
================
import { MessageRole, TaskData } from '@common/types';
⋮----
import { Task } from '@/task/task';
import { Project } from '@/project/project';
⋮----
export interface HookContext {
  addInfoMessage: (message: string) => void;
  addWarningMessage: (message: string) => void;
  addErrorMessage: (message: string) => void;
  addLoadingMessage: (message: string) => void;
  setTaskName: (name: string) => Promise<void>;
  addContextMessage: (role: 'user' | 'assistant', content: string) => Promise<void>;
  task: Task;
  project: Project;
  taskData: TaskData;
  projectDir: string;
}
⋮----
export class HookContextImpl implements HookContext
⋮----
constructor(
⋮----
addInfoMessage(message: string)
⋮----
addWarningMessage(message: string)
⋮----
addErrorMessage(message: string)
⋮----
addLoadingMessage(message: string)
⋮----
async setTaskName(name: string)
⋮----
async addContextMessage(role: 'user' | 'assistant', content: string)
⋮----
get taskData()
⋮----
get projectDir()

================
File: src/main/hooks/hook-manager.ts
================
import fs from 'fs/promises';
import path from 'path';
⋮----
import { FSWatcher, watch } from 'chokidar';
import debounce from 'lodash/debounce';
import { Mode, ResponseCompletedData, ContextFile, TaskData, QuestionData } from '@common/types';
⋮----
import { HookContext, HookContextImpl } from './hook-context';
⋮----
import { Task } from '@/task/task';
import { Project } from '@/project/project';
import { AIDER_DESK_HOOKS_DIR, AIDER_DESK_GLOBAL_HOOKS_DIR } from '@/constants';
import logger from '@/logger';
import { ResponseMessage } from '@/messages';
⋮----
export interface HookEventMap {
  onTaskCreated: { task: TaskData };
  onTaskInitialized: { task: TaskData };
  onTaskClosed: { task: TaskData };
  onPromptSubmitted: { prompt: string; mode: Mode };
  onPromptStarted: { prompt: string | null; mode: Mode };
  onPromptFinished: { responses: ResponseCompletedData[] };
  onAgentStarted: { prompt: string | null };
  onAgentFinished: { resultMessages: unknown[] };
  onAgentStepFinished: { stepResult: unknown };
  onToolCalled: { toolName: string; args: Record<string, unknown> | undefined };
  onToolFinished: { toolName: string; args: Record<string, unknown> | undefined; result: unknown };
  onFileAdded: { file: ContextFile };
  onFileDropped: { filePath: string };
  onCommandExecuted: { command: string };
  onAiderPromptStarted: { prompt: string; mode: Mode };
  onAiderPromptFinished: { responses: ResponseCompletedData[] };
  onQuestionAsked: { question: QuestionData };
  onQuestionAnswered: { question: QuestionData; answer: string; userInput?: string };
  onHandleApproval: { key: string; text: string; subject?: string };
  onSubagentStarted: { subagentId: string; prompt: string };
  onSubagentFinished: { subagentId: string; resultMessages: unknown[] };
  onResponseMessageProcessed: { message: ResponseMessage };
}
⋮----
export type HookFunctions = {
  [K in keyof HookEventMap]?: (event: HookEventMap[K], context: HookContext) => Promise<unknown> | unknown;
};
⋮----
export class HookManager
⋮----
constructor()
⋮----
public async init()
⋮----
private async setupGlobalWatcher()
⋮----
public async reloadProjectHooks(projectDir: string)
⋮----
public async stopWatchingProject(projectDir: string)
⋮----
private async setupWatcherForDir(dir: string, onChange: () => Promise<void>): Promise<FSWatcher | null>
⋮----
private async loadHooksFromDir(dir: string): Promise<HookFunctions[]>
⋮----
// Clear cache to allow reloading
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
public async trigger<K extends keyof HookEventMap>(
    hookName: K,
    event: HookEventMap[K],
    task: Task,
    project: Project,
): Promise<
⋮----
public async dispose()

================
File: src/main/memory/memory-manager.ts
================
import { MemoryConfig, MemoryEmbeddingProgress, MemoryEmbeddingProgressPhase, MemoryEntry, MemoryEntryType, SettingsData } from '@common/types';
import { v4 as uuidv4 } from 'uuid';
⋮----
import type { FeatureExtractionPipeline } from '@huggingface/transformers';
⋮----
import { AIDER_DESK_CACHE_DIR, AIDER_DESK_MEMORY_FILE } from '@/constants';
import logger from '@/logger';
import { Store } from '@/store';
⋮----
type LanceDbModule = typeof import('@lancedb/lancedb');
type TransformersModule = typeof import('@huggingface/transformers');
⋮----
export class MemoryManager
⋮----
constructor(private readonly store: Store)
⋮----
/**
   * Initialize the database connection and the local embedding model.
   * This must be called before using other methods.
   */
public async init(config: MemoryConfig = this.store.getSettings().memory): Promise<void>
⋮----
// 1. Initialize the Database
// Ensure directory exists
⋮----
// Check if table exists, if not, we create it lazily on the first add
⋮----
// 2. Initialize Local Embedding Model (Singleton pattern for the pipeline)
⋮----
// @ts-expect-error progress is not typed properly
⋮----
getProgress(): MemoryEmbeddingProgress
⋮----
private async waitForInit(): Promise<boolean>
⋮----
async settingsChanged(oldSettings: SettingsData, newSettings: SettingsData): Promise<void>
⋮----
// init with old settings before migration
⋮----
const migrate = async () =>
⋮----
// @ts-expect-error progress is not typed properly
⋮----
/**
   * Generates a vector embedding for the given text using the local model.
   */
private async getEmbedding(text: string): Promise<number[]>
⋮----
// Generate embedding
// pooling: 'mean' averages the token vectors to get a single sentence vector
// normalize: true ensures the vector is unit length for cosine similarity
⋮----
// Convert Float32Array to standard number array for LanceDB
⋮----
/**
   * Creates and stores a new memory for a specific project.
   */
async storeMemory(projectId: string, taskId: string, type: MemoryEntryType, content: string)
⋮----
// Create the table if it doesn't exist yet
⋮----
// Add to existing table
⋮----
/**
   * Retrieves memories for a specific project relevant to the user's query.
   * @param projectId - The project to filter by
   * @param query - The user's search query
   * @param limit - Max number of memories to return (default 5)
   */
async retrieveMemories(projectId: string, query: string, limit: number = 5): Promise<MemoryEntry[]>
⋮----
return []; // No memories exist yet
⋮----
// Perform Vector Search + SQL Filtering with distance information
⋮----
.nearestTo(queryVector) // Vector similarity search
.where(`projectid = '${projectId}'`) // SQL-like filtering for the project
⋮----
// Map results back to MemoryEntry interface
// Note: LanceDB returns rows, we cast them to our interface
⋮----
async getMemory(id: string): Promise<MemoryEntry | null>
⋮----
async deleteMemory(id: string): Promise<boolean>
⋮----
async updateMemory(id: string, content: string): Promise<boolean>
⋮----
// Check if memory exists
⋮----
async getAllMemories(): Promise<MemoryEntry[]>
⋮----
// Map results back to MemoryEntry interface
// Note: LanceDB returns rows, we cast them to our interface
⋮----
async deleteMemoriesForProject(projectId: string): Promise<number>
⋮----
async clearAllMemories(): Promise<boolean>
⋮----
isMemoryEnabled(): boolean

================
File: src/main/models/providers/anthropic-compatible.ts
================
import { Model, ProviderProfile, SettingsData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isAnthropicCompatibleProvider, AnthropicCompatibleProvider } from '@common/agent';
import { createAnthropic } from '@ai-sdk/anthropic';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { getAnthropicCacheControl, getAnthropicUsageReport } from '@/models/providers/anthropic';
⋮----
const loadAnthropicCompatibleModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
const hasAnthropicCompatibleEnvVars = (settings: SettingsData): boolean =>
⋮----
const getAnthropicCompatibleAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
// Use anthropic prefix for Anthropic-compatible providers
⋮----
// === LLM Creation Functions ===
const createAnthropicCompatibleLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// Use createAnthropic with custom baseURL to get a provider instance, then get the model
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Cache control

================
File: src/main/models/providers/anthropic.ts
================
import { createAnthropic } from '@ai-sdk/anthropic';
import { AnthropicProvider, isAnthropicProvider } from '@common/agent';
import { Model, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import logger from '@/logger';
import { AiderModelMapping, CacheControl, LlmProviderStrategy } from '@/models';
import { LoadModelsResponse } from '@/models/types';
import { Task } from '@/task/task';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { getDefaultModelInfo } from '@/models/providers/default';
⋮----
export const loadAnthropicModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasAnthropicEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getAnthropicAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createAnthropicLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
type AnthropicMetadata = {
  anthropic: {
    cacheCreationInputTokens?: number;
    cacheReadInputTokens?: number;
  };
};
⋮----
// === Cost and Usage Functions ===
export const calculateAnthropicCost = (
  model: Model,
  sentTokens: number,
  receivedTokens: number,
  cacheWriteTokens: number = 0,
  cacheReadTokens: number = 0,
): number =>
⋮----
export const getAnthropicUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
// Extract cache tokens from provider metadata
⋮----
// Calculate cost internally with already deducted sentTokens
⋮----
// === Configuration Helper Functions ===
export const getAnthropicCacheControl = (): CacheControl | undefined =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Configuration helpers

================
File: src/main/models/providers/azure.ts
================
import { createAzure } from '@ai-sdk/azure';
import { Model, ProviderProfile, ReasoningEffort, SettingsData, UsageReportData } from '@common/types';
import { AzureProvider, isAzureProvider, LlmProvider } from '@common/agent';
import { type OpenAIResponsesProviderOptions } from '@ai-sdk/openai';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2, SharedV2ProviderOptions } from '@ai-sdk/provider';
⋮----
import logger from '@/logger';
import { AiderModelMapping, LlmProviderStrategy } from '@/models';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { Task } from '@/task/task';
import { calculateCost, getDefaultModelInfo } from '@/models/providers/default';
⋮----
const extractResourceNameFromEndpoint = (endpoint: string): string =>
⋮----
// Extract resource name from hostname like "resource-name.openai.azure.com"
⋮----
export const hasAzureEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getAzureAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createAzureLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
type AzureMetadata = {
  openai: {
    cachedPromptTokens?: number;
  };
};
⋮----
// === Cost and Usage Functions ===
export const getAzureUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
// Extract cache read tokens from provider metadata
⋮----
// Calculate sentTokens after deducting cached tokens
⋮----
// Calculate cost internally with already deducted sentTokens
⋮----
export const getAzureProviderOptions = (llmProvider: LlmProvider, model: Model): SharedV2ProviderOptions | undefined =>
⋮----
// Extract reasoningEffort from model overrides or provider config
⋮----
// Map ReasoningEffort enum to AI SDK format
⋮----
export const getAzureProviderParameters = (llmProvider: LlmProvider, model: Model): Record<string, unknown> =>
⋮----
// Extract reasoningEffort from model overrides or provider config
⋮----
// not supported by Azure with reasoning models
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/bedrock.ts
================
import { BedrockClient, GetFoundationModelAvailabilityCommand, type InferenceProfileSummary, ListInferenceProfilesCommand } from '@aws-sdk/client-bedrock';
import { fromNodeProviderChain } from '@aws-sdk/credential-providers';
import { Model, ModelInfo, ProviderProfile, SettingsData } from '@common/types';
import { BedrockProvider, DEFAULT_MODEL_TEMPERATURE, isBedrockProvider } from '@common/agent';
import { createAmazonBedrock } from '@ai-sdk/amazon-bedrock';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { LoadModelsResponse } from '@/models/types';
import { getDefaultUsageReport } from '@/models/providers/default';
⋮----
export const loadBedrockModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
// Check if we have explicit keys or if AWS_PROFILE is set in the main process env
⋮----
nextToken = response.nextToken; // Will be undefined if no more pages
⋮----
// Collect active profiles
⋮----
// Now, prepare availability checks in parallel
⋮----
// Extract modelId from the first model's modelArn
⋮----
// Check if the model is authorized and available
⋮----
export const hasBedrockEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getBedrockAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createBedrockLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
const getBedrockModelInfo = (_provider: ProviderProfile, modelId: string, allModelInfos: Record<string, ModelInfo>): ModelInfo | undefined =>
⋮----
// check by model part of the model name (e.g. excluding any prefix before the first dot)
// Remove prefix before first dot if present (e.g., "us.anthropic.claude-3-sonnet-20240229-v1:0" -> "anthropic.claude-3-sonnet-20240229-v1:0")
⋮----
// Check if key ends with the modelId without prefix
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/cerebras.ts
================
import { Model, ProviderProfile, SettingsData } from '@common/types';
import { CerebrasProvider, DEFAULT_MODEL_TEMPERATURE, isCerebrasProvider } from '@common/agent';
import { createCerebras } from '@ai-sdk/cerebras';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils/environment';
import { LoadModelsResponse } from '@/models/types';
import { getDefaultModelInfo, getDefaultUsageReport } from '@/models/providers/default';
⋮----
interface CerebrasModel {
  id: string;
  max_context_length?: number;
  description?: string;
}
⋮----
export const loadCerebrasModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasCerebrasEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getCerebrasAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createCerebrasLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/claude-agent-sdk.ts
================
import { claudeCode } from 'ai-sdk-provider-claude-code';
import { type JSONSchema, JSONSchemaToZod } from '@dmitryrechkin/json-schema-to-zod';
import { isClaudeAgentSdkProvider } from '@common/agent';
import { Model, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
import { AIDER_TOOL_GROUP_NAME, AIDER_TOOL_RUN_PROMPT, SUBAGENTS_TOOL_GROUP_NAME, SUBAGENTS_TOOL_RUN_TASK, TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
⋮----
import type { ClaudeCodeSettings } from 'ai-sdk-provider-claude-code';
import type { LanguageModelUsage, ToolSet } from 'ai';
import type { LanguageModelV2, JSONSchema7 } from '@ai-sdk/provider';
⋮----
import logger from '@/logger';
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import { Task } from '@/task/task';
import { calculateCost } from '@/models/providers/default';
import { isDev, isElectron } from '@/app';
import { CLAUDE_CODE_EXECUTABLE_PATH } from '@/constants';
import { findExecutableInPath } from '@/utils/shell';
⋮----
interface ClaudeCodeProviderMetadata {
  'claude-code': {
    costUsd?: number;
    rawUsage: {
      cache_creation_input_tokens?: number;
      cache_read_input_tokens?: number;
      input_tokens: number;
      output_tokens: number;
    };
    lastMessageRawUsage?: {
      cache_creation_input_tokens?: number;
      cache_read_input_tokens?: number;
      input_tokens: number;
      output_tokens: number;
    };
    sessionId?: string;
  };
}
⋮----
export const loadClaudeAgentSdkModels = async (profile: ProviderProfile, _settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
const hasClaudeAgentSdkEnvVars = (): boolean =>
⋮----
const getClaudeAgentSdkAiderMapping = (_provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
/**
 * Normalizes the AI SDK ToolSet for Claude Agent SDK by:
 * 1. Converting JSONSchema-based inputSchemas (from MCP tools) to Zod schemas
 * 2. Wrapping specific tools to optimize their output
 *
 * This is necessary because:
 * - Claude Agent SDK provider internally needs ZodRawShape to extract from inputSchema
 * - Tools converted from MCP use jsonSchema() which wraps JSONSchema7, not Zod
 * - Some tools return large amounts of data that need to be optimized
 */
const normalizeAiSdkToolSet = (toolSet: ToolSet): ToolSet =>
⋮----
// First, check if the inputSchema is a jsonSchema wrapper (from MCP tools)
// and convert it to a proper Zod schema
⋮----
// Check if this is a jsonSchema() wrapper by looking for the jsonSchema property
// The AI SDK's jsonSchema() function wraps a JSONSchema7 in a Schema object
⋮----
// Convert JSONSchema7 to Zod schema
// eslint-disable-next-line @typescript-eslint/no-explicit-any
⋮----
// Check if this is the aider run_prompt tool
⋮----
// Run the original execute function
⋮----
// Optimize the result by removing responses and promptContext (same as optimizer.ts)
⋮----
// Check if this is the subagent run_task tool
⋮----
// Run the original execute function
⋮----
// Optimize the result by keeping only the last message (same as optimizer.ts)
⋮----
// If optimization fails, return the original result
⋮----
// For all other tools, use the normalized tool
⋮----
export const createClaudeAgentSdkLlm = (
  _profile: ProviderProfile,
  model: Model,
  _settings: SettingsData,
  _projectDir: string,
  toolSet?: ToolSet,
  systemPrompt?: string,
  providerMetadata?: unknown,
): LanguageModelV2 =>
⋮----
// setting MAX_MCP_OUTPUT_TOKENS to a high number to avoid errors
⋮----
// for now only tools from AiderDesk are allowed
⋮----
const getClaudeAgentSdkUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  _usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
const getClaudeAgentSdkProviderParameters = (): Record<string, unknown> =>

================
File: src/main/models/providers/deepseek.ts
================
import { Model, ProviderProfile, SettingsData } from '@common/types';
import { DeepseekProvider, DEFAULT_MODEL_TEMPERATURE, isDeepseekProvider } from '@common/agent';
import { createDeepSeek } from '@ai-sdk/deepseek';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { getDefaultModelInfo, getDefaultUsageReport } from '@/models/providers/default';
⋮----
export const loadDeepseekModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasDeepseekEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getDeepseekAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createDeepseekLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/default.ts
================
import { Model, ModelInfo, ProviderProfile, UsageReportData } from '@common/types';
⋮----
import type { LanguageModelUsage } from 'ai';
⋮----
import { Task } from '@/task';
import logger from '@/logger';
⋮----
export const getDefaultModelInfo = (provider: ProviderProfile, modelId: string, allModelInfos: Record<string, ModelInfo>): ModelInfo | undefined =>
⋮----
// Try provider.name prefix first
⋮----
// If not found, try provider.id prefix
⋮----
// === Cost and Usage Functions ===
export const calculateCost = (model: Model, sentTokens: number, receivedTokens: number, cacheReadTokens: number = 0): number =>
⋮----
export const getDefaultUsageReport = (task: Task, provider: ProviderProfile, model: Model, usage: LanguageModelUsage): UsageReportData =>

================
File: src/main/models/providers/gemini.ts
================
import { Model, ModelInfo, ProviderProfile, SettingsData, UsageReportData, VoiceSession } from '@common/types';
import { DEFAULT_VOICE_SYSTEM_INSTRUCTIONS, GeminiProvider, GeminiVoiceModel, isGeminiProvider, LlmProvider } from '@common/agent';
import { createGoogleGenerativeAI, google, type GoogleGenerativeAIProviderOptions } from '@ai-sdk/google';
import { Modality } from '@google/genai';
⋮----
import type { LanguageModelUsage, ToolSet } from 'ai';
import type { LanguageModelV2, SharedV2ProviderOptions } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { Task } from '@/task/task';
⋮----
const loadGeminiModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
temperature: 0.7, // Default temperature for Gemini models
⋮----
const hasGeminiEnvVars = (settings: SettingsData): boolean =>
⋮----
const getGeminiAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
const createGeminiLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
type GoogleMetadata = {
  google: {
    cachedInputTokens?: number;
  };
};
⋮----
// === Cost and Usage Functions ===
const calculateGeminiCost = (model: Model, sentTokens: number, receivedTokens: number, cacheReadTokens: number = 0): number =>
⋮----
const getGeminiUsageReport = (task: Task, provider: ProviderProfile, model: Model, usage: LanguageModelUsage, providerMetadata?: unknown): UsageReportData =>
⋮----
// Extract cache read tokens from provider metadata or usage
⋮----
// Calculate sentTokens after deducting cached tokens
⋮----
// Calculate cost internally with already deducted sentTokens
⋮----
const getGeminiProviderOptions = (llmProvider: LlmProvider, model: Model): SharedV2ProviderOptions | undefined =>
⋮----
// Use model-specific overrides, falling back to provider defaults
⋮----
// === Provider Tools Functions ===
const getGeminiProviderTools = (provider: LlmProvider, model: Model): ToolSet =>
⋮----
// Check for model-specific overrides
⋮----
const getGeminiModelInfo = (_provider: ProviderProfile, modelId: string, allModelInfos: Record<string, ModelInfo>): ModelInfo | undefined =>
⋮----
const createGeminiVoiceSession = async (profile: ProviderProfile, settings: SettingsData): Promise<VoiceSession> =>
⋮----
// Default to the model specified in requirements or fallback
⋮----
// Create ephemeral token
// The token is valid for 1 minute for session initiation, and 30 minutes for the session duration by default.
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/gpustack.ts
================
import { Model, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, GpustackProvider, isGpustackProvider } from '@common/agent';
import { createOpenAICompatible } from '@ai-sdk/openai-compatible';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { Task } from '@/task/task';
import { getEffectiveEnvironmentVariable } from '@/utils';
⋮----
interface GpustackModelResponse {
  items: Array<{
    name: string;
    meta?: {
      max_model_len?: number;
    };
  }>;
}
⋮----
const loadGpustackModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
// Extract max_model_len from meta if available
⋮----
const hasGpustackEnvVars = (settings: SettingsData): boolean =>
⋮----
const getGpustackAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
// Use openai prefix for GPUStack providers (compatible with OpenAI format)
⋮----
// === LLM Creation Functions ===
const createGpustackLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// Use createOpenAICompatible to get a provider instance, then get the model
// GPUStack uses /v1-openai prefix for OpenAI compatibility
⋮----
const getGpustackUsageReport = (task: Task, provider: ProviderProfile, model: Model, usage: LanguageModelUsage): UsageReportData =>
⋮----
// Cost is always 0 for GPUStack
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/groq.ts
================
import { Model, ProviderProfile, SettingsData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, GroqProvider, isGroqProvider } from '@common/agent';
import { createGroq } from '@ai-sdk/groq';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { getDefaultModelInfo, getDefaultUsageReport } from '@/models/providers/default';
⋮----
interface GroqModel {
  id: string;
}
⋮----
interface GroqApiResponse {
  data: GroqModel[];
}
⋮----
export const loadGroqModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasGroqEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getGroqAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createGroqLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/kimi-plan.ts
================
import { Model, ProviderProfile, SettingsData } from '@common/types';
import { isKimiPlanProvider, KimiPlanProvider } from '@common/agent';
import { createAnthropic } from '@ai-sdk/anthropic';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { getAnthropicCacheControl, getAnthropicUsageReport } from '@/models/providers/anthropic';
⋮----
const loadKimiPlanModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
// Return hardcoded model instead of fetching from API
⋮----
const hasKimiPlanEnvVars = (settings: SettingsData): boolean =>
⋮----
const getKimiPlanAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
// remove /v1 from the end of the base url for LiteLLM compatibility
⋮----
// Use anthropic prefix for Kimi since it uses Anthropic-compatible API
⋮----
// === LLM Creation Functions ===
const createKimiPlanLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// Use createAnthropic with Kimi's base URL
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Cache control

================
File: src/main/models/providers/litellm.ts
================
import { createOpenAICompatible } from '@ai-sdk/openai-compatible';
import { isLitellmProvider, LitellmProvider } from '@common/agent';
import { Model, ProviderProfile, SettingsData } from '@common/types';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import logger from '@/logger';
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { getDefaultUsageReport } from '@/models/providers/default';
⋮----
interface LiteLLMModelInfo {
  model_name: string;
  id?: string;
  max_tokens?: number;
  max_input_tokens?: number;
  max_output_tokens?: number;
  context_window?: number;
  input_cost_per_token?: number;
  output_cost_per_token?: number;
  litellm_params?: {
    max_tokens?: number;
    max_input_tokens?: number;
    max_output_tokens?: number;
    context_window?: number;
    input_cost_per_token?: number;
    output_cost_per_token?: number;
  };
  model_info?: {
    max_tokens?: number;
    max_input_tokens?: number;
    max_output_tokens?: number;
    context_window?: number;
    input_cost_per_token?: number;
    output_cost_per_token?: number;
  };
}
⋮----
export const loadLitellmModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
// Fetch /model/info for detailed pricing and config
// This is required for LiteLLM provider
⋮----
// Sometimes it might return a map directly
⋮----
// Group by model_name to handle load balancing
⋮----
// Helper to find value in multiple places for a single info object
const getValue = (
        info: LiteLLMModelInfo,
        key: 'context_window' | 'max_input_tokens' | 'max_output_tokens' | 'max_tokens' | 'input_cost_per_token' | 'output_cost_per_token',
) =>
⋮----
// Aggregate values across all backends for this model name
// For limits (context window, max output), use MIN to be safe
// For costs, use MAX to be safe/conservative
⋮----
export const hasLitellmEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getLitellmAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// Ensure no trailing slash to avoid double slashes if Aider appends paths
⋮----
// === LLM Creation Functions ===
export const createLitellmLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
apiKey = 'sk-dummy'; // Dummy key for OpenAI-compatible client which expects a key.
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/lm-studio.ts
================
import { Model, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isLmStudioProvider, LmStudioProvider } from '@common/agent';
import { createOpenAICompatible } from '@ai-sdk/openai-compatible';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { Task } from '@/task/task';
⋮----
export const loadLmStudioModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
const normalized = effectiveBaseUrl.replace(/\/+$/g, ''); // Remove all trailing slashes
⋮----
export const hasLmStudioEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getLmStudioAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createLmStudioLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
export const getLmStudioUsageReport = (task: Task, provider: ProviderProfile, model: Model, usage: LanguageModelUsage): UsageReportData =>
⋮----
// no cost for LMStudio models
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/minimax.ts
================
import { createAnthropic } from '@ai-sdk/anthropic';
import { isMinimaxProvider, MinimaxProvider } from '@common/agent';
import { Model, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import logger from '@/logger';
import { AiderModelMapping, CacheControl, LlmProviderStrategy } from '@/models';
import { LoadModelsResponse } from '@/models/types';
import { Task } from '@/task/task';
import { getEffectiveEnvironmentVariable } from '@/utils';
⋮----
export const loadMinimaxModels = async (profile: ProviderProfile): Promise<LoadModelsResponse> =>
⋮----
// Hardcoded MiniMax models - no API call needed
⋮----
inputCostPerToken: 0.0000003, // 0.3 per 1M tokens
outputCostPerToken: 0.0000012, // 1.2 per 1M tokens
cacheReadInputTokenCost: 0.00000003, // 0.03 per 1M tokens
cacheWriteInputTokenCost: 0.00000004, // 0.04 per 1M tokens
⋮----
inputCostPerToken: 0.0000003, // 0.3 per 1M tokens
outputCostPerToken: 0.0000012, // 1.2 per 1M tokens
cacheReadInputTokenCost: 0.00000003, // 0.03 per 1M tokens
cacheWriteInputTokenCost: 0.00000004, // 0.04 per 1M tokens
⋮----
export const hasMinimaxEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getMinimaxAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createMinimaxLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
type MinimaxMetadata = {
  anthropic: {
    cacheCreationInputTokens?: number;
    cacheReadInputTokens?: number;
  };
};
⋮----
// === Cost and Usage Functions ===
export const calculateMinimaxCost = (
  model: Model,
  sentTokens: number,
  receivedTokens: number,
  cacheWriteTokens: number = 0,
  cacheReadTokens: number = 0,
): number =>
⋮----
export const getMinimaxUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
// Extract cache tokens from provider metadata
⋮----
// Calculate sentTokens after deducting cached tokens
⋮----
// Calculate cost internally with already deducted sentTokens
⋮----
// === Configuration Helper Functions ===
export const getMinimaxCacheControl = (): CacheControl | undefined =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Configuration helpers

================
File: src/main/models/providers/ollama.ts
================
import { Model, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isOllamaProvider, OllamaProvider } from '@common/agent';
import { createOllama } from 'ollama-ai-provider-v2';
import { simulateStreamingMiddleware, wrapLanguageModel } from 'ai';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { Task } from '@/task/task';
⋮----
export const loadOllamaModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
let normalized = effectiveBaseUrl.replace(/\/+$/, ''); // Remove all trailing slashes
⋮----
export const hasOllamaEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getOllamaAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createOllamaLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
let normalized = baseUrl.replace(/\/+$/, ''); // Remove all trailing slashes
⋮----
export const getOllamaUsageReport = (task: Task, provider: ProviderProfile, model: Model, usage: LanguageModelUsage): UsageReportData =>
⋮----
// Cost is always 0 for Ollama
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/openai-compatible.ts
================
import { Model, ProviderProfile, ReasoningEffort, SettingsData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isOpenAiCompatibleProvider, LlmProvider, OpenAiCompatibleProvider } from '@common/agent';
import { createOpenAICompatible } from '@ai-sdk/openai-compatible';
⋮----
import type { LanguageModelV2, SharedV2ProviderOptions } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { getDefaultUsageReport } from '@/models/providers/default';
⋮----
const loadOpenaiCompatibleModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
const hasOpenAiCompatibleEnvVars = (settings: SettingsData): boolean =>
⋮----
const getOpenAiCompatibleAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// Use openai prefix for OpenAI-compatible providers
⋮----
// === LLM Creation Functions ===
const createOpenAiCompatibleLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// Use createOpenAICompatible to get a provider instance, then get the model
⋮----
// === Configuration Helper Functions ===
const getOpenAiCompatibleProviderOptions = (provider: LlmProvider, model: Model): SharedV2ProviderOptions | undefined =>
⋮----
// Extract reasoningEffort from model overrides or provider config
⋮----
// Map ReasoningEffort enum to AI SDK format
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Configuration helper functions

================
File: src/main/models/providers/openai.ts
================
import { createOpenAI } from '@ai-sdk/openai';
import { DEFAULT_VOICE_SYSTEM_INSTRUCTIONS, isOpenAiProvider, LlmProvider, OpenAiProvider, OpenAiVoiceModel } from '@common/agent';
import { Model, ProviderProfile, ReasoningEffort, SettingsData, UsageReportData, VoiceSession } from '@common/types';
⋮----
import type { LanguageModelUsage, ToolSet } from 'ai';
import type { LanguageModelV2, SharedV2ProviderOptions } from '@ai-sdk/provider';
⋮----
import logger from '@/logger';
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import { Task } from '@/task/task';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { calculateCost, getDefaultModelInfo } from '@/models/providers/default';
⋮----
export const loadOpenAiModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasOpenAiEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getOpenAiAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// clear any custom base URL
⋮----
// === LLM Creation Functions ===
export const createOpenAiLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
type OpenAiMetadata = {
  openai: {
    cachedPromptTokens?: number;
  };
};
⋮----
export const getOpenAiUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
// Extract cache read tokens from provider metadata or usage
⋮----
// Calculate sentTokens after deducting cached tokens
⋮----
// Calculate cost internally with already deducted sentTokens
⋮----
// === Configuration Helper Functions ===
export const getOpenAiProviderOptions = (provider: LlmProvider, model: Model): SharedV2ProviderOptions | undefined =>
⋮----
// Extract reasoningEffort from model overrides or provider config
⋮----
// Map ReasoningEffort enum to AI SDK format
⋮----
// === Provider Tools Functions ===
export const getOpenAiProviderTools = (provider: LlmProvider, model: Model): ToolSet =>
⋮----
// Check for model-specific overrides
⋮----
// === Complete Strategy Implementation ===
const createOpenAIVoiceSession = async (profile: ProviderProfile, settings: SettingsData): Promise<VoiceSession> =>
⋮----
// Generate ephemeral token for OpenAI Realtime API
// This creates a short-lived token specifically for Realtime API usage
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Configuration helper functions
⋮----
// Voice support

================
File: src/main/models/providers/opencode.ts
================
import { Model, ProviderProfile, SettingsData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isOpenCodeProvider, OpenCodeProvider } from '@common/agent';
import { createOpenAI } from '@ai-sdk/openai';
import { createAnthropic } from '@ai-sdk/anthropic';
import { createGoogleGenerativeAI } from '@ai-sdk/google';
import { createOpenAICompatible } from '@ai-sdk/openai-compatible';
⋮----
import { getDefaultModelInfo, getDefaultUsageReport } from './default';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import { getEffectiveEnvironmentVariable } from '@/utils';
⋮----
interface OpenCodeModel {
  id: string;
  object: string;
  created: number;
  owned_by: string;
}
⋮----
interface OpenCodeModelsResponse {
  object: string;
  data: OpenCodeModel[];
}
⋮----
type ModelEndpointType = 'openai' | 'anthropic' | 'gemini' | 'openai-compatible';
⋮----
const getModelEndpointType = (modelId: string): ModelEndpointType =>
⋮----
const getDefaultModelTemperature = (modelId: string) =>
⋮----
const loadOpencodeModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasOpencodeEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getOpencodeAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
// Use openai prefix for OpenCode providers
⋮----
// === LLM Creation Functions ===
export const createOpencodeLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/providers/openrouter.ts
================
import { AgentProfile, Model, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isOpenRouterProvider, LlmProvider, OpenRouterProvider } from '@common/agent';
import { createOpenRouter } from '@openrouter/ai-sdk-provider';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AIDER_DESK_TITLE, AIDER_DESK_WEBSITE } from '@/constants';
import { AiderModelMapping, CacheControl, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { Task } from '@/task/task';
import { calculateCost } from '@/models/providers/default';
⋮----
interface OpenRouterTopProvider {
  is_moderated: boolean;
  context_length: number;
  max_completion_tokens: number;
}
⋮----
interface OpenRouterPricing {
  prompt: string;
  completion: string;
  input_cache_read?: string;
  input_cache_write?: string;
}
⋮----
interface OpenRouterModel {
  id: string;
  name: string;
  created: number;
  description: string;
  top_provider: OpenRouterTopProvider;
  pricing: OpenRouterPricing;
  context_length: number;
}
⋮----
interface OpenRouterModelsResponse {
  data: OpenRouterModel[];
}
⋮----
const getDefaultModelTemperature = (modelId: string) =>
⋮----
const loadOpenrouterModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasOpenRouterEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getOpenRouterAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// === LLM Creation Functions ===
export const createOpenRouterLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
type OpenRouterMetadata = {
  openrouter: {
    usage: {
      completionTokens: number;
      completionTokensDetails: {
        reasoningTokens: number;
      };
      cost: number;
      promptTokens: number;
      promptTokensDetails?: {
        cachedTokens: number;
      };
      totalTokens: number;
    };
  };
};
⋮----
export const getOpenRouterUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
// Extract cache read tokens from provider metadata
⋮----
// Calculate sentTokens after deducting cached tokens
⋮----
// Use cost from provider metadata if available, otherwise calculate
⋮----
// === Configuration Helper Functions ===
export const getOpenRouterCacheControl = (profile: AgentProfile, llmProvider: LlmProvider): CacheControl | undefined =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Configuration helpers

================
File: src/main/models/providers/requesty.ts
================
import { AgentProfile, Model, ProviderProfile, ReasoningEffort, SettingsData, UsageReportData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isRequestyProvider, LlmProvider, RequestyProvider } from '@common/agent';
import { createRequesty, type RequestyProviderMetadata } from '@requesty/ai-sdk';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AIDER_DESK_TITLE, AIDER_DESK_WEBSITE } from '@/constants';
import { AiderModelMapping, CacheControl, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { Task } from '@/task/task';
⋮----
interface RequestyModel {
  id: string;
  created: number;
  owned_by: string;
  input_price: number;
  caching_price?: number;
  cached_price?: number;
  output_price: number;
  max_output_tokens: number;
  context_window: number;
  supports_caching: boolean;
  supports_vision: boolean;
  supports_computer_use: boolean;
  supports_reasoning: boolean;
  description: string;
}
⋮----
interface RequestyModelsResponse {
  data: RequestyModel[];
}
⋮----
const getDefaultModelTemperature = (modelId: string) =>
⋮----
const loadRequestyModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
export const hasRequestyEnvVars = (settings: SettingsData): boolean =>
⋮----
export const getRequestyAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
// Requesty doesn't have direct Aider support, so we use OpenAI-compatible endpoint
⋮----
// === LLM Creation Functions ===
export const createRequestyLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// === Cost and Usage Functions ===
export const calculateRequestyCost = (
  model: Model,
  sentTokens: number,
  receivedTokens: number,
  cacheWriteTokens: number = 0,
  cacheReadTokens: number = 0,
): number =>
⋮----
export const getRequestyUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
// Extract cache tokens from provider metadata
⋮----
// Calculate sentTokens after deducting cached tokens
⋮----
// Calculate cost internally with already deducted sentTokens
⋮----
// === Configuration Helper Functions ===
export const getRequestyCacheControl = (profile: AgentProfile, llmProvider: LlmProvider): CacheControl | undefined =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Configuration helpers

================
File: src/main/models/providers/synthetic.ts
================
import { Model, ModelInfo, ProviderProfile, SettingsData } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE, isSyntheticProvider, SyntheticProvider } from '@common/agent';
import { createOpenAICompatible } from '@ai-sdk/openai-compatible';
⋮----
import { getDefaultUsageReport } from './default';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
⋮----
const loadSyntheticModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
const hasSyntheticEnvVars = (): boolean
⋮----
const getSyntheticAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
const createSyntheticLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
const getSyntheticModelInfo = (_provider: ProviderProfile, modelId: string, allModelInfos: Record<string, ModelInfo>): ModelInfo | undefined =>

================
File: src/main/models/providers/vertex-ai.ts
================
import { v1beta1 } from '@google-cloud/aiplatform';
import { GoogleAuth } from 'google-auth-library';
import { Model, ModelInfo, ProviderProfile, SettingsData, UsageReportData } from '@common/types';
import { isVertexAiProvider, LlmProvider, VertexAiProvider } from '@common/agent';
import { createVertex } from '@ai-sdk/google-vertex';
⋮----
import type { LanguageModelUsage } from 'ai';
import type { LanguageModelV2, SharedV2ProviderOptions } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
import { Task } from '@/task/task';
⋮----
export const loadVertexAIModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
// Use provided credentials JSON
⋮----
// Use default credentials (e.g., gcloud, environment variables, or service account)
⋮----
temperature: 0.7, // Default temperature for Vertex AI models
⋮----
export const hasVertexAiEnvVars = (_settings: SettingsData): boolean =>
⋮----
// Vertex AI doesn't have a simple environment variable check like other providers
// It requires project, location, and potentially credentials
⋮----
export const getVertexAiAiderMapping = (provider: ProviderProfile, modelId: string): AiderModelMapping =>
⋮----
// Aider uses vertex_ai prefix instead of vertex-ai
⋮----
// === LLM Creation Functions ===
export const createVertexAiLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// using custom base URL to fix the 'global' location
⋮----
type VertexGoogleMetadata = {
  google: {
    cachedContentTokenCount?: number;
  };
};
⋮----
const calculateVertexAiCost = (model: Model, sentTokens: number, receivedTokens: number, cacheReadTokens: number = 0): number =>
⋮----
// Use model overrides if available, otherwise use base model info
⋮----
const getVertexAiUsageReport = (
  task: Task,
  provider: ProviderProfile,
  model: Model,
  usage: LanguageModelUsage,
  providerMetadata?: unknown,
): UsageReportData =>
⋮----
// Extract cache read tokens from provider metadata
⋮----
// Calculate sentTokens after deducting cached tokens
⋮----
// Calculate cost internally with already deducted sentTokens
⋮----
export const getVertexAiProviderOptions = (llmProvider: LlmProvider, model: Model): SharedV2ProviderOptions | undefined =>
⋮----
// Use model-specific overrides, falling back to provider defaults
⋮----
const getVertexAiModelInfo = (_provider: ProviderProfile, modelId: string, allModelInfos: Record<string, ModelInfo>): ModelInfo | undefined =>
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions
⋮----
// Configuration helpers

================
File: src/main/models/providers/zai-plan.ts
================
import { Model, ModelInfo, ProviderProfile, SettingsData } from '@common/types';
import { isZaiPlanProvider, LlmProvider, ZaiPlanProvider } from '@common/agent';
import { createOpenAICompatible } from '@ai-sdk/openai-compatible';
⋮----
import { getDefaultUsageReport } from './default';
⋮----
import type { LanguageModelV2, SharedV2ProviderOptions } from '@ai-sdk/provider';
⋮----
import { AiderModelMapping, LlmProviderStrategy, LoadModelsResponse } from '@/models';
import logger from '@/logger';
import { getEffectiveEnvironmentVariable } from '@/utils';
⋮----
const loadZaiPlanModels = async (profile: ProviderProfile, settings: SettingsData): Promise<LoadModelsResponse> =>
⋮----
// ZAI uses specific endpoint for model discovery
⋮----
temperature: 0.7, // Default temperature for ZAI models
⋮----
const hasZaiPlanEnvVars = (): boolean
⋮----
const getZaiPlanAiderMapping = (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string): AiderModelMapping =>
⋮----
// Set the base URL for ZAI Plan
⋮----
// Use zai-plan prefix for ZAI providers
⋮----
// === LLM Creation Functions ===
const createZaiPlanLlm = (profile: ProviderProfile, model: Model, settings: SettingsData, projectDir: string): LanguageModelV2 =>
⋮----
// Use createOpenAICompatible to get a provider instance, then get the model
// ZAI uses specific base URL for chat completions
⋮----
const getZaiPlanModelInfo = (_provider: ProviderProfile, modelId: string, allModelInfos: Record<string, ModelInfo>): ModelInfo | undefined =>
⋮----
const getZaiPlanProviderOptions = (llmProvider: LlmProvider, model: Model): SharedV2ProviderOptions | undefined =>
⋮----
// Only disable thinking if explicitly set to false
⋮----
// === Complete Strategy Implementation ===
⋮----
// Core LLM functions
⋮----
// Model discovery functions

================
File: src/main/models/index.ts
================


================
File: src/main/models/model-manager.ts
================
import { promises as fs } from 'fs';
import path from 'path';
⋮----
import { AVAILABLE_PROVIDERS, getDefaultProviderParams, LlmProvider, LlmProviderName } from '@common/agent';
import {
  AgentProfile,
  Model,
  ModelInfo,
  ModelOverrides,
  ProviderModelsData,
  ProviderProfile,
  SettingsData,
  UsageReportData,
  VoiceSession,
} from '@common/types';
import { extractProviderModel } from '@common/utils';
⋮----
import { anthropicProviderStrategy } from './providers/anthropic';
import { anthropicCompatibleProviderStrategy } from './providers/anthropic-compatible';
import { azureProviderStrategy } from './providers/azure';
import { bedrockProviderStrategy } from './providers/bedrock';
import { cerebrasProviderStrategy } from './providers/cerebras';
import { claudeAgentSdkProviderStrategy } from './providers/claude-agent-sdk';
import { deepseekProviderStrategy } from './providers/deepseek';
import { geminiProviderStrategy } from './providers/gemini';
import { gpustackProviderStrategy } from './providers/gpustack';
import { groqProviderStrategy } from './providers/groq';
import { kimiPlanProviderStrategy } from './providers/kimi-plan';
import { litellmProviderStrategy } from './providers/litellm';
import { lmStudioProviderStrategy } from './providers/lm-studio';
import { minimaxProviderStrategy } from './providers/minimax';
import { ollamaProviderStrategy } from './providers/ollama';
import { openaiProviderStrategy } from './providers/openai';
import { openaiCompatibleProviderStrategy } from './providers/openai-compatible';
import { opencodeProviderStrategy } from './providers/opencode';
import { openrouterProviderStrategy } from './providers/openrouter';
import { requestyProviderStrategy } from './providers/requesty';
import { syntheticProviderStrategy } from './providers/synthetic';
import { vertexAiProviderStrategy } from './providers/vertex-ai';
import { zaiPlanProviderStrategy } from './providers/zai-plan';
⋮----
import type { LanguageModelV2 } from '@ai-sdk/provider';
import type { JSONValue, LanguageModelUsage, ToolSet } from 'ai';
⋮----
import { AIDER_DESK_CACHE_DIR, AIDER_DESK_DATA_DIR } from '@/constants';
import logger from '@/logger';
import { Store } from '@/store';
import { EventManager } from '@/events';
import { Task } from '@/task/task';
import { AiderModelMapping, CacheControl, LlmProviderRegistry, LlmProviderStrategy } from '@/models/types';
⋮----
type ModelsMetaResponse = Record<
  string,
  {
    models: Record<
      string,
      {
        id: string;
        cost?: {
          input?: number;
          output?: number;
          cache_read?: number;
          cache_write?: number;
        };
        temperature?: boolean;
        limit: {
          context: number;
          output: number;
        };
      }
    >;
  }
>;
⋮----
export class ModelManager
⋮----
// Provider registry for strategy pattern
⋮----
constructor(
    private store: Store,
    private eventManager: EventManager,
)
⋮----
private async init(): Promise<void>
⋮----
private async loadModelsInfo(): Promise<void>
⋮----
// Try to load from cache first
⋮----
// Cache file doesn't exist or is invalid, we'll fetch fresh data
⋮----
const fetchFreshDataAndCache = async (cacheFile: string): Promise<void> =>
⋮----
// Save the fresh data to cache
⋮----
// Fetch fresh data in background if cache was loaded, otherwise await it
⋮----
private processModelsMeta(data: ModelsMetaResponse)
⋮----
getModelInfo(modelName: string): ModelInfo | undefined
⋮----
private createEnvVarProvider(providerName: LlmProviderName): ProviderProfile
⋮----
private getChangedProviders(oldProviders: ProviderProfile[], newProviders: ProviderProfile[]): ProviderProfile[]
⋮----
// Check for added/modified providers
⋮----
async providersChanged(oldProviders: ProviderProfile[], newProviders: ProviderProfile[])
⋮----
// Clear models for removed providers
⋮----
// Clear models for providers that became disabled
⋮----
private async loadProviderModels(providers: ProviderProfile[]): Promise<void>
⋮----
// Group providers by their provider name
⋮----
const loadModels = async () =>
⋮----
// Load models from each profile for this provider type
⋮----
// Skip disabled providers
⋮----
// Emit the updated provider models event
⋮----
// Update agent profiles with the new models
// Note: agent profiles are now file-based, so this update is handled differently
⋮----
private enrichWithModelInfo(models: Model[], profile: ProviderProfile, strategy: LlmProviderStrategy): Model[]
⋮----
// remove temperature if model does not support it
⋮----
private enrichWithOverrides(models: Model[], providerId: string): Model[]
⋮----
// maxOutputTokens and temperature should be also overridden by undefined values
⋮----
/**
   * Detect and add automatic providers from environment variables
   */
private updateEnvVarsProviders()
⋮----
async getProviderModels(reload = false): Promise<ProviderModelsData>
⋮----
// Clear cached models if reloading
⋮----
// Load models from all enabled providers
⋮----
private async loadModelOverrides(): Promise<void>
⋮----
private async saveModelOverrides(): Promise<void>
⋮----
async upsertModel(providerId: string, modelId: string, model: Model): Promise<void>
⋮----
async deleteModel(providerId: string, modelId: string): Promise<void>
⋮----
async updateModels(modelUpdates: Array<
⋮----
// Reload models for all affected providers at once
⋮----
getAiderModelMapping(modelName: string, projectDir: string): AiderModelMapping
⋮----
private getProviderAiderMapping(provider: ProviderProfile, modelId: string, projectDir: string): AiderModelMapping
⋮----
getModelSettings(providerId: string, modelId: string, useModelInfoFallback = false): Model | undefined
⋮----
createLlm(
    provider: ProviderProfile,
    model: string | Model,
    settings: SettingsData,
    projectDir: string,
    toolSet?: ToolSet,
    systemPrompt?: string,
    providerMetadata?: unknown,
): LanguageModelV2
⋮----
// Resolve Model object if string is provided
⋮----
// Fallback to creating a minimal Model object if not found
⋮----
getUsageReport(task: Task, provider: ProviderProfile, model: string | Model, usage: LanguageModelUsage, providerMetadata?: unknown): UsageReportData
⋮----
// Resolve Model object
⋮----
getCacheControl(profile: AgentProfile, llmProvider: LlmProvider): CacheControl | undefined
⋮----
isStreamingDisabled(provider: ProviderProfile, modelId: string): boolean
⋮----
getProviderOptions(provider: ProviderProfile, modelId: string): Record<string, Record<string, JSONValue>> | undefined
⋮----
// Look up the actual Model object from providerModels
⋮----
getProviderParameters(provider: ProviderProfile, modelId: string): Record<string, unknown>
⋮----
// Look up the actual Model object from providerModels
⋮----
/**
   * Returns provider-specific tools for the given provider and model
   */
async getProviderTools(provider: ProviderProfile, modelId: string): Promise<ToolSet>
⋮----
// Resolve Model object
⋮----
/**
   * Creates a voice session if supported by the provider
   */
async createVoiceSession(provider: ProviderProfile): Promise<VoiceSession>

================
File: src/main/models/types.ts
================
import { AgentProfile, Model, ModelInfo, ProviderProfile, SettingsData, UsageReportData, VoiceSession } from '@common/types';
import { LlmProvider, LlmProviderName } from '@common/agent';
⋮----
import type { LanguageModelV2, SharedV2ProviderOptions } from '@ai-sdk/provider';
import type { LanguageModelUsage, ToolSet } from 'ai';
⋮----
import { Task } from '@/task';
⋮----
export interface CacheControl {
  providerOptions: SharedV2ProviderOptions;
  placement?: 'message' | 'message-part';
}
⋮----
export interface AiderModelMapping {
  modelName: string;
  environmentVariables: Record<string, string>;
}
⋮----
/**
 * Complete strategy interface for LLM providers
 * Encapsulates all provider-specific functionality including:
 * - LLM creation and usage tracking
 * - Model discovery and configuration
 * - Cost calculation and usage reporting
 * - Environment variable detection
 * - Aider integration
 */
export interface LoadModelsResponse {
  models: Model[];
  success: boolean;
  error?: string;
}
⋮----
export interface LlmProviderStrategy {
  // === LLM Creation and Usage Functions ===
  /**
   * Creates a LanguageModel instance for the given provider and model
   * Each provider is responsible for loading its own credentials using getEffectiveEnvironmentVariable
   */
  createLlm: (
    profile: ProviderProfile,
    model: Model,
    settings: SettingsData,
    projectDir: string,
    toolSet?: ToolSet,
    systemPrompt?: string,
    providerMetadata?: unknown,
  ) => LanguageModelV2;

  /**
   * Generates usage reports with provider-specific metadata and calculates cost internally
   */
  getUsageReport: (task: Task, provider: ProviderProfile, model: Model, usage: LanguageModelUsage, providerMetadata?: unknown) => UsageReportData;

  // === Model Discovery and Configuration Functions ===
  /**
   * Loads available models from the provider's API
   */
  loadModels: (profile: ProviderProfile, settings: SettingsData) => Promise<LoadModelsResponse>;

  /**
   * Checks if required environment variables are available
   */
  hasEnvVars: (settings: SettingsData) => boolean;

  /**
   * Generates Aider-compatible model mapping with environment variables
   */
  getAiderMapping: (provider: ProviderProfile, modelId: string, settings: SettingsData, projectDir: string) => AiderModelMapping;

  // === Optional Configuration Helper Functions ===
  /**
   * Returns provider-specific cache control configuration
   */
  getCacheControl?: (profile: AgentProfile, provider: LlmProvider) => CacheControl | undefined;

  /**
   * Returns provider-specific options for model instantiation
   */
  getProviderOptions?: (provider: LlmProvider, model: Model) => SharedV2ProviderOptions | undefined;

  /**
   * Returns provider-specific tools that should be available to the agent
   */
  getProviderTools?: (provider: LlmProvider, model: Model) => ToolSet | Promise<ToolSet>;

  /**
   * Returns provider-specific parameters for the given model
   */
  getProviderParameters?: (provider: LlmProvider, model: Model) => Record<string, unknown>;

  /**
   * Returns model info for a specific model ID
   */
  getModelInfo?: (provider: ProviderProfile, modelId: string, allModelInfos: Record<string, ModelInfo>) => ModelInfo | undefined;

  /**
   * Creates a voice session configuration if supported
   */
  createVoiceSession?: (profile: ProviderProfile, settings: SettingsData) => Promise<VoiceSession>;
}
⋮----
// === LLM Creation and Usage Functions ===
/**
   * Creates a LanguageModel instance for the given provider and model
   * Each provider is responsible for loading its own credentials using getEffectiveEnvironmentVariable
   */
⋮----
/**
   * Generates usage reports with provider-specific metadata and calculates cost internally
   */
⋮----
// === Model Discovery and Configuration Functions ===
/**
   * Loads available models from the provider's API
   */
⋮----
/**
   * Checks if required environment variables are available
   */
⋮----
/**
   * Generates Aider-compatible model mapping with environment variables
   */
⋮----
// === Optional Configuration Helper Functions ===
/**
   * Returns provider-specific cache control configuration
   */
⋮----
/**
   * Returns provider-specific options for model instantiation
   */
⋮----
/**
   * Returns provider-specific tools that should be available to the agent
   */
⋮----
/**
   * Returns provider-specific parameters for the given model
   */
⋮----
/**
   * Returns model info for a specific model ID
   */
⋮----
/**
   * Creates a voice session configuration if supported
   */
⋮----
export type LlmProviderRegistry = Record<LlmProviderName, LlmProviderStrategy>;

================
File: src/main/project/index.ts
================


================
File: src/main/project/migrations.ts
================
import fs from 'fs/promises';
import path from 'path';
⋮----
import { v4 as uuidv4 } from 'uuid';
import { ContextFile, ContextMessage, TaskContext, TaskData } from '@common/types';
import { fileExists } from '@common/utils';
import { DEFAULT_AIDER_MAIN_MODEL } from '@common/agent';
⋮----
import { AIDER_DESK_DIR, AIDER_DESK_TASKS_DIR } from '@/constants';
import logger from '@/logger';
import { Project } from '@/project';
⋮----
interface SessionData {
  version: number;
  contextMessages: ContextMessage[];
  contextFiles: ContextFile[];
}
⋮----
/**
 * @deprecated this will be removed in 0.40.0
 *
 * Migrates legacy sessions to the new task system.
 *
 * This function:
 * 1. Checks if sessions directory exists
 * 2. Reads all session JSON files
 * 3. Creates tasks for each session
 * 4. Deletes the sessions directory after successful migration
 */
export const migrateSessionsToTasks = async (project: Project): Promise<void> =>
⋮----
// Check if sessions directory exists
⋮----
// Ensure tasks directory exists
⋮----
// Read all files in sessions directory
⋮----
// Process each session file
⋮----
// Delete the entire sessions directory after successful migration
⋮----
/**
 * Migrates a single session file to a task.
 */
const migrateSessionFile = async (project: Project, sessionsDirPath: string, tasksDirPath: string, sessionFile: string): Promise<void> =>
⋮----
// Read session data
⋮----
// Determine taskId and task folder name
⋮----
// Create task directory
⋮----
// Extract name from session file (without .json extension)
⋮----
// Write settings.json file
⋮----
// Create TaskContext by merging session data with required properties
⋮----
// Merge any other properties from session data, but don't override required ones
⋮----
// Write context.json file

================
File: src/main/project/project-manager.ts
================
import { normalizeBaseDir } from '@common/utils';
import { AgentProfile, ProjectSettings, SettingsData } from '@common/types';
⋮----
import { TelemetryManager } from '@/telemetry';
import { AgentProfileManager, McpManager } from '@/agent';
import { DataManager } from '@/data-manager';
import logger from '@/logger';
import { Project } from '@/project';
import { Store } from '@/store';
import { EventManager } from '@/events';
import { ModelManager } from '@/models';
import { WorktreeManager } from '@/worktrees';
import { MemoryManager } from '@/memory/memory-manager';
import { HookManager } from '@/hooks/hook-manager';
import { PromptsManager } from '@/prompts';
⋮----
export class ProjectManager
⋮----
constructor(
    private readonly store: Store,
    private readonly mcpManager: McpManager,
    private readonly telemetryManager: TelemetryManager,
    private readonly dataManager: DataManager,
    private readonly eventManager: EventManager,
    private readonly modelManager: ModelManager,
    worktreeManager: WorktreeManager,
    private readonly agentProfileManager: AgentProfileManager,
    private readonly memoryManager: MemoryManager,
    private readonly hookManager: HookManager,
    private readonly promptsManager: PromptsManager,
)
⋮----
private findProject(baseDir: string): Project | undefined
⋮----
private createProject(baseDir: string)
⋮----
public getProject(baseDir: string)
⋮----
public async startProject(baseDir: string)
⋮----
public async closeProject(baseDir: string)
⋮----
public async restartProject(baseDir: string): Promise<void>
⋮----
public async close(): Promise<void>
⋮----
async settingsChanged(oldSettings: SettingsData, newSettings: SettingsData)
⋮----
modelsUpdated()
⋮----
projectSettingsChanged(baseDir: string, oldSettings: ProjectSettings, newSettings: ProjectSettings)
⋮----
public getCustomCommands(baseDir: string)
⋮----
agentProfileUpdated(oldProfile: AgentProfile, profile: AgentProfile)

================
File: src/main/project/project.ts
================
import fs from 'fs/promises';
import path from 'path';
⋮----
import { CustomCommand, DefaultTaskState, ProjectSettings, SettingsData, TaskData, CreateTaskParams, WorkflowExecutionResult } from '@common/types';
import { fileExists } from '@common/utils';
import { v4 as uuidv4 } from 'uuid';
⋮----
import type { BmadStatus, InstallResult } from '@common/bmad-types';
⋮----
import { AgentProfileManager, McpManager } from '@/agent';
import { Connector } from '@/connector';
import { DataManager } from '@/data-manager';
import logger from '@/logger';
import { Store } from '@/store';
import { ModelManager } from '@/models';
import { CustomCommandManager } from '@/custom-commands';
import { TelemetryManager } from '@/telemetry';
import { EventManager } from '@/events';
import { INTERNAL_TASK_ID, Task } from '@/task';
import { migrateSessionsToTasks } from '@/project/migrations';
import { WorktreeManager } from '@/worktrees';
import { MemoryManager } from '@/memory/memory-manager';
import { HookManager } from '@/hooks/hook-manager';
import { PromptsManager } from '@/prompts';
import { AIDER_DESK_WATCH_FILES_LOCK } from '@/constants';
import { determineMainModel, determineWeakModel } from '@/utils';
import { BmadManager } from '@/bmad/bmad-manager';
⋮----
export class Project
⋮----
constructor(
    public readonly baseDir: string,
    private readonly store: Store,
    private readonly mcpManager: McpManager,
    private readonly telemetryManager: TelemetryManager,
    private readonly dataManager: DataManager,
    private readonly eventManager: EventManager,
    private readonly modelManager: ModelManager,
    private readonly worktreeManager: WorktreeManager,
    private readonly agentProfileManager: AgentProfileManager,
    private readonly memoryManager: MemoryManager,
    private readonly hookManager: HookManager,
    private readonly promptsManager: PromptsManager,
)
⋮----
public async start()
⋮----
private async prepareInternalTask()
⋮----
public async createNewTask(params?: CreateTaskParams)
⋮----
// adding files from internal task that keeps track of files to new task
⋮----
private prepareTask(taskId: string = uuidv4(), initialTaskData?: Partial<TaskData>)
⋮----
private async loadTasks()
⋮----
// Migrate sessions to tasks before starting
⋮----
public getMostRecentTask()
⋮----
public getTask(taskId: string = INTERNAL_TASK_ID)
⋮----
public getInternalTask()
⋮----
public getProjectSettings()
⋮----
public addConnector(connector: Connector)
⋮----
// Set input history file if provided by the connector
⋮----
public removeConnector(connector: Connector)
⋮----
public async loadInputHistory(): Promise<string[]>
⋮----
public async addToInputHistory(message: string)
⋮----
private async sendInputHistoryUpdatedEvent()
⋮----
public getCustomCommands()
⋮----
public sendCustomCommandsUpdated(commands: CustomCommand[])
⋮----
private async deleteTaskInternal(taskId: string): Promise<void>
⋮----
// Close the task if it's loaded
⋮----
// Delete the task directory
⋮----
public async deleteTask(taskId: string): Promise<void>
⋮----
// First, find and delete all subtasks recursively
⋮----
// Then delete the parent task
⋮----
public async duplicateTask(taskId: string): Promise<TaskData>
⋮----
public async forkTask(taskId: string, messageId: string): Promise<TaskData>
⋮----
async getTasks(): Promise<TaskData[]>
⋮----
forEachTask(callback: (task: Task) => void, initializedOnly = true)
⋮----
async settingsChanged(oldSettings: SettingsData, newSettings: SettingsData)
⋮----
async projectSettingsChanged(oldSettings: ProjectSettings, newSettings: ProjectSettings)
⋮----
async getBmadStatus(): Promise<BmadStatus>
⋮----
async installBmad(): Promise<InstallResult>
⋮----
// Emit events for browser clients
⋮----
async executeBmadWorkflow(workflowId: string, task: Task): Promise<WorkflowExecutionResult>
⋮----
async resetBmadWorkflow(): Promise<
⋮----
// Emit status change event for browser clients
⋮----
async close()
⋮----
// Remove watch-files lock file if it exists
⋮----
// Ignore error if file doesn't exist

================
File: src/main/prompts/helpers/conditional.ts
================
import Handlebars from 'handlebars';
import { ToolApprovalState } from '@common/types';
⋮----
export const registerConditionalHelpers = (): void =>

================
File: src/main/prompts/helpers/file.ts
================
import fs from 'fs';
import path from 'path';
⋮----
import Handlebars from 'handlebars';
⋮----
export const registerFileHelpers = (): void =>

================
File: src/main/prompts/helpers/formatting.ts
================
import Handlebars from 'handlebars';
⋮----
export const registerFormattingHelpers = (): void =>

================
File: src/main/prompts/helpers/index.ts
================
import { registerConditionalHelpers } from './conditional';
import { registerFileHelpers } from './file';
import { registerFormattingHelpers } from './formatting';
⋮----
import logger from '@/logger';
⋮----
export const registerAllHelpers = (): void =>

================
File: src/main/prompts/index.ts
================


================
File: src/main/prompts/prompts-manager.ts
================
import fs from 'fs/promises';
import path from 'path';
⋮----
import Handlebars from 'handlebars';
import { FSWatcher, watch } from 'chokidar';
import debounce from 'lodash/debounce';
import { AgentProfile, ConflictResolutionFileContext, SettingsData, ToolApprovalState } from '@common/types';
import {
  AIDER_TOOL_ADD_CONTEXT_FILES,
  AIDER_TOOL_DROP_CONTEXT_FILES,
  AIDER_TOOL_GET_CONTEXT_FILES,
  AIDER_TOOL_GROUP_NAME,
  AIDER_TOOL_RUN_PROMPT,
  HELPERS_TOOL_GROUP_NAME,
  MEMORY_TOOL_DELETE,
  MEMORY_TOOL_GROUP_NAME,
  MEMORY_TOOL_LIST,
  MEMORY_TOOL_RETRIEVE,
  MEMORY_TOOL_STORE,
  POWER_TOOL_BASH,
  POWER_TOOL_FILE_EDIT,
  POWER_TOOL_FILE_READ,
  POWER_TOOL_FILE_WRITE,
  POWER_TOOL_GLOB,
  POWER_TOOL_GREP,
  POWER_TOOL_GROUP_NAME,
  POWER_TOOL_SEMANTIC_SEARCH,
  SKILLS_TOOL_ACTIVATE_SKILL,
  SKILLS_TOOL_GROUP_NAME,
  SUBAGENTS_TOOL_GROUP_NAME,
  SUBAGENTS_TOOL_RUN_TASK,
  TODO_TOOL_CLEAR_ITEMS,
  TODO_TOOL_GET_ITEMS,
  TODO_TOOL_GROUP_NAME,
  TODO_TOOL_SET_ITEMS,
  TODO_TOOL_UPDATE_ITEM_COMPLETION,
  TOOL_GROUP_NAME_SEPARATOR,
} from '@common/tools';
⋮----
import { registerAllHelpers } from './helpers';
import {
  CommitMessagePromptData,
  CompactConversationPromptData,
  ConflictResolutionPromptData,
  ConflictResolutionSystemPromptData,
  HandoffPromptData,
  InitProjectPromptData,
  PromptTemplateData,
  PromptTemplateName,
  TaskNamePromptData,
  ToolPermissions,
  UpdateTaskStateData,
} from './types';
⋮----
import { AIDER_DESK_DEFAULT_PROMPTS_DIR, AIDER_DESK_GLOBAL_PROMPTS_DIR, AIDER_DESK_PROMPTS_DIR } from '@/constants';
import logger from '@/logger';
import { Task } from '@/task';
⋮----
export class PromptsManager
⋮----
constructor(
    private readonly defaultTemplatesDir = AIDER_DESK_DEFAULT_PROMPTS_DIR,
    private readonly globalPromptsDir = AIDER_DESK_GLOBAL_PROMPTS_DIR,
)
⋮----
public async init(): Promise<void>
⋮----
private async compileGlobalTemplates(): Promise<void>
⋮----
private async compileProjectTemplates(projectDir: string): Promise<void>
⋮----
private getTemplateNames(): PromptTemplateName[]
⋮----
private async loadGlobalTemplateSource(name: PromptTemplateName): Promise<string | null>
⋮----
// Check global prompts
⋮----
// Fall back to default templates from resources
⋮----
private async loadProjectTemplateSource(projectPromptsDir: string, name: PromptTemplateName): Promise<string | null>
⋮----
// It's fine if project template doesn't exist
⋮----
private async setupGlobalWatcher(): Promise<void>
⋮----
public async watchProject(projectDir: string): Promise<void>
⋮----
public async unwatchProject(projectDir: string): Promise<void>
⋮----
public async dispose(): Promise<void>
⋮----
private render(name: PromptTemplateName, data: unknown, projectDir?: string): string
⋮----
const isAllowed = (tool: string)
⋮----
anyEnabled: false, // Will be set below
⋮----
workflow: '', // Placeholder

================
File: src/main/prompts/types.ts
================
import { ContextFile } from '@common/types';
⋮----
export interface ToolPermissions {
  aiderTools: boolean;
  powerTools: {
    semanticSearch: boolean;
    fileRead: boolean;
    fileWrite: boolean;
    fileEdit: boolean;
    glob: boolean;
    grep: boolean;
    bash: boolean;
    anyEnabled: boolean;
  };
  todoTools: boolean;
  subagents: boolean;
  memory: {
    enabled: boolean;
    retrieveAllowed: boolean;
    storeAllowed: boolean;
    listAllowed: boolean;
    deleteAllowed: boolean;
  };
  skills: {
    allowed: boolean;
  };
  autoApprove: boolean;
}
⋮----
export interface PromptTemplateData {
  projectDir: string;
  taskDir: string;
  additionalInstructions?: string;
  osName: string;
  currentDate: string;
  rulesFiles: string;
  customInstructions: string;
  toolPermissions: ToolPermissions;
  toolConstants: Record<string, string>;
  workflow: string;
  projectGitRootDirectory?: string;
}
⋮----
// eslint-disable-next-line @typescript-eslint/no-empty-object-type
export interface InitProjectPromptData {
  // Static for now
}
⋮----
// Static for now
⋮----
export interface CompactConversationPromptData {
  customInstructions?: string;
}
⋮----
export interface HandoffPromptData {
  focus?: string;
  contextFiles?: ContextFile[];
}
⋮----
// eslint-disable-next-line @typescript-eslint/no-empty-object-type
export interface CommitMessagePromptData {
  // Static for now
}
⋮----
// Static for now
⋮----
// eslint-disable-next-line @typescript-eslint/no-empty-object-type
export interface TaskNamePromptData {
  // Static for now
}
⋮----
// Static for now
⋮----
export interface ConflictResolutionSystemPromptData {
  POWER_TOOL_GROUP_NAME: string;
  TOOL_GROUP_NAME_SEPARATOR: string;
  POWER_TOOL_FILE_EDIT: string;
}
⋮----
export interface ConflictResolutionPromptData {
  filePath: string;
  basePath?: string;
  oursPath?: string;
  theirsPath?: string;
}
⋮----
// eslint-disable-next-line @typescript-eslint/no-empty-object-type
export interface UpdateTaskStateData {
  // Static for now
}
⋮----
// Static for now
⋮----
export type PromptTemplateName =
  | 'system-prompt'
  | 'init-project'
  | 'workflow'
  | 'compact-conversation'
  | 'commit-message'
  | 'task-name'
  | 'conflict-resolution'
  | 'conflict-resolution-system'
  | 'update-task-state'
  | 'handoff';

================
File: src/main/server/rest-api/agent-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
profile: z.any(), // AgentProfile schema
⋮----
profile: z.any(), // AgentProfile schema
⋮----
agentProfiles: z.array(z.any()), // AgentProfile array
⋮----
export class AgentApi extends BaseApi
⋮----
constructor(private eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// GET /agent-profiles
⋮----
// POST /agent-profile/create
⋮----
// POST /agent-profile/update
⋮----
// POST /agent-profile/delete
⋮----
// POST /agent-profiles/order

================
File: src/main/server/rest-api/base-api.ts
================
import { Request, Response, Router } from 'express';
import { z } from 'zod';
⋮----
import { Project } from '@/project';
⋮----
export abstract class BaseApi
⋮----
protected constructor()
⋮----
/**
   * Finds a project by directory path and validates it exists and is started
   * Returns null if project not found or not started, and sends appropriate error response
   */
protected findProject(project: Project | undefined, projectDir: string, res: Response): Project | null
⋮----
/**
   * Generic request handler wrapper with consistent error handling
   */
protected handleRequest<T>(handler: (req: Request, res: Response) => Promise<T>)
⋮----
// eslint-disable-next-line no-console
⋮----
/**
   * Validates request data using a Zod schema and handles invalid requests
   */
protected validateRequest<T>(schema: z.ZodSchema<T>, data: unknown, res: Response): T | null
⋮----
/**
   * Abstract method for registering routes - each API module must implement this
   */
abstract registerRoutes(router: Router): void;

================
File: src/main/server/rest-api/bmad-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
// Request schemas
⋮----
export class BmadApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Get BMAD status
⋮----
// Install BMAD library
⋮----
// Execute BMAD workflow
⋮----
// Reset BMAD workflow (clear _bmad-output folder)

================
File: src/main/server/rest-api/commands-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class CommandsApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Get custom commands
⋮----
// Run custom command

================
File: src/main/server/rest-api/context-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
import { ProjectManager } from '@/project';
⋮----
export class ContextApi extends BaseApi
⋮----
constructor(
    private readonly projectManager: ProjectManager,
    private readonly eventsHandler: EventsHandler,
)
⋮----
registerRoutes(router: Router): void
⋮----
// Add context file
⋮----
// Drop context file
⋮----
// Get context files
⋮----
// Get addable files

================
File: src/main/server/rest-api/index.ts
================


================
File: src/main/server/rest-api/mcp-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class McpApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Load MCP server tools
⋮----
// Reload MCP servers
⋮----
// Reload single MCP server

================
File: src/main/server/rest-api/memory-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class MemoryApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void

================
File: src/main/server/rest-api/project-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
import { CreateTaskParams, ProjectSettingsSchema, TaskDataSchema } from '@common/types';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class ProjectApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Get projects
⋮----
// Get input history
⋮----
// Redo last user prompt
⋮----
// Resume task
⋮----
// Validate path
⋮----
// Is project path
⋮----
// Get file path suggestions
⋮----
// Paste image
⋮----
// Apply edits
⋮----
// Run command
⋮----
// Init project rules file
⋮----
// Create new task
⋮----
// Save task
⋮----
// Load task messages
⋮----
// List tasks
⋮----
// Delete session
⋮----
// Duplicate task
⋮----
// Fork task from message
⋮----
// Reset task
⋮----
// Load task data
⋮----
// Export session to markdown
⋮----
// Remove last message
⋮----
// Remove message by ID
⋮----
// Remove messages up to specified message ID
⋮----
// Compact conversation
⋮----
// Handoff conversation
⋮----
// Scrape web
⋮----
// Merge worktree to main
⋮----
// Apply uncommitted changes
⋮----
// Revert last merge
⋮----
// List branches
⋮----
// Worktree status
⋮----
// Rebase worktree from branch
⋮----
// Abort worktree rebase
⋮----
// Continue worktree rebase
⋮----
// Resolve worktree conflicts with agent
⋮----
// Update open projects order
⋮----
// Remove open project
⋮----
// Set active project
⋮----
// Restart project
⋮----
// Get project settings
⋮----
// Update project settings
⋮----
// Interrupt project
⋮----
// Clear project context
⋮----
// Answer project question
⋮----
// Update main model
⋮----
// Update weak model
⋮----
// Update architect model
⋮----
// Update edit formats
⋮----
// Start project
⋮----
// Stop project
⋮----
// Add open project

================
File: src/main/server/rest-api/prompt-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class PromptApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void

================
File: src/main/server/rest-api/providers-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
const LlmProviderProfileSchema = z.any(); // Placeholder - can be refined based on LlmProviderProfile type
⋮----
model: z.any(), // Model object - will be validated at runtime
⋮----
export class ProvidersApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Get providers
⋮----
// Update providers
⋮----
// Get provider models
⋮----
// Bulk update models
⋮----
// Upsert a single model
⋮----
// Delete a model

================
File: src/main/server/rest-api/settings-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
const SettingsDataSchema = z.any(); // Placeholder - can be refined based on SettingsData type
⋮----
export class SettingsApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Get settings
⋮----
// Update settings
⋮----
// Get recent projects
⋮----
// Add recent project
⋮----
// Remove recent project
⋮----
// Set zoom level
⋮----
// Get versions
⋮----
// Download latest AiderDesk
⋮----
// Get release notes
⋮----
// Clear release notes
⋮----
// Get OS

================
File: src/main/server/rest-api/system-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class SystemApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void

================
File: src/main/server/rest-api/terminal-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class TerminalApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Create terminal
⋮----
// Write to terminal
⋮----
// Resize terminal
⋮----
// Close terminal
⋮----
// Get terminal for task
⋮----
// Get all terminals for task

================
File: src/main/server/rest-api/todo-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class TodoApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void
⋮----
// Get todos
⋮----
// Add todo
⋮----
// Update todo
⋮----
// Delete todo
⋮----
// Clear all todos

================
File: src/main/server/rest-api/usage-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class UsageApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void

================
File: src/main/server/rest-api/voice-api.ts
================
import { Router } from 'express';
import { z } from 'zod';
⋮----
import { BaseApi } from './base-api';
⋮----
import { EventsHandler } from '@/events-handler';
⋮----
export class VoiceApi extends BaseApi
⋮----
constructor(private readonly eventsHandler: EventsHandler)
⋮----
registerRoutes(router: Router): void

================
File: src/main/server/cloudflare-tunnel-manager.ts
================
import { CloudflareTunnelStatus } from '@common/types';
import { Tunnel, use as setCloudflaredBinary } from 'cloudflared';
⋮----
import { CLOUDFLARED_BINARY_PATH, SERVER_PORT } from '@/constants';
import logger from '@/logger';
import { isDev } from '@/app';
⋮----
export class CloudflareTunnelManager
⋮----
async start(): Promise<void>
⋮----
// set cloudflared binary path only in production app
⋮----
// Wait for URL
⋮----
// Wait for connection
⋮----
// Keep listeners for ongoing events
⋮----
stop(): void
⋮----
getStatus(): CloudflareTunnelStatus

================
File: src/main/server/index.ts
================
// Export main controller

================
File: src/main/server/runner.ts
================
import { normalizeBaseDir } from '@common/utils';
import { ProjectData } from '@common/types';
⋮----
import logger from '@/logger';
import { initManagers } from '@/managers';
import { performStartUp } from '@/start-up';
import { Store } from '@/store';
import { AIDER_DESK_DATA_DIR } from '@/constants';
import { getDefaultProjectSettings } from '@/utils';
import { ModelManager } from '@/models';
import { AgentProfileManager } from '@/agent';
⋮----
export const addProjectsFromEnv = async (store: Store, modelManager: ModelManager, agentProfileManager: AgentProfileManager): Promise<void> =>
⋮----
// Create all projects from the env var
⋮----
// Override open projects with the ones from env var
⋮----
// Preserve active state from existing projects if they match
⋮----
// Set the first project as active if none are active
⋮----
const main = async (): Promise<void> =>
⋮----
// Force headless mode for node-runner
⋮----
const updateProgress = (
⋮----
// Initialize managers first
⋮----
// Check for AIDER_DESK_PROJECTS environment variable and add projects
⋮----
// Only run main if this file is being executed directly (not imported for testing)

================
File: src/main/server/server-controller.ts
================
import { Server } from 'http';
import { join } from 'path';
⋮----
import express, { NextFunction, Request, Response } from 'express';
import cors from 'cors';
⋮----
import {
  AgentApi,
  CommandsApi,
  ContextApi,
  McpApi,
  ProjectApi,
  PromptApi,
  ProvidersApi,
  SettingsApi,
  SystemApi,
  TodoApi,
  UsageApi,
  MemoryApi,
  VoiceApi,
  TerminalApi,
  BmadApi,
} from '@/server/rest-api';
import { AUTH_PASSWORD, AUTH_USERNAME, SERVER_PORT } from '@/constants';
import logger from '@/logger';
import { ProjectManager } from '@/project';
import { EventsHandler } from '@/events-handler';
import { Store } from '@/store';
import { isDev, isElectron } from '@/app';
⋮----
const REQUEST_TIMEOUT_MS = 5 * 60 * 1000; // 5 minutes
⋮----
export class ServerController
⋮----
constructor(
    private readonly server: Server,
    private readonly projectManager: ProjectManager,
    private readonly eventsHandler: EventsHandler,
    private readonly store: Store,
)
⋮----
private serverGuardMiddleware(_: Request, res: Response, next: NextFunction): void
⋮----
// In headless mode, always allow requests regardless of server.enabled setting
⋮----
private timeoutMiddleware(req: Request, res: Response, next: NextFunction): void
⋮----
private basicAuthMiddleware(req: Request, res: Response, next: NextFunction): void
⋮----
// Check if environment variables for auth are provided, which overrides settings
⋮----
private setupApiRoutes(): void
⋮----
// Create API router
⋮----
// Register all API modules
⋮----
// Mount the API router globally under /api
⋮----
private init()
⋮----
// Configure Express
⋮----
// Add server guard middleware as the first middleware
⋮----
// Set timeout for all requests
⋮----
// Add Basic Auth
⋮----
// Serve static renderer files in production (for browser access)
⋮----
// Handle SPA routing: serve index.html for non-API routes
⋮----
async close()
⋮----
// No need to stop server anymore - it's always attached
⋮----
async startServer()
⋮----
async stopServer()

================
File: src/main/store/migrations/v0-to-v1.ts
================
// eslint-disable-next-line @typescript-eslint/no-explicit-any
export const migrateSettingsV0toV1 = (settings: any): any =>
⋮----
// Create base providers array

================
File: src/main/store/migrations/v1-to-v2.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { DEFAULT_SETTINGS } from '../store';
⋮----
export const migrateSettingsV1toV2 = (settings: any): any => (
⋮----
// @ts-expect-error the config has changed

================
File: src/main/store/migrations/v10-to-v11.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { SettingsData } from '@common/types';
⋮----
export const migrateV10ToV11 = (settings: any): SettingsData =>
⋮----
// If the profile has a description, move it to the subagent
⋮----
// Remove description from the main profile
⋮----
// Move description to subagent

================
File: src/main/store/migrations/v11-to-v12.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { ContextMemoryMode, SettingsData } from '@common/types';
⋮----
export const migrateV11ToV12 = (settings: any): SettingsData =>
⋮----
hasContextMemory: undefined, // Remove old field

================
File: src/main/store/migrations/v12-to-v13.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { SettingsData } from '@common/types';
⋮----
export const migrateV12ToV13 = (settings: any): SettingsData =>

================
File: src/main/store/migrations/v13-to-v14.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { ProviderProfile } from '@common/types';
import { LlmProvider, LlmProviderName } from '@common/agent';
⋮----
export const migrateProvidersV13toV14 = (settings:

================
File: src/main/store/migrations/v14-to-v15.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { SettingsData } from '@common/types';
⋮----
export const migrateSettingsV14toV15 = (settings: any): SettingsData =>
⋮----
// Combine aiderPreferred and agentPreferred into preferredModels
// Add aiderPreferred first, then agentPreferred, removing duplicates
⋮----
// Remove the old models structure

================
File: src/main/store/migrations/v15-to-v16.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { SettingsData } from '@common/types';
import { DEFAULT_AGENT_PROFILE } from '@common/agent';
⋮----
export const migrateSettingsV15toV16 = (settings: any): SettingsData =>
⋮----
// Ensure toolSettings from DEFAULT_AGENT_PROFILE are included in existing agent profiles

================
File: src/main/store/migrations/v16-to-v17.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import fs from 'fs/promises';
import path from 'path';
import { homedir } from 'os';
⋮----
import { SettingsData, AgentProfile } from '@common/types';
⋮----
import { AIDER_DESK_AGENTS_DIR } from '@/constants';
import logger from '@/logger';
import { deriveDirName } from '@/utils';
⋮----
const getExistingDirNames = async (agentsDir: string): Promise<Set<string>> =>
⋮----
// Directory doesn't exist or can't be read
⋮----
const saveProfileToFile = async (profile: any, filePath: string): Promise<void> =>
⋮----
export const migrateSettingsV16toV17 = async (settings: SettingsData): Promise<SettingsData> =>
⋮----
// Create global agents directory
⋮----
// Migrate existing agent profiles from settings to directory structure
⋮----
// Get existing directory names for collision handling
⋮----
// Derive unique directory name from profile name
⋮----
// Check if directory already exists (don't overwrite existing directories)
⋮----
// Directory doesn't exist, create it
⋮----
existingDirNames.add(dirName); // Add to set to avoid collisions in same loop
⋮----
// Create order.json file using profile IDs
⋮----
// keeping the agentProfiles in settings for now, just in case user needs to revert the version

================
File: src/main/store/migrations/v2-to-v3.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { DEFAULT_SETTINGS } from '../store';
⋮----
export const migrateSettingsV2toV3 = (settings: any): any =>
⋮----
disabledTools: [], // Clear disabled tools
⋮----
mcpAgent: undefined, // Remove the old key

================
File: src/main/store/migrations/v3-to-v4.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { SettingsData } from '@common/types';
import { DEFAULT_AGENT_PROFILE, LlmProvider, LlmProviderName } from '@common/agent';
⋮----
export const migrateSettingsV3toV4 = (settingsV3: any): SettingsData =>
⋮----
// Ensure agentConfig and its properties exist, providing defaults if necessary
⋮----
export const migrateOpenProjectsV3toV4 = (openProjectsV3: any): string[] =>

================
File: src/main/store/migrations/v4-to-v5.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { SettingsData } from '@common/types';
⋮----
export const migrateSettingsV4toV5 = (settingsV4: any): SettingsData =>

================
File: src/main/store/migrations/v5-to-v6.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { SettingsData } from '@common/types';
⋮----
export const migrateSettingsV5toV6 = (settingsV5: any): SettingsData =>

================
File: src/main/store/migrations/v6-to-v7.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { AgentProfile, SettingsData, ToolApprovalState } from '@common/types';
⋮----
export const migrateV6ToV7 = (settings: SettingsData): SettingsData =>
⋮----
// Update AIDER_TOOL_ADD_CONTEXT_FILE to AIDER_TOOL_ADD_CONTEXT_FILES
⋮----
// Update AIDER_TOOL_DROP_CONTEXT_FILE to AIDER_TOOL_DROP_CONTEXT_FILES

================
File: src/main/store/migrations/v7-to-v8.ts
================
/* eslint-disable @typescript-eslint/no-explicit-any */
import { AgentProfile, SettingsData } from '@common/types';
⋮----
export const migrateV7ToV8 = (settings: SettingsData): SettingsData =>
⋮----
// Add temperature field with default value of 0.7 if it doesn't exist

================
File: src/main/store/migrations/v8-to-v9.ts
================
import { SettingsData } from '@common/types';
import { isOpenRouterProvider } from '@common/agent';
⋮----
export const migrateV8ToV9 = (settings: SettingsData): SettingsData =>

================
File: src/main/store/migrations/v9-to-v10.ts
================
import { SettingsData } from '@common/types';
import { isOpenRouterProvider } from '@common/agent';
⋮----
export const migrateV9ToV10 = (settings: SettingsData): SettingsData =>

================
File: src/main/store/index.ts
================


================
File: src/main/store/store.ts
================
import { v4 as uuidv4 } from 'uuid';
import {
  ContextCompactionType,
  DiffViewMode,
  MemoryEmbeddingProvider,
  MessageViewMode,
  ProjectData,
  ProjectSettings,
  ProjectStartMode,
  ProviderProfile,
  SettingsData,
  SuggestionMode,
  WindowState,
} from '@common/types';
import { normalizeBaseDir } from '@common/utils';
⋮----
import { migrateSettingsV0toV1 } from './migrations/v0-to-v1';
import { migrateSettingsV1toV2 } from './migrations/v1-to-v2';
import { migrateSettingsV2toV3 } from './migrations/v2-to-v3';
import { migrateOpenProjectsV3toV4, migrateSettingsV3toV4 } from './migrations/v3-to-v4';
import { migrateSettingsV4toV5 } from './migrations/v4-to-v5';
import { migrateSettingsV5toV6 } from './migrations/v5-to-v6';
import { migrateV6ToV7 } from './migrations/v6-to-v7';
import { migrateV7ToV8 } from './migrations/v7-to-v8';
import { migrateV8ToV9 } from './migrations/v8-to-v9';
import { migrateV9ToV10 } from './migrations/v9-to-v10';
import { migrateV10ToV11 } from './migrations/v10-to-v11';
import { migrateV11ToV12 } from './migrations/v11-to-v12';
import { migrateV12ToV13 } from './migrations/v12-to-v13';
⋮----
import { getDefaultProjectSettings } from '@/utils';
import logger from '@/logger';
import { migrateProvidersV13toV14 } from '@/store/migrations/v13-to-v14';
import { migrateSettingsV14toV15 } from '@/store/migrations/v14-to-v15';
import { migrateSettingsV15toV16 } from '@/store/migrations/v15-to-v16';
import { migrateSettingsV16toV17 } from '@/store/migrations/v16-to-v17';
⋮----
const compareBaseDirs = (baseDir1: string, baseDir2: string): boolean =>
⋮----
interface StoreSchema {
  windowState: WindowState;
  openProjects: ProjectData[];
  recentProjects: string[]; // baseDir paths of recently closed projects
  settings: SettingsData;
  providers: ProviderProfile[];
  settingsVersion: number;
  releaseNotes?: string | null;
  userId?: string;
}
⋮----
recentProjects: string[]; // baseDir paths of recently closed projects
⋮----
export class Store
⋮----
// @ts-expect-error expected to be initialized
⋮----
async init(path?: string): Promise<void>
⋮----
getUserId(): string
⋮----
createDefaultSettings(): SettingsData
⋮----
getSettings(): SettingsData
⋮----
// Ensure proper merging for nested objects
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
private async migrateSettings(settings: any, openProjects: any, providers: any): Promise<SettingsData>
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
private findOutCurrentVersion(settings: any): number
⋮----
// Check if agentProfiles still exists in settings (pre-v17)
⋮----
saveSettings(settings: SettingsData): void
⋮----
getOpenProjects(): ProjectData[]
⋮----
setOpenProjects(projects: ProjectData[]): void
⋮----
updateOpenProjectsOrder(baseDirs: string[]): ProjectData[]
⋮----
// This case should ideally not happen if baseDirs comes from the existing open projects.
// If it can happen, we might need to decide how to handle it (e.g., log a warning).
⋮----
getRecentProjects(): string[]
⋮----
addRecentProject(baseDir: string): void
⋮----
removeRecentProject(baseDir: string): void
⋮----
getProjectSettings(baseDir: string): ProjectSettings
⋮----
saveProjectSettings(baseDir: string, settings: ProjectSettings): ProjectSettings
⋮----
getWindowState(): StoreSchema['windowState']
⋮----
private getDefaultWindowState(): WindowState
⋮----
setWindowState(windowState: WindowState): void
⋮----
getReleaseNotes(): string | null
⋮----
clearReleaseNotes(): void
⋮----
setReleaseNotes(releaseNotes: string)
⋮----
getProviders(): ProviderProfile[]
⋮----
setProviders(providers: ProviderProfile[]): void

================
File: src/main/task/migrations/v1-to-v2.ts
================
import { ContextMessage, TaskContext } from '@common/types';
import { AIDER_TOOL_GROUP_NAME, AIDER_TOOL_RUN_PROMPT, SUBAGENTS_TOOL_GROUP_NAME, SUBAGENTS_TOOL_RUN_TASK } from '@common/tools';
import { extractServerNameToolName } from '@common/utils';
⋮----
import logger from '@/logger';
⋮----
/**
 * Migrates a single ContextMessage from V1 (AI SDK v4) to V2 (AI SDK v5) format.
 * This function is reusable and can handle recursive migration for subagent messages.
 */
const migrateContextMessage = (message: ContextMessage): ContextMessage =>
⋮----
// If content is already an array, it might be V1 format that needs migration or already V2 format
⋮----
// Check if this is V1 format by looking for 'args' or 'result' properties
⋮----
// Migrate V1 format to V2
⋮----
// V1 tool-call: change 'args' to 'input'
⋮----
args: undefined, // Remove old property
⋮----
// V1 tool-result: change 'result' to 'output' with proper typing
⋮----
// Check if this is a subagent tool result with messages that need migration
⋮----
// @ts-expect-error value is expected to have messages
⋮----
// Recursively migrate each message in the subagent result
⋮----
// @ts-expect-error value is expected to have responses
⋮----
// Recursively migrate each response message
⋮----
result: undefined, // Remove old property
⋮----
// Leave other parts (text, reasoning, etc.) unchanged
⋮----
// Return the message as is if it doesn't match migration conditions
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
export const migrateContextV1toV2 = (taskId: string, sessionData: any): TaskContext =>

================
File: src/main/task/aider-manager.ts
================
import { ChildProcessWithoutNullStreams, spawn } from 'child_process';
import { createHash } from 'crypto';
import { unlinkSync } from 'fs';
import fs from 'fs/promises';
import path from 'path';
⋮----
import { EditFormat, ModelsData } from '@common/types';
import { fileExists } from '@common/utils';
import treeKill from 'tree-kill';
import { DEFAULT_AIDER_MAIN_MODEL } from '@common/agent';
⋮----
import { AIDER_DESK_CONNECTOR_DIR, AIDER_DESK_PROJECT_RULES_DIR, AIDER_DESK_TASKS_DIR, PID_FILES_DIR, PYTHON_COMMAND, SERVER_PORT } from '@/constants';
import { Connector } from '@/connector';
import logger from '@/logger';
import { Store } from '@/store';
import { ModelManager } from '@/models';
import { EventManager } from '@/events';
import { getEnvironmentVariablesForAider } from '@/utils';
import { Task } from '@/task/task';
⋮----
export class AiderManager
⋮----
constructor(
⋮----
public async start(forceRestart = false): Promise<void>
⋮----
// Set aiderStarting to true when starting aider
⋮----
i++; // Skip the model value
⋮----
// Spawn without shell to have direct process control
⋮----
public async kill(): Promise<void>
⋮----
public isStarted(): boolean
⋮----
private createAiderStartPromise(): Promise<void>
⋮----
public async waitForStart(): Promise<void>
⋮----
private getAiderProcessPidFilePath(): string
⋮----
private async writeAiderProcessPidFile(): Promise<void>
⋮----
private removeAiderProcessPidFile()
⋮----
private async checkAndCleanupPidFile(): Promise<void>
⋮----
public handleConnectorAdded(connector: Connector): void
⋮----
// Set aiderStarting to false when a connector with source==='aider' is added
⋮----
public updateAiderModels(modelsData: ModelsData): void
⋮----
const getWeakModelProvider = () =>
⋮----
// use the provider prefix from the main model when Aider's provider prefix is different
⋮----
sendUpdateAiderModels()
⋮----
public updateModels(mainModel: string, weakModel: string | null, editFormat: EditFormat = 'diff'): void
⋮----
private sendSetModels(mainModel: string, weakModel: string | null, editFormat: EditFormat = 'diff', environmentVariables?: Record<string, string>): void
⋮----
public setArchitectModel(architectModel: string): void
⋮----
public getArchitectModel(): string | null
⋮----
public getAiderModelsData(): ModelsData | null
⋮----
public getRepoMap(): string
⋮----
public setRepoMap(repoMap: string): void
⋮----
public updateRepoMapFromConnector(repoMap: string): void
⋮----
public openCommandOutput(command: string): void
⋮----
private addCommandOutput(command: string, output: string): void
⋮----
// Append output to the commandOutputs map
⋮----
public closeCommandOutput(addToContext = true):
⋮----
public sendUpdateEnvVars(environmentVariables: Record<string, unknown>): void

================
File: src/main/task/context-manager.ts
================
import path from 'path';
import { promises as fs } from 'fs';
⋮----
import { v4 as uuidv4 } from 'uuid';
import debounce from 'lodash/debounce';
import {
  ContextFile,
  ContextMessage,
  ContextToolMessage,
  MessageRole,
  ResponseCompletedData,
  TaskContext,
  ToolData,
  UsageReportData,
  UserMessageData,
} from '@common/types';
import { extractServerNameToolName, extractTextContent, fileExists, isMessageEmpty, isTextContent } from '@common/utils';
import { AIDER_TOOL_GROUP_NAME, AIDER_TOOL_RUN_PROMPT, SUBAGENTS_TOOL_GROUP_NAME, SUBAGENTS_TOOL_RUN_TASK } from '@common/tools';
⋮----
import type { ToolResultPart } from 'ai';
⋮----
import logger from '@/logger';
import { Task } from '@/task';
import { isDirectory, isFileIgnored } from '@/utils';
import { ANSWER_RESPONSE_START_TAG, extractPromptContextFromToolResult, THINKING_RESPONSE_STAR_TAG } from '@/agent/utils';
import { migrateContextV1toV2 } from '@/task/migrations/v1-to-v2';
import { AIDER_DESK_TASKS_DIR } from '@/constants';
⋮----
export class ContextManager
⋮----
constructor(
    private readonly task: Task,
    private readonly taskId: string,
    initialMessages: ContextMessage[] = [],
    initialFiles: ContextFile[] = [],
)
⋮----
// Task-specific storage path - single context per task
⋮----
public enableAutosave()
⋮----
public disableAutosave()
⋮----
addContextMessage(role: MessageRole, content: string, usageReport?: UsageReportData): void;
addContextMessage(message: ContextMessage): void;
addContextMessage(roleOrMessage: MessageRole | ContextMessage, content?: string, usageReport?: UsageReportData)
⋮----
private async isFileIgnored(contextFile: ContextFile): Promise<boolean>
⋮----
async addContextFile(contextFile: ContextFile): Promise<ContextFile[]>
⋮----
dropContextFile(filePath: string): ContextFile[]
⋮----
setContextFiles(contextFiles: ContextFile[], save = true)
⋮----
getContextFiles(): ContextFile[]
⋮----
async getContextFilesEnsureLoaded(): Promise<ContextFile[]>
⋮----
setContextMessages(contextMessages: ContextMessage[], save = true)
⋮----
async getContextMessages(): Promise<ContextMessage[]>
⋮----
// Deep clone messages to prevent external modifications from affecting internal state
⋮----
clearContextFiles(save = true)
⋮----
clearMessages(save = true)
⋮----
removeMessageById(messageId: string): string[]
⋮----
// First, try to find a message with the exact ID
⋮----
// If it's an assistant message with array content
⋮----
// Check if it has mixed content (text/reasoning + tool calls)
⋮----
// Remove only text and reasoning parts, keep the message with tool calls
⋮----
// Otherwise, remove the whole message
⋮----
// If not found by ID, try to find by tool call ID
⋮----
private removeMessageByIndex(index: number, messageId: string): string[]
⋮----
private removeByToolCallId(toolCallId: string): string[]
⋮----
// Find tool message with matching toolCallId
⋮----
// Remove only the tool-result part from the tool message
⋮----
// If tool message is now empty, remove the whole message
⋮----
// Search backwards for assistant message with matching tool-call
⋮----
// If assistant message is now empty, remove the whole message
⋮----
removeLastMessage(): void
⋮----
removeMessagesUpToLastUserMessage(): ContextMessage[]
⋮----
toConnectorMessages(contextMessages: ContextMessage[] = this.messages):
⋮----
async save(): Promise<void>
⋮----
private async cleanupContext(): Promise<void>
⋮----
// Filter out files that no longer exist
⋮----
private async migrateContext(contextData: unknown): Promise<TaskContext>
⋮----
// Sequential migration chain
⋮----
// Future migrations will be added here
// if (sessionVersion === 2) {
//   migratedData = migrateSessionV2toV3(migratedData);
//   sessionVersion = 3;
// }
⋮----
async load(): Promise<void>
⋮----
private async loadInternal(): Promise<void>
⋮----
async loadMessages(messages: ContextMessage[]): Promise<void>
⋮----
// Clear all current messages
⋮----
// Get the messages data and send them to the UI
⋮----
// UserMessageData
⋮----
// ResponseCompletedData
⋮----
// ToolData
⋮----
// send messages to Connectors (Aider)
⋮----
async delete(): Promise<void>
⋮----
private autosave()
⋮----
public getContextMessagesData(contextMessages: ContextMessage[] = this.messages): (UserMessageData | ResponseCompletedData | ToolData)[]
⋮----
const processToolResult = (part: ToolResultPart) =>
⋮----
// Handle aider tool responses - create ResponseCompletedData for each response
⋮----
// Handle agent tool results - process all messages from subagent
⋮----
// Collect reasoning and text parts to combine them if both exist
⋮----
// Process combined reasoning and text content
⋮----
// Process tool-call parts
⋮----
const pushResponseCompletedData = (content = '') =>
⋮----
// Create tool message for tool-call parts
⋮----
// Now update tool messages with their responses from tool-results
⋮----
async generateContextMarkdown(): Promise<string | null>
⋮----
getMessagesUpTo(messageId: string): ContextMessage[]
⋮----
// If not found as a message ID, check if it's a toolCallId
⋮----
// If it's an assistant message with tool calls, we need to filter out tool calls
⋮----
// Filter the assistant message to keep only reasoning and text parts, exclude tool calls
⋮----
// If it's a tool message, we need to handle the assistant message with tool calls
⋮----
// messageId might be a toolCallId passed directly, or the message ID
// Try to get the toolCallId from the message content
⋮----
// If messageId is a toolCallId that doesn't match the first result, search for it
⋮----
// Find the assistant message that contains this tool call
⋮----
// Clone messages up to and including the assistant message
⋮----
// Clone the assistant message and keep only tool calls up to and including the target
⋮----
// Add all tool messages up to and including the target
⋮----
// Check if this tool message contains a tool-result for a tool-call we kept
⋮----
// Check if this tool call is in the assistant message we kept
⋮----
// For non-tool messages or if we couldn't find the assistant message, return all messages up to the target
⋮----
/**
   * Removes all messages after the specified message ID, keeping messages up to and including the specified message.
   * Uses intelligent slicing logic from getMessagesUpTo to handle tool messages and assistant messages with tool calls.
   * For assistant messages that are the target, inverts the filtering to keep tool calls instead of text/reasoning.
   *
   * @param messageId - The ID of the message to keep (all messages after this will be removed), or a toolCallId
   * @returns Array of removed message IDs
   */
removeMessagesAfter(messageId: string): string[]
⋮----
// Find the target message index in the original messages array
⋮----
// If not found as a message ID, check if it's a toolCallId
⋮----
// Get the messages to keep using the intelligent slicing logic
⋮----
// If no messages would be removed, return early
⋮----
// Process messages: deep clone all messages and handle assistant message filtering
⋮----
// Deep clone the message object
⋮----
// For target assistant message, get original content and keep text/reasoning (remove tool calls)
⋮----
// For non-target assistant messages, keep tool calls and text, remove reasoning only
⋮----
// Collect IDs of messages that will be removed
⋮----
// Replace the messages array with the processed messages
⋮----
// Trigger autosave if messages were removed

================
File: src/main/task/index.ts
================


================
File: src/main/task/task.ts
================
import fs from 'fs/promises';
import path from 'path';
import { homedir } from 'os';
⋮----
import { simpleGit } from 'simple-git';
import YAML from 'yaml';
import {
  AiderRunOptions,
  AIDER_MODES,
  AGENT_MODES,
  AgentProfile,
  ContextAssistantMessage,
  ContextFile,
  ContextMessage,
  DefaultTaskState,
  EditFormat,
  FileEdit,
  LogData,
  LogLevel,
  MessageRole,
  Mode,
  ModelInfo,
  ModelsData,
  ProjectSettings,
  PromptContext,
  QuestionData,
  ResponseChunkData,
  ResponseCompletedData,
  SettingsData,
  TaskContext,
  TaskData,
  TaskStateData,
  TaskStateEmoji,
  TodoItem,
  TokensInfoData,
  ToolData,
  UpdatedFile,
  UsageReportData,
  UserMessageData,
  WorkingMode,
} from '@common/types';
import { extractProviderModel, extractTextContent, fileExists, parseUsageReport } from '@common/utils';
import { COMPACT_CONVERSATION_AGENT_PROFILE, CONFLICT_RESOLUTION_PROFILE, HANDOFF_AGENT_PROFILE, INIT_PROJECT_AGENTS_PROFILE } from '@common/agent';
import { v4 as uuidv4 } from 'uuid';
import debounce from 'lodash/debounce';
import { isEqual } from 'lodash';
⋮----
import type { SimpleGit } from 'simple-git';
import type { WorkflowExecutionResult } from '@common/bmad-types';
⋮----
import { getAllFiles, isValidProjectFile } from '@/utils/file-system';
import {
  AIDER_DESK_TASKS_DIR,
  AIDER_DESK_TODOS_FILE,
  WORKTREE_BRANCH_PREFIX,
  AIDER_DESK_PROJECT_RULES_DIR,
  AIDER_DESK_GLOBAL_RULES_DIR,
  AIDER_DESK_TMP_DIR,
} from '@/constants';
import { Agent, AgentProfileManager, McpManager } from '@/agent';
import { Connector } from '@/connector';
import { DataManager } from '@/data-manager';
import logger from '@/logger';
import { MessageAction, ResponseMessage } from '@/messages';
import { Store } from '@/store';
import { ModelManager } from '@/models';
import { CustomCommandManager, ShellCommandError } from '@/custom-commands';
import { TelemetryManager } from '@/telemetry';
import { EventManager } from '@/events';
import { getEnvironmentVariablesForAider, execWithShellPath } from '@/utils';
import { ContextManager } from '@/task/context-manager';
import { Project } from '@/project';
import { AiderManager } from '@/task/aider-manager';
import { WorktreeManager, GitError } from '@/worktrees';
import { MemoryManager } from '@/memory/memory-manager';
import { getElectronApp } from '@/app';
import { HookManager } from '@/hooks/hook-manager';
import { PromptsManager } from '@/prompts';
⋮----
const getTaskFinishedNotificationText = (task: TaskData) =>
⋮----
export class Task
⋮----
constructor(
    public readonly project: Project,
    public readonly taskId: string,
    private readonly store: Store,
    private readonly mcpManager: McpManager,
    private readonly customCommandManager: CustomCommandManager,
    private readonly agentProfileManager: AgentProfileManager,
    private readonly telemetryManager: TelemetryManager,
    private readonly dataManager: DataManager,
    private readonly eventManager: EventManager,
    private readonly modelManager: ModelManager,
    private readonly worktreeManager: WorktreeManager,
    private readonly memoryManager: MemoryManager,
    public readonly hookManager: HookManager,
    private readonly promptsManager: PromptsManager,
    initialTaskData?: Partial<TaskData>,
)
⋮----
public async getTaskAgentProfile(): Promise<AgentProfile | null>
⋮----
// Check task-level agent profile first
⋮----
// If no task-level profile, fall back to project-level
⋮----
// If profile not found, try to create a temporary one from task-level provider/model
⋮----
// Create a temporary profile with task-level overrides
⋮----
private async loadTaskData()
⋮----
// make sure we always have the most recent project baseDir, in case the task was migrated from another path
⋮----
// Migrate missing task-level settings from project settings
⋮----
// Migrate task state based on last message in context
⋮----
/**
   * @deprecated Migrate missing task-level settings from project settings
   */
private async migrateFromProjectSettings()
⋮----
/**
   * @deprecated Migrate task state based on last message in context
   */
private async migrateTaskState()
⋮----
// Skip if state is already set
⋮----
// Set state based on last message role
⋮----
/**
   * Generate a branch name from task name (first 7 words, separated by '-')
   */
private generateBranchName(): string
⋮----
// Split into words, filter out empty strings, and take first 7
⋮----
.replace(/[^a-z0-9\s-]/g, '') // Remove special characters except spaces and hyphens
⋮----
// Join with hyphens and ensure it's a valid branch name
⋮----
// Ensure branch name doesn't start with a dot or dash, and replace consecutive dashes
⋮----
.replace(/^[.-]+/, '') // Remove leading dots or dashes
.replace(/-+/g, '-') // Replace multiple dashes with single dash
.replace(/-$/, ''); // Remove trailing dash
⋮----
// If result is empty, use taskId
⋮----
private isInternal()
⋮----
public async saveTask(updates?: Partial<TaskData>, updateTimestamps = true): Promise<TaskData>
⋮----
// Internal task is not saved
⋮----
public async init()
⋮----
private async initInternal()
⋮----
// Check if worktree is enabled for this task
⋮----
// Worktree is already set (e.g. inherited from parent)
⋮----
// Create a default worktree for this task
⋮----
// Check if worktree exists and set worktreeEnabled accordingly
⋮----
public async load(): Promise<TaskStateData>
⋮----
private async loadContext()
⋮----
public addConnector(connector: Connector)
⋮----
// Handle connector addition in AiderManager
⋮----
public removeConnector(connector: Connector)
⋮----
public getProjectDir()
⋮----
public getTaskDir()
⋮----
private normalizeFilePath(filePath: string): string
⋮----
private cleanupChunkBuffers()
⋮----
public async close(clearContext = false, cleanupEmptyTask = true)
⋮----
private async cleanUpEmptyTask()
⋮----
private findMessageConnectors(action: MessageAction): Connector[]
⋮----
private async waitForCurrentPromptToFinish()
⋮----
private async waitForCurrentAgentToFinish()
⋮----
private resolveAgentRunPromises()
⋮----
public async runPrompt(prompt: string, mode: Mode = 'code', addToInputHistory = true, userMessageId = uuidv4()): Promise<ResponseCompletedData[]>
⋮----
// Generate promptContext for this run
⋮----
public async savePromptOnly(prompt: string, addInputHistory = true): Promise<void>
⋮----
// Add to context manager
⋮----
// Add user message to context
⋮----
public async runPromptInAider(prompt: string, promptContext: PromptContext, mode?: Mode): Promise<ResponseCompletedData[]>
⋮----
// Detect files in prompt and ask to add them to context (only for aider modes)
⋮----
// Persist user message to the task context before running Aider so it can be redone even if the first call fails.
⋮----
// Create enhanced assistant message with full metadata
⋮----
public async runPromptInAgent(
    profile: AgentProfile,
    prompt: string | null,
    promptContext: PromptContext = { id: uuidv4() },
    contextMessages?: ContextMessage[],
    contextFiles?: ContextFile[],
    systemPrompt?: string,
    waitForCurrentAgentToFinish = true,
): Promise<ResponseCompletedData[]>
⋮----
// send messages to connectors
⋮----
// Determine task state based on the last assistant message
⋮----
public async executeBmadWorkflow(workflowId: string, asSubtask?: boolean): Promise<WorkflowExecutionResult>
⋮----
// Create a new subtask. If the current task already has a parentId (is a subtask),
// use that parentId to maintain only 1 level of subtasks
⋮----
private getTaskNameFromPrompt(prompt: string): string
⋮----
private async generateTaskNameInBackground(prompt: string): Promise<string | null>
⋮----
private async determineTaskState(resultMessages: ContextMessage[]): Promise<string | null>
⋮----
// Find the last assistant message from result messages
⋮----
// Extract reasoning and text from the last assistant message
⋮----
// Create a user message wrapping the last assistant message information
⋮----
public async runSubagent(
    profile: AgentProfile,
    prompt: string,
    contextMessages: ContextMessage[],
    contextFiles: ContextFile[],
    systemPrompt?: string,
    abortSignal?: AbortSignal,
    promptContext?: PromptContext,
): Promise<ContextMessage[]>
⋮----
public sendPromptToAider(
    prompt: string,
    promptContext: PromptContext = { id: uuidv4() },
    mode?: Mode,
    messages: {
      role: MessageRole;
      content: string;
    }[] = this.contextManager.toConnectorMessages(),
    files: ContextFile[] = this.contextManager.getContextFiles(),
    options?: AiderRunOptions,
): Promise<ResponseCompletedData[]>
⋮----
// Wait for prompt to finish and return collected responses
⋮----
public promptFinished(promptId?: string)
⋮----
// Notify waiting prompts with collected responses
⋮----
public async processResponseMessage(message: ResponseMessage, saveToDb = true)
⋮----
const sendResponseChunk = (chunk: string) =>
⋮----
// First chunk: send immediately and create interval
⋮----
// No buffered chunk, stop interval
⋮----
// Subsequent chunks: append to buffer
⋮----
// Collect the completed response
⋮----
// Sort by sequence number when adding
⋮----
sendResponseCompleted(data: ResponseCompletedData)
⋮----
private notifyIfEnabled(title: string, text: string)
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
private getQuestionKey(question: QuestionData): string
⋮----
public answerQuestion(answer: string, userInput?: string): boolean
⋮----
// If user input 'd' (don't ask again) or 'a' (always), store the determined answer.
⋮----
// Send question-answered event
⋮----
public async addFiles(...contextFiles: ContextFile[])
⋮----
// Send add file message for each added file
⋮----
public sendAddFile(contextFile: ContextFile, noUpdate?: boolean)
⋮----
public dropFile(filePath: string)
⋮----
// Send drop file message for each dropped file
⋮----
public sendDropFile(filePath: string, readOnly?: boolean, noUpdate?: boolean): void
⋮----
public async addToGit(absolutePath: string, promptContext?: PromptContext): Promise<void>
⋮----
// Add the new file to git staging
⋮----
// Continue even if git add fails, as the file was created successfully
⋮----
private async sendContextFilesUpdated()
⋮----
public async runCommand(command: string, addToHistory = true)
⋮----
// Get the Git root directory to handle monorepo scenarios
⋮----
// Get the current HEAD commit hash before undoing
⋮----
// Get all files from the last commit
⋮----
// For each file, check if it exists at HEAD~1 before attempting checkout
⋮----
// Check if file exists at HEAD~1
⋮----
// If it exists, checkout the previous version
⋮----
// Reset --soft HEAD~1
⋮----
public updateContextFiles(contextFiles: ContextFile[])
⋮----
public async askQuestion(questionData: QuestionData, awaitAnswer = true): Promise<[string, string | undefined]>
⋮----
// Wait if another question is already pending
⋮----
// group questions have a default set of answers
⋮----
// At this point, this.currentQuestion should be null due to the loop above,
// or it was null initially.
⋮----
// Auto-answer based on stored preference
⋮----
// Store the resolve function for the promise
⋮----
public updateAiderModels(modelsData: ModelsData)
⋮----
public updateModels(mainModel: string, weakModel: string | null, editFormat: EditFormat = 'diff')
⋮----
public setArchitectModel(architectModel: string)
⋮----
private async sendUpdateModelsInfo(): Promise<void>
⋮----
// Helper function to extract model info using getModel with fallback
const extractModelInfo = (modelName: string | null | undefined) =>
⋮----
// Extract info for main model
⋮----
// Extract info for weak model
⋮----
// Extract info for architect model
⋮----
// Send to connectors that listen to 'update-models-info'
⋮----
private async detectAndAddFilesFromPrompt(prompt: string): Promise<void>
⋮----
// First pass: match files by full path
⋮----
// Check if any context file matches a path in the prompt and track those names
⋮----
// Second pass: match files by filename only (if not already matched by path)
⋮----
// Skip if already matched by path
⋮----
// Skip if filename was already matched by path (prevents false positives)
⋮----
// Only match by filename if it's not empty and appears in the prompt
⋮----
public async getAddableFiles(searchRegex?: string): Promise<string[]>
⋮----
public async getAllFiles(useGit = true): Promise<string[]>
⋮----
public async getUpdatedFiles(): Promise<UpdatedFile[]>
⋮----
public async getContextFiles(includeRuleFiles = false): Promise<ContextFile[]>
⋮----
public async getRuleFilesAsContextFiles(profile?: AgentProfile): Promise<ContextFile[]>
⋮----
// Get global rule files
⋮----
// Convert to relative path with ~/ prefix
⋮----
// Global rules directory doesn't exist or can't be read
⋮----
// Include AGENTS.md from project root if it exists
⋮----
// AGENTS.md doesn't exist, which is fine
⋮----
// Get project rule files
⋮----
// Project rules directory doesn't exist or can't be read
⋮----
// Get agent profile rule files
⋮----
// Convert to relative path with ~/ prefix if in home directory
⋮----
// Rule file doesn't exist or can't be accessed
⋮----
public getRepoMap(): string
⋮----
public setRepoMap(repoMap: string): void
⋮----
public updateRepoMapFromConnector(repoMap: string): void
⋮----
public openCommandOutput(command: string)
⋮----
public closeCommandOutput(addToContext = true)
⋮----
public addLogMessage(level: LogLevel, message?: string, finished = false, promptContext?: PromptContext, actionIds?: string[])
⋮----
public getContextMessages()
⋮----
public async addRoleContextMessage(role: MessageRole, content: string, usageReport?: UsageReportData)
⋮----
public async addContextMessage(message: ContextMessage, updateContextInfo = false)
⋮----
public sendAddMessage(role: MessageRole = MessageRole.User, content: string, acknowledge = true)
⋮----
public sendUserMessage(data: UserMessageData)
⋮----
public sendToolMessage(data: ToolData)
⋮----
public async clearContext(addToHistory = false, updateContextInfo = true)
⋮----
public async resetContext()
⋮----
/**
   * Load context messages into the task context and send them to the UI.
   * This is used for loading pre-authored context (e.g., BMAD workflow context).
   */
public async loadContextMessages(messages: ContextMessage[])
⋮----
public interruptResponse(interruptId?: string)
⋮----
// Interrupt specific conflict resolution agent
⋮----
// Default behavior: interrupt all agents
⋮----
public applyEdits(edits: FileEdit[])
⋮----
public addToolMessage(
    id: string,
    serverName: string,
    toolName: string,
    args?: unknown,
    response?: string,
    usageReport?: UsageReportData,
    promptContext?: PromptContext,
    saveToDb = true,
    finished = !!response,
)
⋮----
// Update total costs when adding the tool message
⋮----
private updateTotalCosts(usageReport: UsageReportData)
⋮----
private addUserMessage(id: string, content: string, promptContext?: PromptContext)
⋮----
public async removeLastMessage()
⋮----
public async removeMessage(messageId: string): Promise<string[]>
⋮----
public async removeMessagesUpTo(messageId: string): Promise<string[]>
⋮----
public async redoLastUserPrompt(mode: Mode, updatedPrompt?: string)
⋮----
// No need to await runPrompt here, let it run in the background
⋮----
public async resumeTask()
⋮----
// In other modes, check if last message is user
⋮----
// Last message is from user, redo it
⋮----
// Last message is not from user, send "Continue" to aider
⋮----
private getCurrentMode()
⋮----
private shouldStartAider(): boolean
⋮----
private async reloadConnectorMessages()
⋮----
public async compactConversation(
    mode: Mode,
    customInstructions?: string,
    profile: AgentProfile | null = null,
    contextMessages?: ContextMessage[],
    promptContext?: PromptContext,
    abortSignal?: AbortSignal,
    waitForAgentCompletion = true,
    loadingMessage = 'Compacting conversation...',
)
⋮----
// Get profile if not provided
⋮----
const extractSummary = (content: string): string =>
⋮----
// Agent mode logic
⋮----
// Clear existing context and add the summary
⋮----
// Collect all new messages before setting the context
⋮----
// Set all messages at once
⋮----
// Prevent memory leaks by cleaning up pending prompt resources
⋮----
public async handoffConversation(
    mode: Mode,
    focus: string = '',
    contextMessages?: ContextMessage[],
    execute = false,
    waitForAgentCompletion = true,
    loadingMessage = 'Preparing handoff...',
): Promise<void>
⋮----
// Get context messages
⋮----
// Get context files to transfer
⋮----
// Generate the handoff prompt using agent.generateText
⋮----
// Agent mode logic
⋮----
// Other modes (ask, edit)
⋮----
// Create new task without sending event (sendEvent flag defaults to true)
⋮----
// Get the newly created Task instance
⋮----
// Add prompt to new task
⋮----
// Transfer context files
⋮----
// Send task-created event to trigger activation and handoff
⋮----
public async generateContextMarkdown(): Promise<string | null>
⋮----
updateTokensInfo(data: Partial<TokensInfoData>)
⋮----
async updateContextInfo(checkContextFilesIncluded = false, checkRepoMapIncluded = false)
⋮----
private async sendRequestContextInfo()
⋮----
public async updateAutocompletionData(words?: string[], force = false, useGit = true)
⋮----
async updateAgentEstimatedTokens(checkContextFilesIncluded = false, checkRepoMapIncluded = false)
⋮----
async settingsChanged(oldSettings: SettingsData, newSettings: SettingsData)
⋮----
// For old profile, we can't easily get it from old settings since they're now file-based
// We'll just use null for old profile comparison
// Note: agent profile changes are now handled differently since profiles are file-based
⋮----
// Check for changes in agent config properties that affect token count
const modelChanged = false; // oldAgentProfile is null, so no change
const disabledServersChanged = false; // oldAgentProfile is null, so no change
const toolApprovalsChanged = false; // oldAgentProfile is null, so no change
const includeContextFilesChanged = false; // oldAgentProfile is null, so no change
const includeRepoMapChanged = false; // oldAgentProfile is null, so no change
const useAiderToolsChanged = false; // oldAgentProfile is null, so no change
const usePowerToolsChanged = false; // oldAgentProfile is null, so no change
const customInstructionsChanged = false; // oldAgentProfile is null, so no change
⋮----
// Check for changes in Aider
⋮----
async modelsUpdated()
⋮----
async projectSettingsChanged(oldSettings: ProjectSettings, newSettings: ProjectSettings)
⋮----
private sendUpdateEnvVars(environmentVariables: Record<string, unknown>)
⋮----
private getTodoFilePath(): string
⋮----
public async readTodoFile(): Promise<
⋮----
public async writeTodoFile(data:
⋮----
public async getTodos(): Promise<TodoItem[]>
⋮----
public async setTodos(items: TodoItem[], initialUserPrompt = ''): Promise<void>
⋮----
public async addTodo(name: string): Promise<TodoItem[]>
⋮----
public async updateTodo(name: string, updates: Partial<TodoItem>): Promise<TodoItem[]>
⋮----
public async deleteTodo(name: string): Promise<TodoItem[]>
⋮----
public async clearAllTodos(): Promise<TodoItem[]>
⋮----
async initProjectAgentsFile(): Promise<void>
⋮----
// clear context before execution
⋮----
// Get the active agent profile
⋮----
// Run the agent with the modified profile
⋮----
// Check if the AGENTS.md file was created
⋮----
// Ask the user if they want to add this file to .aider.conf.yml
⋮----
private async addProjectAgentsToAiderConfig(): Promise<void>
⋮----
// Read existing config if it exists
⋮----
// Ensure read section exists and is an array
⋮----
// Add PROJECT.md to read section if not already present
⋮----
// Write the updated config
⋮----
public async runCustomCommand(commandName: string, args: string[], mode: Mode = 'agent'): Promise<void>
⋮----
// Handle shell command execution errors
⋮----
// Re-throw other errors
⋮----
// Agent mode logic
⋮----
// All other modes (code, ask, architect)
⋮----
// Clear loading message after execution completes (success or failure)
⋮----
async reset()
⋮----
public async updateTask(updates: Partial<TaskData>): Promise<TaskData>
⋮----
// Handle worktree configuration changes
⋮----
// Check if currentMode changed and start aider if new mode requires it
⋮----
// setting a name will also save the task
⋮----
// if this task is new empty task update should not trigger save
⋮----
private async sendWorktreeIntegrationStatusUpdated()
⋮----
private async sendUpdatedFilesUpdated()
⋮----
private async applyWorkingMode(mode: WorkingMode)
⋮----
public async mergeWorktreeToMain(squash: boolean, targetBranch?: string, commitMessage?: string): Promise<void>
⋮----
// For squash merge, we need a commit message
⋮----
// Get changes information for AI generation
⋮----
// Try to generate commit message using AI
⋮----
// Fallback to task name if AI generation fails
⋮----
// Store merge state for potential revert
⋮----
public async applyUncommittedChanges(targetBranch?: string): Promise<void>
⋮----
public async revertLastMerge(): Promise<void>
⋮----
// Clear merge state after successful revert
⋮----
public async getWorktreeIntegrationStatus(targetBranch?: string)
⋮----
public async rebaseWorktreeFromBranch(fromBranch?: string): Promise<void>
⋮----
public async abortWorktreeRebase(): Promise<void>
⋮----
private async executeConflictResolution(directoryPath: string, directoryName: string): Promise<void>
⋮----
// Create temp directory structure for conflict files
⋮----
// Create version files using the relative path structure
⋮----
// Write version files
⋮----
// Update context based on whether it was interrupted or resolved
⋮----
// Stage the file
⋮----
// Clean up temp files
⋮----
// Clean up abort controller
⋮----
public async resolveConflictsWithAgent(): Promise<void>
⋮----
// Check worktree first
⋮----
// Check main repository
⋮----
// No conflicts found
⋮----
public async continueWorktreeRebase(): Promise<void>
⋮----
// Clear any remaining merge state after successful rebase continuation
⋮----
public async duplicateFrom(sourceTask: Task): Promise<void>
⋮----
// Copy basic task data
⋮----
// Copy context files
⋮----
// Copy messages
⋮----
// Copy todos
⋮----
// Copy worktree if exists
⋮----
public async forkFrom(sourceTask: Task, messageId: string): Promise<void>
⋮----
// Copy basic task data
⋮----
// Copy ALL context files from source task (not just up to fork point)
⋮----
// Get messages up to and including the specified message
⋮----
// Save forked messages into new task
⋮----
// Copy worktree if exists
⋮----
async agentProfileUpdated(oldProfile: AgentProfile, newProfile: AgentProfile)
⋮----
public getProject(): Project
⋮----
public isInitialized()

================
File: src/main/telemetry/index.ts
================


================
File: src/main/telemetry/langfuse.ts
================
import { LangfuseExporter } from 'langfuse-vercel';
⋮----
import type { SpanExporter } from '@opentelemetry/sdk-trace-base';
import type { SettingsData } from '@common/types';
⋮----
import { getEffectiveEnvironmentVariable } from '@/utils/environment';
import logger from '@/logger';
⋮----
export const initializeLangfuseExporter = (): SpanExporter | undefined =>
⋮----
export const getLangfuseEnvironmentVariables = (baseDir: string, settings: SettingsData): Record<string, unknown> =>

================
File: src/main/telemetry/open-telemetry.ts
================
import { NodeSDK } from '@opentelemetry/sdk-node';
import { getNodeAutoInstrumentations } from '@opentelemetry/auto-instrumentations-node';
⋮----
import { initializeLangfuseExporter } from './langfuse';
⋮----
import type { SpanExporter } from '@opentelemetry/sdk-trace-base';
⋮----
import logger from '@/logger';
⋮----
// Graceful shutdown

================
File: src/main/telemetry/telemetry-manager.ts
================
import { PostHog } from 'posthog-node';
import { AgentProfile, Mode, SettingsData, TaskData } from '@common/types';
⋮----
import { Store } from '@/store';
import logger from '@/logger';
import { POSTHOG_PUBLIC_API_KEY, POSTHOG_HOST } from '@/constants';
import { getElectronApp } from '@/app';
⋮----
export class TelemetryManager
⋮----
constructor(store: Store)
⋮----
settingsChanged(oldSettings: SettingsData, newSettings: SettingsData)
⋮----
async init(): Promise<void>
⋮----
async destroy(): Promise<void>
⋮----
captureProjectOpened(openedProjectsCount: number)
⋮----
captureProjectClosed(closedProjectsCount: number)
⋮----
captureRunPrompt(mode?: Mode)
⋮----
captureAgentRun(profile: AgentProfile, task?: TaskData)
⋮----
captureCustomCommand(commandName: string, argsCount: number, mode: Mode)
⋮----
captureTerminalCreated()

================
File: src/main/terminal/index.ts
================


================
File: src/main/terminal/terminal-manager.ts
================
import { v4 as uuidv4 } from 'uuid';
⋮----
import logger from '@/logger';
import { TelemetryManager } from '@/telemetry';
import { EventManager } from '@/events';
import { WorktreeManager } from '@/worktrees/worktree-manager';
⋮----
export interface TerminalInstance {
  id: string;
  baseDir: string;
  taskId: string;
  ptyProcess: pty.IPty;
  cols: number;
  rows: number;
}
⋮----
export class TerminalManager
⋮----
constructor(
⋮----
private getShellCommand(): string
⋮----
// Try PowerShell first, fallback to cmd
⋮----
// Unix-like systems (Linux, macOS)
⋮----
private getShellArgs(): string[]
⋮----
public async createTerminal(baseDir: string, taskId: string, cols: number = 80, rows: number = 24): Promise<string>
⋮----
// Handle data from terminal
⋮----
// Handle terminal exit
⋮----
// Capture telemetry event for terminal creation
⋮----
public writeToTerminal(terminalId: string, data: string): boolean
⋮----
public resizeTerminal(terminalId: string, cols: number, rows: number): boolean
⋮----
public closeTerminal(terminalId: string): boolean
⋮----
public closeTerminalForProject(baseDir: string): void
⋮----
public getTerminalForTask(taskId: string): TerminalInstance | undefined
⋮----
public getTerminalsForTask(taskId: string): TerminalInstance[]
⋮----
public close(): void

================
File: src/main/utils/environment.ts
================
import fs from 'fs';
import path from 'path';
⋮----
import { parse } from '@dotenvx/dotenvx';
import YAML from 'yaml';
import { DEFAULT_AGENT_PROFILE, DEFAULT_AIDER_MAIN_MODEL, DEFAULT_PROVIDER_MODELS } from '@common/agent';
import { EnvironmentVariable, Model, ProjectSettings, ProviderProfile, SettingsData } from '@common/types';
⋮----
import logger from '@/logger';
import { getLangfuseEnvironmentVariables } from '@/telemetry';
import { Store } from '@/store';
⋮----
const readEnvFile = (filePath: string): Record<string, string> | null =>
⋮----
const readPropertyFromConfFile = (filePath: string, property: string): string | undefined =>
⋮----
const readApiKeyFromConfFile = (filePath: string, envVarName: string): string | undefined =>
⋮----
// Map environment variable names to provider names used in api-key property
// GOOGLE_API_KEY maps to 'gemini' in the api-key property
⋮----
// Normalize apiKeyValue to array for unified processing
⋮----
export const getEffectiveEnvironmentVariable = (key: string, settings?: SettingsData, projectDir?: string): EnvironmentVariable | undefined =>
⋮----
// 1. From settings.aider.environmentVariables
⋮----
// 2. From --env-file in settings.aider.options
⋮----
// 3. from `env-file` in $projectDir/.aider.conf.yml
⋮----
// 4. from $projectDir/.env
⋮----
// 5. from api-key property in $projectDir/.aider.conf.yml
⋮----
// 6. from kebab-case property in $projectDir/.aider.conf.yml
⋮----
// Home dir related checks
⋮----
// 7. from `env-file` in $HOME/.aider.conf.yml
⋮----
// 8. from $HOME/.env
⋮----
// 9. from api-key property in $HOME/.aider.conf.yml
⋮----
// 10. from kebab-case property in $HOME/.aider.conf.yml
⋮----
// 11. From process.env
⋮----
// Not found
⋮----
export const parseAiderEnv = (settings: SettingsData): Record<string, string> =>
⋮----
// Parse Aider environment variables from settings
⋮----
// Check for --env or --env-file in aider options
⋮----
...aiderEnvVars, // Start with settings env
...(fileEnv ?? {}), // Override with file env if it exists
⋮----
export const readAiderConfProperty = (baseDir: string, property: string): string | undefined =>
⋮----
export const determineWeakModel = (baseDir: string): string | undefined =>
⋮----
export const determineMainModel = (settings: SettingsData, providers: ProviderProfile[], providerModels: Model[], baseDir: string): string =>
⋮----
// Check for --model in aider options
⋮----
// Default model if no other condition is met
⋮----
export const getEnvironmentVariablesForAider = (settings: SettingsData, baseDir: string): Record<string, unknown> =>
⋮----
const getTelemetryEnvironmentVariablesForAider = (settings: SettingsData, baseDir: string): Record<string, unknown> =>
⋮----
export const getDefaultProjectSettings = (
  store: Store,
  providerModels: Model[],
  baseDir: string,
  defaultAgentProfileId = DEFAULT_AGENT_PROFILE.id,
): ProjectSettings =>

================
File: src/main/utils/errors.ts
================
/**
 * Utility functions for error handling
 */
⋮----
/**
 * Checks if an error is an AbortError (operation was cancelled)
 * In Node.js, AbortError has name === 'AbortError' and code === 'ABORT_ERR'
 */
export const isAbortError = (error: unknown): boolean =>
⋮----
/**
 * Checks if an error is a file not found error (ENOENT)
 */
export const isFileNotFoundError = (error: unknown): boolean =>

================
File: src/main/utils/file-system.ts
================
import { simpleGit } from 'simple-git';
import filenamifyImport from 'filenamify';
import slugify from 'slugify';
import { glob } from 'glob';
⋮----
import logger from '@/logger';
// @ts-expect-error filenamify is not typed properly
⋮----
export const getFilePathSuggestions = async (currentPath: string, directoriesOnly = false): Promise<string[]> =>
⋮----
// Extract directory and search pattern
⋮----
// Fallback to parent directory if current doesn't exist
⋮----
// Ensure dirPath is a directory
⋮----
// Get directory contents
⋮----
// Filter entries based on type and search pattern
⋮----
export const isProjectPath = async (path: string): Promise<boolean> =>
⋮----
export const isValidPath = async (baseDir: string, filePath: string): Promise<boolean> =>
⋮----
export const isDirectory = async (path: string): Promise<boolean> =>
⋮----
export const isFileIgnored = async (projectBaseDir: string, filePath: string): Promise<boolean> =>
⋮----
// Make the path relative to the base directory for git check-ignore
⋮----
export const filterIgnoredFiles = async (projectBaseDir: string, filePaths: string[]): Promise<string[]> =>
⋮----
// Convert all file paths to relative paths for git check-ignore
⋮----
// Process files in chunks of max 100
⋮----
// Return only files that are not ignored
⋮----
// Return all files if git check fails (safer default)
⋮----
const isGitRepository = async (baseDir: string): Promise<boolean> =>
⋮----
const getAllFilesFromFS = async (baseDir: string, ignore: string[] = []): Promise<string[]> =>
⋮----
// Convert to relative paths
⋮----
const getIgnoreGlobPatterns = async (gitignorePath: string): Promise<string[]> =>
⋮----
// ignore
⋮----
export const getAllFiles = async (baseDir: string, useGit = true): Promise<string[]> =>
⋮----
// Try to use git first
⋮----
// use filesystem when useGit is false or git fails
⋮----
// If it's a git repo, filter out ignored files
⋮----
export const deriveDirName = (name: string, existingDirNames: Set<string>): string =>
⋮----
// First slugify the name to create a clean URL-friendly slug
⋮----
strict: true, // remove special characters except for hyphens and underscores
trim: true, // trim leading and trailing whitespace
⋮----
// Then filenamify to ensure it's safe as a directory name across all platforms
⋮----
replacement: '-', // use hyphens as replacement for invalid characters
maxLength: 100, // reasonable length limit
⋮----
/**
 * Validate if a file path is potentially valid for the current project
 *
 * @param filePath - File path to validate
 * @param taskDir - Task directory to check against
 * @returns True if file path could be valid for project
 */
export const isValidProjectFile = (filePath: string, taskDir: string): boolean =>
⋮----
// Convert to absolute path for validation
⋮----
// Check if resolved path is still within task directory

================
File: src/main/utils/index.ts
================


================
File: src/main/utils/mutex.ts
================
import logger from '@/logger';
⋮----
/**
 * A simple async mutex implementation for preventing race conditions
 * in critical sections of code. Supports named locks and timeouts.
 */
export class Mutex
⋮----
private defaultTimeout = 30000; // 30 seconds
⋮----
/**
   * Acquire a lock for the given resource name
   * @param resourceName - Unique name for the resource to lock
   * @param timeout - Optional timeout in milliseconds (default: 30 seconds)
   * @returns Promise<() => void> - Release function to unlock the resource
   */
async acquire(resourceName: string, timeout: number = this.defaultTimeout): Promise<() => void>
⋮----
// If there's already a lock for this resource, wait for it
⋮----
// Create a new lock promise
⋮----
// Store the lock
⋮----
// Return the release function
⋮----
/**
   * Execute a function with a mutex lock
   * @param resourceName - Unique name for the resource to lock
   * @param fn - Function to execute while holding the lock
   * @param timeout - Optional timeout in milliseconds
   * @returns Promise<T> - Result of the function execution
   */
async withLock<T>(resourceName: string, fn: () => Promise<T> | T, timeout?: number): Promise<T>
⋮----
/**
   * Check if a resource is currently locked
   * @param resourceName - Name of the resource to check
   * @returns boolean - True if the resource is locked
   */
isLocked(resourceName: string): boolean
⋮----
/**
   * Get the current number of active locks
   * @returns number - Number of active locks
   */
getActiveLockCount(): number
⋮----
/**
   * Get all currently locked resource names
   * @returns string[] - Array of locked resource names
   */
getLockedResources(): string[]
⋮----
/**
   * Force release all locks (use with caution)
   */
releaseAll(): void
⋮----
// Global mutex instance for the application
⋮----
/**
 * Convenience function to execute code with a named lock
 * @param resourceName - Unique name for the resource to lock
 * @param fn - Function to execute while holding the lock
 * @param timeout - Optional timeout in milliseconds
 * @returns Promise<T> - Result of the function execution
 */
export const withLock = async <T>(resourceName: string, fn: ()
⋮----
/**
 * Convenience function to acquire a named lock
 * @param resourceName - Unique name for the resource to lock
 * @param timeout - Optional timeout in milliseconds
 * @returns Promise<() => void> - Release function to unlock the resource
 */
export const acquireLock = async (resourceName: string, timeout?: number): Promise<()
⋮----
/**
 * Check if a resource is currently locked
 * @param resourceName - Name of the resource to check
 * @returns boolean - True if the resource is locked
 */
export const isLocked = (resourceName: string): boolean

================
File: src/main/utils/python.ts
================
import path from 'path';
import { exec } from 'child_process';
import { promisify } from 'util';
⋮----
import { PYTHON_COMMAND, PYTHON_VENV_DIR, UV_EXECUTABLE } from '@/constants';
import logger from '@/logger';
⋮----
export const getPythonVenvBinPath = (): string =>
⋮----
/**
 * Gets the currently installed version of a Python library within the virtual environment.
 * @param library The name of the Python library.
 * @returns The version string or null if not found or an error occurs.
 */
export const getCurrentPythonLibVersion = async (library: string): Promise<string | null> =>
⋮----
// Log error but return null as expected for 'not found' or other issues
⋮----
/**
 * Gets the latest available version of a Python library from the pip index.
 * @param library The name of the Python library.
 * @returns The latest version string or null if not found or an error occurs.
 */
export const getLatestPythonLibVersion = async (library: string): Promise<string | null> =>

================
File: src/main/utils/shell.ts
================
import { exec, execSync } from 'child_process';
⋮----
import { promisify } from 'util';
⋮----
import logger from '@/logger';
import { getElectronApp } from '@/app';
⋮----
interface ShellInfo {
  path: string;
  name: string;
  args?: string[];
}
⋮----
class ShellDetector
⋮----
/**
   * Get the user's default shell
   * @param forceRefresh Force re-detection instead of using cache
   * @returns Shell information including path and name
   */
static getDefaultShell(forceRefresh = false): ShellInfo
⋮----
private static detectShell(): ShellInfo
⋮----
private static detectWindowsShell(): ShellInfo
⋮----
// Check for PowerShell Core first
⋮----
// Check for Windows PowerShell
⋮----
// Fall back to cmd.exe
⋮----
// Last resort
⋮----
private static detectUnixShell(): ShellInfo
⋮----
// First, try the SHELL environment variable
⋮----
// On macOS, try to get the default shell from Directory Services
⋮----
// Ignore errors and continue with fallback detection
⋮----
// Try to read from /etc/passwd
⋮----
// Ignore errors and continue with fallback detection
⋮----
// Try common shell paths in order of preference
⋮----
// Last resort - use sh
⋮----
private static findExecutable(name: string): string | null
⋮----
// Not executable, continue searching
⋮----
private static getShellArgs(shellName: string): string[]
⋮----
// Return appropriate arguments for interactive shell sessions
⋮----
return ['-i']; // Interactive mode
⋮----
return ['-NoExit']; // Keep PowerShell open
⋮----
/**
   * Get shell-specific command execution arguments
   * @param command The command to execute
   * @returns Array of arguments to pass to spawn/exec
   */
static getShellCommandArgs(command: string):
⋮----
// Unix shells
⋮----
/**
   * Check if a shell exists at the given path
   * @param shellPath Path to the shell executable
   * @returns true if the shell exists and is executable
   */
static isShellAvailable(shellPath: string): boolean
⋮----
/**
 * Get the path separator for the current platform
 */
const getPathSeparator = (): string
⋮----
/**
 * Get the user's shell PATH by executing their shell
 */
export const getShellPath = (): string =>
⋮----
// In packaged apps, always refresh PATH on first call to avoid cached restricted PATH
⋮----
// On Windows, use cmd.exe to get PATH
⋮----
// Also try to get PATH from PowerShell for more complete results
⋮----
// Combine both paths
⋮----
// PowerShell might not be available, continue with cmd.exe result
⋮----
// Unix/macOS logic - use ShellDetector to get the actual shell
⋮----
// For Linux, avoid slow interactive shell startup
// Use non-interactive mode for better performance
⋮----
? `${shell} -c 'echo $PATH'` // Fast non-interactive mode for Linux
: `${shell} -l -i -c 'echo $PATH'`; // Keep login shell for macOS
⋮----
// Execute the command to get the PATH
// For packaged apps, ALWAYS use login shell to get the user's real PATH
⋮----
// Use minimal base PATH - just enough to find the shell
⋮----
// Use login shell to load user's full environment
⋮----
// First try with explicit sourcing of shell config files
⋮----
// For zsh, source the standard config files
⋮----
// For bash, source the standard config files
⋮----
timeout: isLinux ? 3000 : 10000, // Shorter timeout for Linux
⋮----
// Add ZDOTDIR for zsh users who might have custom config location
⋮----
// Try the standard login shell approach
⋮----
timeout: isLinux ? 3000 : 10000, // Shorter timeout for Linux
⋮----
// Fallback to current PATH + common locations
⋮----
// In development, try faster approach first
⋮----
timeout: isLinux ? 3000 : 10000, // Shorter timeout for Linux
⋮----
// Combine with current process PATH to ensure we don't lose anything
⋮----
// Also include npm global bin directories
⋮----
// Skip npm/yarn checks on Linux for better performance (they're usually in PATH already)
⋮----
// Try to get npm global bin directory
⋮----
// Ignore npm bin errors
⋮----
// Try to get yarn global bin directory
⋮----
// Ignore yarn bin errors
⋮----
// Windows-specific paths
⋮----
// Check for nvm-windows
⋮----
// Check for nvm-windows symlink
⋮----
// Unix/macOS-specific paths
⋮----
// Linux-specific common paths
⋮----
// Only add Linux paths that exist and aren't already in PATH
⋮----
// Check for nvm directories - look for all versions
⋮----
// Ignore nvm directory read errors
⋮----
// Try alternative method: read shell config files directly (Unix/macOS only)
⋮----
// Look for PATH exports
⋮----
// Expand $PATH references
⋮----
// Final fallback to process PATH
⋮----
/**
 * Find an executable in the shell PATH
 */
export const findExecutableInPath = (executable: string, checkOnly = false): string | null =>
⋮----
// On Windows, executables might have .exe, .cmd, or .bat extensions
⋮----
// On Windows, check if file exists
⋮----
// On Unix, check if the executable exists and is executable
⋮----
// Not found in this directory
⋮----
// Wrapper for execAsync that includes enhanced PATH
export const execWithShellPath = async (command: string, options?:

================
File: src/main/utils/web-scrapper.ts
================
import Turndown from 'turndown';
⋮----
import type { BrowserWindow as BrowserWindowType } from 'electron';
⋮----
import { isAbortError } from '@/utils/errors';
import { isElectron } from '@/app';
⋮----
type WebScrapeFormat = 'markdown' | 'html' | 'raw';
⋮----
export class WebScraper
⋮----
async scrape(url: string, timeout: number = 60000, abortSignal?: AbortSignal, format: WebScrapeFormat = 'markdown'): Promise<string>
⋮----
private async scrapeWithBrowserWindow(
    url: string,
    timeout: number = 60000,
    abortSignal?: AbortSignal,
    format: WebScrapeFormat = 'markdown',
): Promise<string>
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
// Create hidden BrowserWindow for scraping
⋮----
// Create timeout promise
⋮----
// Create abort promise if signal is provided
⋮----
// Load the URL with timeout and abort signal
⋮----
// Wait for page to load completely with timeout and abort signal
⋮----
// Get page content with timeout and abort signal
⋮----
// Get content type from headers with timeout and abort signal
⋮----
// If it's HTML, convert to markdown-like text or return HTML based on format
⋮----
// Cleanup window
⋮----
private async waitForPageLoad(window: BrowserWindowType): Promise<void>
⋮----
const checkLoadState = () =>
⋮----
// Additional wait for dynamic content to load
⋮----
private async getContentType(window: BrowserWindowType): Promise<string>
⋮----
private async cleanupWindow(window: BrowserWindowType): Promise<void>
⋮----
private async scrapeWithFetch(url: string, timeout: number = 60000, abortSignal?: AbortSignal): Promise<string>
⋮----
// If it's HTML, return the text content
⋮----
// For other content types, return as text
⋮----
private looksLikeHTML(content: string): boolean
⋮----
private cleanHtml(content: string): string
⋮----
// Remove comments
⋮----
private htmlToMarkDown(content: string): string
⋮----
export const scrapeWeb = async (url: string, timeout: number = 60000, abortSignal?: AbortSignal, format: WebScrapeFormat = 'markdown') =>

================
File: src/main/versions/index.ts
================


================
File: src/main/versions/versions-manager.ts
================
import path from 'path';
⋮----
import { VersionsInfo } from '@common/types';
⋮----
import { getCurrentPythonLibVersion, getLatestPythonLibVersion } from '@/utils';
import logger from '@/logger';
import { Store } from '@/store';
import { EventManager } from '@/events';
import { getElectronApp, isDev } from '@/app';
⋮----
export class VersionsManager
⋮----
private readonly checkInterval = 10 * 60 * 1000; // 10 minutes
⋮----
constructor(
    private readonly eventManager: EventManager,
    private readonly store: Store,
)
⋮----
async getVersions(forceRefresh = false): Promise<VersionsInfo>
⋮----
// Get AiderDesk version using app.getVersion()
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
// Get current and available Aider versions using utility functions
⋮----
// Don't show error box for this common case
⋮----
// Check if auto-update is enabled and a new version was found
⋮----
return this.versionsInfo!; // versionsInfo is guaranteed to be non-null after updateVersionsInfo
⋮----
private updateVersionsInfo(partialInfo: Partial<VersionsInfo>): void
⋮----
private async init(): Promise<void>
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
autoUpdater.autoInstallOnAppQuit = true; // Install on quit after download
⋮----
// Schedule periodic checks
⋮----
// Initial check
⋮----
public destroy(): void
⋮----
public async downloadLatestAiderDesk(): Promise<void>
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
// Check for updates first to ensure we have the latest info
⋮----
// Set autoDownload to true temporarily for this download action
⋮----
// Reset autoDownload back to false after initiating
⋮----
autoUpdater.autoDownload = false; // Ensure it's reset on error

================
File: src/main/voice/index.ts
================
// Voice functionality is now handled directly by LlmProviderStrategy

================
File: src/main/voice/VoiceService.ts
================
// This file has been removed as voice functionality is now handled directly by LlmProviderStrategy

================
File: src/main/worktrees/index.ts
================


================
File: src/main/worktrees/worktree-manager.ts
================
import path, { join } from 'path';
import fs, { mkdir, rm, lstat, symlink } from 'fs/promises';
import { existsSync } from 'fs';
⋮----
import { ConflictResolutionFileContext, MergeState, RebaseState, UpdatedFile, Worktree, WorktreeAheadCommits, WorktreeUncommittedFiles } from '@common/types';
⋮----
import { execWithShellPath, withLock } from '@/utils';
import { AIDER_DESK_TASKS_DIR } from '@/constants';
import logger from '@/logger';
⋮----
export class GitError extends Error
⋮----
getErrorDetails()
⋮----
// Interface for raw commit data
interface RawCommitData {
  hash: string;
  message: string;
  date: string | Date;
  author?: string;
  additions?: number;
  deletions?: number;
  filesChanged?: number;
}
⋮----
export class WorktreeManager
⋮----
private getWorktreePath(projectPath: string, taskId: string): string
⋮----
private async initializeWorktree(projectPath: string, taskId: string): Promise<void>
⋮----
async createWorktree(projectPath: string, taskId: string, branch?: string, baseBranch = 'HEAD'): Promise<Worktree>
⋮----
// 1. Initialize repository if necessary
⋮----
// Initialize git repository
⋮----
// 2. Clean up any existing worktree directory first
⋮----
// Ignore cleanup errors
⋮----
// 3. Ensure the repository has at least one commit
⋮----
// Repository has no commits yet, create initial commit
⋮----
// Ignore add errors (no files to add)
⋮----
// 4. Logic for creating the worktree
⋮----
const baseRef = baseBranch; // Will be 'HEAD' if not provided
⋮----
// A. Branch name provided: Check if branch exists or create it
⋮----
// Check if it's an actual branch (not just a commit SHA)
⋮----
// Branch doesn't exist
⋮----
// A1. Use existing branch
⋮----
// Get the base commit (the tip of the existing branch)
⋮----
// A2. Create new branch from baseRef (which defaults to 'HEAD')
⋮----
// Verify that the base branch exists if specified and is a branch name
⋮----
// Capture the base commit before creating the worktree
⋮----
// Create the new branch and checkout the worktree
⋮----
actualBaseBranch = branch; // Use the newly created branch name
⋮----
// B. No branch name provided: Create detached worktree from current HEAD (or specified baseRef)
⋮----
// Note: git worktree add <path> defaults to current HEAD
⋮----
// Capture the base commit (the commit it's detached at)
⋮----
// Use the baseRef for the branch name, or resolve the current branch if baseRef is 'HEAD'
⋮----
async createSymlinks(projectPath: string, worktreePath: string, folderNames: string[]): Promise<void>
⋮----
private async existsAndIsDirectory(path: string): Promise<boolean>
⋮----
private async isFolderTrackedByGit(projectPath: string, folderName: string): Promise<boolean>
⋮----
async removeWorktree(projectDir: string, worktree: Worktree): Promise<void>
⋮----
// Clean up the branch if it's a task branch (starts with "task-" or looks like generated from task name)
⋮----
// Branch might not exist or be protected, don't fail the removal
⋮----
// If the worktree is not found, that's okay - it might have been manually deleted
⋮----
// For other errors, still throw
⋮----
async listWorktrees(projectDir: string): Promise<Worktree[]>
⋮----
async listBranches(projectPath: string): Promise<Array<
⋮----
// Get all local branches
⋮----
// Get all worktrees to identify which branches have worktrees
⋮----
// Remove leading *, +, and spaces. The + indicates uncommitted changes
⋮----
// Sort branches: worktree branches first, then the rest
⋮----
// Within each group, sort alphabetically
⋮----
async getProjectMainBranch(projectPath: string): Promise<string>
⋮----
// ONLY check the current branch in the project root directory
⋮----
// Throw error if we're in detached HEAD state
⋮----
// Deprecated: Use getProjectMainBranch instead
async detectMainBranch(projectPath: string): Promise<string>
⋮----
// Deprecated: Use getProjectMainBranch instead
async getEffectiveMainBranch(project:
⋮----
async hasChangesToRebase(worktreePath: string, mainBranch: string): Promise<boolean>
⋮----
// Check if main branch has commits that the current branch doesn't have
// Use cross-platform approach
⋮----
// Error checking, assume no changes
⋮----
async checkForRebaseConflicts(
    worktreePath: string,
    mainBranch: string,
): Promise<
⋮----
// First check if there are any changes to rebase
⋮----
// Get the merge base
⋮----
// Try a dry-run merge to detect conflicts
// We use merge-tree to check for conflicts without modifying the working tree
⋮----
// Parse merge-tree output for conflicts
⋮----
// Get list of files that would conflict
⋮----
// Find files modified in both branches
⋮----
// Get commit info for better error reporting
⋮----
// If merge-tree is not available (older git), fall back to checking modified files
⋮----
// Get files changed in both branches
⋮----
// Find files modified in both branches (potential conflicts)
⋮----
// Get commit info
⋮----
// On error, return unknown status
⋮----
async rebaseMainIntoWorktree(
    worktreePath: string,
    mainBranch: string,
): Promise<
⋮----
// 1. Check for uncommitted changes and create temporary commit if needed
⋮----
// Stage all changes
⋮----
// Create temporary commit with unique timestamp
⋮----
// 2. Rebase the current worktree branch onto local main branch
⋮----
// 3. If rebase succeeds AND we had uncommitted changes, reset to uncommitted state
⋮----
// Create detailed error with git command output
⋮----
async abortRebase(worktreePath: string): Promise<void>
⋮----
// Check if we're in the middle of a rebase
⋮----
// Abort the rebase
⋮----
// Always try to reset temporary commit if it exists
⋮----
async continueRebase(worktreePath: string): Promise<void>
⋮----
// Always try to reset temporary commit if it exists after successful continue
⋮----
private async squashAndMergeWorktreeToMain(projectPath: string, worktreePath: string, mainBranch: string, commitMessage: string): Promise<void>
⋮----
// Get current branch name in worktree (for logging purposes)
⋮----
// Check if there are any changes to merge (before rebase)
⋮----
// SAFETY CHECK 1: Rebase worktree onto main FIRST before squashing
⋮----
// If rebase fails, abort it in the worktree
⋮----
// Ignore abort errors
⋮----
// Get the HEAD commit hash from worktree AFTER rebase (but before squashing)
// This preserves the worktree's commit history
⋮----
// Switch to main branch in the main repository
⋮----
// SQUASH MERGE: Use git merge --squash to create a squashed staging of all changes
// This keeps the worktree branch history intact while creating a single commit in main
⋮----
// Check if there are staged changes to commit
⋮----
// Commit the squashed changes with the provided message
⋮----
// Create detailed error with git command output
⋮----
// Prioritize actual error messages over lastOutput (which may contain unrelated data like commit counts)
⋮----
private async mergeWorktreeToMain(projectPath: string, worktreePath: string, mainBranch: string): Promise<void>
⋮----
// Get current branch name in worktree (for logging purposes)
⋮----
// Check if there are any changes to merge
⋮----
// SAFETY CHECK 1: Rebase worktree onto main FIRST (resolves conflicts in worktree, not main)
⋮----
// If rebase fails, abort it in the worktree
⋮----
// Ignore abort errors
⋮----
// Get the HEAD commit hash from worktree AFTER rebase
⋮----
// Switch to main branch in the main repository
⋮----
// SAFETY CHECK 2: Use --ff-only merge to prevent history rewriting
// This will fail if local main has diverged from the worktree branch
⋮----
// Create detailed error with git command output
⋮----
// Prioritize actual error messages over lastOutput (which may contain unrelated data like commit counts)
⋮----
generateRebaseCommands(mainBranch: string): string[]
⋮----
generateSquashCommands(mainBranch: string, branchName: string): string[]
⋮----
generateMergeCommands(mainBranch: string, branchName: string): string[]
⋮----
async gitPull(worktreePath: string): Promise<
⋮----
async gitPush(worktreePath: string): Promise<
⋮----
async getLastCommits(worktreePath: string, count: number = 20): Promise<RawCommitData[]>
⋮----
async getChangesDiff(projectPath: string, worktreePath: string, targetBranch?: string): Promise<string>
⋮----
// Check if there are any commits in worktree that are not in main
⋮----
// No commits in worktree, return empty string
⋮----
// Get the first commit hash in the worktree branch (oldest commit not in main)
⋮----
// Get full diff from the commit before the oldest worktree commit to HEAD
⋮----
async getOriginBranch(worktreePath: string, branch: string): Promise<string | null>
⋮----
async getTaskWorktree(projectPath: string, taskId: string): Promise<Worktree | null>
⋮----
// Find worktree that matches our task's worktree path
⋮----
// If no worktree exists for this task, return null
⋮----
/**
   * Check if there are uncommitted changes in the given path
   */
async hasUncommittedChanges(path: string): Promise<boolean>
⋮----
/**
   * Stash uncommitted changes with a unique identifier
   * Returns the stash identifier or null if no changes to stash
   */
async stashUncommittedChanges(stashId: string, path: string, message: string, symlinkFolders: string[] = []): Promise<string | null>
⋮----
// Find which symlink folders have untracked files
⋮----
// Get untracked files to check which symlink folders have content
⋮----
// Check if folder has untracked files
⋮----
// Build stash command with exclude patterns for folders with untracked files
⋮----
/**
   * Apply a stash by its identifier
   */
async applyStash(path: string, stashId: string): Promise<void>
⋮----
// Find the stash entry that matches our identifier
⋮----
// Extract stash reference (e.g., "stash@{0}")
⋮----
/**
   * Drop a stash by its identifier
   */
async dropStash(path: string, stashId: string): Promise<void>
⋮----
// Find the stash entry that matches our identifier
⋮----
// Extract stash reference (e.g., "stash@{0}")
⋮----
// Don't throw - dropping stash is not critical
⋮----
/**
   * Merge worktree to main branch with uncommitted changes support
   * Returns MergeState for potential revert
   */
async mergeWorktreeToMainWithUncommitted(
    projectPath: string,
    taskId: string,
    worktreePath: string,
    squash: boolean,
    commitMessage?: string,
    targetBranch?: string,
    symlinkFolders: string[] = [],
): Promise<MergeState>
⋮----
// 1. Track initial state
⋮----
// 2. Stash uncommitted changes in worktree
⋮----
// 3. Stash uncommitted changes in main branch if any
⋮----
// 4. Perform the merge operation (existing methods handle the actual merge)
⋮----
// 5. Apply worktree stash to both branches (keeping changes uncommitted)
⋮----
// Drop the worktree stash after successful application
⋮----
// 6. Restore main branch's original uncommitted changes if any
// DO NOT drop this stash - we need it for potential revert
⋮----
// Return merge state for potential revert
⋮----
// Recovery: try to restore stashes
⋮----
/**
   * Check if worktree has uncommitted changes or unmerged commits
   * Returns information about unsaved work in the worktree
   */
async checkWorktreeForUnmergedWork(
    projectPath: string,
    worktreePath: string,
    targetBranch?: string,
): Promise<
⋮----
// 1. Check for uncommitted changes
⋮----
// 2. Get the target branch name
⋮----
// 3. Check for commits in worktree that are not in target branch
⋮----
// If we can't get commits, log but don't fail
⋮----
// On error, return safe defaults (assume there might be work)
⋮----
async getAheadCommits(worktreePath: string, targetBranch: string): Promise<WorktreeAheadCommits>
⋮----
async getUncommittedFiles(worktreePath: string): Promise<WorktreeUncommittedFiles>
⋮----
/**
   * Get updated files with line diff stats from git
   * Uses `git diff --numstat HEAD` to get additions and deletions per file
   * Format: "additions\tdeletions\tfilepath"
   * Also fetches the full git diff for each file
   */
async getUpdatedFiles(worktreePath: string): Promise<UpdatedFile[]>
⋮----
const filePath = parts.slice(2).join('\t'); // Handle paths with tabs
⋮----
// Fetch git diff for this file
⋮----
// If diff fetch fails, continue with empty diff
⋮----
// If git diff fails (e.g., no HEAD commit), return empty array
⋮----
async getRebaseState(worktreePath: string): Promise<RebaseState>
⋮----
// ignore
⋮----
// ignore
⋮----
async getUnmergedFiles(worktreePath: string): Promise<string[]>
⋮----
async getStageFileContent(worktreePath: string, stage: 1 | 2 | 3, filePath: string): Promise<string | null>
⋮----
async collectConflictContext(worktreePath: string, filePath: string): Promise<ConflictResolutionFileContext>
⋮----
/**
   * Reset a temporary commit back to uncommitted changes state
   */
private async resetTempCommit(worktreePath: string): Promise<void>
⋮----
/**
   * Reset temporary commit if it exists by finding it by name pattern
   */
private async resetTempCommitIfExists(worktreePath: string): Promise<void>
⋮----
// Check if HEAD is a temporary commit
⋮----
// Don't throw - this is cleanup logic
⋮----
async stageResolvedFile(worktreePath: string, filePath: string, content: string): Promise<void>
⋮----
async listConflictedFiles(worktreePath: string): Promise<string[]>
⋮----
/**
   * Apply uncommitted changes from worktree to main branch without merging commits
   * This transfers work-in-progress changes while keeping them uncommitted in both branches
   */
async applyUncommittedChangesToMain(
    projectPath: string,
    taskId: string,
    worktreePath: string,
    targetBranch?: string,
    symlinkFolders: string[] = [],
): Promise<void>
⋮----
// 1. Check if there are uncommitted changes in worktree
⋮----
// 2. Stash uncommitted changes from worktree
⋮----
// 3. Switch main repo to target branch
⋮----
// 4. Apply stash to target branch (keeping uncommitted)
⋮----
// 5. Apply stash back to worktree (keeping uncommitted)
⋮----
// 6. Clean up stash
⋮----
// Recovery: try to restore stash to worktree
⋮----
/**
   * Revert a merge operation using the stored MergeState
   * Restores the main branch to its pre-merge state while preserving uncommitted changes
   */
async revertMerge(projectPath: string, taskId: string, worktreePath: string, mergeState: MergeState, symlinkFolders: string[] = []): Promise<void>
⋮----
// 1. Stash current uncommitted changes in worktree
⋮----
// 2. Stash current uncommitted changes in main repo to clean the working directory
// This is crucial to avoid conflicts with untracked files when applying the original stash
⋮----
// 3. Switch to the branch we merged into, then reset it to previous state
⋮----
// 4. Reset worktree branch to previous state
⋮----
// 5. Restore main's original uncommitted changes if they were preserved
⋮----
// Clean up the stash after successful revert
⋮----
// 6. Restore uncommitted changes in worktree
⋮----
// 7. Clean up temporary main stash
// We don't apply it back because we want to revert to the state BEFORE the merge (with original changes)
// Applying it back would re-introduce the changes that were just merged
⋮----
// Recovery: try to restore stashes
⋮----
private async pruneDeleted(projectDir: string): Promise<void>
⋮----
// in case of failure, try to remove the directory manually
⋮----
async close(projectDir: string)

================
File: src/main/app.ts
================
import type { App } from 'electron';
⋮----
export const isElectron = (): boolean =>
⋮----
export const getElectronApp = (): App | null =>
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
export const isDev = (): boolean =>
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports

================
File: src/main/constants.ts
================
import path from 'path';
import { homedir } from 'os';
⋮----
import { getDataDir, getResourceDir } from './paths';
⋮----
// constants for project directory files

================
File: src/main/events-handler.ts
================
import path from 'path';
import fs from 'fs/promises';
⋮----
import {
  AgentProfile,
  CloudflareTunnelStatus,
  CreateTaskParams,
  CustomCommand,
  EditFormat,
  EnvironmentVariable,
  FileEdit,
  McpServerConfig,
  McpTool,
  MemoryEntry,
  Mode,
  Model,
  OS,
  ProjectData,
  ProjectSettings,
  ProviderModelsData,
  ProviderProfile,
  ResponseCompletedData,
  SettingsData,
  TaskData,
  TaskStateData,
  TodoItem,
  UpdatedFile,
  UsageDataRow,
  VersionsInfo,
  VoiceSession,
  WorkflowExecutionResult,
} from '@common/types';
import { normalizeBaseDir } from '@common/utils';
⋮----
import type { BmadStatus, InstallResult } from '@common/bmad-types';
import type { BrowserWindow } from 'electron';
⋮----
import { McpManager, AgentProfileManager } from '@/agent';
import { MemoryManager } from '@/memory/memory-manager';
import { ModelManager } from '@/models';
import { ProjectManager } from '@/project';
import { CloudflareTunnelManager } from '@/server';
import { Store } from '@/store';
import { TelemetryManager } from '@/telemetry';
import { VersionsManager } from '@/versions';
import { DataManager } from '@/data-manager';
import { TerminalManager } from '@/terminal/terminal-manager';
import logger from '@/logger';
import { getDefaultProjectSettings, getEffectiveEnvironmentVariable, getFilePathSuggestions, isProjectPath, isValidPath, scrapeWeb } from '@/utils';
import { AIDER_DESK_TMP_DIR, LOGS_DIR } from '@/constants';
import { EventManager } from '@/events';
import { isElectron } from '@/app';
⋮----
export class EventsHandler
⋮----
constructor(
⋮----
loadSettings(): SettingsData
⋮----
async saveSettings(newSettings: SettingsData): Promise<SettingsData>
⋮----
getProjectSettings(baseDir: string): ProjectSettings
⋮----
patchProjectSettings(baseDir: string, settings: Partial<ProjectSettings>): ProjectSettings
⋮----
async startProject(baseDir: string)
⋮----
async stopProject(baseDir: string): Promise<void>
⋮----
async restartProject(baseDir: string): Promise<void>
⋮----
async createVoiceSession(providerProfile: ProviderProfile): Promise<VoiceSession>
⋮----
async resetTask(baseDir: string, taskId: string): Promise<void>
⋮----
getOpenProjects(): ProjectData[]
⋮----
async addOpenProject(baseDir: string): Promise<ProjectData[]>
⋮----
removeOpenProject(baseDir: string): ProjectData[]
⋮----
// Set the last project as active if the current active project was removed
⋮----
async setActiveProject(baseDir: string): Promise<ProjectData[]>
⋮----
updateOpenProjectsOrder(baseDirs: string[]): ProjectData[]
⋮----
getRecentProjects(): string[]
⋮----
addRecentProject(baseDir: string): void
⋮----
removeRecentProject(baseDir: string): void
⋮----
interruptResponse(baseDir: string, taskId: string, interruptId?: string): void
⋮----
clearContext(baseDir: string, taskId: string, includeLastMessage = true): void
⋮----
async removeLastMessage(baseDir: string, taskId: string): Promise<void>
⋮----
async removeMessage(baseDir: string, taskId: string, messageId: string): Promise<void>
⋮----
async removeMessagesUpTo(baseDir: string, taskId: string, messageId: string): Promise<void>
⋮----
async redoLastUserPrompt(baseDir: string, taskId: string, mode: Mode, updatedPrompt?: string): Promise<void>
⋮----
async resumeTask(baseDir: string, taskId: string): Promise<void>
⋮----
async compactConversation(baseDir: string, taskId: string, mode: Mode, customInstructions?: string): Promise<void>
⋮----
async handoffConversation(baseDir: string, taskId: string, focus?: string): Promise<void>
⋮----
async loadInputHistory(baseDir: string): Promise<string[]>
⋮----
async getAddableFiles(baseDir: string, taskId: string, searchRegex?: string): Promise<string[]>
⋮----
async getAllFiles(baseDir: string, taskId: string, useGit = true): Promise<string[]>
⋮----
async getUpdatedFiles(baseDir: string, taskId: string): Promise<UpdatedFile[]>
⋮----
async addFile(baseDir: string, taskId: string, filePath: string, readOnly = false): Promise<void>
⋮----
dropFile(baseDir: string, taskId: string, filePath: string): void
⋮----
async pasteImage(baseDir: string, taskId: string, imageBuffer?: Buffer): Promise<void>
⋮----
applyEdits(baseDir: string, taskId: string, edits: FileEdit[]): void
⋮----
async runPrompt(baseDir: string, taskId: string, prompt: string, mode?: Mode): Promise<ResponseCompletedData[]>
⋮----
async savePrompt(baseDir: string, taskId: string, prompt: string): Promise<void>
⋮----
answerQuestion(baseDir: string, taskId: string, answer: string): void
⋮----
runCommand(baseDir: string, taskId: string, command: string): void
⋮----
async getCustomCommands(baseDir: string): Promise<CustomCommand[]>
⋮----
async runCustomCommand(baseDir: string, taskId: string, commandName: string, args: string[], mode: Mode): Promise<void>
⋮----
async updateMainModel(baseDir: string, taskId: string, mainModel: string): Promise<void>
⋮----
async updateWeakModel(baseDir: string, taskId: string, weakModel: string): Promise<void>
⋮----
async updateArchitectModel(baseDir: string, taskId: string, architectModel: string): Promise<void>
⋮----
updateEditFormats(baseDir: string, updatedFormats: Record<string, EditFormat>): void
⋮----
// Update just the current model's edit format while preserving others
⋮----
async loadMcpServerTools(serverName: string, config?: McpServerConfig): Promise<McpTool[] | string | null>
⋮----
async reloadMcpServers(mcpServers: Record<string, McpServerConfig>, force = false): Promise<void>
⋮----
async reloadMcpServer(serverName: string, config: McpServerConfig): Promise<McpTool[]>
⋮----
async createTerminal(baseDir: string, taskId: string, cols?: number, rows?: number): Promise<string>
⋮----
writeToTerminal(terminalId: string, data: string): void
⋮----
resizeTerminal(terminalId: string, cols: number, rows: number): void
⋮----
closeTerminal(terminalId: string): void
⋮----
getTerminalForTask(taskId: string): string | null
⋮----
getTerminalsForTask(taskId: string):
⋮----
async mergeWorktreeToMain(baseDir: string, taskId: string, squash: boolean, targetBranch?: string, commitMessage?: string): Promise<void>
⋮----
async applyUncommittedChanges(baseDir: string, taskId: string, targetBranch?: string): Promise<void>
⋮----
async revertLastMerge(baseDir: string, taskId: string): Promise<void>
⋮----
async listBranches(projectDir: string): Promise<Array<
⋮----
async getWorktreeIntegrationStatus(baseDir: string, taskId: string, targetBranch?: string)
⋮----
async rebaseWorktreeFromBranch(baseDir: string, taskId: string, fromBranch?: string): Promise<void>
⋮----
async abortWorktreeRebase(baseDir: string, taskId: string): Promise<void>
⋮----
async continueWorktreeRebase(baseDir: string, taskId: string): Promise<void>
⋮----
async resolveConflictsWithAgent(baseDir: string, taskId: string): Promise<void>
⋮----
async scrapeWeb(baseDir: string, taskId: string, url: string, filePath?: string): Promise<void>
⋮----
// Normalize URL for filename
⋮----
// Truncate if too long
⋮----
// Check if path looks like a directory (ends with separator)
⋮----
async createNewTask(baseDir: string, params?: CreateTaskParams): Promise<TaskData>
⋮----
async updateTask(baseDir: string, id: string, updates: Partial<TaskData>): Promise<TaskData | undefined>
⋮----
// Delegate to Task.updateTask method which handles worktree logic
⋮----
async deleteTask(baseDir: string, id: string): Promise<void>
⋮----
async duplicateTask(baseDir: string, taskId: string): Promise<TaskData>
⋮----
async forkTask(baseDir: string, taskId: string, messageId: string): Promise<TaskData>
⋮----
async getTasks(baseDir: string): Promise<TaskData[]>
⋮----
async loadTask(baseDir: string, taskId: string): Promise<TaskStateData>
⋮----
async generateTaskMarkdown(baseDir: string, taskId: string): Promise<string | null>
⋮----
async exportTaskToMarkdown(baseDir: string, taskId: string): Promise<void>
⋮----
setZoomLevel(zoomLevel: number): void
⋮----
async getVersions(forceRefresh = false): Promise<VersionsInfo>
⋮----
async downloadLatestAiderDesk(): Promise<void>
⋮----
getReleaseNotes(): string | null
⋮----
clearReleaseNotes(): void
⋮----
getOS(): OS
⋮----
async queryUsageData(from: Date, to: Date): Promise<UsageDataRow[]>
⋮----
getEffectiveEnvironmentVariable(key: string, baseDir?: string): EnvironmentVariable | undefined
⋮----
async getProviderModels(reload = false): Promise<ProviderModelsData>
⋮----
getProviders(): ProviderProfile[]
⋮----
async updateProviders(providers: ProviderProfile[]): Promise<void>
⋮----
async upsertModel(providerId: string, modelId: string, model: Model): Promise<void>
⋮----
async deleteModel(providerId: string, modelId: string): Promise<void>
⋮----
async updateModels(modelUpdates: Array<
⋮----
async showOpenDialog(options: Electron.OpenDialogSyncOptions): Promise<Electron.OpenDialogReturnValue>
⋮----
async openLogsDirectory(): Promise<boolean>
⋮----
async openPath(path: string): Promise<boolean>
⋮----
async isProjectPath(path: string): Promise<boolean>
⋮----
async isValidPath(baseDir: string, path: string): Promise<boolean>
⋮----
async getFilePathSuggestions(currentPath: string, directoriesOnly = true): Promise<string[]>
⋮----
async getTodos(baseDir: string, taskId: string): Promise<TodoItem[]>
⋮----
async addTodo(baseDir: string, taskId: string, name: string): Promise<TodoItem[]>
⋮----
async updateTodo(baseDir: string, taskId: string, name: string, updates: Partial<TodoItem>): Promise<TodoItem[]>
⋮----
async deleteTodo(baseDir: string, taskId: string, name: string): Promise<TodoItem[]>
⋮----
async clearAllTodos(baseDir: string, taskId: string): Promise<TodoItem[]>
⋮----
async initProjectRulesFile(baseDir: string, taskId: string): Promise<void>
⋮----
enableServer(username?: string, password?: string): SettingsData
⋮----
disableServer(): SettingsData
⋮----
async startCloudflareTunnel(): Promise<CloudflareTunnelStatus | null>
⋮----
stopCloudflareTunnel(): void
⋮----
getCloudflareTunnelStatus(): CloudflareTunnelStatus
⋮----
async getAllAgentProfiles()
⋮----
async createAgentProfile(profile: AgentProfile, projectDir?: string)
⋮----
async updateAgentProfile(profile: AgentProfile)
⋮----
async deleteAgentProfile(profileId: string)
⋮----
async updateAgentProfilesOrder(agentProfiles: AgentProfile[])
⋮----
async listAllMemories(): Promise<MemoryEntry[]>
⋮----
async deleteMemory(id: string): Promise<boolean>
⋮----
async deleteProjectMemories(projectId: string): Promise<number>
⋮----
getMemoryEmbeddingProgress()
⋮----
async getBmadStatus(projectDir: string): Promise<BmadStatus>
⋮----
async installBmad(projectDir: string): Promise<InstallResult>
⋮----
async executeWorkflow(projectDir: string, taskId: string, workflowId: string, asSubtask?: boolean): Promise<WorkflowExecutionResult>
⋮----
async resetBmadWorkflow(projectDir: string): Promise<

================
File: src/main/index.ts
================
import { join } from 'path';
import { existsSync, statSync } from 'fs';
⋮----
import { compareBaseDirs, delay } from '@common/utils';
import { electronApp, is, optimizer } from '@electron-toolkit/utils';
import { app, BrowserWindow, dialog, Menu, session, shell } from 'electron';
⋮----
import icon from '../../resources/icon.png?asset';
⋮----
import { AIDER_DESK_DATA_DIR, HEADLESS_MODE } from '@/constants';
import { ProgressWindow } from '@/progress-window';
import { setupIpcHandlers } from '@/ipc-handlers';
import { performStartUp, UpdateProgressData } from '@/start-up';
import { Store } from '@/store';
import logger from '@/logger';
import { initManagers } from '@/managers';
import { getDefaultProjectSettings } from '@/utils';
⋮----
const setupCustomMenu = (): void =>
⋮----
// File menu
⋮----
// Edit menu
⋮----
// View menu
⋮----
// Settings menu
⋮----
const initStore = async (): Promise<Store> =>
⋮----
const initWindow = async (store: Store): Promise<BrowserWindow> =>
⋮----
const saveWindowState = (): void =>
⋮----
const beforeQuit = async (event?: Electron.Event) =>
⋮----
// Handle CTRL+C (SIGINT)
⋮----
// Allow renderer getUserMedia() microphone access.
// Without this, Electron may never surface the macOS TCC permission prompt and the mic stays unavailable.
⋮----
// Initialize IPC handlers
⋮----
// HMR for renderer base on electron-vite cli.
// Load the remote URL for development or the local html file for production.
⋮----
// Apply saved zoom level
⋮----
// Setup custom menu only in GUI mode
⋮----
updateProgress = (
⋮----
// In headless mode, use a no-op updateProgress
updateProgress = () =>
⋮----
// Initialize managers without window in headless mode

================
File: src/main/ipc-handlers.ts
================
import {
  EditFormat,
  FileEdit,
  McpServerConfig,
  Mode,
  Model,
  ProjectSettings,
  ProviderProfile,
  SettingsData,
  TaskData,
  CreateTaskParams,
  TodoItem,
  AgentProfile,
} from '@common/types';
import { ipcMain, clipboard } from 'electron';
⋮----
import { EventsHandler } from './events-handler';
⋮----
import { ServerController } from '@/server';
⋮----
export const setupIpcHandlers = (eventsHandler: EventsHandler, serverController: ServerController) =>
⋮----
// Voice handlers
⋮----
// Terminal handlers
⋮----
// Worktree merge handlers
⋮----
// Server control handlers
⋮----
// Cloudflare tunnel handlers
⋮----
// Agent profile handlers
⋮----
// Memory handlers
⋮----
// BMAD handlers

================
File: src/main/logger.ts
================
import winston from 'winston';
import DailyRotateFile from 'winston-daily-rotate-file';
⋮----
import { LOGS_DIR } from '@/constants';
⋮----
// If we're not in production OR running in headless mode (Docker), also log to the console

================
File: src/main/managers.ts
================
import { createServer } from 'http';
⋮----
import type { BrowserWindow } from 'electron';
⋮----
import { AgentProfileManager, McpManager } from '@/agent';
import { CloudflareTunnelManager, ServerController } from '@/server';
import { ConnectorManager } from '@/connector';
import { ProjectManager } from '@/project';
import { EventManager } from '@/events';
import { ModelManager } from '@/models';
import { DataManager } from '@/data-manager';
import { TerminalManager } from '@/terminal';
import { VersionsManager } from '@/versions';
import { TelemetryManager } from '@/telemetry';
import { WorktreeManager } from '@/worktrees';
import { MemoryManager } from '@/memory/memory-manager';
import { Store } from '@/store';
import { SERVER_PORT } from '@/constants';
import logger from '@/logger';
import { EventsHandler } from '@/events-handler';
import { HookManager } from '@/hooks/hook-manager';
import { PromptsManager } from '@/prompts';
⋮----
export interface ManagersResult {
  eventsHandler: EventsHandler;
  serverController: ServerController;
  cleanup: () => Promise<void>;
  modelManager: ModelManager;
  agentProfileManager: AgentProfileManager;
}
⋮----
export const initManagers = async (store: Store, mainWindow: BrowserWindow | null = null): Promise<ManagersResult> =>
⋮----
// Initialize telemetry manager
⋮----
// Initialize MCP manager
⋮----
// Initialize event manager (no main window in headless)
⋮----
// Initialize model manager
⋮----
// Initialize data manager
⋮----
// Initialize memory manager
⋮----
// Initialize agent profile manager
⋮----
// Initialize project manager
⋮----
// Initialize terminal manager
⋮----
// Initialize Versions Manager
⋮----
// Create HTTP server
⋮----
// Initialize Cloudflare tunnel manager
⋮----
// Initialize events handler (no main window)
⋮----
// Create and initialize REST API controller with the server
⋮----
// Initialize connector manager with the server
⋮----
// Start listening
⋮----
const cleanup = async (): Promise<void> =>
⋮----
// Handle process signals

================
File: src/main/messages.ts
================
import {
  AiderRunOptions,
  ContextFile,
  ContextFileSourceType,
  EditFormat,
  FileEdit,
  LogLevel,
  MessageRole,
  Mode,
  ModelInfo,
  PromptContext,
  RawModelInfo,
  TokensCost,
  UsageReportData,
} from '@common/types';
⋮----
export type MessageAction =
  | 'init'
  | 'prompt'
  | 'prompt-finished'
  | 'response'
  | 'add-file'
  | 'drop-file'
  | 'update-autocompletion'
  | 'ask-question'
  | 'answer-question'
  | 'set-models'
  | 'update-context-files'
  | 'use-command-output'
  | 'run-command'
  | 'tokens-info'
  | 'add-message'
  | 'interrupt-response'
  | 'apply-edits'
  | 'compact-conversation'
  | 'update-repo-map'
  | 'update-env-vars'
  | 'request-context-info'
  | 'subscribe-events'
  | 'unsubscribe-events'
  | 'update-models-info';
⋮----
export interface Message {
  action: MessageAction;
}
⋮----
export interface LogMessage {
  message: string;
  level: LogLevel;
  finished?: boolean;
  promptContext?: PromptContext;
}
⋮----
export interface InitMessage {
  action: 'init';
  baseDir: string;
  taskId?: string;
  source?: string;
  contextFiles?: ContextFile[];
  listenTo?: MessageAction[];
  inputHistoryFile?: string;
}
⋮----
export const isInitMessage = (message: Message): message is InitMessage =>
⋮----
export interface PromptMessage extends Message {
  action: 'prompt';
  prompt: string;
  mode: Mode | null;
  architectModel: string | null;
  promptContext: PromptContext;
  messages?: { role: MessageRole; content: string }[];
  files?: ContextFile[];
  options?: AiderRunOptions;
}
⋮----
export interface ResponseMessage extends Message {
  id: string;
  action: 'response';
  content: string;
  reflectedMessage?: string;
  finished: boolean;
  usageReport?: string | UsageReportData;
  editedFiles?: string[];
  commitHash?: string;
  commitMessage?: string;
  diff?: string;
  sequenceNumber?: number;
  promptContext?: PromptContext;
}
⋮----
export const isResponseMessage = (message: Message): message is ResponseMessage =>
⋮----
export interface AddFileMessage extends Message {
  action: 'add-file';
  path: string;
  sourceType?: ContextFileSourceType;
  readOnly?: boolean;
  noUpdate?: boolean;
}
⋮----
export const isAddFileMessage = (message: Message): message is AddFileMessage =>
⋮----
export interface DropFileMessage extends Message {
  action: 'drop-file';
  path: string;
  readOnly?: boolean;
  noUpdate?: boolean;
}
⋮----
export const isDropFileMessage = (message: Message): message is DropFileMessage =>
⋮----
export interface RunCommandMessage extends Message {
  action: 'run-command';
  command: string;
  messages?: { role: MessageRole; content: string }[];
  files?: ContextFile[];
}
⋮----
export interface UpdateAutocompletionMessage extends Message {
  action: 'update-autocompletion';
  words: string[];
}
⋮----
export const isUpdateAutocompletionMessage = (message: Message): message is UpdateAutocompletionMessage =>
⋮----
export interface AskQuestionMessage extends Message {
  action: 'ask-question';
  question: string;
  subject?: string;
  defaultAnswer: string;
  isGroupQuestion?: boolean;
}
⋮----
export const isAskQuestionMessage = (message: Message): message is AskQuestionMessage =>
⋮----
export interface AnswerQuestionMessage extends Message {
  action: 'answer-question';
  answer: string;
}
⋮----
export interface SetModelsMessage extends Message {
  action: 'set-models';
  mainModel: string;
  weakModel?: string | null;
  editFormat?: EditFormat;
  environmentVariables?: Record<string, string>;
  info?: RawModelInfo;
  hasError?: boolean;
}
⋮----
export const isSetModelsMessage = (message: Message): message is SetModelsMessage =>
⋮----
export interface UpdateContextFilesMessage extends Message {
  action: 'update-context-files';
  files: ContextFile[];
}
⋮----
export const isUpdateContextFilesMessage = (message: Message): message is UpdateContextFilesMessage =>
⋮----
export interface UseCommandOutputMessage extends Message {
  action: 'use-command-output';
  command: string;
  addToContext?: boolean;
  finished: boolean;
}
⋮----
export const isUseCommandOutputMessage = (message: Message): message is UseCommandOutputMessage =>
⋮----
export interface TokensInfoMessage extends Message {
  action: 'tokens-info';
  info: {
    files: Record<string, TokensCost>;
    systemMessages: TokensCost;
    chatHistory: TokensCost;
    repoMap: TokensCost;
  };
}
⋮----
export const isTokensInfoMessage = (message: Message): message is TokensInfoMessage =>
⋮----
export interface AddMessageMessage extends Message {
  action: 'add-message';
  content: string;
  role: MessageRole;
  acknowledge: boolean;
  usageReport?: UsageReportData;
}
⋮----
export const isAddMessageMessage = (message: Message): message is AddMessageMessage =>
⋮----
export interface InterruptResponseMessage extends Message {
  action: 'interrupt-response';
}
⋮----
export interface PromptFinishedMessage extends Message {
  action: 'prompt-finished';
  promptId: string;
}
⋮----
export const isPromptFinishedMessage = (message: Message): message is PromptFinishedMessage =>
⋮----
export interface ApplyEditsMessage extends Message {
  action: 'apply-edits';
  edits: FileEdit[];
}
⋮----
export interface CompactConversationMessage extends Message {
  action: 'compact-conversation';
  customInstructions?: string;
}
⋮----
export interface UpdateRepoMapMessage extends Message {
  action: 'update-repo-map';
  repoMap: string;
}
⋮----
export const isUpdateRepoMapMessage = (message: Message): message is UpdateRepoMapMessage =>
⋮----
export interface UpdateEnvVarsMessage extends Message {
  action: 'update-env-vars';
  environmentVariables: Record<string, unknown>;
}
⋮----
export const isUpdateEnvVarsMessage = (message: Message): message is UpdateEnvVarsMessage =>
⋮----
export interface UpdateModelsInfoMessage extends Message {
  action: 'update-models-info';
  modelsInfo: Record<string, ModelInfo>;
}
⋮----
export const isUpdateModelsInfoMessage = (message: Message): message is UpdateModelsInfoMessage =>
⋮----
export interface RequestContextInfoMessage extends Message {
  action: 'request-context-info';
  messages?: { role: MessageRole; content: string }[];
  files?: ContextFile[];
}
⋮----
export const isRequestContextInfoMessage = (message: Message): message is RequestContextInfoMessage =>
⋮----
export interface SubscribeEventsMessage extends Message {
  action: 'subscribe-events';
  eventTypes?: string[];
  baseDirs?: string[];
}
⋮----
export const isSubscribeEventsMessage = (message: Message): message is SubscribeEventsMessage =>
⋮----
export interface UnsubscribeEventsMessage extends Message {
  action: 'unsubscribe-events';
}
⋮----
export const isUnsubscribeEventsMessage = (message: Message): message is UnsubscribeEventsMessage =>

================
File: src/main/paths.ts
================
import path from 'path';
⋮----
import { getElectronApp, isDev, isElectron } from '@/app';
⋮----
export const getDataDir = (): string =>
⋮----
// eslint-disable-next-line @typescript-eslint/no-require-imports
⋮----
export const getResourceDir = (): string =>

================
File: src/main/progress-window.ts
================
import { join } from 'path';
⋮----
import { BrowserWindow, ipcMain } from 'electron';
⋮----
import { isDev } from '@/app';
⋮----
export class ProgressWindow
⋮----
constructor(options:
⋮----
on(event: 'ready', callback: () => void): void
⋮----
set title(value: string)
⋮----
setDetail(value: string, subtitle?: string): void
⋮----
setCompleted(): void
⋮----
setProgress(progress: number): void
⋮----
close(): void

================
File: src/main/start-up.ts
================
import { exec } from 'child_process';
⋮----
import { promisify } from 'util';
⋮----
import { delay } from '@common/utils';
⋮----
import logger from '@/logger';
import { getCurrentPythonLibVersion, getLatestPythonLibVersion, getPythonVenvBinPath } from '@/utils';
import {
  AIDER_DESK_DATA_DIR,
  SETUP_COMPLETE_FILENAME,
  PYTHON_VENV_DIR,
  AIDER_DESK_CONNECTOR_DIR,
  RESOURCES_DIR,
  AIDER_DESK_MCP_SERVER_DIR,
  UV_EXECUTABLE,
} from '@/constants';
import { isDev } from '@/app';
⋮----
/**
 * Checks if uv is available and accessible.
 */
const checkUvAvailable = async (): Promise<void> =>
⋮----
const createVirtualEnv = async (): Promise<void> =>
⋮----
const setupAiderConnector = async (cleanInstall: boolean, updateProgress?: UpdateProgressFunction): Promise<void> =>
⋮----
// Copy connector.py from resources
⋮----
const installAiderConnectorRequirements = async (cleanInstall: boolean, updateProgress?: UpdateProgressFunction): Promise<void> =>
⋮----
// Version-pinned package - check if matches required version
⋮----
// For non-version-pinned packages, check if newer version is available
⋮----
// If currentVersion is null, the package is not installed, so proceed with installation.
⋮----
const setupMcpServer = async () =>
⋮----
// Copy all files from the MCP server directory
⋮----
// Skip directories for now, only copy files
⋮----
const performUpdateCheck = async (updateProgress: UpdateProgressFunction): Promise<void> =>
⋮----
export type UpdateProgressData = {
  step: string;
  message: string;
  info?: string;
  progress?: number; // 0-100
};
⋮----
progress?: number; // 0-100
⋮----
export type UpdateProgressFunction = (data: UpdateProgressData) => void;
⋮----
export const performStartUp = async (updateProgress: UpdateProgressFunction): Promise<boolean> =>
⋮----
// Create setup complete file
⋮----
// Clean up if setup fails

================
File: src/mcp-server/aider-desk-mcp-server.ts
================
/* eslint-disable func-style,@typescript-eslint/no-explicit-any */
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import axios from 'axios';
import { z } from 'zod/v3';
⋮----
// Get project directory from command line arguments or use default
⋮----
// AiderDesk API configuration
⋮----
// eslint-disable-next-line no-console
⋮----
// Create MCP server
⋮----
// Define tool schemas
⋮----
// Add tools to the server
⋮----
// Start the server
export async function main()
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console

================
File: src/preload/index.d.ts
================
import { ApplicationAPI } from '@common/api';
⋮----
import type { ElectronAPI } from '@electron-toolkit/preload';
⋮----
interface Window {
    electron: ElectronAPI;
    api: ApplicationAPI;
  }

================
File: src/preload/index.ts
================
import {
  AutocompletionData,
  ClearTaskData,
  CommandOutputData,
  ContextFilesUpdatedData,
  CustomCommandsUpdatedData,
  FileEdit,
  InputHistoryData,
  LogData,
  McpServerConfig,
  MessageRemovedData,
  ModelsData,
  OS,
  ProjectSettings,
  ProjectStartedData,
  ProviderModelsData,
  ProvidersUpdatedData,
  QuestionAnsweredData,
  QuestionData,
  ResponseChunkData,
  ResponseCompletedData,
  SettingsData,
  TaskData,
  CreateTaskParams,
  TerminalData,
  TerminalExitData,
  TokensInfoData,
  ToolData,
  UserMessageData,
  VersionsInfo,
  WorktreeIntegrationStatusUpdatedData,
  TaskCreatedData,
  UpdatedFilesUpdatedData,
} from '@common/types';
import { electronAPI } from '@electron-toolkit/preload';
import { contextBridge, ipcRenderer, webUtils } from 'electron';
import { ApplicationAPI } from '@common/api';
import { compareBaseDirs } from '@common/utils';
⋮----
// Voice API
⋮----
const listener = (_: Electron.IpcRendererEvent, data: SettingsData) =>
⋮----
// Task lifecycle event listeners
⋮----
// Terminal operations
⋮----
// Worktree merge operations
⋮----
// Agent profile operations
⋮----
// Memory operations
⋮----
// BMAD operations
⋮----
// notifications in Electron app are handled by the main process
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/public/manifest.json
================
{
  "name": "AiderDesk",
  "short_name": "AiderDesk",
  "description": "AI-powered coding assistant desktop application",
  "start_url": "/",
  "scope": "/",
  "display": "standalone",
  "background_color": "#1c2025",
  "theme_color": "#3b82f6",
  "orientation": "any",
  "categories": ["development", "productivity"],
  "prefer_related_applications": false,
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "maskable"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable"
    }
  ]
}

================
File: src/renderer/public/sw.js
================
// Minimal service worker for PWA recognition
// No caching - just exists to enable PWA features
⋮----
// Skip waiting to activate immediately
⋮----
// Claim clients immediately
⋮----
// Pass through all fetch requests without caching

================
File: src/renderer/src/api/browser-api.ts
================
import {
  AgentProfilesUpdatedData,
  AutocompletionData,
  ClearTaskData,
  CloudflareTunnelStatus,
  CommandOutputData,
  ContextFilesUpdatedData,
  CustomCommand,
  CustomCommandsUpdatedData,
  EditFormat,
  EnvironmentVariable,
  FileEdit,
  InputHistoryData,
  LogData,
  McpServerConfig,
  McpTool,
  MessageRemovedData,
  Mode,
  Model,
  ModelsData,
  NotificationData,
  OS,
  ProjectData,
  ProjectSettings,
  ProjectStartedData,
  ProviderModelsData,
  ProviderProfile,
  ProvidersUpdatedData,
  QuestionAnsweredData,
  QuestionData,
  ResponseChunkData,
  ResponseCompletedData,
  SettingsData,
  TaskData,
  CreateTaskParams,
  TaskStateData,
  TerminalData,
  TerminalExitData,
  TodoItem,
  TokensInfoData,
  ToolData,
  UsageDataRow,
  UserMessageData,
  VersionsInfo,
  VoiceSession,
  AgentProfile,
  MemoryEntry,
  MemoryEmbeddingProgress,
  WorktreeIntegrationStatus,
  WorktreeIntegrationStatusUpdatedData,
  TaskCreatedData,
  UpdatedFilesUpdatedData,
  WorkflowExecutionResult,
} from '@common/types';
import { ApplicationAPI } from '@common/api';
import axios, { type AxiosInstance } from 'axios';
import { io, Socket } from 'socket.io-client';
import { compareBaseDirs } from '@common/utils';
import { v4 as uuidv4 } from 'uuid';
⋮----
import type { BmadStatus } from '@common/bmad-types';
⋮----
type EventDataMap = {
  'settings-updated': SettingsData;
  'response-chunk': ResponseChunkData;
  'response-completed': ResponseCompletedData;
  log: LogData;
  'context-files-updated': ContextFilesUpdatedData;
  'custom-commands-updated': CustomCommandsUpdatedData;
  'update-autocompletion': AutocompletionData;
  'ask-question': QuestionData;
  'question-answered': QuestionAnsweredData;
  'update-aider-models': ModelsData;
  'command-output': CommandOutputData;
  'update-tokens-info': TokensInfoData;
  tool: ToolData;
  'user-message': UserMessageData;
  'input-history-updated': InputHistoryData;
  'clear-task': ClearTaskData;
  'project-started': ProjectStartedData;
  'provider-models-updated': ProviderModelsData;
  'providers-updated': ProvidersUpdatedData;
  'project-settings-updated': { baseDir: string; settings: ProjectSettings };
  'worktree-integration-status-updated': WorktreeIntegrationStatusUpdatedData;
  'agent-profiles-updated': AgentProfilesUpdatedData;
  'updated-files-updated': UpdatedFilesUpdatedData;
  notification: NotificationData;
  'task-created': TaskCreatedData;
  'task-initialized': TaskData;
  'task-updated': TaskData;
  'task-deleted': TaskData;
  'task-started': TaskData;
  'task-completed': TaskData;
  'task-cancelled': TaskData;
  'message-removed': MessageRemovedData;
  'terminal-data': TerminalData;
  'terminal-exit': TerminalExitData;
  'bmad-status-changed': BmadStatus;
};
⋮----
type EventCallback<T> = (data: T) => void;
⋮----
interface ListenerEntry<T> {
  callback: EventCallback<T>;
  baseDir?: string;
  taskId?: string;
}
⋮----
class UnsupportedError extends Error
⋮----
constructor(message: string)
⋮----
export class BrowserApi implements ApplicationAPI
⋮----
constructor()
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Filter by baseDir
⋮----
// Filter by taskId for task-level events
⋮----
private ensureSocketConnected(): void
⋮----
private addListener<T extends keyof EventDataMap>(eventType: T, callback: EventCallback<EventDataMap[T]>, baseDir?: string, taskId?: string): () => void
⋮----
private async post<B, R>(endpoint: string, body: B): Promise<R>
⋮----
private async get<T>(endpoint: string, params?: Record<string, unknown>): Promise<T>
⋮----
private async patch<B, R>(endpoint: string, body: B): Promise<R>
⋮----
private async delete<T>(endpoint: string, params?: Record<string, unknown>): Promise<T>
⋮----
private async deleteWithBody<B, T>(endpoint: string, body: B): Promise<T>
⋮----
private async put<B, R>(endpoint: string, body: B, params?: Record<string, unknown>): Promise<R>
⋮----
isOpenLogsDirectorySupported(): boolean
openLogsDirectory(): Promise<boolean>
loadSettings(): Promise<SettingsData>
saveSettings(settings: SettingsData): Promise<SettingsData>
startProject(baseDir: string): Promise<void>
stopProject(baseDir: string): void
⋮----
restartProject(baseDir: string): void
resetTask(baseDir: string, taskId: string): void
runPrompt(baseDir: string, taskId: string, prompt: string, mode?: Mode): void
savePrompt(baseDir: string, taskId: string, prompt: string): Promise<void>
redoLastUserPrompt(baseDir: string, taskId: string, mode: Mode, updatedPrompt?: string): void
resumeTask(baseDir: string, taskId: string): void
answerQuestion(baseDir: string, taskId: string, answer: string): void
loadInputHistory(baseDir: string): Promise<string[]>
isOpenDialogSupported(): boolean
showOpenDialog(options: Electron.OpenDialogSyncOptions): Promise<Electron.OpenDialogReturnValue>
getPathForFile(file: File): string
getOpenProjects(): Promise<ProjectData[]>
addOpenProject(baseDir: string): Promise<ProjectData[]>
setActiveProject(baseDir: string): Promise<ProjectData[]>
removeOpenProject(baseDir: string): Promise<ProjectData[]>
updateOpenProjectsOrder(baseDirs: string[]): Promise<ProjectData[]>
updateMainModel(baseDir: string, taskId: string, model: string): void
updateWeakModel(baseDir: string, taskId: string, model: string): void
updateArchitectModel(baseDir: string, taskId: string, model: string): void
updateEditFormats(baseDir: string, editFormats: Record<string, EditFormat>): void
getProjectSettings(baseDir: string): Promise<ProjectSettings>
patchProjectSettings(baseDir: string, settings: Partial<ProjectSettings>): Promise<ProjectSettings>
getFilePathSuggestions(currentPath: string, directoriesOnly?: boolean): Promise<string[]>
getAddableFiles(baseDir: string, taskId: string): Promise<string[]>
getAllFiles(baseDir: string, taskId: string, useGit?: boolean): Promise<string[]>
getUpdatedFiles(baseDir: string, taskId: string): Promise<
addFile(baseDir: string, taskId: string, filePath: string, readOnly?: boolean): void
async isValidPath(baseDir: string, path: string): Promise<boolean>
async isProjectPath(path: string): Promise<boolean>
dropFile(baseDir: string, taskId: string, path: string): void
runCommand(baseDir: string, taskId: string, command: string): void
async pasteImage(baseDir: string, taskId: string, imageBuffer?: ArrayBuffer): Promise<void>
scrapeWeb(baseDir: string, taskId: string, url: string, filePath?: string): Promise<void>
initProjectRulesFile(baseDir: string, taskId: string): Promise<void>
getTodos(baseDir: string, taskId: string): Promise<TodoItem[]>
addTodo(baseDir: string, taskId: string, name: string): Promise<TodoItem[]>
updateTodo(baseDir: string, taskId: string, name: string, updates: Partial<TodoItem>): Promise<TodoItem[]>
deleteTodo(baseDir: string, taskId: string, name: string): Promise<TodoItem[]>
clearAllTodos(baseDir: string, taskId: string): Promise<TodoItem[]>
loadMcpServerTools(serverName: string, config?: McpServerConfig): Promise<McpTool[] | null>
reloadMcpServers(mcpServers: Record<string, McpServerConfig>, force = false): Promise<void>
reloadMcpServer(serverName: string, config: McpServerConfig): Promise<McpTool[]>
createNewTask(baseDir: string, params?: CreateTaskParams): Promise<TaskData>
updateTask(baseDir: string, id: string, updates: Partial<TaskData>): Promise<boolean>
deleteTask(baseDir: string, id: string): Promise<boolean>
duplicateTask(baseDir: string, taskId: string): Promise<TaskData>
forkTask(baseDir: string, taskId: string, messageId: string): Promise<TaskData>
getTasks(baseDir: string): Promise<TaskData[]>
loadTask(baseDir: string, id: string): Promise<TaskStateData>
⋮----
async exportTaskToMarkdown(baseDir: string, taskId: string): Promise<void>
⋮----
getRecentProjects(): Promise<string[]>
addRecentProject(baseDir: string): Promise<void>
removeRecentProject(baseDir: string): Promise<void>
interruptResponse(baseDir: string, taskId: string, interruptId?: string): void
applyEdits(baseDir: string, taskId: string, edits: FileEdit[]): void
⋮----
clearContext(baseDir: string, taskId: string): void
removeLastMessage(baseDir: string, taskId: string): void
⋮----
async removeMessage(baseDir: string, taskId: string, messageId: string): Promise<void>
⋮----
async removeMessagesUpTo(baseDir: string, taskId: string, messageId: string): Promise<void>
compactConversation(baseDir: string, taskId: string, mode: Mode, customInstructions?: string): void
⋮----
async handoffConversation(baseDir: string, taskId: string, focus?: string): Promise<void>
⋮----
setZoomLevel(level: number): Promise<void>
⋮----
// eslint-disable-next-line no-console
⋮----
getVersions(forceRefresh = false): Promise<VersionsInfo | null>
downloadLatestAiderDesk(): Promise<void>
async getReleaseNotes(): Promise<string | null>
clearReleaseNotes(): Promise<void>
async getOS(): Promise<OS>
getProviderModels(reload?: boolean): Promise<ProviderModelsData>
getProviders(): Promise<ProviderProfile[]>
updateProviders(providers: ProviderProfile[]): Promise<ProviderProfile[]>
upsertModel(providerId: string, modelId: string, model: Model): Promise<ProviderModelsData>
deleteModel(providerId: string, modelId: string): Promise<ProviderModelsData>
updateModels(modelUpdates: Array<
queryUsageData(from: string, to: string): Promise<UsageDataRow[]>
getEffectiveEnvironmentVariable(key: string, baseDir?: string): Promise<EnvironmentVariable | undefined>
⋮----
// Voice API
createVoiceSession(provider: ProviderProfile): Promise<VoiceSession>
⋮----
addSettingsUpdatedListener(callback: (data: SettingsData) => void): () => void
addResponseChunkListener(baseDir: string, taskId: string, callback: (data: ResponseChunkData) => void): () => void
addResponseCompletedListener(baseDir: string, taskId: string, callback: (data: ResponseCompletedData) => void): () => void
addLogListener(baseDir: string, taskId: string, callback: (data: LogData) => void): () => void
addContextFilesUpdatedListener(baseDir: string, taskId: string, callback: (data: ContextFilesUpdatedData) => void): () => void
addUpdatedFilesUpdatedListener(baseDir: string, taskId: string, callback: (data: UpdatedFilesUpdatedData) => void): () => void
addCustomCommandsUpdatedListener(baseDir: string, callback: (data: CustomCommandsUpdatedData) => void): () => void
addUpdateAutocompletionListener(baseDir: string, taskId: string, callback: (data: AutocompletionData) => void): () => void
addAskQuestionListener(baseDir: string, taskId: string, callback: (data: QuestionData) => void): () => void
⋮----
addQuestionAnsweredListener(baseDir: string, taskId: string, callback: (data: QuestionAnsweredData) => void): () => void
addUpdateAiderModelsListener(baseDir: string, taskId: string, callback: (data: ModelsData) => void): () => void
addCommandOutputListener(baseDir: string, taskId: string, callback: (data: CommandOutputData) => void): () => void
addTokensInfoListener(baseDir: string, taskId: string, callback: (data: TokensInfoData) => void): () => void
addToolListener(baseDir: string, taskId: string, callback: (data: ToolData) => void): () => void
addUserMessageListener(baseDir: string, taskId: string, callback: (data: UserMessageData) => void): () => void
addInputHistoryUpdatedListener(baseDir: string, callback: (data: InputHistoryData) => void): () => void
addClearTaskListener(baseDir: string, taskId: string, callback: (data: ClearTaskData) => void): () => void
⋮----
addMessageRemovedListener(baseDir: string, taskId: string, callback: (data: MessageRemovedData) => void): () => void
addProjectStartedListener(baseDir: string, callback: (data: ProjectStartedData) => void): () => void
addVersionsInfoUpdatedListener(callback: (data: VersionsInfo) => void): () => void
⋮----
addProviderModelsUpdatedListener(callback: (data: ProviderModelsData) => void): () => void
⋮----
addProvidersUpdatedListener(callback: (data: ProvidersUpdatedData) => void): () => void
⋮----
addAgentProfilesUpdatedListener(callback: (data: AgentProfilesUpdatedData) => void): () => void
⋮----
addProjectSettingsUpdatedListener(baseDir: string, callback: (data:
⋮----
addWorktreeIntegrationStatusUpdatedListener(baseDir: string, taskId: string, callback: (data: WorktreeIntegrationStatusUpdatedData) => void): () => void
⋮----
// Task lifecycle event listeners
addTaskCreatedListener(baseDir: string, callback: (data: TaskCreatedData) => void): () => void
⋮----
addTaskInitializedListener(baseDir: string, callback: (data: TaskData) => void): () => void
⋮----
addTaskUpdatedListener(baseDir: string, callback: (data: TaskData) => void): () => void
⋮----
addTaskStartedListener(baseDir: string, callback: (data: TaskData) => void): () => void
⋮----
addTaskCompletedListener(baseDir: string, callback: (data: TaskData) => void): () => void
⋮----
addTaskCancelledListener(baseDir: string, callback: (data: TaskData) => void): () => void
⋮----
addTaskDeletedListener(baseDir: string, callback: (data: TaskData) => void): () => void
addTerminalDataListener(baseDir: string, callback: (data: TerminalData) => void): () => void
addTerminalExitListener(baseDir: string, callback: (data: TerminalExitData) => void): () => void
addContextMenuListener(callback: (params: Electron.ContextMenuParams) => void): () => void
addOpenSettingsListener(callback: (pageId: string) => void): () => void
getCustomCommands(baseDir: string): Promise<CustomCommand[]>
runCustomCommand(baseDir: string, taskId: string, commandName: string, args: string[], mode: Mode): Promise<void>
isTerminalSupported(): boolean
async createTerminal(baseDir: string, taskId: string, cols?: number, rows?: number): Promise<string>
async writeToTerminal(terminalId: string, data: string): Promise<boolean>
async resizeTerminal(terminalId: string, cols: number, rows: number): Promise<boolean>
async closeTerminal(terminalId: string): Promise<boolean>
async getTerminalForTask(taskId: string): Promise<string | null>
async getAllTerminalsForTask(taskId: string): Promise<Array<
isManageServerSupported(): boolean
⋮----
startServer(username?: string, password?: string): Promise<boolean>
⋮----
// Server control not supported in browser mode
⋮----
stopServer(): Promise<boolean>
⋮----
// Server control not supported in browser mode
⋮----
startCloudflareTunnel(): Promise<boolean>
⋮----
stopCloudflareTunnel(): Promise<void>
⋮----
getCloudflareTunnelStatus(): Promise<CloudflareTunnelStatus>
⋮----
// Worktree merge operations
mergeWorktreeToMain(baseDir: string, taskId: string, squash: boolean, targetBranch?: string, commitMessage?: string): Promise<void>
⋮----
applyUncommittedChanges(baseDir: string, taskId: string, targetBranch?: string): Promise<void>
⋮----
revertLastMerge(baseDir: string, taskId: string): Promise<void>
⋮----
listBranches(baseDir: string): Promise<Array<
⋮----
getWorktreeIntegrationStatus(baseDir: string, taskId: string, targetBranch?: string): Promise<WorktreeIntegrationStatus>
⋮----
rebaseWorktreeFromBranch(baseDir: string, taskId: string, fromBranch?: string): Promise<void>
⋮----
abortWorktreeRebase(baseDir: string, taskId: string): Promise<void>
⋮----
continueWorktreeRebase(baseDir: string, taskId: string): Promise<void>
⋮----
resolveWorktreeConflictsWithAgent(baseDir: string, taskId: string): Promise<void>
⋮----
resolveConflictsWithAgent(baseDir: string, taskId: string): Promise<void>
⋮----
// Memory operations
listAllMemories(): Promise<MemoryEntry[]>
⋮----
async deleteMemory(id: string): Promise<boolean>
⋮----
getMemoryEmbeddingProgress(): Promise<MemoryEmbeddingProgress>
⋮----
async deleteProjectMemories(projectId: string): Promise<number>
⋮----
// BMAD operations
async installBmad(projectDir: string): Promise<
⋮----
getBmadStatus(projectDir: string): Promise<BmadStatus>
⋮----
async executeWorkflow(projectDir: string, taskId: string, workflowId: string, asSubtask?: boolean): Promise<WorkflowExecutionResult>
⋮----
async resetBmadWorkflow(projectDir: string): Promise<
⋮----
async writeToClipboard(text: string): Promise<void>
⋮----
// Fallback for mobile browsers and non-secure contexts
⋮----
async openPath(): Promise<boolean>
⋮----
// Not available in browser context
⋮----
// Agent profile operations
getAllAgentProfiles(baseDir?: string): Promise<AgentProfile[]>
⋮----
createAgentProfile(profile: AgentProfile, projectDir?: string): Promise<AgentProfile[]>
⋮----
updateAgentProfile(profile: AgentProfile, baseDir?: string): Promise<AgentProfile[]>
⋮----
deleteAgentProfile(profileId: string, baseDir?: string): Promise<AgentProfile[]>
⋮----
updateAgentProfilesOrder(agentProfiles: AgentProfile[]): Promise<void>
⋮----
addNotificationListener(baseDir: string, callback: (data: NotificationData) => void): () => void
⋮----
addBmadStatusChangedListener(baseDir: string, callback: (status: BmadStatus) => void): () => void

================
File: src/renderer/src/components/AgentSelector/AgentSelector.tsx
================
import { memo, useCallback, useEffect, useMemo, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { MdCheck, MdFlashOn, MdOutlineChecklist, MdOutlineFileCopy, MdOutlineHdrAuto, MdOutlineMap, MdPsychology, MdSave } from 'react-icons/md';
import { RiToolsFill } from 'react-icons/ri';
import { clsx } from 'clsx';
import { AgentProfile, TaskData, ToolApprovalState } from '@common/types';
import { BiCog } from 'react-icons/bi';
import { TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
import { useHotkeys } from 'react-hotkeys-hook';
import { LuBrain, LuClipboardList } from 'react-icons/lu';
⋮----
import { McpServerSelectorItem } from './McpServerSelectorItem';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
import { IconButton } from '@/components/common/IconButton';
import { Accordion } from '@/components/common/Accordion';
import { useSettings } from '@/contexts/SettingsContext';
import { useProjectSettings } from '@/contexts/ProjectSettingsContext';
import { useApi } from '@/contexts/ApiContext';
import { useAgents } from '@/contexts/AgentsContext';
import { useTask } from '@/contexts/TaskContext';
import { resolveAgentProfile } from '@/utils/agents';
⋮----
type Props = {
  projectDir: string;
  task: TaskData;
  isActive: boolean;
  showSettingsPage?: (pageId?: string, options?: Record<string, unknown>) => void;
};
⋮----
const calculateEnabledTools = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
if (activeTaskProfile)
⋮----
if (activeGlobalProfile)
⋮----
// Remove tool approvals for this server
⋮----
{/* Profiles List */}
⋮----
onClick=
⋮----
{/* MCP Servers */}
⋮----
<span className="text-xs flex-1 font-medium text-text-secondary text-left px-1 uppercase">
⋮----
{/* Quick Settings */}
⋮----
className=
⋮----
<LuBrain className=

================
File: src/renderer/src/components/AgentSelector/index.ts
================


================
File: src/renderer/src/components/AgentSelector/McpServerSelectorItem.tsx
================
import { useEffect, useState } from 'react';
import { CgSpinner } from 'react-icons/cg';
import { ToolApprovalState } from '@common/types';
import { TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
import { useTranslation } from 'react-i18next';
⋮----
import { Checkbox } from '../common/Checkbox';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  serverName: string;
  disabled: boolean;
  toolApprovals: Record<string, ToolApprovalState>;
  onToggle: (serverName: string) => void;
};
⋮----
export const McpServerSelectorItem = (
⋮----
const loadTools = async () =>
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/components/bmad/BmadInstallPrompt.tsx
================
import { MouseEvent, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FiCheck, FiDownload } from 'react-icons/fi';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { BmadWelcomeSection } from './BmadWelcomeSection';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { showErrorNotification, showSuccessNotification } from '@/utils/notifications';
import { Button } from '@/components/common/Button';
import { CopyMessageButton } from '@/components/message/CopyMessageButton';
⋮----
type Props = {
  refreshState: () => void;
  projectDir: string;
};
⋮----
const handleInstall = async (e: MouseEvent<HTMLButtonElement>) =>
⋮----
// Refresh BMAD state immediately after successful installation
⋮----

================
File: src/renderer/src/components/bmad/BmadTaskActions.tsx
================
import { RiAlertLine } from 'react-icons/ri';
import { useTranslation } from 'react-i18next';
import { TaskData } from '@common/types';
⋮----
import { useBmadState } from './useBmadState';
⋮----
import { SuggestedWorkflowCard } from '@/components/bmad/SuggestedWorkflowCard';
⋮----
type Props = {
  projectDir: string;
  taskId: string;
  task?: TaskData | null;
};

================
File: src/renderer/src/components/bmad/BmadWelcomeSection.tsx
================
import { useTranslation } from 'react-i18next';
import { FiPackage } from 'react-icons/fi';

================
File: src/renderer/src/components/bmad/BmadWorkflowPage.tsx
================
import { MouseEvent, useEffect, useState, useRef } from 'react';
import { useTranslation } from 'react-i18next';
import { FiAlertTriangle, FiLayers, FiZap } from 'react-icons/fi';
import { clsx } from 'clsx';
⋮----
import { useBmadState } from './useBmadState';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { BmadInstallPrompt } from '@/components/bmad/BmadInstallPrompt';
import { BmadWelcomeSection } from '@/components/bmad/BmadWelcomeSection';
import { WorkflowList } from '@/components/bmad/WorkflowList';
import { PathInfoCard } from '@/components/bmad/PathInfoCard';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { Button } from '@/components/common/Button';
import { showErrorNotification, showSuccessNotification } from '@/utils/notifications';
import { LoadingOverlay } from '@/components/common/LoadingOverlay';
⋮----
type PathType = 'full' | 'quick';
⋮----
type Props = {
  projectDir?: string;
  taskId?: string;
};
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
const handleTabChange = (tab: PathType) =>
⋮----
const handleResetClick = (e: MouseEvent<HTMLButtonElement>) =>
⋮----
const handleResetCancel = () =>
⋮----
const handleResetConfirm = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
onClick=
⋮----

⋮----
<div className=
⋮----
title=

================
File: src/renderer/src/components/bmad/PathInfoCard.tsx
================
import { useTranslation } from 'react-i18next';
import { FiLayers, FiZap } from 'react-icons/fi';
import { clsx } from 'clsx';
⋮----
type PathType = 'full' | 'quick';
⋮----
type Props = {
  pathType: PathType;
};
⋮----
export const PathInfoCard = (
⋮----
<div className=

================
File: src/renderer/src/components/bmad/SuggestedWorkflowCard.tsx
================
import { WorkflowMetadata } from '@common/bmad-types';
import { MouseEvent, useState } from 'react';
import { CgSpinner } from 'react-icons/cg';
import { FiPlay } from 'react-icons/fi';
import { useTranslation } from 'react-i18next';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { showErrorNotification } from '@/utils/notifications';
import { Button } from '@/components/common/Button';
⋮----
type Props = {
  workflow: WorkflowMetadata;
  projectDir: string;
  taskId: string;
  onRefresh: () => Promise<void>;
};
⋮----
export const SuggestedWorkflowCard = (
⋮----
const handleExecuteWorkflow = async (e: MouseEvent<HTMLButtonElement>) =>

================
File: src/renderer/src/components/bmad/useBmadState.ts
================
import { useCallback, useEffect, useMemo, useState } from 'react';
import { BmadStatus } from '@common/bmad-types';
import { TaskData } from '@common/types';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { generateSuggestions } from '@/utils/bmad-suggestions';
⋮----
type Result = {
  status: BmadStatus | null;
  suggestedWorkflows: string[];
  isLoading: boolean;
  error: string | null;
  refresh: (loading?: boolean) => Promise<void>;
};
⋮----
type UseBmadStateParams = {
  projectDir?: string;
  task?: TaskData | null;
};
⋮----
export const useBmadState = (params: UseBmadStateParams): Result =>
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps

================
File: src/renderer/src/components/bmad/WorkflowActionButton.tsx
================
import { WorkflowMetadata } from '@common/bmad-types';
import { MouseEvent, useState } from 'react';
import { CgSpinner } from 'react-icons/cg';
import { HiCheck, HiClock } from 'react-icons/hi';
import { clsx } from 'clsx';
import { useTranslation } from 'react-i18next';
⋮----
import { Button } from '@/components/common/Button';
import { useApi } from '@/contexts/ApiContext';
import { showErrorNotification } from '@/utils/notifications';
⋮----
type Props = {
  workflow: WorkflowMetadata;
  isCompleted: boolean;
  isInProgress: boolean;
  isSuggested: boolean;
  projectDir: string;
  taskId: string;
  onRefresh: () => Promise<void>;
};
⋮----
export const WorkflowActionButton = (
⋮----
const handleExecuteWorkflow = async (e: MouseEvent<HTMLButtonElement>) =>
⋮----
// Refresh BMAD state to update UI
⋮----
// Show error notification with recovery action
⋮----
// Handle unexpected errors
⋮----
// eslint-disable-next-line no-console
⋮----
<span className=

================
File: src/renderer/src/components/bmad/WorkflowItem.tsx
================
import { IncompleteWorkflowMetadata, WorkflowMetadata } from '@common/bmad-types';
import { MouseEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { FiFile, FiExternalLink } from 'react-icons/fi';
import { clsx } from 'clsx';
⋮----
import { WorkflowActionButton } from './WorkflowActionButton';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  workflow: WorkflowMetadata;
  isCompleted: boolean;
  isInProgress: boolean;
  isSuggested: boolean;
  artifactPath?: string;
  projectDir: string;
  taskId: string;
  incompleteWorkflow?: IncompleteWorkflowMetadata;
  onRefresh: () => Promise<void>;
};
⋮----
const handleOpenArtifact = async (e: MouseEvent<HTMLButtonElement>) =>
⋮----
const getFileName = (path: string) =>
⋮----
const getStepInfo = () =>

================
File: src/renderer/src/components/bmad/WorkflowList.tsx
================
import { WorkflowPhase, BmadStatus } from '@common/bmad-types';
import { useTranslation } from 'react-i18next';
import { useMemo } from 'react';
⋮----
import { WorkflowItem } from './WorkflowItem';
import { WorkflowPhaseSection } from './WorkflowPhaseSection';
⋮----
type PathType = 'full' | 'quick';
⋮----
type Props = {
  projectDir: string;
  taskId: string;
  activeTab: PathType;
  status: BmadStatus | null;
  suggestedWorkflows: string[];
  isLoading: boolean;
  error: string | null;
  onRefresh: () => Promise<void>;
};
⋮----
const getArtifactPath = (workflowId: string): string | undefined =>
⋮----
const getIncompleteWorkflow = (workflowId: string) =>

================
File: src/renderer/src/components/bmad/WorkflowPhaseSection.tsx
================
import { WorkflowMetadata, WorkflowPhase } from '@common/bmad-types';
import { ReactNode, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FaChevronDown } from 'react-icons/fa';
import { FiSearch, FiClipboard, FiCpu, FiCode } from 'react-icons/fi';
import { clsx } from 'clsx';
⋮----
type Props = {
  phase: WorkflowPhase;
  workflows: WorkflowMetadata[];
  completedCount: number;
  children: ReactNode;
  defaultOpen?: boolean;
};
⋮----
const handleToggle = () =>
⋮----
className=
⋮----
<div className=

================
File: src/renderer/src/components/common/DiffViewer/CompactDiffViewer.tsx
================
import React, { useMemo, FC } from 'react';
import { diffLines, formatLines } from 'unidiff';
import { getLanguageFromPath } from '@common/utils';
import { clsx } from 'clsx';
import { HiOutlineSelector } from 'react-icons/hi';
⋮----
import { parseDiff, File, Hunk as HunkType, SkipBlock, Line as LineType } from './utils';
⋮----
import { highlightWithRefractor } from '@/utils/highlighter';
⋮----
interface DiffContextValue {
  language: string;
  fileStatus: File['type'];
}
⋮----
const useDiffContext = () =>
⋮----
export interface DiffProps extends React.TableHTMLAttributes<HTMLTableElement>, Pick<File, 'hunks' | 'type'> {
  fileName?: string;
  language?: string;
}
⋮----
<tr className=
⋮----
className=

================
File: src/renderer/src/components/common/DiffViewer/DiffViewer.scss
================
.diff-viewer {
  .diff-gutter {
    color: var(--color-text-muted);
    text-align: center; // Better alignment for line numbers

    &.diff-gutter-omit {
      &:before {
        background-color: var(--color-bg-tertiary);
      }
    }
  }

  .diff-code {
    padding: 0;
    font-family: 'Sono', monospace;
  }

  .diff-code-insert {
    background-color: var(--color-bg-diff-viewer-new-primary);

    .diff-code-edit {
      background-color: var(--color-bg-diff-viewer-new-secondary);
    }
  }

  .diff-code-delete {
    background-color: var(--color-bg-diff-viewer-old-primary);

    .diff-code-edit {
      background-color: var(--color-bg-diff-viewer-old-secondary);
    }
  }

  .diff-gutter-insert {
    background-color: var(--color-bg-diff-viewer-new-primary);
    width: 16px;
    min-width: 16px;
    max-width: 16px;
  }

  .diff-gutter-delete {
    background-color: var(--color-bg-diff-viewer-old-primary);
  }

  ::selection {
    background-color: var(--color-bg-tertiary);
    color: var(--color-text-primary);
  }
}

================
File: src/renderer/src/components/common/DiffViewer/DiffViewer.tsx
================
import { useMemo } from 'react';
import { useTranslation } from 'react-i18next';
import { Diff, Hunk, parseDiff } from 'react-diff-view';
import { diffLines, formatLines } from 'unidiff';
import { useDebounce } from '@reactuses/core';
import { DiffViewMode } from '@common/types';
⋮----
import { createTokens } from './utils';
⋮----
import { useResponsive } from '@/hooks/useResponsive';
⋮----
type Props = {
  oldValue: string;
  newValue: string;
  language: string;
  isComplete?: boolean;
  viewMode?: DiffViewMode;
};
⋮----
export const DiffViewer = (
⋮----
// eslint-disable-next-line no-console
⋮----
Please report an issue in https://github.com/hotovo/aider-desk/issues.
⋮----
// No error, but no diff file (e.g., identical content)

================
File: src/renderer/src/components/common/DiffViewer/index.tsx
================


================
File: src/renderer/src/components/common/DiffViewer/UDiffViewer.tsx
================
import { useMemo } from 'react';
import { Diff, Hunk, parseDiff } from 'react-diff-view';
import { DiffViewMode } from '@common/types';
⋮----
import { createTokens } from './utils';
⋮----
import { useResponsive } from '@/hooks/useResponsive';
⋮----
type Props = {
  udiff: string;
  language: string;
  viewMode?: DiffViewMode;
  showFilename?: boolean;
};
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/components/common/DiffViewer/utils.ts
================
import { tokenize } from 'react-diff-view';
import { refractor } from 'refractor/all';
import { HunkData } from 'react-diff-view/types/utils';
import gitDiffParser, { Hunk as _Hunk, File as _File, Change as _Change, DeleteChange, InsertChange } from 'gitdiff-parser';
import { diffChars, diffWords } from 'diff';
⋮----
/**
 * Refractor v5 returns a Root node with a children array,
 * but react-diff-view (v3) expects the highlight function to return the array directly.
 */
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
export const createTokens = (hunks: HunkData[], language: string) =>
⋮----
// eslint-disable-next-line no-console
⋮----
export interface LineSegment {
  value: string;
  type: 'insert' | 'delete' | 'normal';
}
⋮----
type ReplaceKey<T, K extends PropertyKey, V> = T extends unknown ? Omit<T, K> & Record<K, V> : never;
⋮----
export type Line = ReplaceKey<_Change, 'content', LineSegment[]>;
⋮----
export interface Hunk extends Omit<_Hunk, 'changes'> {
  type: 'hunk';
  lines: Line[];
}
⋮----
export interface SkipBlock {
  count: number;
  type: 'skip';
  content: string;
}
⋮----
export interface File extends Omit<_File, 'hunks'> {
  hunks: (Hunk | SkipBlock)[];
}
⋮----
export interface ParseOptions {
  maxDiffDistance: number;
  maxChangeRatio: number;
  mergeModifiedLines: boolean;
  inlineMaxCharEdits: number;
  wordDiff: boolean;
}
⋮----
const calculateChangeRatio = (a: string, b: string): number =>
⋮----
const isSimilarEnough = (a: string, b: string, maxChangeRatio: number): boolean =>
⋮----
const changeToLine = (change: _Change): Line => (
⋮----
const diffCharsIfWithinEditLimit = (
  a: string,
  b: string,
  maxEdits = 4,
):
  | {
      exceededLimit: true;
    }
  | {
      exceededLimit: false;
      diffs: LineSegment[];
    } => {
  const diffs = diffChars(a, b);
⋮----
const buildInlineDiffSegments = (current: _Change, next: _Change, options: ParseOptions): Line['content'] =>
⋮----
const mergeIntoResult = (segment: LineSegment) =>
⋮----
const mergeAdjacentLines = (changes: _Change[], options: ParseOptions): Line[] =>
⋮----
const buildChangeIndices = (changes: _Change[]) =>
⋮----
// TODO: slight penalty for distance?
// TODO: improve performance w binary search?
const findBestInsertForDelete = (changes: _Change[], delIdx: number, insertIdxs: number[], pairOfAdd: Int32Array, options: ParseOptions): number =>
⋮----
const buildInitialPairs = (changes: _Change[], insertIdxs: number[], deleteIdxs: number[], options: ParseOptions) =>
⋮----
const buildUnpairedDeletePrefix = (changes: _Change[], pairOfDel: Int32Array) =>
⋮----
const hasUnpairedDeleteBetween = (unpairedDelPrefix: Int32Array, deleteIdx: number, insertIdx: number) =>
⋮----
const emitNormal = (out: Line[], c: _Change) =>
⋮----
const emitModified = (out: Line[], del: DeleteChange, add: InsertChange, options: ParseOptions) =>
⋮----
const emitLines = (changes: _Change[], pairOfDel: Int32Array, pairOfAdd: Int32Array, unpairedDelPrefix: Int32Array, options: ParseOptions): Line[] =>
⋮----
// Defer emission to paired insert
⋮----
export const mergeModifiedLines = (changes: _Change[], options: ParseOptions): Line[] =>
⋮----
const parseHunk = (hunk: _Hunk, options: ParseOptions): Hunk =>
⋮----
const extractHunkContext = (header: string): string
⋮----
const insertSkipBlocks = (hunks: Hunk[]): (Hunk | SkipBlock)[] =>
⋮----
export const parseDiff = (diff: string, options?: Partial<ParseOptions>): File[] =>

================
File: src/renderer/src/components/common/Accordion.tsx
================
import { ReactNode, useEffect, useRef, useState, Activity } from 'react';
import { FaChevronDown } from 'react-icons/fa';
import { clsx } from 'clsx';
import { useTranslation } from 'react-i18next';
import { twMerge } from 'tailwind-merge';
⋮----
type Props = {
  title: ReactNode;
  children: ReactNode;
  className?: string;
  buttonClassName?: string;
  defaultOpen?: boolean;
  chevronPosition?: 'left' | 'right';
  isOpen?: boolean;
  onOpenChange?: (isOpen: boolean) => void;
  noMaxHeight?: boolean;
  scrollToVisibleWhenExpanded?: boolean;
  showCollapseButton?: boolean;
};
⋮----
const handleOpenChange = () =>
⋮----
className=

================
File: src/renderer/src/components/common/BaseDialog.tsx
================
import { FocusTrap } from 'focus-trap-react';
import { ReactNode, useRef } from 'react';
import { useTranslation } from 'react-i18next';
import { twMerge } from 'tailwind-merge';
import { useHotkeys } from 'react-hotkeys-hook';
⋮----
type Props = {
  title: string;
  onClose?: () => void;
  children: ReactNode;
  contentClass?: string;
  footer?: ReactNode;
  width?: number;
  closeOnEscape?: boolean;
  closeButtonText?: string;
};
⋮----
className=

================
File: src/renderer/src/components/common/Button.tsx
================
import { ReactNode, MouseEvent } from 'react';
import { twMerge } from 'tailwind-merge';
⋮----
export type ButtonVariant = 'contained' | 'text' | 'outline';
export type ButtonColor = 'primary' | 'secondary' | 'tertiary' | 'danger';
export type ButtonSize = 'sm' | 'md' | 'xs';
⋮----
type Props = {
  children: ReactNode;
  onClick?: (e: MouseEvent<HTMLButtonElement>) => void;
  variant?: ButtonVariant;
  color?: ButtonColor;
  className?: string;
  disabled?: boolean;
  autoFocus?: boolean;
  size?: ButtonSize;
  type?: 'button' | 'submit' | 'reset';
};
⋮----
export const Button = ({
  children,
  onClick,
  variant = 'contained',
  color = 'primary',
  className = '',
  disabled = false,
  autoFocus = false,
  size = 'md',
  type = 'button',
}: Props) =>
⋮----
className=

================
File: src/renderer/src/components/common/Checkbox.tsx
================
import { InputHTMLAttributes, ReactNode } from 'react';
import { clsx } from 'clsx';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = Omit<InputHTMLAttributes<HTMLInputElement>, 'size' | 'onChange'> & {
  label?: ReactNode;
  checked: boolean;
  onChange: (checked: boolean) => void;
  className?: string;
  size?: 'xs' | 'sm' | 'md';
  tooltip?: string;
};
⋮----
className=
⋮----
className="sr-only" // Hide the actual input but keep it accessible

================
File: src/renderer/src/components/common/Chip.tsx
================
import { IoClose } from 'react-icons/io5';
import { twMerge } from 'tailwind-merge';
⋮----
import { IconButton } from '@/components/common/IconButton';
⋮----
type Props = {
  label: string;
  onRemove?: () => void;
  removeTooltip?: string;
  className?: string;
};
⋮----
className=

================
File: src/renderer/src/components/common/CodeBlock.tsx
================
import { startTransition, useMemo, useOptimistic, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { AiOutlineLoading3Quarters } from 'react-icons/ai';
import { MdKeyboardArrowDown, MdUndo } from 'react-icons/md';
import { VscCode } from 'react-icons/vsc';
import { DiffViewMode } from '@common/types';
⋮----
import { CopyMessageButton } from '../message/CopyMessageButton';
⋮----
import { MermaidDiagram } from './MermaidDiagram';
import { IconButton } from './IconButton';
import { CompactSelect } from './CompactSelect';
⋮----
import { DiffViewer, UDiffViewer, CompactDiffViewer } from '@/components/common/DiffViewer';
import { useApi } from '@/contexts/ApiContext';
import { useSettings } from '@/contexts/SettingsContext';
import { useResponsive } from '@/hooks/useResponsive';
import { highlightWithLowlight } from '@/utils/highlighter';
⋮----
const isCustomDiffContent = (content: string): boolean =>
⋮----
const isUdiffContent = (content: string): boolean =>
⋮----
const parseDiffContent = (content: string):
⋮----
// We have old value complete and new value being streamed
⋮----
// We have complete diff
⋮----
type Props = {
  baseDir: string;
  taskId?: string;
  language: string;
  children?: string;
  file?: string;
  isComplete?: boolean;
  oldValue?: string;
  newValue?: string;
};
⋮----
const handleDiffViewModeChange = (value: string) =>
⋮----
diffOldValue = oldValue!; // Known to be string
diffNewValue = newValue!; // Known to be string
⋮----
const parsed = parseDiffContent(children!); // children is non-null and a diff
⋮----
// Not a diff, display children as plain code (if it exists)
⋮----
const handleRevertChanges = () =>
⋮----
<div onClick=

================
File: src/renderer/src/components/common/CodeInline.tsx
================
import { clsx } from 'clsx';
import { ReactNode } from 'react';
⋮----
type Props = {
  className?: string;
  children?: ReactNode;
};
⋮----
export const CodeInline = (
⋮----
className=

================
File: src/renderer/src/components/common/CompactSelect.tsx
================
import { Listbox, ListboxButton, ListboxOption, ListboxOptions, Transition } from '@headlessui/react';
import { Fragment, ReactNode } from 'react';
import { HiCheck, HiChevronDown } from 'react-icons/hi2';
import { clsx } from 'clsx';
⋮----
export type CompactOption = {
  label: ReactNode;
  value: string;
};
⋮----
type Props = {
  options: CompactOption[];
  value: string;
  onChange: (value: string) => void;
  className?: string;
};
⋮----
<div className=
⋮----
clsx(

================
File: src/renderer/src/components/common/ConfirmDialog.tsx
================
import { ReactNode } from 'react';
import { useTranslation } from 'react-i18next';
⋮----
import { BaseDialog } from './BaseDialog';
import { Button, ButtonColor } from './Button';
⋮----
type Props = {
  title: string;
  onConfirm: () => void;
  onCancel: () => void;
  confirmButtonText?: string;
  cancelButtonText?: string;
  contentClass?: string;
  children: ReactNode;
  disabled?: boolean;
  confirmButtonClass?: string;
  confirmButtonColor?: ButtonColor;
  width?: number;
  closeOnEscape?: boolean;
  footerAdditionalComponents?: ReactNode;
};

================
File: src/renderer/src/components/common/DatePicker.css
================
.react-datepicker {
⋮----
.react-datepicker__header {
⋮----
.react-datepicker__triangle {
⋮----
@apply hidden;
⋮----
.react-datepicker__current-month,
⋮----
@apply text-text-primary;
⋮----
.react-datepicker__day-name,
⋮----
.react-datepicker__day:hover {
⋮----
@apply bg-bg-tertiary;
⋮----
.react-datepicker__day--selected,
⋮----
@apply bg-info-light;
⋮----
.react-datepicker__day--keyboard-selected {

================
File: src/renderer/src/components/common/DatePicker.tsx
================
import { forwardRef, ReactNode } from 'react';
import ReactDatePicker, { type DatePickerProps } from 'react-datepicker';
⋮----
import { FaCalendarAlt } from 'react-icons/fa';
import { clsx } from 'clsx';
⋮----
import { Input } from './Input';
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
⋮----
type Props = DatePickerProps & {
  label?: ReactNode;
};
⋮----
className=

================
File: src/renderer/src/components/common/FileChip.tsx
================
import { useTranslation } from 'react-i18next';
⋮----
import { Chip } from '@/components/common/Chip';
⋮----
type Props = {
  path: string;
  onRemove: (path: string) => void;
};
⋮----
export const FileChip = (
⋮----
return <Chip key=

================
File: src/renderer/src/components/common/HtmlInfoDialog.tsx
================
import { useTranslation } from 'react-i18next';
⋮----
import { BaseDialog } from '@/components/common/BaseDialog';
⋮----
type Props = {
  title: string;
  text: string;
  onClose: () => void;
};

================
File: src/renderer/src/components/common/IconButton.tsx
================
import { MouseEvent, ReactNode } from 'react';
import { twMerge } from 'tailwind-merge';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  icon: ReactNode;
  onClick?: () => void;
  tooltip?: ReactNode;
  className?: string;
  disabled?: boolean;
  'data-testid'?: string;
};
⋮----
export const IconButton = (
⋮----
const handleClick = (e: MouseEvent<HTMLDivElement>) =>

================
File: src/renderer/src/components/common/InfoIcon.tsx
================
import { FaInfoCircle } from 'react-icons/fa';
import { ReactNode } from 'react';
import { clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';
⋮----
import { IconButton } from './IconButton';
⋮----
type Props = {
  tooltip: ReactNode;
  className?: string;
  size?: 'sm' | 'md' | 'lg';
};
⋮----
export const InfoIcon = (
⋮----
className=

================
File: src/renderer/src/components/common/Input.tsx
================
import { forwardRef, InputHTMLAttributes, ReactNode } from 'react';
import { twMerge } from 'tailwind-merge';
⋮----
type InputSize = 'md' | 'sm';
⋮----
export type Props = Omit<InputHTMLAttributes<HTMLInputElement>, 'size'> & {
  wrapperClassName?: string;
  label?: ReactNode;
  size?: InputSize;
};

================
File: src/renderer/src/components/common/ItemSelector.tsx
================
import { ElementType, useRef, useState } from 'react';
import { MdKeyboardArrowDown, MdKeyboardArrowUp } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
import { useClickOutside } from '@/hooks/useClickOutside';
⋮----
export type ItemConfig<T extends string = string> = {
  value: T;
  icon: ElementType;
  labelKey: string;
  tooltipKey?: string;
};
⋮----
type PopupPlacement = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';
⋮----
const getPopupPositionClasses = (placement: PopupPlacement): string =>
⋮----
type Props<T extends string = string> = {
  items: ItemConfig<T>[];
  selectedValue: T;
  onChange: (value: T) => void;
  className?: string;
  disabled?: boolean;
  popupPlacement?: PopupPlacement;
  minWidth?: number;
  iconOnly?: boolean;
};
⋮----
export const ItemSelector = <T extends string = string>({
  items,
  selectedValue,
  onChange,
  className = '',
  disabled = false,
  popupPlacement = 'top-left',
  minWidth = 150,
  iconOnly = false,
}: Props<T>) =>
⋮----
const toggleOpen = () =>
⋮----
const handleItemSelect = (value: T) =>
⋮----
const renderItem = (item: ItemConfig<T>) =>

================
File: src/renderer/src/components/common/LoadingOverlay.tsx
================
import { AnimatePresence, motion } from 'framer-motion';
import { CgSpinner } from 'react-icons/cg';
import { clsx } from 'clsx';
⋮----
type Props = {
  message: string;
  spinnerSize?: 'sm' | 'md' | 'lg';
  animateOpacity?: boolean;
};
⋮----
export const LoadingOverlay = (

================
File: src/renderer/src/components/common/LoadingText.tsx
================
import { ReactNode } from 'react';
⋮----
import { useTypingAnimation } from '@/hooks/useTypingAnimation';
⋮----
type Props = {
  label: string;
  typingSpeed?: number;
  pauseDuration?: number;
  icon?: ReactNode;
  className?: string;
};
⋮----
export const LoadingText = (

================
File: src/renderer/src/components/common/MarkdownInfoDialog.tsx
================
import ReactMarkdown from 'react-markdown';
import { useTranslation } from 'react-i18next';
⋮----
import { BaseDialog } from '@/components/common/BaseDialog';
⋮----
type Props = {
  title: string;
  text: string;
  onClose: () => void;
};

================
File: src/renderer/src/components/common/MermaidDiagram.tsx
================
import { useEffect, useId, useState } from 'react';
import mermaid from 'mermaid';
import { CgSpinner } from 'react-icons/cg';
⋮----
type Props = {
  code: string;
  className?: string;
};
⋮----
export const MermaidDiagram = (
⋮----
const renderDiagram = async () =>

================
File: src/renderer/src/components/common/ModalOverlayLayout.tsx
================
import { ReactNode } from 'react';
import { useTranslation } from 'react-i18next';
import { IoMdClose } from 'react-icons/io';
import { useHotkeys } from 'react-hotkeys-hook';
⋮----
import { IconButton } from './IconButton';
⋮----
type Props = {
  title: string;
  children: ReactNode;
  onClose?: () => void;
  closeOnEscape?: boolean;
};

================
File: src/renderer/src/components/common/MultiSelect.tsx
================
import { useState, useRef, ReactNode } from 'react';
import { createPortal } from 'react-dom';
import { HiChevronUpDown } from 'react-icons/hi2';
import { useTranslation } from 'react-i18next';
⋮----
import { Checkbox } from './Checkbox';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
⋮----
type Option = {
  value: string;
  label: string;
};
⋮----
type Props = {
  options: Option[];
  selected: string[];
  onChange: (selected: string[]) => void;
  label?: ReactNode;
  className?: string;
  size?: 'sm' | 'md' | 'lg';
  noneSelectedLabel?: string;
  filterInput?: boolean;
};
⋮----
const handleToggle = () =>
⋮----
const handleCheckboxChange = (value: string) =>
⋮----
const handleSelectAll = () =>
⋮----
? noneSelectedLabel || t('multiselect.noneSelected')
? t('multiselect.allSelected')
⋮----
<Checkbox label=

================
File: src/renderer/src/components/common/RadioButton.tsx
================
import { ReactNode } from 'react';
⋮----
type Props = {
  id: string;
  name: string;
  value: string;
  checked: boolean;
  onChange: (value: string) => void;
  label?: ReactNode;
  className?: string;
};
⋮----
export const RadioButton = (
⋮----
const handleChange = () =>
⋮----
className="sr-only" // Hide the actual input but keep it accessible

================
File: src/renderer/src/components/common/Section.tsx
================
import { ReactNode } from 'react';
import { clsx } from 'clsx';
⋮----
type Props = {
  id?: string;
  title?: string;
  children: ReactNode;
  className?: string;
};
⋮----
export const Section = (

================
File: src/renderer/src/components/common/Select.tsx
================
import { ReactNode, useRef, useCallback, useState } from 'react';
import { createPortal } from 'react-dom';
import { HiChevronUpDown, HiCheck } from 'react-icons/hi2';
import { useTranslation } from 'react-i18next';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
import { useDropdownState } from '@/hooks/useDropdownState';
import { KeyboardKeys } from '@/constants/keyboardKeys';
⋮----
export type Option = {
  label: ReactNode;
  value: string;
  style?: React.CSSProperties;
};
⋮----
type Props = {
  label?: ReactNode;
  options?: Option[];
  value?: string;
  onChange?: (value: string) => void;
  className?: string;
  size?: 'sm' | 'md' | 'lg';
  disabled?: boolean;
};
⋮----
// Pass both refs to useClickOutside
⋮----
const handleKeyDown = (e: React.KeyboardEvent) =>
⋮----
const handleOptionSelect = (option: Option) =>
⋮----
{/* Button container */}
⋮----
{/* Portal for Dropdown */}
⋮----
document.body, // Render into the body

================
File: src/renderer/src/components/common/Slider.tsx
================
import { ChangeEvent, CSSProperties, ReactNode } from 'react';
⋮----
type SliderSize = 'md' | 'sm';
⋮----
type Props = {
  label?: ReactNode;
  min: number;
  max: number;
  step?: number;
  value: number;
  onChange: (value: number) => void;
  className?: string;
  showValue?: boolean;
  size?: SliderSize;
};
⋮----
const handleChange = (e: ChangeEvent<HTMLInputElement>) =>

================
File: src/renderer/src/components/common/StyledTooltip.tsx
================
import { ReactNode } from 'react';
⋮----
type Props = {
  id: string;

  content?: ReactNode;

  maxWidth?: number | string;
};
⋮----
/**
 * @deprecated Use the new Tooltip component directly instead
 */
export const StyledTooltip = ({
  id: _id,

  content: _content,

  maxWidth: _maxWidth = '300px',
}: Props) =>
⋮----
// The new Tooltip component doesn't use ids, so this is a no-op
// The actual tooltip rendering is handled by the components that wrap
// their elements with <Tooltip content={...}>

================
File: src/renderer/src/components/common/Table.tsx
================
import React, { ReactNode, useState } from 'react';
import { MdArrowUpward, MdArrowDownward } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
⋮----
export type Column<T> = {
  accessor?: keyof T;
  header: ReactNode;
  cell?: (value: T[keyof T] | null, row: T) => ReactNode;
  headerClassName?: string;
  cellClassName?: string;
  align?: 'left' | 'center' | 'right';
  maxWidth?: string | number;
  sort?: (a: T, b: T) => number;
};
⋮----
export type FooterColumn = {
  cell: ReactNode;
  colSpan?: number;
  className?: string;
};
⋮----
type SortState = {
  columnKey: string;
  direction: 'asc' | 'desc' | null;
};
⋮----
type Props<T> = {
  data: T[];
  columns: Column<T>[];
  footerColumns?: FooterColumn[];
};
⋮----
const handleSort = (column: Column<T>) =>
⋮----
onClick=

================
File: src/renderer/src/components/common/TaskStateChip.tsx
================
import { useTranslation } from 'react-i18next';
import { twMerge } from 'tailwind-merge';
import { DefaultTaskState } from '@common/types';
⋮----
import type { TFunction } from 'i18next';
⋮----
type Props = {
  state: string;
  className?: string;
};
⋮----
const getStateTextClass = (state: string): string =>
⋮----
export const getTaskStateLabel = (t: TFunction, state: string) =>
⋮----
export const TaskStateChip = (
⋮----
<span className=

================
File: src/renderer/src/components/common/TextArea.tsx
================
import { ReactNode, TextareaHTMLAttributes } from 'react';
⋮----
export type Props = TextareaHTMLAttributes<HTMLTextAreaElement> & {
  label?: ReactNode;
  wrapperClassName?: string;
};
⋮----
export const TextArea = (

================
File: src/renderer/src/components/common/TriStateCheckbox.tsx
================
import { InputHTMLAttributes } from 'react';
⋮----
type TriState = 'checked' | 'unchecked' | 'indeterminate';
⋮----
type Props = InputHTMLAttributes<HTMLInputElement> & {
  label?: string;
  state: TriState;
  onChange: () => void;
  className?: string;
};
⋮----
onClick=

================
File: src/renderer/src/components/common/VerticalDotsMenu.tsx
================
import React, { useRef, useState } from 'react';
import { FaEllipsisVertical } from 'react-icons/fa6';
import { clsx } from 'clsx';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
⋮----
export type MenuOption = {
  label: string;
  action: () => void;
  icon?: React.ReactNode;
  disabled?: boolean;
};
⋮----
type Props = {
  options: MenuOption[];
  className?: string;
};
⋮----
const handleMenuClick = () =>
⋮----
const handleOptionClick = (option: MenuOption) =>
⋮----
<div className=
⋮----
className={clsx(
            'transition-opacity p-1.5 rounded-md hover:bg-bg-tertiary text-text-muted hover:text-text-primary',
            !isMenuOpen && 'opacity-0 group-hover:opacity-100',
          )}
onClick=

================
File: src/renderer/src/components/common/VirtualTable.tsx
================
import { ReactNode, useMemo, useState } from 'react';
⋮----
import { useVirtualizer } from '@tanstack/react-virtual';
import { flexRender, getCoreRowModel, useReactTable, type ColumnDef, type SortingState } from '@tanstack/react-table';
import { twMerge } from 'tailwind-merge';
import { MdArrowUpward, MdArrowDownward } from 'react-icons/md';
⋮----
import { Column, FooterColumn } from './Table';
⋮----
type Props<T> = {
  data: T[];
  columns: Column<T>[];
  footerColumns?: FooterColumn[];
  rowHeight?: number | ((params: { index: number }) => number);
  overscanCount?: number;
  disableHeader?: boolean;
  getRowClassName?: (row: T, index: number) => string | undefined;
};
⋮----
// Apply manual sorting to data
⋮----
// Convert Column<T> to ColumnDef<T> for @tanstack/react-table
⋮----
// Create table instance
⋮----
// Parent ref for virtualizer
⋮----
// Create virtualizer
⋮----
{/* Header - Outside virtualized area */}
⋮----

⋮----
{/* Virtualized body */}
⋮----
{/* Footer - Outside virtualized area */}

================
File: src/renderer/src/components/common/WarningIcon.tsx
================
import { FaExclamationTriangle } from 'react-icons/fa';
import { ReactNode } from 'react';
import { clsx } from 'clsx';
⋮----
import { IconButton } from './IconButton';
⋮----
type Props = {
  tooltip: ReactNode;
  className?: string;
  size?: 'sm' | 'md' | 'lg';
};
⋮----
export const WarningIcon = (
⋮----
className=

================
File: src/renderer/src/components/ContextFiles/ContextFiles.css
================
.rct-tree-items-container {
⋮----
.rct-tree-root {
⋮----
@apply p-0;
⋮----
.context-dimmed {
⋮----
@apply text-text-muted;
⋮----
body.theme-light .context-dimmed {
⋮----
.context-files-root.drag-over {
⋮----
@apply bg-bg-tertiary;
⋮----
@tailwind utilities;

================
File: src/renderer/src/components/ContextFiles/ContextFiles.tsx
================
import { AIDER_MODES, ContextFile, Mode, OS, TokensInfoData, UpdatedFile } from '@common/types';
import React, { useCallback, useEffect, useMemo, useState } from 'react';
import objectHash from 'object-hash';
import { ControlledTreeEnvironment, Tree } from 'react-complex-tree';
import { HiChevronDown, HiChevronRight, HiOutlineTrash, HiPlus, HiX } from 'react-icons/hi';
import { MdOutlinePublic, MdOutlineRefresh, MdOutlineSearch } from 'react-icons/md';
import { BiCollapseVertical, BiExpandVertical } from 'react-icons/bi';
import { TbPencilOff } from 'react-icons/tb';
import { RiRobot2Line } from 'react-icons/ri';
import { VscFileCode } from 'react-icons/vsc';
import { FaGitSquare } from 'react-icons/fa';
import { useTranslation } from 'react-i18next';
import { useDebounce, useLocalStorage } from '@reactuses/core';
import { AnimatePresence, motion } from 'framer-motion';
import { clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';
⋮----
import { UpdatedFilesDiffModal } from './UpdatedFilesDiffModal';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
import { Input } from '@/components/common/Input';
import { useOS } from '@/hooks/useOS';
import { useApi } from '@/contexts/ApiContext';
⋮----
interface TreeItem {
  index: string | number;
  isFolder?: boolean;
  children?: (string | number)[];
  data: string;
  file?: ContextFile;
}
⋮----
const normalizePath = (path: string): string =>
⋮----
const createFileTree = (files: ContextFile[], rootId = 'root') =>
⋮----
// Ensure file data is updated if it exists
⋮----
// Sort children: folders first, then files, both alphabetically
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  allFiles: string[];
  contextFiles: ContextFile[];
  showFileDialog: () => void;
  tokensInfo?: TokensInfoData | null;
  refreshAllFiles: (useGit?: boolean) => Promise<void>;
  mode: Mode;
};
⋮----
type EmptyContextInfoProps = {
  mode: Mode;
};
⋮----
// Separate expanded items for each tree
⋮----
// Updated files state
⋮----
// Calculate total additions and deletions for updated files
⋮----
// Fetch updated files on mount and when baseDir/taskId changes
⋮----
// eslint-disable-next-line no-console
⋮----
// Listen for updated files updates
⋮----
// eslint-disable-next-line no-console
⋮----
// Tree Data Generators
⋮----
// Check if readOnly in context files
⋮----
// Expand logic for Context Tree (auto-expand folders with files)
⋮----
const expandFolders = (treeData: Record<string, TreeItem>, files: ContextFile[], currentExpanded: string[], setExpanded: (items: string[]) => void) =>
⋮----
const checkChild = (childKey: string | number) =>
⋮----
// Only auto-expand context and rules trees
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// Expand all folders in updated tree by default
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
const handleDropAllFiles = () =>
⋮----
const handleDragOver = (event: React.DragEvent<HTMLDivElement>) =>
⋮----
const handleDragLeave = (event: React.DragEvent<HTMLDivElement>) =>
⋮----
const handleSearchToggle = () =>
⋮----
const handleRefreshFiles = async (useGit: boolean) =>
⋮----
// eslint-disable-next-line no-console
⋮----
const toggleUseGit = () =>
⋮----
const handleSearchClose = () =>
⋮----
const dropFile = (item: TreeItem) => (e: React.MouseEvent<HTMLButtonElement>) =>
⋮----
const addFile = (item: TreeItem) => (event: React.MouseEvent<HTMLButtonElement>) =>
⋮----
// Actions logic
⋮----
// Get line stats for updated files section
⋮----
// Helper functions
const toggleFolder = () =>
⋮----
const renderChevron = () =>
⋮----
const renderTitle = () =>
⋮----
// Show line stats for updated files with click handler
⋮----

⋮----
<button onClick=
⋮----
className=
⋮----
{/* Search Field */}
⋮----
key={objectHash(treeData)} // Force re-render if data structure changes drastically
⋮----
onExpandItem=
⋮----
{/* Context Files Section */}
⋮----
<Tooltip content=
⋮----
{/* Updated Files Section */}
⋮----
{/* Project Files Section */}
⋮----
<FaGitSquare className=
⋮----
onClick=
⋮----
{/* Rules Section */}

================
File: src/renderer/src/components/ContextFiles/index.ts
================


================
File: src/renderer/src/components/ContextFiles/UpdatedFilesDiffModal.tsx
================
import { useCallback, useMemo, useState, startTransition, useOptimistic } from 'react';
import { HiChevronLeft, HiChevronRight } from 'react-icons/hi';
import { useTranslation } from 'react-i18next';
import { useHotkeys } from 'react-hotkeys-hook';
import { DiffViewMode, UpdatedFile } from '@common/types';
import { getLanguageFromPath } from '@common/utils';
import { clsx } from 'clsx';
⋮----
import { IconButton } from '../common/IconButton';
import { ModalOverlayLayout } from '../common/ModalOverlayLayout';
import { UDiffViewer, CompactDiffViewer } from '../common/DiffViewer';
import { CompactSelect } from '../common/CompactSelect';
⋮----
import { useSettings } from '@/contexts/SettingsContext';
⋮----
type Props = {
  files: UpdatedFile[];
  initialFileIndex: number;
  onClose: () => void;
};
⋮----
<ModalOverlayLayout title=

================
File: src/renderer/src/components/message/ActivateSkillToolMessage.tsx
================
import { MdPsychology } from 'react-icons/md';
import { CgSpinner } from 'react-icons/cg';
import { useTranslation } from 'react-i18next';
import { VscError } from 'react-icons/vsc';
import { clsx } from 'clsx';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
import { ExpandableMessageBlock } from './ExpandableMessageBlock';
import { parseToolContent } from './utils';
⋮----
import { ToolMessage } from '@/types/message';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
<div className=

================
File: src/renderer/src/components/message/AssistantMessageBlock.tsx
================
import { memo, useRef } from 'react';
import { clsx } from 'clsx';
import { RiRobot2Line } from 'react-icons/ri';
import { UsageReportData } from '@common/types';
⋮----
import { MessageBar } from './MessageBar';
import { MessageBlock } from './MessageBlock';
import { areMessagesEqual } from './utils';
⋮----
import { useParsedContent } from '@/hooks/useParsedContent';
import { AssistantGroupMessage, isResponseMessage, isToolMessage, ToolMessage } from '@/types/message';
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  message: AssistantGroupMessage;
  allFiles: string[];
  renderMarkdown: boolean;
  remove?: () => void;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
};
⋮----
const aggregateUsage = (): UsageReportData | undefined =>
⋮----
{/* Response content */}
⋮----
{/* Tool messages - using MessageBlock with hideMessageBar to avoid duplicate MessageBars */}
⋮----
<div className=
⋮----
{/* Single MessageBar for the entire group */}
⋮----
const arePropsEqual = (prevProps: Props, nextProps: Props): boolean =>

================
File: src/renderer/src/components/message/BashToolMessage.tsx
================
import { useEffect, useRef } from 'react';
import { useTranslation } from 'react-i18next';
import { RiTerminalLine, RiErrorWarningFill, RiCheckboxCircleFill, RiCloseCircleFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { MdKeyboardDoubleArrowDown } from 'react-icons/md';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
import { CopyMessageButton } from '@/components/message/CopyMessageButton';
import { IconButton } from '@/components/common/IconButton';
import { useScrollingPaused } from '@/hooks/useScrollingPaused';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const handleScrollToBottom = () =>
⋮----
const handleExpandedChange = (open: boolean) =>
⋮----
aria-label=

================
File: src/renderer/src/components/message/CommandOutputMessageBlock.tsx
================
import { BiTerminal } from 'react-icons/bi';
import { useTranslation } from 'react-i18next';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
⋮----
import { CommandOutputMessage } from '@/types/message';
⋮----
type Props = {
  message: CommandOutputMessage;
  compact?: boolean;
};

================
File: src/renderer/src/components/message/CompactToolMessage.tsx
================
import { ReactNode, memo } from 'react';
import { CgSpinner } from 'react-icons/cg';
import { RiToolsFill } from 'react-icons/ri';
import { useTranslation } from 'react-i18next';
import { VscError } from 'react-icons/vsc';
import { IoChevronDown, IoChevronForward } from 'react-icons/io5';
import { clsx } from 'clsx';
import {
  AIDER_TOOL_ADD_CONTEXT_FILES,
  AIDER_TOOL_DROP_CONTEXT_FILES,
  AIDER_TOOL_GROUP_NAME,
  AIDER_TOOL_RUN_PROMPT,
  POWER_TOOL_BASH,
  POWER_TOOL_FETCH,
  POWER_TOOL_FILE_READ,
  POWER_TOOL_GLOB,
  POWER_TOOL_GREP,
  POWER_TOOL_GROUP_NAME,
  POWER_TOOL_SEMANTIC_SEARCH,
} from '@common/tools';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
import { parseToolContent } from './utils';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
⋮----
type Props = {
  message: ToolMessage;
  isExpanded: boolean;
  onToggle: () => void;
};
⋮----
const formatName = (name: string): string =>
⋮----
const defaultLabel = () => t('toolMessage.toolLabel',
⋮----
<span>
⋮----

⋮----
className=
⋮----
{/* Header - clickable to toggle */}
⋮----
<div className=
⋮----
{/* Expanded content */}

================
File: src/renderer/src/components/message/CopyMessageButton.tsx
================
import { BiCopy } from 'react-icons/bi';
import { useTranslation } from 'react-i18next';
import { twMerge } from 'tailwind-merge';
⋮----
import { IconButton } from '../common/IconButton';
⋮----
import { showInfoNotification } from '@/utils/notifications';
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  content: string;
  className?: string;
  alwaysShow?: boolean;
};
⋮----
const copyToClipboard = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
icon=

================
File: src/renderer/src/components/message/CreateTaskToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiCheckboxCircleFill, RiCloseCircleFill, RiErrorWarningFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { MdAssignmentAdd } from 'react-icons/md';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
{/* Task Details */}

================
File: src/renderer/src/components/message/CustomCommandBashBlock.tsx
================
import { useState } from 'react';
import { FaChevronDown, FaChevronRight } from 'react-icons/fa';
import { BiTerminal } from 'react-icons/bi';
⋮----
import { CodeBlock } from '@/components/common/CodeBlock';
⋮----
type Props = {
  baseDir: string;
  command: string;
  output: string;
};
⋮----
const toggleAccordion = () =>

================
File: src/renderer/src/components/message/DeleteMemoryToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { FaBrain, FaCheckCircle, FaExclamationTriangle, FaTimesCircle } from 'react-icons/fa';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
{/* Memory Details */}

================
File: src/renderer/src/components/message/DeleteTaskToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiCheckboxCircleFill, RiCloseCircleFill, RiErrorWarningFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { LiaFolderMinusSolid } from 'react-icons/lia';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { TaskStateChip } from '@/components/common/TaskStateChip';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const renderStatusIcon = () =>

================
File: src/renderer/src/components/message/ExpandableMessageBlock.tsx
================
import { ReactNode, useEffect, useState, forwardRef, useImperativeHandle } from 'react';
import { UsageReportData } from '@common/types';
⋮----
import { MessageBar } from './MessageBar';
⋮----
import { Accordion } from '@/components/common/Accordion';
⋮----
type Props = {
  title: ReactNode;
  content: ReactNode;
  copyContent?: string;
  usageReport?: UsageReportData;
  onRemove?: () => void;
  initialExpanded?: boolean;
  onOpenChange?: (open: boolean) => void;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
export interface ExpandableMessageBlockRef {
  open: () => void;
  close: () => void;
}
⋮----
const handleExpandedChange = (open: boolean) =>
⋮----
{/* Gradient overlay for initial auto-expand */}

================
File: src/renderer/src/components/message/FetchToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiLinkM, RiErrorWarningFill, RiCheckboxCircleFill, RiCloseCircleFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { highlightWithLowlight } from '@/utils/highlighter';
import { CopyMessageButton } from '@/components/message/CopyMessageButton';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const renderStatusIcon = () =>
⋮----
const renderContent = () =>

================
File: src/renderer/src/components/message/FileEditToolMessage.tsx
================
import { useLayoutEffect, useRef } from 'react';
import { RiCheckboxCircleFill, RiEditLine, RiErrorWarningFill, RiCloseCircleFill } from 'react-icons/ri';
import { getLanguageFromPath } from '@common/utils';
import { CgSpinner } from 'react-icons/cg';
import { useTranslation } from 'react-i18next';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeBlock } from '@/components/common/CodeBlock';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock, ExpandableMessageBlockRef } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
<strong>

================
File: src/renderer/src/components/message/FileReadToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiFileTextLine, RiCheckboxCircleFill, RiErrorWarningFill, RiCloseCircleFill } from 'react-icons/ri';
import { getLanguageFromPath } from '@common/utils';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeBlock } from '@/components/common/CodeBlock';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
{/* File content - filter out line numbers if present */}
⋮----
{/* Parameter information */}

================
File: src/renderer/src/components/message/FileWriteToolMessage.tsx
================
import { useLayoutEffect, useRef } from 'react';
import { RiCheckboxCircleFill, RiEditLine, RiErrorWarningFill, RiCloseCircleFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { useTranslation } from 'react-i18next';
import { FileWriteMode } from '@common/types';
import { getLanguageFromPath } from '@common/utils';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeBlock } from '@/components/common/CodeBlock';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock, ExpandableMessageBlockRef } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const formatName = (name: string): string =>
⋮----
const getToolName = (): string =>

================
File: src/renderer/src/components/message/GetTaskMessageToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiMessage3Line, RiCheckboxCircleFill, RiErrorWarningFill, RiCloseCircleFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const renderStatusIcon = () =>

================
File: src/renderer/src/components/message/GetTaskToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiCheckboxCircleFill, RiCloseCircleFill, RiErrorWarningFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { MdAssignment } from 'react-icons/md';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { TaskStateChip } from '@/components/common/TaskStateChip';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
type ContextFile = {
    path: string;
    readOnly?: boolean;
  };
⋮----
const renderStatusIcon = () =>
⋮----
{/* Task Header */}
⋮----
{/* Task Configuration */}
⋮----
{/* Context Files */}
⋮----
{/* Context Messages Count */}

================
File: src/renderer/src/components/message/GlobToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiFolderLine, RiFileTextLine, RiErrorWarningFill, RiCheckboxCircleFill, RiCloseCircleFill } from 'react-icons/ri';
import { LuFolderSearch } from 'react-icons/lu';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};

================
File: src/renderer/src/components/message/GrepToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiErrorWarningFill, RiCheckboxCircleFill, RiCloseCircleFill } from 'react-icons/ri';
import { LuFileSearch } from 'react-icons/lu';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};

================
File: src/renderer/src/components/message/GroupMessageBlock.tsx
================
import { AnimatePresence, motion } from 'framer-motion';
import { memo, useMemo, useState, MouseEvent } from 'react';
import { clsx } from 'clsx';
import { useTranslation } from 'react-i18next';
import { LocalizedString, UsageReportData } from '@common/types';
⋮----
import { MessageBlock } from './MessageBlock';
import { MessageBar } from './MessageBar';
import { areMessagesEqual } from './utils';
⋮----
import { Accordion } from '@/components/common/Accordion';
import { GroupMessage, isResponseMessage, isToolMessage, isUserMessage, Message, ResponseMessage, ToolMessage } from '@/types/message';
import { Button } from '@/components/common/Button';
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  message: GroupMessage;
  allFiles: string[];
  renderMarkdown: boolean;
  remove?: (message: Message) => void;
  redo?: () => void;
  edit?: (content: string) => void;
  onInterrupt?: (interruptId?: string) => void;
};
⋮----
const aggregateUsage = (messages: Message[]): UsageReportData | undefined =>
⋮----
// Find all messages with usageReport and the last one
⋮----
// Use tokens from the last message with usage
⋮----
// Sum costs from all messages with usage
⋮----
const getGroupDisplayName = (name?: string | LocalizedString) =>
⋮----
// name is LocalizedString
⋮----
const handleInterrupt = (e: MouseEvent<HTMLButtonElement>) =>
⋮----
<div className=
⋮----
{/* Color Bar */}
⋮----
{/* Content */}
⋮----
const arePropsEqual = (prevProps: Props, nextProps: Props): boolean =>
⋮----
// Check basic message properties
⋮----
// Check group properties
⋮----
// Check children arrays

================
File: src/renderer/src/components/message/index.ts
================


================
File: src/renderer/src/components/message/ListMemoriesToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { FaBrain, FaCheckCircle, FaExclamationTriangle, FaTimesCircle } from 'react-icons/fa';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
// Handle array data (new format)
⋮----
{/* Memory List */}
⋮----
// Fallback for unexpected content (backward compatibility)

================
File: src/renderer/src/components/message/ListTasksToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiCheckboxCircleFill, RiCloseCircleFill, RiErrorWarningFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { LuClipboardList } from 'react-icons/lu';
⋮----
import { ToolMessage } from '@/types/message';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { TaskStateChip } from '@/components/common/TaskStateChip';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
type Task = {
    id: string;
    name: string;
    archived?: boolean;
    description?: string;
    createdAt?: string;
    updatedAt?: string;
    state?: string;
  };
⋮----
const renderStatusIcon = () =>

================
File: src/renderer/src/components/message/LoadingMessageBlock.tsx
================
import { LoadingMessage } from '@/types/message';
import { useTypingAnimation } from '@/hooks/useTypingAnimation';
import { MessageActions } from '@/components/message/MessageActions';
⋮----
type Props = {
  message: LoadingMessage;
  baseDir: string;
  taskId: string;
  onInterrupt?: () => void;
};

================
File: src/renderer/src/components/message/LogMessageBlock.tsx
================
import { FaInfoCircle, FaExclamationTriangle, FaExclamationCircle } from 'react-icons/fa';
import { MdClose } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
import { MessageActions } from './MessageActions';
⋮----
import { LogMessage } from '@/types/message';
import { IconButton } from '@/components/common/IconButton';
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  message: LogMessage;
  onRemove?: () => void;
  compact?: boolean;
  onInterrupt?: () => void;
};
⋮----
const renderMessage = () => (
    <div className="flex items-start gap-3">
      <Icon className="inline-block h-3 w-3 flex-shrink-0 mt-[3px]" />
      <div>{t(message.content)}</div>
    </div>
  );
⋮----
<CopyMessageButton content=

================
File: src/renderer/src/components/message/MessageActions.tsx
================
import { useTranslation } from 'react-i18next';
import { useState } from 'react';
⋮----
import { Button } from '../common/Button';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  actionIds: string[];
  baseDir: string;
  taskId: string;
  onInterrupt?: () => void;
};
⋮----
const handleAbortRebase = () =>
⋮----
const handleContinueRebase = () =>
⋮----
const handleResolveConflictsWithAgent = () =>
⋮----
const handleRebaseWorktree = () =>

================
File: src/renderer/src/components/message/MessageBar.tsx
================
import { useRef, useState, useCallback } from 'react';
import { createPortal } from 'react-dom';
import { useTranslation } from 'react-i18next';
import { UsageReportData } from '@common/types';
import { MdCallSplit, MdDeleteForever, MdDeleteSweep, MdEdit, MdRedo } from 'react-icons/md';
import { FaEllipsisVertical } from 'react-icons/fa6';
import { twMerge } from 'tailwind-merge';
⋮----
import { IconButton } from '../common/IconButton';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
import { UsageInfo } from './UsageInfo';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
⋮----
type MenuPosition = {
  top?: number;
  bottom?: number;
  right?: number;
  left?: number;
};
⋮----
type Props = {
  className?: string;
  content?: string;
  usageReport?: UsageReportData;
  remove?: () => void;
  redo?: () => void;
  edit?: () => void;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
};
⋮----
// Position menu above the button, aligned to the right edge
⋮----
const handleRemoveClick = () =>
⋮----
const handleRedoClick = () =>
⋮----
const handleEditClick = () =>
⋮----
const handleForkClick = () =>
⋮----
const handleRemoveUpToClick = () =>
⋮----
<div className=

================
File: src/renderer/src/components/message/MessageBlock.tsx
================
import { memo } from 'react';
import { useTranslation } from 'react-i18next';
import {
  HELPERS_TOOL_GROUP_NAME,
  HELPERS_TOOL_INVALID_TOOL_ARGUMENTS,
  HELPERS_TOOL_NO_SUCH_TOOL,
  MEMORY_TOOL_GROUP_NAME,
  MEMORY_TOOL_STORE,
  MEMORY_TOOL_RETRIEVE,
  MEMORY_TOOL_DELETE,
  MEMORY_TOOL_LIST,
  MEMORY_TOOL_UPDATE,
  POWER_TOOL_BASH,
  POWER_TOOL_FETCH,
  POWER_TOOL_FILE_EDIT,
  POWER_TOOL_FILE_READ,
  POWER_TOOL_FILE_WRITE,
  POWER_TOOL_GLOB,
  POWER_TOOL_GREP,
  POWER_TOOL_GROUP_NAME,
  POWER_TOOL_SEMANTIC_SEARCH,
  SKILLS_TOOL_ACTIVATE_SKILL,
  SKILLS_TOOL_GROUP_NAME,
  SUBAGENTS_TOOL_GROUP_NAME,
  SUBAGENTS_TOOL_RUN_TASK,
  TASKS_TOOL_GROUP_NAME,
  TASKS_TOOL_LIST_TASKS,
  TASKS_TOOL_GET_TASK,
  TASKS_TOOL_GET_TASK_MESSAGE,
  TASKS_TOOL_CREATE_TASK,
  TASKS_TOOL_DELETE_TASK,
  TASKS_TOOL_SEARCH_TASK,
  TASKS_TOOL_SEARCH_PARENT_TASK,
} from '@common/tools';
⋮----
import { CommandOutputMessageBlock } from './CommandOutputMessageBlock';
import { LoadingMessageBlock } from './LoadingMessageBlock';
import { LogMessageBlock } from './LogMessageBlock';
import { UserMessageBlock } from './UserMessageBlock';
import { ReflectedMessageBlock } from './ReflectedMessageBlock';
import { ResponseMessageBlock } from './ResponseMessageBlock';
import { ToolMessageBlock } from './ToolMessageBlock';
import { FileWriteToolMessage } from './FileWriteToolMessage';
import { FileEditToolMessage } from './FileEditToolMessage';
import { FileReadToolMessage } from './FileReadToolMessage';
import { GlobToolMessage } from './GlobToolMessage';
import { GrepToolMessage } from './GrepToolMessage';
import { BashToolMessage } from './BashToolMessage';
import { FetchToolMessage } from './FetchToolMessage';
import { SemanticSearchToolMessage } from './SemanticSearchToolMessage';
import { SubagentToolMessage } from './SubagentToolMessage';
import { ListTasksToolMessage } from './ListTasksToolMessage';
import { GetTaskToolMessage } from './GetTaskToolMessage';
import { GetTaskMessageToolMessage } from './GetTaskMessageToolMessage';
import { CreateTaskToolMessage } from './CreateTaskToolMessage';
import { DeleteTaskToolMessage } from './DeleteTaskToolMessage';
import { SearchTaskToolMessage } from './SearchTaskToolMessage';
import { SearchParentTaskToolMessage } from './SearchParentTaskToolMessage';
import { StoreMemoryToolMessage } from './StoreMemoryToolMessage';
import { RetrieveMemoryToolMessage } from './RetrieveMemoryToolMessage';
import { DeleteMemoryToolMessage } from './DeleteMemoryToolMessage';
import { ListMemoriesToolMessage } from './ListMemoriesToolMessage';
import { UpdateMemoryToolMessage } from './UpdateMemoryToolMessage';
import { ActivateSkillToolMessage } from './ActivateSkillToolMessage';
import { TaskInfoMessage } from './TaskInfoMessage';
import { areMessagesEqual } from './utils';
⋮----
import {
  isCommandOutputMessage,
  isLoadingMessage,
  isLogMessage,
  isReflectedMessage,
  isResponseMessage,
  isTaskInfoMessage,
  isToolMessage,
  isUserMessage,
  LogMessage,
  Message,
  ToolMessage,
} from '@/types/message';
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  message: Message;
  allFiles: string[];
  renderMarkdown: boolean;
  compact?: boolean;
  hideMessageBar?: boolean;
  remove?: () => void;
  redo?: () => void;
  edit?: (content: string) => void;
  onInterrupt?: () => void;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
};
⋮----
const MessageBlockComponent = ({
  baseDir,
  taskId,
  message,
  allFiles,
  renderMarkdown,
  compact = false,
  hideMessageBar = false,
  remove,
  redo,
  edit,
  onInterrupt,
  onFork,
  onRemoveUpTo,
}: Props) =>
⋮----
const arePropsEqual = (prevProps: Props, nextProps: Props): boolean =>

================
File: src/renderer/src/components/message/Messages.tsx
================
import { forwardRef, memo, useEffect, useImperativeHandle, useMemo, useRef } from 'react';
import { toPng } from 'html-to-image';
import { MdKeyboardDoubleArrowDown } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
import { DefaultTaskState, MessageViewMode, TaskData } from '@common/types';
import { TaskStateActions } from 'src/renderer/src/components/message/TaskStateActions';
⋮----
import { MessageBlock } from './MessageBlock';
import { GroupMessageBlock } from './GroupMessageBlock';
import { AssistantMessageBlock } from './AssistantMessageBlock';
⋮----
import { isAssistantGroupMessage, isGroupMessage, isLoadingMessage, isUserMessage, Message } from '@/types/message';
import { IconButton } from '@/components/common/IconButton';
import { groupAssistantMessages, groupMessagesByPromptContext } from '@/components/message/utils';
import { useScrollingPaused } from '@/hooks/useScrollingPaused';
import { useUserMessageNavigation } from '@/hooks/useUserMessageNavigation';
import { useSettings } from '@/contexts/SettingsContext';
⋮----
export type MessagesRef = {
  exportToImage: () => void;
  container: HTMLDivElement | null;
  scrollToBottom: () => void;
};
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  task: TaskData;
  messages: Message[];
  allFiles?: string[];
  renderMarkdown: boolean;
  removeMessage: (message: Message) => void;
  resumeTask: () => void;
  redoLastUserPrompt: () => void;
  editLastUserMessage: (content: string) => void;
  onMarkAsDone: () => void;
  onProceed?: () => void;
  onArchiveTask?: () => void;
  onUnarchiveTask?: () => void;
  onDeleteTask?: () => void;
  onInterrupt?: () => void;
  onForkFromMessage?: (message: Message) => void;
  onRemoveUpToMessage?: (message: Message) => void;
};
⋮----
// Group messages by promptContext.group.id, then optionally group assistant messages for compact mode
⋮----
// Get all user message IDs
⋮----
const exportToImage = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
aria-label=

================
File: src/renderer/src/components/message/ReflectedMessageBlock.tsx
================
import { useState } from 'react';
import { MdKeyboardArrowDown, MdKeyboardArrowRight } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
⋮----
import { useParsedContent } from '@/hooks/useParsedContent';
import { Message } from '@/types/message';
⋮----
type Props = {
  baseDir: string;
  message: Message;
  allFiles: string[];
  compact?: boolean;
};

================
File: src/renderer/src/components/message/ResponseMessageBlock.tsx
================
import { clsx } from 'clsx';
import { RiRobot2Line } from 'react-icons/ri';
⋮----
import { MessageBar } from './MessageBar';
⋮----
import { useParsedContent } from '@/hooks/useParsedContent';
import { ResponseMessage } from '@/types/message';
⋮----
type Props = {
  baseDir: string;
  message: ResponseMessage;
  allFiles: string[];
  renderMarkdown: boolean;
  compact?: boolean;
  onRemove?: () => void;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
};
⋮----
export const ResponseMessageBlock = (
⋮----
className=

================
File: src/renderer/src/components/message/RetrieveMemoryToolMessage.tsx
================
import { useEffect, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FaBrain, FaCheckCircle, FaExclamationTriangle, FaTimesCircle, FaTrash } from 'react-icons/fa';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { IconButton } from '@/components/common/IconButton';
import { Tooltip } from '@/components/ui/Tooltip';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const loadMemories = async () =>
⋮----
// Ignore errors loading memories
⋮----
const handleDeleteMemory = async () =>
⋮----
// Ignore errors loading memories
⋮----
{/* Query parameters */}
⋮----
{/* Memory List */}
⋮----
onClick=
⋮----
// Fallback for unexpected content (backward compatibility)
⋮----
title=
⋮----
confirmButtonText=

================
File: src/renderer/src/components/message/SearchParentTaskToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiCheckboxCircleFill, RiCloseCircleFill, RiErrorWarningFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { MdOutlineContentPasteSearch } from 'react-icons/md';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};

================
File: src/renderer/src/components/message/SearchTaskToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiCheckboxCircleFill, RiCloseCircleFill, RiErrorWarningFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { MdOutlineContentPasteSearch } from 'react-icons/md';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};

================
File: src/renderer/src/components/message/SemanticSearchToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiErrorWarningFill, RiCheckboxCircleFill, RiCloseCircleFill } from 'react-icons/ri';
import { FaSearchengin } from 'react-icons/fa6';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};

================
File: src/renderer/src/components/message/StoreMemoryToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { FaBrain, FaCheckCircle, FaExclamationTriangle, FaTimesCircle } from 'react-icons/fa';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
{/* Memory Details */}

================
File: src/renderer/src/components/message/SubagentToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { RiToolsFill } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { FaExclamationTriangle } from 'react-icons/fa';
⋮----
import { ToolMessage } from '@/types/message';
import { MessageBar } from '@/components/message/MessageBar';
import { CopyMessageButton } from '@/components/message/CopyMessageButton';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const getToolName = (): string =>

================
File: src/renderer/src/components/message/TaskInfoMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { FaFolderOpen } from 'react-icons/fa';
import { MdAssignment, MdClose } from 'react-icons/md';
⋮----
import { TaskInfoMessage as TaskInfoMessageType } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
import { CopyMessageButton } from '@/components/message/CopyMessageButton';
import { IconButton } from '@/components/common/IconButton';
import { useApi } from '@/contexts/ApiContext';
import { getTaskStateLabel } from '@/components/common/TaskStateChip';
⋮----
type Props = {
  message: TaskInfoMessageType;
  onRemove?: () => void;
};
⋮----
const handleOpenFolder = async (path: string) =>
⋮----
// eslint-disable-next-line no-console
⋮----
const formatDate = (dateString?: string) =>
⋮----
onClick=

================
File: src/renderer/src/components/message/TaskStateActions.tsx
================
import { IoPlayOutline } from 'react-icons/io5';
import { RiAlertLine, RiCheckLine, RiPlayLine } from 'react-icons/ri';
import { useTranslation } from 'react-i18next';
import { ReactNode, useState } from 'react';
import { DefaultTaskState, Mode, TaskData } from '@common/types';
⋮----
import { BmadTaskActions } from '@/components/bmad/BmadTaskActions';
import { Button } from '@/components/common/Button';
⋮----
type Props = {
  projectDir: string;
  taskId: string;
  state: string | undefined;
  mode?: Mode;
  isArchived: boolean | undefined;
  task?: TaskData | null;
  onResumeTask: () => void;
  onMarkAsDone: () => void;
  onProceed?: () => void;
  onArchiveTask?: () => void;
  onUnarchiveTask?: () => void;
  onDeleteTask?: () => void;
};
⋮----
const handleDeleteClick = () =>
⋮----
const handleCancelDelete = () =>
⋮----
const handleConfirmDelete = () =>
⋮----
const handleProceedClick = () =>
⋮----
const handleArchiveClick = () =>
⋮----
const handleUnarchiveClick = () =>
⋮----
const renderSection = (icon: ReactNode, text: string, actions: ReactNode) =>
⋮----
// BMAD mode rendering
⋮----

================
File: src/renderer/src/components/message/ThinkingAnswerBlock.tsx
================
import { MouseEvent, useState } from 'react';
import { FaChevronRight } from 'react-icons/fa';
import { TfiThought } from 'react-icons/tfi';
import { useTranslation } from 'react-i18next';
import { clsx } from 'clsx';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
⋮----
import { useParsedContent } from '@/hooks/useParsedContent';
⋮----
type Props = {
  thinking: string;
  answer?: string | null;
  baseDir?: string;
  allFiles?: string[];
  renderMarkdown: boolean;
};
⋮----
// Internal state for manual toggle control
⋮----
// Determine expansion state:
// - Start expanded (true) when there's no answer
// - When answer arrives, auto-collapse to false
// - Manual toggle overrides auto-collapse
⋮----
const handleToggleThinking = (e: MouseEvent<HTMLDivElement>) =>
⋮----
{/* Thinking section */}
⋮----
<div className=
⋮----
{/* Answer section - only show if we have an answer or we're streaming */}
⋮----
className=

================
File: src/renderer/src/components/message/ToolMessageBlock.tsx
================
import { ReactNode } from 'react';
import { CgSpinner } from 'react-icons/cg';
import { RiToolsFill } from 'react-icons/ri';
import { useTranslation } from 'react-i18next';
import { VscError } from 'react-icons/vsc';
import {
  AIDER_TOOL_ADD_CONTEXT_FILES,
  AIDER_TOOL_DROP_CONTEXT_FILES,
  AIDER_TOOL_GROUP_NAME,
  AIDER_TOOL_RUN_PROMPT,
  POWER_TOOL_BASH,
  POWER_TOOL_FETCH,
  POWER_TOOL_FILE_READ,
  POWER_TOOL_GLOB,
  POWER_TOOL_GREP,
  POWER_TOOL_GROUP_NAME,
  POWER_TOOL_SEMANTIC_SEARCH,
} from '@common/tools';
⋮----
import { CopyMessageButton } from './CopyMessageButton';
import { parseToolContent } from './utils';
import { ExpandableMessageBlock } from './ExpandableMessageBlock';
⋮----
import { ToolMessage } from '@/types/message';
import { CodeInline } from '@/components/common/CodeInline';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
const formatName = (name: string): string =>
⋮----
const defaultLabel = () => t('toolMessage.toolLabel',
⋮----
// Handles message.args.paths (array) or fallback to message.args.path (string)
⋮----
// Handles message.args.paths (array) or fallback to message.args.path (string)
⋮----
<span>
⋮----
// Display pretty-printed JSON
⋮----
rawContentToCopy = JSON.stringify(parsedResult.json); // Copy raw JSON
⋮----
// Display extracted text if inner JSON parsing failed
⋮----
// Fallback to the original raw content if no text was extracted
⋮----

⋮----
{/* Tool Specific Content */}

================
File: src/renderer/src/components/message/UpdateMemoryToolMessage.tsx
================
import { useTranslation } from 'react-i18next';
import { FaBrain, FaCheckCircle, FaExclamationTriangle, FaTimesCircle } from 'react-icons/fa';
import { CgSpinner } from 'react-icons/cg';
⋮----
import { ToolMessage } from '@/types/message';
import { ExpandableMessageBlock } from '@/components/message/ExpandableMessageBlock';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  message: ToolMessage;
  onRemove?: () => void;
  compact?: boolean;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
  hideMessageBar?: boolean;
};
⋮----
{/* Memory ID */}
⋮----
{/* New Content */}

================
File: src/renderer/src/components/message/UsageInfo.tsx
================
import { useTranslation } from 'react-i18next';
import { FaArrowRightFromBracket, FaArrowRightToBracket, FaDollarSign, FaDownload, FaUpload } from 'react-icons/fa6';
import { UsageReportData } from '@common/types';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  usageReport: UsageReportData;
  className?: string;
};

================
File: src/renderer/src/components/message/UserMessageBlock.tsx
================
import { FaRegUser } from 'react-icons/fa';
import { clsx } from 'clsx';
import { AnimatePresence, motion } from 'framer-motion';
⋮----
import { MessageBar } from './MessageBar';
⋮----
import { useParsedContent } from '@/hooks/useParsedContent';
import { UserMessage } from '@/types/message';
⋮----
type Props = {
  baseDir: string;
  message: UserMessage;
  allFiles: string[];
  renderMarkdown: boolean;
  compact?: boolean;
  onRemove?: () => void;
  onRedo?: () => void;
  onEdit?: (content: string) => void;
  onFork?: () => void;
  onRemoveUpTo?: () => void;
};
⋮----
export const UserMessageBlock = (
⋮----
const handleEdit = () =>
⋮----
className=

================
File: src/renderer/src/components/message/utils.tsx
================
import React from 'react';
import ReactMarkdown from 'react-markdown';
import { type Components } from 'react-markdown';
import remarkGfm from 'remark-gfm';
import { Group } from '@common/types';
⋮----
import { CustomCommandBashBlock } from './CustomCommandBashBlock';
import { ThinkingAnswerBlock } from './ThinkingAnswerBlock';
⋮----
import { CodeBlock } from '@/components/common/CodeBlock';
import { MermaidDiagram } from '@/components/common/MermaidDiagram';
import { CodeInline } from '@/components/common/CodeInline';
import { AssistantGroupMessage, GroupMessage, isResponseMessage, isToolMessage, Message, ResponseMessage, ToolMessage } from '@/types/message';
⋮----
// Handle code blocks - check if it's a mermaid diagram or regular code
⋮----
// Check if this is a mermaid code block (className includes 'language-mermaid')
⋮----
// Use CodeInline for inline code elements
⋮----
// Basic styling for preformatted blocks (e.g., indented code)
⋮----
// Table styling
⋮----
// First check if the content matches the thinking/answer format
const thinkingAnswerContent = parseThinkingAnswerFormat(content, baseDir, allFiles, renderMarkdown, renderThinking);
if (thinkingAnswerContent)
⋮----
const processCodeBlock = () =>
⋮----
// Check if the line is just a filepath
⋮----
// Check if line ends with a filepath
⋮----
const findFileInNextLine = (currentLine: number):
⋮----
// Check if the next line is just a filepath
⋮----
// Check if the next line starts with a filepath
⋮----
// Check for custom-command-bash blocks
⋮----
// Process any accumulated text first
⋮----
// Find the end of the custom-command-bash block
⋮----
if (lines[j].trim() === '</custom-command-bash>')
⋮----
// Extract the content between the tags
⋮----
// Skip to after the closing tag
⋮----
// Check if line starts a code block
⋮----
// Try finding the file in the previous line first
⋮----
// Remove the last line from currentText if it contains the filename
⋮----
// If not found in the previous line, check the next line
⋮----
// Skip the next line in the loop
⋮----
// Extract language for ``` fence
⋮----
// Handle inline code ticks
⋮----
// Check if line ends the code block
⋮----
// Handle any remaining content
⋮----
processCodeBlock();
⋮----
export const parseThinkingAnswerFormat = (
  content: string,
  baseDir: string = '',
  allFiles: string[] = [],
  renderMarkdown = false,
  renderThinking = true,
): React.ReactNode | null =>
⋮----
// Check for the thinking section first
⋮----
// Check if the answer section exists
⋮----
// Find the opening tag
⋮----
// Find the closing tag
⋮----
// Extract content between opening and closing tags
⋮----
// Find command tags
⋮----
// Find output tags (search after the command closing tag)
⋮----
// Extract command and output content
⋮----
// --- Tool Message Parsing ---
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
[key: string]: any; // Allow other properties
⋮----
rawContent: string; // Always include the original raw content
⋮----
/**
 * Parses the content string from a ToolMessage.
 * Expected format: A JSON string containing an object with 'content' (an array) and 'isError' (boolean).
 * The 'content' array items should have a 'text' property.
 * The concatenated 'text' properties might themselves be a JSON string.
 */
⋮----
return result; // Return default if rawContent is empty
⋮----
// Type check for the expected outer structure
⋮----
// Extract text from the 'content' array
⋮----
// Try parsing the extracted text as JSON
⋮----
// Ignore error if inner content is not valid JSON
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Ignore error if the raw content is not valid JSON
// eslint-disable-next-line no-console
⋮----
/**
 * Groups ResponseMessage with their following ToolMessages into AssistantGroupMessage.
 * This is used for the compact view mode where assistant turns are displayed as a single unit.
 *
 * Rules:
 * - A ResponseMessage followed by ToolMessages forms a single group
 * - A new ResponseMessage starts a new group
 * - Orphan ToolMessages (without preceding ResponseMessage) remain standalone
 * - Other message types remain standalone
 */
⋮----
const flushCurrentGroup = () =>
⋮----
// Create an AssistantGroupMessage
⋮----
// No tool messages, just push the response as-is
⋮----
// Flush any previous group before starting a new one
⋮----
// Add to current group
⋮----
// Orphan tool message - push as-is
⋮----
// Other message types - flush current group and push as-is
⋮----
// Flush any remaining group
⋮----
// Check basic message properties
⋮----
// Check usageReport for ResponseMessage and ToolMessage
⋮----
// Check args for ToolMessage
⋮----
// First pass: collect messages with groups
⋮----
// Track the latest group information for this group ID, but only update if current group isn't finished
⋮----
// Create GroupMessage for the first message in the group
⋮----
// Only create the group once

================
File: src/renderer/src/components/message/VirtualizedMessages.tsx
================
import { MdKeyboardDoubleArrowDown } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
import { defaultRangeExtractor, useVirtualizer } from '@tanstack/react-virtual';
import { DefaultTaskState, MessageViewMode, TaskData } from '@common/types';
import { forwardRef, useImperativeHandle, useLayoutEffect, useMemo, useRef } from 'react';
import { clsx } from 'clsx';
⋮----
import { MessageBlock } from './MessageBlock';
import { GroupMessageBlock } from './GroupMessageBlock';
import { AssistantMessageBlock } from './AssistantMessageBlock';
⋮----
import { TaskStateActions } from '@/components/message/TaskStateActions';
import { isAssistantGroupMessage, isGroupMessage, isLoadingMessage, isUserMessage, Message } from '@/types/message';
import { IconButton } from '@/components/common/IconButton';
import { groupAssistantMessages, groupMessagesByPromptContext } from '@/components/message/utils';
import { showInfoNotification } from '@/utils/notifications';
import { useScrollingPaused } from '@/hooks/useScrollingPaused';
import { useUserMessageNavigation } from '@/hooks/useUserMessageNavigation';
import { useSettings } from '@/contexts/SettingsContext';
⋮----
export type VirtualizedMessagesRef = {
  exportToImage: () => void;
  container: HTMLDivElement | null;
  scrollToBottom: () => void;
};
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  task: TaskData;
  messages: Message[];
  allFiles?: string[];
  renderMarkdown: boolean;
  removeMessage: (message: Message) => void;
  resumeTask: () => void;
  redoLastUserPrompt: () => void;
  editLastUserMessage: (content: string) => void;
  onMarkAsDone: () => void;
  onProceed?: () => void;
  onArchiveTask?: () => void;
  onUnarchiveTask?: () => void;
  onDeleteTask?: () => void;
  onInterrupt?: () => void;
  onForkFromMessage?: (message: Message) => void;
};
⋮----
// Group messages by promptContext.group.id, then optionally group assistant messages for compact mode
⋮----
// Get all user message IDs
⋮----
// Create virtualizer for dynamic sized items
⋮----
estimateSize: () => 44, // Initial estimate, will be measured
⋮----
// Scroll to last item when new messages arrive
⋮----
const exportToImage = async () =>
⋮----
// Show notification that export is not available with virtualized rendering
⋮----
onFork=
⋮----
aria-label=

================
File: src/renderer/src/components/ModelLibrary/providers/AnthropicCompatibleParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { AnthropicCompatibleProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: AnthropicCompatibleProvider;
  onChange: (updated: AnthropicCompatibleProvider) => void;
};
⋮----
const handleBaseUrlChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/AnthropicParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { AnthropicProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: AnthropicProvider;
  onChange: (updated: AnthropicProvider) => void;
};
⋮----
export const AnthropicParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/AzureAdvancedSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { AzureProvider } from '@common/agent';
import { ReasoningEffort } from '@common/types';
⋮----
import { Select, Option } from '@/components/common/Select';
⋮----
type Props = {
  provider: AzureProvider;
  onChange: (updated: AzureProvider) => void;
};
⋮----
export const AzureAdvancedSettings = (
⋮----
const handleReasoningEffortChange = (value: string) =>
⋮----
<Select label=

================
File: src/renderer/src/components/ModelLibrary/providers/AzureModelOverrides.tsx
================
import { getDefaultProviderParams, AzureProvider, LlmProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
import { AzureAdvancedSettings } from './AzureAdvancedSettings';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<AzureProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const AzureModelOverrides = (
⋮----
// Convert overrides to AzureProvider format for AdvancedSettings
⋮----
// Convert AzureProvider back to overrides format
const handleProviderChange = (updatedProvider: AzureProvider) =>
⋮----
// Remove undefined values
⋮----
// Handle disable streaming change separately
const handleDisableStreamingChange = (disableStreaming: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/AzureParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { AzureProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: AzureProvider;
  onChange: (updated: AzureProvider) => void;
};
⋮----
// Environment variable hooks for placeholders
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleResourceNameChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleApiVersionChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=
⋮----
<p className="text-xs text-info-lightest">

================
File: src/renderer/src/components/ModelLibrary/providers/BedrockParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { BedrockProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { InfoIcon } from '@/components/common/InfoIcon';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: BedrockProvider;
  onChange: (updated: BedrockProvider) => void;
};
⋮----
const handleRegionChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleAccessKeyIdChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleSecretAccessKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleSessionTokenChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=
⋮----
awsAccessKeyIdEnv
⋮----
<span>
⋮----
awsSecretAccessKeyEnv

================
File: src/renderer/src/components/ModelLibrary/providers/CerebrasParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { CerebrasProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: CerebrasProvider;
  onChange: (updated: CerebrasProvider) => void;
};
⋮----
export const CerebrasParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/ClaudeAgentSdkParameters.tsx
================
import { useTranslation } from 'react-i18next';
import { ClaudeAgentSdkProvider } from '@common/agent';
⋮----
type Props = {
  provider: ClaudeAgentSdkProvider;
  onChange: (updated: ClaudeAgentSdkProvider) => void;
};

================
File: src/renderer/src/components/ModelLibrary/providers/DeepseekParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { DeepseekProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: DeepseekProvider;
  onChange: (updated: DeepseekProvider) => void;
};
⋮----
export const DeepseekParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/DefaultModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Record<string, unknown>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const DefaultModelOverrides = (
⋮----
// Convert overrides to LlmProvider format
⋮----
// Convert back to overrides format
const handleDisableStreamingChange = (disableStreaming: boolean) =>
⋮----
// Remove undefined values

================
File: src/renderer/src/components/ModelLibrary/providers/EnableVoiceControl.tsx
================
import { useTranslation } from 'react-i18next';
⋮----
import { Checkbox } from '@/components/common/Checkbox';
⋮----
type Props = {
  voiceEnabled: boolean;
  onChange: (enabled: boolean) => void;
};

================
File: src/renderer/src/components/ModelLibrary/providers/GeminiAdvancedSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { GeminiProvider } from '@common/agent';
⋮----
import { Slider } from '@/components/common/Slider';
import { Checkbox } from '@/components/common/Checkbox';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  provider: GeminiProvider;
  onChange: (updated: GeminiProvider) => void;
};
⋮----
const handleThinkingBudgetChange = (value: number) =>
⋮----
const handleIncludeThoughtsChange = (checked: boolean) =>
⋮----
const handleUseSearchGroundingChange = (checked: boolean) =>
⋮----
label=
⋮----
<Checkbox label=

================
File: src/renderer/src/components/ModelLibrary/providers/GeminiModelOverrides.tsx
================
import { getDefaultProviderParams, GeminiProvider, LlmProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
import { GeminiAdvancedSettings } from './GeminiAdvancedSettings';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<GeminiProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const GeminiModelOverrides = (
⋮----
// Convert overrides to GeminiProvider format for AdvancedSettings
⋮----
// Convert GeminiProvider back to overrides format
const handleProviderChange = (updatedProvider: GeminiProvider) =>
⋮----
// Remove undefined values
⋮----
// Handle disable streaming change separately
const handleDisableStreamingChange = (disableStreaming: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/GeminiParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { GeminiProvider } from '@common/agent';
⋮----
import { GeminiAdvancedSettings } from './GeminiAdvancedSettings';
import { EnableVoiceControl } from './EnableVoiceControl';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: GeminiProvider;
  onChange: (updated: GeminiProvider) => void;
};
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleCustomBaseUrlChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleVoiceEnabledChange = (checked: boolean) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/GpustackParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { GpustackProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: GpustackProvider;
  onChange: (updated: GpustackProvider) => void;
};
⋮----
const handleBaseUrlChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/GroqParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { GroqProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: GroqProvider;
  onChange: (updated: GroqProvider) => void;
};
⋮----
export const GroqParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/index.ts
================
// Advanced Settings
⋮----
// Model Overrides
⋮----
// Utility Components

================
File: src/renderer/src/components/ModelLibrary/providers/KimiPlanParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { KimiPlanProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: KimiPlanProvider;
  onChange: (updated: KimiPlanProvider) => void;
};
⋮----
export const KimiPlanParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/LitellmParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { LitellmProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: LitellmProvider;
  onChange: (updated: LitellmProvider) => void;
};
⋮----
const handleBaseUrlChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/LmStudioParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { LmStudioProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: LmStudioProvider;
  onChange: (updated: LmStudioProvider) => void;
};
⋮----
const handleBaseUrlChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/MinimaxParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { MinimaxProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: MinimaxProvider;
  onChange: (updated: MinimaxProvider) => void;
};
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>

================
File: src/renderer/src/components/ModelLibrary/providers/OllamaParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { OllamaProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: OllamaProvider;
  onChange: (updated: OllamaProvider) => void;
};
⋮----
const handleBaseUrlChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/OpenAiAdvancedSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { OpenAiProvider } from '@common/agent';
import { ReasoningEffort } from '@common/types';
⋮----
import { Select, Option } from '@/components/common/Select';
import { Checkbox } from '@/components/common/Checkbox';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  provider: OpenAiProvider;
  onChange: (updated: OpenAiProvider) => void;
};
⋮----
export const OpenAiAdvancedSettings = (
⋮----
const handleReasoningEffortChange = (value: string) =>
⋮----
const handleUseWebSearchChange = (checked: boolean) =>
⋮----
<Select label=

================
File: src/renderer/src/components/ModelLibrary/providers/OpenAiCompatibleAdvancedSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { OpenAiCompatibleProvider } from '@common/agent';
import { ReasoningEffort } from '@common/types';
⋮----
import { Select, Option } from '@/components/common/Select';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  provider: OpenAiCompatibleProvider;
  onChange: (updated: OpenAiCompatibleProvider) => void;
};
⋮----
const handleReasoningEffortChange = (value: string) =>
⋮----
<span>

================
File: src/renderer/src/components/ModelLibrary/providers/OpenAiCompatibleModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider, OpenAiCompatibleProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
import { OpenAiCompatibleAdvancedSettings } from './OpenAiCompatibleAdvancedSettings';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<OpenAiCompatibleProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const OpenAiCompatibleModelOverrides = (
⋮----
// Convert overrides to OpenAiCompatibleProvider format for AdvancedSettings
⋮----
// Convert OpenAiCompatibleProvider back to overrides format
const handleProviderChange = (updatedProvider: OpenAiCompatibleProvider) =>
⋮----
// Remove undefined values
⋮----
// Handle disable streaming change separately
const handleDisableStreamingChange = (disableStreaming: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/OpenAiCompatibleParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { OpenAiCompatibleProvider } from '@common/agent';
⋮----
import { OpenAiCompatibleAdvancedSettings } from './OpenAiCompatibleAdvancedSettings';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: OpenAiCompatibleProvider;
  onChange: (updated: OpenAiCompatibleProvider) => void;
};
⋮----
const handleBaseUrlChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/OpenAiModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider, OpenAiProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
import { OpenAiAdvancedSettings } from './OpenAiAdvancedSettings';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<OpenAiProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const OpenAiModelOverrides = (
⋮----
// Convert overrides to OpenAiProvider format for AdvancedSettings
⋮----
// Convert OpenAiProvider back to overrides format
const handleProviderChange = (updatedProvider: OpenAiProvider) =>
⋮----
// Remove undefined values
⋮----
// Handle disable streaming change separately
const handleDisableStreamingChange = (disableStreaming: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/OpenAiParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { OpenAiProvider } from '@common/agent';
⋮----
import { OpenAiAdvancedSettings } from './OpenAiAdvancedSettings';
import { EnableVoiceControl } from './EnableVoiceControl';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: OpenAiProvider;
  onChange: (updated: OpenAiProvider) => void;
};
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleVoiceEnabledChange = (checked: boolean) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/OpenCodeAdvancedSettings.tsx
================
export const OpenCodeAdvancedSettings = () =>

================
File: src/renderer/src/components/ModelLibrary/providers/OpenCodeModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Record<string, unknown>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const OpenCodeModelOverrides = (
⋮----
// Convert overrides to LlmProvider format
⋮----
// Convert back to overrides format
const handleDisableStreamingChange = (disableStreaming: boolean) =>
⋮----
// Remove undefined values

================
File: src/renderer/src/components/ModelLibrary/providers/OpenCodeParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { OpenCodeProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: OpenCodeProvider;
  onChange: (updated: OpenCodeProvider) => void;
};
⋮----
export const OpenCodeParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/OpenRouterAdvancedSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { OpenRouterProvider } from '@common/agent';
⋮----
import { useArrayField } from './useArrayField';
⋮----
import { InfoIcon } from '@/components/common/InfoIcon';
import { Input } from '@/components/common/Input';
import { Select } from '@/components/common/Select';
import { Checkbox } from '@/components/common/Checkbox';
⋮----
type Props = {
  provider: OpenRouterProvider;
  onChange: (updated: OpenRouterProvider) => void;
};
⋮----
const handleAllowFallbacksChange = (checked: boolean) =>
⋮----
const handleDataCollectionChange = (value: string) =>
⋮----
const handleSortChange = (value: string) =>
⋮----
const handleRequireParametersChange = (checked: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/OpenRouterModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider, OpenRouterProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
import { OpenRouterAdvancedSettings } from './OpenRouterAdvancedSettings';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<OpenRouterProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const OpenRouterModelOverrides = (
⋮----
// Convert overrides to OpenRouterProvider format for AdvancedSettings
⋮----
// Convert OpenRouterProvider back to overrides format
const handleProviderChange = (updatedProvider: OpenRouterProvider) =>
⋮----
// Remove undefined values
⋮----
// Handle disable streaming change separately
const handleDisableStreamingChange = (disableStreaming: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/OpenRouterParameters.tsx
================
import { ChangeEvent, ReactNode } from 'react';
import { useTranslation } from 'react-i18next';
import { OpenRouterProvider } from '@common/agent';
⋮----
import { OpenRouterAdvancedSettings } from './OpenRouterAdvancedSettings';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
import { Accordion } from '@/components/common/Accordion';
⋮----
type Props = {
  provider: OpenRouterProvider;
  onChange: (updated: OpenRouterProvider) => void;
};
⋮----
export const OpenRouterParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const renderSectionAccordion = (title: ReactNode, children: ReactNode, open?: boolean, setOpen?: (open: boolean) => void) => (
    <Accordion
      title={<div className="flex-1 text-left text-sm font-medium px-2">{title}</div>}
      chevronPosition="right"
      className="mb-2 border rounded-md border-border-default-dark"
      isOpen={open}
      onOpenChange={setOpen}
    >
      <div className="p-4 pt-2">{children}</div>
    </Accordion>
  );
⋮----
label=
⋮----
openRouterApiKeyEnv

================
File: src/renderer/src/components/ModelLibrary/providers/ProviderModels.tsx
================
import { useState } from 'react';
import { useTranslation } from 'react-i18next';
import { IoClose } from 'react-icons/io5';
import { HiPlus } from 'react-icons/hi';
import { clsx } from 'clsx';
⋮----
import { Input } from '@/components/common/Input';
import { Button } from '@/components/common/Button';
import { IconButton } from '@/components/common/IconButton';
import { MultiSelect } from '@/components/common/MultiSelect';
⋮----
type Props = {
  models: string[];
  onChange: (updatedModels: string[]) => void;
  placeholder?: string;
  availableModels?: string[];
};
⋮----
const handleModelsChange = (updatedModels: string[]) =>
⋮----
const handleRemoveModel = (index: number) =>
⋮----
const handleAddModels = () =>
⋮----
// Add all selected models at once
⋮----
onChange=

================
File: src/renderer/src/components/ModelLibrary/providers/RequestyAdvancedSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { RequestyProvider } from '@common/agent';
import { ReasoningEffort } from '@common/types';
⋮----
import { Checkbox } from '@/components/common/Checkbox';
import { InfoIcon } from '@/components/common/InfoIcon';
import { Select, Option } from '@/components/common/Select';
⋮----
type Props = {
  provider: RequestyProvider;
  onChange: (updated: RequestyProvider) => void;
};
⋮----
const handleUseAutoCacheChange = (checked: boolean) =>
⋮----
const handleReasoningEffortChange = (value: string) =>
⋮----
<Checkbox label=
⋮----
<span>

================
File: src/renderer/src/components/ModelLibrary/providers/RequestyModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider, RequestyProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
import { RequestyAdvancedSettings } from './RequestyAdvancedSettings';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<RequestyProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const RequestyModelOverrides = (
⋮----
// Convert overrides to RequestyProvider format for AdvancedSettings
⋮----
// Convert RequestyProvider back to overrides format
const handleProviderChange = (updatedProvider: RequestyProvider) =>
⋮----
// Remove undefined values
⋮----
// Handle disable streaming change separately
const handleDisableStreamingChange = (disableStreaming: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/RequestyParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { RequestyProvider } from '@common/agent';
⋮----
import { RequestyAdvancedSettings } from './RequestyAdvancedSettings';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: RequestyProvider;
  onChange: (updated: RequestyProvider) => void;
};
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/SyntheticParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { SyntheticProvider } from '@common/agent';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: SyntheticProvider;
  onChange: (updated: SyntheticProvider) => void;
};
⋮----
export const SyntheticParameters = (
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/useArrayField.ts
================
import { useState, useEffect } from 'react';
import { OpenRouterProvider } from '@common/agent';
⋮----
export const useArrayField = (
  provider: OpenRouterProvider,
  field: keyof Pick<OpenRouterProvider, 'order' | 'only' | 'ignore' | 'quantizations'>,
  onChange: (updated: OpenRouterProvider) => void,
) =>
⋮----
const handleChange = (e: React.ChangeEvent<HTMLInputElement>) =>
⋮----
const handleBlur = () =>

================
File: src/renderer/src/components/ModelLibrary/providers/VertexAiAdvancedSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { VertexAiProvider } from '@common/agent';
⋮----
import { Slider } from '@/components/common/Slider';
import { Checkbox } from '@/components/common/Checkbox';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  provider: VertexAiProvider;
  onChange: (updated: VertexAiProvider) => void;
};
⋮----
const handleThinkingBudgetChange = (value: number) =>
⋮----
const handleIncludeThoughtsChange = (checked: boolean) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/VertexAiModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider, VertexAiProvider } from '@common/agent';
⋮----
import { DisableStreaming } from '../DisableStreaming';
⋮----
import { VertexAiAdvancedSettings } from './VertexAiAdvancedSettings';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<VertexAiProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const VertexAiModelOverrides = (
⋮----
// Convert overrides to VertexAiProvider format for AdvancedSettings
⋮----
// Convert VertexAiProvider back to overrides format
const handleProviderChange = (updatedProvider: VertexAiProvider) =>
⋮----
// Remove undefined values
⋮----
// Handle disable streaming change separately
const handleDisableStreamingChange = (disableStreaming: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/providers/VertexAIParameters.tsx
================
import { useTranslation } from 'react-i18next';
import { VertexAiProvider } from '@common/agent';
import { ChangeEvent } from 'react';
⋮----
import { VertexAiAdvancedSettings } from './VertexAiAdvancedSettings';
⋮----
import { Input } from '@/components/common/Input';
import { TextArea } from '@/components/common/TextArea';
⋮----
type Props = {
  provider: VertexAiProvider;
  onChange: (updated: VertexAiProvider) => void;
};
⋮----
const handleProjectChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleLocationChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleCredentialsChange = (e: ChangeEvent<HTMLTextAreaElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/ZaiPlanAdvancedSettings.tsx
================
import { useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { ZaiPlanProvider } from '@common/agent';
import { SettingsData, McpServerConfig } from '@common/types';
import { FaCheck, FaPlus, FaInfoCircle, FaExternalLinkAlt } from 'react-icons/fa';
⋮----
import { ZaiPlanThinkingSetting } from './ZaiPlanThinkingSetting';
⋮----
import { useSettings } from '@/contexts/SettingsContext';
import { Button } from '@/components/common/Button';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  provider: ZaiPlanProvider;
  onChange: (updated: ZaiPlanProvider) => void;
};
⋮----
type McpServerInfo = {
  key: string;
  name: string;
  description: string;
  config: McpServerConfig;
  documentationLink: string;
};
⋮----
const isServerConfigured = (serverKey: string): boolean =>
⋮----
const handleAddServer = async (serverInfo: McpServerInfo) =>
⋮----
// eslint-disable-next-line no-console
⋮----
<Button onClick=
⋮----

================
File: src/renderer/src/components/ModelLibrary/providers/ZaiPlanModelOverrides.tsx
================
import { getDefaultProviderParams, LlmProvider, ZaiPlanProvider } from '@common/agent';
⋮----
import { ZaiPlanThinkingSetting } from './ZaiPlanThinkingSetting';
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Partial<ZaiPlanProvider>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
export const ZaiPlanModelOverrides = (
⋮----
const handleProviderChange = (updatedProvider: ZaiPlanProvider) =>

================
File: src/renderer/src/components/ModelLibrary/providers/ZaiPlanParameters.tsx
================
import { ChangeEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { ZaiPlanProvider } from '@common/agent';
⋮----
import { ZaiPlanAdvancedSettings } from './ZaiPlanAdvancedSettings';
⋮----
import { Input } from '@/components/common/Input';
import { useEffectiveEnvironmentVariable } from '@/hooks/useEffectiveEnvironmentVariable';
⋮----
type Props = {
  provider: ZaiPlanProvider;
  onChange: (updated: ZaiPlanProvider) => void;
};
⋮----
const handleApiKeyChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/ModelLibrary/providers/ZaiPlanThinkingSetting.tsx
================
import { useTranslation } from 'react-i18next';
import { ZaiPlanProvider } from '@common/agent';
⋮----
import { Checkbox } from '@/components/common/Checkbox';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  provider: ZaiPlanProvider;
  onChange: (updated: ZaiPlanProvider) => void;
};
⋮----
const handleThinkingEnabledChange = (checked: boolean) =>

================
File: src/renderer/src/components/ModelLibrary/DisableStreaming.tsx
================
import { useTranslation } from 'react-i18next';
⋮----
import { Checkbox } from '@/components/common/Checkbox';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  checked: boolean;
  onChange: (checked: boolean) => void;
};
⋮----
<Checkbox label=

================
File: src/renderer/src/components/ModelLibrary/index.ts
================


================
File: src/renderer/src/components/ModelLibrary/ModelDialog.tsx
================
import { startTransition, useEffect, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { Model, ProviderProfile } from '@common/types';
import { DEFAULT_MODEL_TEMPERATURE } from '@common/agent';
⋮----
import { ModelParameterOverrides } from './ModelParameterOverrides';
⋮----
import { Input } from '@/components/common/Input';
import { Select } from '@/components/common/Select';
import { Checkbox } from '@/components/common/Checkbox';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { Slider } from '@/components/common/Slider';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  model?: Model;
  providers: ProviderProfile[];
  onSave: (model: Model) => void;
  onCancel: () => void;
};
⋮----
// Batch state updates to avoid cascading renders
⋮----
// Batch state updates to avoid cascading renders
⋮----
const validateForm = (): boolean =>
⋮----
const handleSubmit = () =>
⋮----
const handleInputChange = (field: keyof Model, value: unknown) =>
⋮----
// Clear error when user starts typing
⋮----
const handleCostBlur = (field: keyof Model, displayField: keyof typeof costDisplayValues, inputValue: string) =>
⋮----
const handleTemperatureToggle = (enabled: boolean) =>
⋮----
label=
⋮----
onChange=
⋮----
disabled={!!model} // Don't allow changing provider for existing models
⋮----
disabled={!!model} // Don't allow changing ID for existing models
⋮----
onBlur=
⋮----
<span>
⋮----
{/* Advanced Settings - Provider Overrides */}
⋮----
<Checkbox label=

================
File: src/renderer/src/components/ModelLibrary/ModelLibrary.tsx
================
import { useState, useEffect, useRef } from 'react';
import { useTranslation } from 'react-i18next';
import { useHotkeys } from 'react-hotkeys-hook';
import { Model, ProviderProfile } from '@common/types';
import { LlmProviderName } from '@common/agent';
⋮----
import { ModelDialog } from './ModelDialog';
import { ProviderSelection } from './ProviderSelection';
import { ProviderProfileForm } from './ProviderProfileForm';
import { ProviderProfileDialog } from './ProviderProfileDialog';
import { ProviderHeader } from './ProviderHeader';
import { ModelTableSection } from './ModelTableSection';
⋮----
import { ModalOverlayLayout } from '@/components/common/ModalOverlayLayout';
import { useModelProviders } from '@/contexts/ModelProviderContext';
⋮----
type Props = {
  onClose: () => void;
};
⋮----
export const ModelLibrary = (
⋮----
const handleCancelConfigure = () =>
⋮----
const handleClose = () =>
⋮----
const handleToggleProviderSelect = (profileId: string) =>
⋮----
const handleAddProvider = () =>
⋮----
const handleSelectProvider = (provider: LlmProviderName) =>
⋮----
const handleEditProfile = (profile: ProviderProfile) =>
⋮----
const handleDeleteProfile = async (profile: ProviderProfile) =>
⋮----
const handleSaveProfile = async (profile: ProviderProfile) =>
⋮----
const handleAddModel = () =>
⋮----
const handleEditModel = (model: Model) =>
⋮----
const handleDeleteModel = async (model: Model) =>
⋮----
const handleSaveModel = async (model: Model) =>
⋮----
const handleToggleHidden = async (model: Model) =>
⋮----
const handleBulkToggleHidden = async (modelIds: string[], isHidden: boolean) =>
⋮----
// Show provider selection when adding new provider
⋮----
<ModalOverlayLayout title=
⋮----
// Show provider configuration form

================
File: src/renderer/src/components/ModelLibrary/ModelParameterOverrides.tsx
================
import { useTranslation } from 'react-i18next';
import { LlmProvider, LlmProviderName } from '@common/agent';
import { ComponentType } from 'react';
⋮----
import { OpenRouterModelOverrides } from './providers/OpenRouterModelOverrides';
import { GeminiModelOverrides } from './providers/GeminiModelOverrides';
import { VertexAiModelOverrides } from './providers/VertexAiModelOverrides';
import { OpenAiModelOverrides } from './providers/OpenAiModelOverrides';
import { OpenCodeModelOverrides } from './providers/OpenCodeModelOverrides';
import { RequestyModelOverrides } from './providers/RequestyModelOverrides';
import { AzureModelOverrides } from './providers/AzureModelOverrides';
import { OpenAiCompatibleModelOverrides } from './providers/OpenAiCompatibleModelOverrides';
import { DefaultModelOverrides } from './providers/DefaultModelOverrides';
import { ZaiPlanModelOverrides } from './providers/ZaiPlanModelOverrides';
⋮----
import { Button } from '@/components/common/Button';
import { Accordion } from '@/components/common/Accordion';
⋮----
type ProviderOverridesProps = {
  provider: LlmProvider;
  overrides: Record<string, unknown>;
  onChange: (overrides: Record<string, unknown>) => void;
};
⋮----
// Providers without specific overrides use DefaultModelOverrides
⋮----
type Props = {
  provider: LlmProvider;
  overrides: Record<string, unknown>;
  onChange: (overrides: Record<string, unknown>) => void;
  className?: string;
};
⋮----
const handleProviderOverrideChange = (providerOverrides: Record<string, unknown>) =>
⋮----
const handleResetToDefaults = () =>
⋮----
<div className="text-sm font-medium text-text-primary">

================
File: src/renderer/src/components/ModelLibrary/ModelTableSection.tsx
================
import { useState, ReactNode, useRef, useEffect, RefObject } from 'react';
import { useDebounce } from '@reactuses/core';
import { useTranslation } from 'react-i18next';
import { FiEdit2, FiTrash2, FiPlus, FiEye, FiSliders, FiRefreshCw, FiChevronDown } from 'react-icons/fi';
import { Model, ProviderProfile } from '@common/types';
import { MdThermostat } from 'react-icons/md';
⋮----
import { Input } from '@/components/common/Input';
import { Button } from '@/components/common/Button';
import { Checkbox } from '@/components/common/Checkbox';
import { Column } from '@/components/common/Table';
import { VirtualTable } from '@/components/common/VirtualTable';
import { IconButton } from '@/components/common/IconButton';
import { Tooltip } from '@/components/ui/Tooltip';
import { type MenuOption } from '@/components/common/VerticalDotsMenu';
⋮----
type Props = {
  models: Model[];
  selectedProviderIds: string[];
  providers: ProviderProfile[];
  onAddModel: () => void;
  onEditModel: (model: Model) => void;
  onDeleteModel: (model: Model) => void;
  onToggleHidden: (model: Model) => void;
  onBulkToggleHidden: (modelIds: string[], isHidden: boolean) => void;
  onRefreshModels: () => void;
  modelsLoading?: boolean;
};
⋮----
const useClickOutside = (refs: React.RefObject<HTMLElement>[], callback: () => void) =>
⋮----
const handleClickOutside = (event: MouseEvent) =>
⋮----
const handleToggleSelectAll = () =>
⋮----
const handleSelectModel = (modelId: string, checked: boolean) =>
⋮----
const handleClearSelection = () =>
⋮----
const handleBulkHide = () =>
⋮----
const handleBulkUnhide = () =>
⋮----
const getRowClassName = (row: Model) =>
⋮----
onClick=
⋮----
{/* Search and Info Header */}
⋮----
<Checkbox label=
⋮----
option.action();
setIsBulkActionsOpen(false);
⋮----
{/* Table */}

================
File: src/renderer/src/components/ModelLibrary/ProviderCard.tsx
================
import { ReactNode } from 'react';
⋮----
type Props = {
  name: string;
  icon: ReactNode;
  onClick: () => void;
};
⋮----
export const ProviderCard = (

================
File: src/renderer/src/components/ModelLibrary/ProviderHeader.tsx
================
import { useTranslation } from 'react-i18next';
import { FiPlus } from 'react-icons/fi';
import { ProviderProfile } from '@common/types';
⋮----
import { ProviderProfileCard } from './ProviderProfileCard';
⋮----
import { Button } from '@/components/common/Button';
⋮----
type Props = {
  providers: ProviderProfile[];
  providerErrors: Record<string, string>;
  selectedProfileIds: string[];
  onToggleSelect: (profileId: string) => void;
  onAddProvider: () => void;
  onEditProfile: (profile: ProviderProfile) => void;
  onDeleteProfile: (profile: ProviderProfile) => void;
};
⋮----
onToggleSelect=
⋮----
onEdit=
onDelete=

================
File: src/renderer/src/components/ModelLibrary/ProviderProfileCard.tsx
================
import { useState, ComponentType } from 'react';
import { useTranslation } from 'react-i18next';
import { FiEdit2, FiTrash2, FiMic } from 'react-icons/fi';
import { clsx } from 'clsx';
import { ProviderProfile } from '@common/types';
import { LlmProviderName } from '@common/agent';
import { FaExclamationCircle } from 'react-icons/fa';
⋮----
import { IconButton } from '@/components/common/IconButton';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import {
  AnthropicIcon,
  AnthropicCompatibleIcon,
  AzureIcon,
  BedrockIcon,
  CerebrasIcon,
  ClaudeAgentSdkIcon,
  DeepseekIcon,
  GeminiIcon,
  GpustackIcon,
  GroqIcon,
  LitellmIcon,
  LmStudioIcon,
  MinimaxIcon,
  OllamaIcon,
  OpenAiCompatibleIcon,
  OpenAiIcon,
  OpenCodeIcon,
  OpenRouterIcon,
  RequestyIcon,
  SyntheticIcon,
  VertexAiIcon,
  ZaiPlanIcon,
} from '@/icons';
import { useResponsive } from '@/hooks/useResponsive';
import { Tooltip } from '@/components/ui/Tooltip';
import { KimiPlanIcon } from '@/icons/KimiPlanIcon';
⋮----
type Props = {
  provider: ProviderProfile;
  error?: string;
  isSelected: boolean;
  onToggleSelect: () => void;
  onEdit: () => void;
  onDelete: () => void;
};
⋮----
const handleCardClick = () =>
⋮----
// If already selected and no actions showing, show actions (mobile behavior)
⋮----
// Otherwise, toggle selection (mobile behavior)
⋮----
const handleEdit = () =>
⋮----
const handleDelete = () =>
⋮----
className=
⋮----
{/* Action buttons - shown on hover (desktop) or when showActions is true (mobile) */}
⋮----
className={clsx(
            'flex flex-col items-center h-full space-y-3 transition-all duration-200',
            showActions ? 'opacity-100 translate-x-6' : 'opacity-0 translate-x-4 pointer-events-none',
            'md:group-hover:opacity-100 md:group-hover:translate-x-4 md:group-hover:pointer-events-auto',
          )}
        >
          <IconButton icon={<FiEdit2 />} onClick={handleEdit} />
          <IconButton icon={<FiTrash2 />} onClick={handleDelete} className="text-error hover:text-error-light" />
        </div>
      </div>
      {showDeleteConfirm && (
        <ConfirmDialog
          title={t('modelLibrary.deleteProfileTitle')}
onConfirm=
⋮----
title=
⋮----
onDelete();
setShowDeleteConfirm(false);
⋮----
onCancel=

================
File: src/renderer/src/components/ModelLibrary/ProviderProfileDialog.tsx
================
import { useTranslation } from 'react-i18next';
import { useRef, useState } from 'react';
import { LlmProviderName } from '@common/agent';
import { ProviderProfile } from '@common/types';
⋮----
import { ProviderProfileForm, ProviderProfileFormRef } from './ProviderProfileForm';
⋮----
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { Button } from '@/components/common/Button';
⋮----
type Props = {
  provider: LlmProviderName;
  profile?: ProviderProfile;
  providers: ProviderProfile[];
  onSave: (profile: ProviderProfile) => void;
  onCancel: () => void;
};
⋮----
export const ProviderProfileDialog = (
⋮----
const handleSave = (savedProfile: ProviderProfile) =>
⋮----
const handleToggleDisabled = () =>
⋮----
title=
⋮----
confirmButtonText=

================
File: src/renderer/src/components/ModelLibrary/ProviderProfileForm.tsx
================
import { getDefaultProviderParams, LlmProvider, LlmProviderName } from '@common/agent';
import { ProviderProfile } from '@common/types';
import { useTranslation } from 'react-i18next';
import { ComponentType, forwardRef, useImperativeHandle, useState } from 'react';
import { v4 as uuidv4 } from 'uuid';
import { FaPlus, FaTrash } from 'react-icons/fa';
⋮----
import { DisableStreaming } from './DisableStreaming';
⋮----
import {
  AnthropicParameters,
  AnthropicCompatibleParameters,
  AzureParameters,
  BedrockParameters,
  ClaudeAgentSdkParameters,
  DeepseekParameters,
  GeminiParameters,
  GpustackParameters,
  GroqParameters,
  KimiPlanParameters,
  LitellmParameters,
  LmStudioParameters,
  MinimaxParameters,
  OllamaParameters,
  OpenAiCompatibleParameters,
  OpenAiParameters,
  OpenCodeParameters,
  OpenRouterParameters,
  RequestyParameters,
  SyntheticParameters,
  VertexAIParameters,
  ZaiPlanParameters,
} from '@/components/ModelLibrary/providers';
import { Input } from '@/components/common/Input';
import { Button } from '@/components/common/Button';
import { IconButton } from '@/components/common/IconButton';
import { Accordion } from '@/components/common/Accordion';
⋮----
type ProviderParametersProps<T extends LlmProvider> = {
  provider: T;
  onChange: (updated: T) => void;
};
⋮----
// @ts-expect-error using LlmProvider as type
⋮----
type Header = { id: string; key: string; value: string };
⋮----
type Props = {
  provider: LlmProviderName;
  editProfile?: ProviderProfile;
  providers: ProviderProfile[];
  onSave: (profile: ProviderProfile) => void;
  onCancel: () => void;
  hideActions?: boolean;
  hideTitle?: boolean;
};
⋮----
export type ProviderProfileFormRef = {
  submit: () => void;
};
⋮----
const handleIdChange = (value: string) =>
⋮----
// Clear error when user starts typing
⋮----
const handleHeaderChange = (id: string, field: 'key' | 'value', value: string) =>
⋮----
const addHeader = () =>
⋮----
const removeHeader = (id: string) =>
⋮----
const handleDisableStreamingChange = (disableStreaming: boolean) =>
⋮----
const validateForm = (): boolean =>
⋮----
// Check for duplicate IDs
⋮----
const handleSave = () =>
⋮----
placeholder=
⋮----
onChange=
⋮----
{/* Disable streaming checkbox */}

================
File: src/renderer/src/components/ModelLibrary/ProviderSelection.tsx
================
import { LlmProviderName, AVAILABLE_PROVIDERS } from '@common/agent';
import { useTranslation } from 'react-i18next';
import { ComponentType } from 'react';
import { FiArrowLeft } from 'react-icons/fi';
⋮----
import { ProviderCard } from './ProviderCard';
⋮----
import { IconButton } from '@/components/common/IconButton';
import {
  AnthropicIcon,
  AnthropicCompatibleIcon,
  AzureIcon,
  BedrockIcon,
  CerebrasIcon,
  ClaudeAgentSdkIcon,
  DeepseekIcon,
  GeminiIcon,
  GpustackIcon,
  GroqIcon,
  LitellmIcon,
  LmStudioIcon,
  MinimaxIcon,
  OllamaIcon,
  OpenAiCompatibleIcon,
  OpenAiIcon,
  OpenCodeIcon,
  OpenRouterIcon,
  RequestyIcon,
  SyntheticIcon,
  VertexAiIcon,
  ZaiPlanIcon,
  KimiPlanIcon,
} from '@/icons';
⋮----
type Props = {
  onSelectProvider: (provider: LlmProviderName) => void;
  onCancel?: () => void;
  showTitle?: boolean;
};
⋮----
onClick=

================
File: src/renderer/src/components/onboarding/OnboardingProviderSetup.tsx
================
import { useState } from 'react';
import { ProviderProfile } from '@common/types';
import { LlmProviderName } from '@common/agent';
⋮----
import { ProviderSelection } from '@/components/ModelLibrary/ProviderSelection';
import { ProviderProfileForm } from '@/components/ModelLibrary/ProviderProfileForm';
import { useModelProviders } from '@/contexts/ModelProviderContext';
import { ProviderHeader } from '@/components/ModelLibrary/ProviderHeader';
⋮----
export const OnboardingProviderSetup = () =>
⋮----
const handleAddProvider = () =>
⋮----
const handleSelectProvider = (provider: LlmProviderName) =>
⋮----
const handleEditProfile = (profile: ProviderProfile) =>
⋮----
const handleDeleteProfile = async (profile: ProviderProfile) =>
⋮----
const handleCancelConfigure = () =>
⋮----
const handleSaveProfile = async (profile: ProviderProfile) =>
⋮----
// Show provider configuration form
⋮----
// Show provider selection when adding new provider

================
File: src/renderer/src/components/onboarding/OnboardingStepper.tsx
================
import { HiCheck } from 'react-icons/hi';
import { clsx } from 'clsx';
⋮----
type Step = {
  title: string;
};
⋮----
type Props = {
  steps: Step[];
  currentStep: number;
};
⋮----
{/* Step Circle */}
⋮----
className=
⋮----
{/* Step Title */}
⋮----
{/* Connector Line */}

================
File: src/renderer/src/components/project/TaskSidebar/TaskItem.tsx
================
import { TaskData, DefaultTaskState } from '@common/types';
import { useTranslation } from 'react-i18next';
import { KeyboardEvent, MouseEvent, useEffect, memo, useState } from 'react';
import { HiPlus, HiCheck, HiSparkles } from 'react-icons/hi';
import { IoGitBranch } from 'react-icons/io5';
import { MdPushPin, MdChevronRight } from 'react-icons/md';
import { clsx } from 'clsx';
import { useLocalStorage, useLongPress } from '@reactuses/core';
import { AnimatePresence, motion } from 'framer-motion';
⋮----
import { TaskStatusIcon } from './TaskStatusIcon';
import { TaskMenuButton } from './TaskMenuButton';
⋮----
import { getSortedVisibleTasks } from '@/utils/task-utils';
import { Input } from '@/components/common/Input';
import { Button } from '@/components/common/Button';
import { LoadingText } from '@/components/common/LoadingText';
import { TaskStateChip } from '@/components/common/TaskStateChip';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  task: TaskData;
  tasks: TaskData[];
  level: number;
  selectedTasks: Set<string>;
  deleteConfirmTaskId: string | null;
  showArchived: boolean;
  searchQuery: string;
  isMultiselectMode: boolean;
  setIsMultiselectMode: (value: boolean) => void;
  activeTaskId: string | null;
  onTaskClick: (e: MouseEvent, taskId: string) => void;
  createNewTask?: (parentId?: string) => void;
  editingTaskId: string | null;
  onEditClick: (taskId: string) => void;
  onEditConfirm: (taskId: string, newName: string) => Promise<void>;
  onEditCancel: () => void;
  onDeleteClick: (taskId: string) => void;
  onArchiveTask: (taskId: string) => Promise<void>;
  onUnarchiveTask: (taskId: string) => Promise<void>;
  onTogglePin: (taskId: string) => Promise<void>;
  onChangeState: (taskId: string, newState: string) => Promise<void>;
  onExportToMarkdown?: (taskId: string) => void;
  onExportToImage?: (taskId: string) => void;
  onDuplicateTask?: (taskId: string) => void;
  updateTask?: (taskId: string, updates: Partial<TaskData>) => Promise<void>;
  deleteTask?: (taskId: string) => Promise<void>;
  handleConfirmDelete: (taskId: string) => Promise<void>;
  handleCancelDelete: () => void;
};
⋮----
// Auto-expand if this task contains the active task as a subtask (recursively)
⋮----
const hasActiveSubtask = (taskId: string): boolean =>
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
const toggleExpand = (e: MouseEvent) =>
⋮----
const handleCreateSubtask = (e: MouseEvent) =>
⋮----
const handleEditKeyDown = (e: KeyboardEvent<HTMLInputElement>) =>
⋮----
const handleOnEdit = () =>
⋮----
className=
⋮----
label=
⋮----
onDelete=
⋮----
onTogglePin=
onChangeState=

================
File: src/renderer/src/components/project/TaskSidebar/TaskMenuButton.tsx
================
import { DefaultTaskState, TaskData } from '@common/types';
import { useTranslation } from 'react-i18next';
import { MouseEvent, useRef, useState, useEffect, memo } from 'react';
import { HiOutlinePencil, HiOutlineTrash } from 'react-icons/hi';
import { FaEllipsisVertical } from 'react-icons/fa6';
import { IoLogoMarkdown } from 'react-icons/io';
import { RiFlag2Line } from 'react-icons/ri';
import { MdImage, MdPushPin, MdChevronRight } from 'react-icons/md';
import { BiDuplicate, BiArchive, BiArchiveIn } from 'react-icons/bi';
import { createPortal } from 'react-dom';
import { clsx } from 'clsx';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
import { getTaskStateLabel } from '@/components/common/TaskStateChip';
⋮----
type Props = {
  task: TaskData;
  onEdit: () => void;
  onDelete?: () => void;
  onExportToMarkdown?: () => void;
  onExportToImage?: () => void;
  onDuplicateTask?: () => void;
  onArchiveTask?: () => void;
  onUnarchiveTask?: () => void;
  onTogglePin?: () => void;
  onChangeState?: (newState: string) => void;
  isPinned?: boolean;
};
⋮----
const handleMenuClick = () =>
⋮----
const handleEditClick = (e: MouseEvent) =>
⋮----
const handleDeleteClick = (e: MouseEvent) =>
⋮----
const handleExportToMarkdownClick = (e: MouseEvent) =>
⋮----
const handleExportToImageClick = (e: MouseEvent) =>
⋮----
const handleDuplicateTaskClick = (e: MouseEvent) =>
⋮----
const handleArchiveTaskClick = (e: MouseEvent) =>
⋮----
const handleUnarchiveTaskClick = (e: MouseEvent) =>
⋮----
const handlePinClick = (e: MouseEvent) =>
⋮----
const handleStateSubmenuToggle = () =>
⋮----
const handleStateChange = (e: MouseEvent, state: string) =>
⋮----
<div className=
⋮----
className={clsx(
              'transition-opacity p-1.5 rounded-md hover:bg-bg-tertiary text-text-muted hover:text-text-primary',
              !isMenuOpen && 'opacity-0 group-hover:opacity-100',
            )}
onClick=
⋮----
e.stopPropagation();
handleStateSubmenuToggle();

================
File: src/renderer/src/components/project/TaskSidebar/TaskSidebar.tsx
================
import { TaskData } from '@common/types';
import { useTranslation } from 'react-i18next';
import { MouseEvent, useState, useRef, useEffect, useOptimistic, startTransition, Activity, memo, useCallback, useDeferredValue } from 'react';
import { HiPlus } from 'react-icons/hi';
import { RiMenuUnfold4Line } from 'react-icons/ri';
import { CgSpinner } from 'react-icons/cg';
import { MdOutlineSearch } from 'react-icons/md';
import { clsx } from 'clsx';
import { AnimatePresence, motion } from 'framer-motion';
import { BiArchive, BiArchiveIn } from 'react-icons/bi';
import { HiXMark } from 'react-icons/hi2';
import { useDebounce } from '@reactuses/core';
⋮----
import { TaskSidebarMultiSelectMenu } from './TaskSidebarMultiSelectMenu';
import { TaskItem } from './TaskItem';
⋮----
import { getSortedVisibleTasks } from '@/utils/task-utils';
import { Input } from '@/components/common/Input';
import { IconButton } from '@/components/common/IconButton';
import { useClickOutside } from '@/hooks/useClickOutside';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  loading: boolean;
  tasks: TaskData[];
  activeTaskId: string | null;
  onTaskSelect: (taskId: string) => void;
  createNewTask?: (parentId?: string) => void;
  className?: string;
  isCollapsed: boolean;
  onToggleCollapse: () => void;
  updateTask?: (taskId: string, updates: Partial<TaskData>) => Promise<void>;
  deleteTask?: (taskId: string) => Promise<void>;
  onExportToMarkdown?: (taskId: string) => void;
  onExportToImage?: (taskId: string) => void;
  onDuplicateTask?: (taskId: string) => void;
  isMobile?: boolean;
  onClose?: () => void;
};
⋮----
// Multiselect state
⋮----
const handleMultiselectClose = () =>
⋮----
// Handle ESC key to exit multiselect mode
⋮----
const handleKeyDown = (e: globalThis.KeyboardEvent) =>
⋮----
// Handle click outside for multiselect menu
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
const handleCreateTask = () =>
⋮----
const handleSearchToggle = () =>
⋮----
const handleSearchClose = () =>
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Multiselect handlers
⋮----
const handleBulkDelete = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleBulkArchive = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
<h3 className="text-sm font-semibold uppercase h-5">
⋮----
onArchive=
onUnarchive=
⋮----
onClick=
⋮----
{/* Bulk Delete Confirmation */}
⋮----
title=
⋮----
{/* Bulk Archive Confirmation */}
⋮----
// Custom comparison function for React.memo
const arePropsEqual = (prevProps: Props, nextProps: Props): boolean =>
⋮----
// Compare primitive props
⋮----
// Compare function props
⋮----
// Compare tasks array - shallow check first, then deep check for task properties
⋮----
// Check if tasks have changed in meaningful ways
⋮----
// Only check properties that affect rendering

================
File: src/renderer/src/components/project/TaskSidebar/TaskSidebarMultiSelectMenu.tsx
================
import { useTranslation } from 'react-i18next';
import { HiOutlineTrash } from 'react-icons/hi';
import { FaEllipsisVertical } from 'react-icons/fa6';
import { BiArchive, BiArchiveIn } from 'react-icons/bi';
⋮----
type Props = {
  hasArchived: boolean;
  onDelete: () => void;
  onArchive: () => void;
  onUnarchive: () => void;
  isOpen: boolean;
  onToggle: () => void;
  menuRef: React.RefObject<HTMLDivElement | null>;
  buttonRef: React.RefObject<HTMLDivElement | null>;
};
⋮----
e.stopPropagation();
onDelete();
⋮----
onArchive();
⋮----
onUnarchive();

================
File: src/renderer/src/components/project/TaskSidebar/TaskStatusIcon.tsx
================
import { DefaultTaskState } from '@common/types';
import { CgSpinner } from 'react-icons/cg';
import { clsx } from 'clsx';
⋮----
import { useTaskState } from '@/stores/taskStore';
⋮----
type Props = {
  taskId: string;
  state?: string;
  isCollapsed?: boolean;
};
⋮----
export const TaskStatusIcon = (
⋮----
return <span className=

================
File: src/renderer/src/components/project/AddFileDialog.tsx
================
import { useCallback, useEffect, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
⋮----
import { FileFinder } from '@/components/project/FileFinder';
import { FileChip } from '@/components/common/FileChip';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { Checkbox } from '@/components/common/Checkbox';
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  onClose: () => void;
  onAddFiles: (filePaths: string[], readOnly?: boolean) => void;
  initialReadOnly?: boolean;
};
⋮----
const handleDragEnter = (event: DragEvent) =>
⋮----
const handleDragOver = (event: DragEvent) =>
⋮----
const handleDrop = async (event: DragEvent) =>
⋮----
const handleOnPaste = async (pastedText: string): Promise<boolean> =>
⋮----
const handleRemovePath = (pathToRemove: string) =>
⋮----
const handleAddFiles = () =>
⋮----
// onClose will be called by ConfirmDialog's onConfirm
⋮----
title=
⋮----
className="w-full" // Changed from flex-1 as it's the only main element now
⋮----
<Checkbox label=

================
File: src/renderer/src/components/project/FileFinder.tsx
================
import { matchSorter } from 'match-sorter';
import { useEffect, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FaFile, FaFolder } from 'react-icons/fa';
import { PiKeyReturn } from 'react-icons/pi';
⋮----
import { AutocompletionInput } from '@/components/AutocompletionInput';
import { IconButton } from '@/components/common/IconButton';
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  baseDir?: string;
  taskId?: string;
  isReadOnly: boolean;
  selectedPaths: string[];
  onPathAdded: (path: string) => void;
  onSubmit?: () => void;
  onPaste?: (pastedText: string) => Promise<boolean>;
  autoFocus?: boolean;
  className?: string;
  allowFiles?: boolean;
  allowDirectories?: boolean;
};
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect
⋮----
const checkValidPath = async () =>
⋮----
const updateSuggestions = async () =>
⋮----
const getParentDirectories = () =>
⋮----
continue; // No parent directories if it's a root file or empty/invalid path
⋮----
// Construct the parent path by joining segments from start up to current segment 'i'
⋮----
// Add to set if it's not an empty string (e.g. from a path like "/file.txt" where first segment is empty)
⋮----
// Deduplicate in case a path could be sourced from both lists or if suggestionFiles had duplicates
⋮----
const handleInputSubmit = (isMultiSelect = false) =>
⋮----
const handleAutocompleteInputChange = (value: string, isFromSuggestion?: boolean, isMultiSelect?: boolean) =>
⋮----
setInputValue(''); // Clear input after adding from suggestion
setShowSuggestions(false); // Hide suggestions after selection
⋮----
const getPlaceholderKey = (isForSelectedPaths: boolean) =>
⋮----
// Fallback, though ideally one of them should always be true
⋮----
const handleBrowse = async (browseType: 'file' | 'directory') =>
⋮----
// eslint-disable-next-line no-console
⋮----
onClick=
⋮----
tooltip=

================
File: src/renderer/src/components/project/FilesContextInfoContent.tsx
================
import { ContextFile, Mode, TaskData, TokensInfoData } from '@common/types';
⋮----
import { ContextFiles } from '@/components/ContextFiles';
import { CostInfo } from '@/components/CostInfo';
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  allFiles: string[];
  contextFiles: ContextFile[];
  tokensInfo: TokensInfoData | null;
  aiderTotalCost: number;
  maxInputTokens: number;
  clearMessages: (clearContext?: boolean) => void;
  runCommand: (command: string) => void;
  resetTask: () => void;
  mode: Mode;
  showFileDialog: () => void;
  task: TaskData;
  updateTask: (taskId: string, updates: Partial<TaskData>) => void;
  refreshAllFiles: (useGit?: boolean) => Promise<void>;
};
⋮----
export const FilesContextInfoContent = ({
  baseDir,
  taskId,
  allFiles,
  contextFiles,
  tokensInfo,
  aiderTotalCost,
  maxInputTokens,
  clearMessages,
  runCommand,
  resetTask,
  mode,
  showFileDialog,
  task,
  updateTask,
  refreshAllFiles,
}: Props) =>
⋮----
refreshRepoMap=

================
File: src/renderer/src/components/project/MobileSidebar.tsx
================
import React from 'react';
import { motion } from 'framer-motion';
import { clsx } from 'clsx';
import { ContextFile, Mode, TaskData, TokensInfoData } from '@common/types';
import { FiChevronDown } from 'react-icons/fi';
⋮----
import { FilesContextInfoContent } from '@/components/project/FilesContextInfoContent';
⋮----
type AddFileDialogOptions = {
  readOnly: boolean;
};
⋮----
type Props = {
  showSidebar: boolean;
  setShowSidebar: (show: boolean) => void;
  baseDir: string;
  taskId: string;
  allFiles: string[];
  contextFiles: ContextFile[];
  tokensInfo: TokensInfoData | null;
  aiderTotalCost: number;
  maxInputTokens: number;
  clearMessages: (clearContext?: boolean) => void;
  runCommand: (command: string) => void;
  resetTask: () => void;
  mode: Mode;
  setAddFileDialogOptions: React.Dispatch<React.SetStateAction<AddFileDialogOptions | null>>;
  task: TaskData;
  updateTask: (taskId: string, updates: Partial<TaskData>) => void;
  refreshAllFiles: (useGit?: boolean) => Promise<void>;
};
⋮----
export const MobileSidebar = ({
  showSidebar,
  setShowSidebar,
  baseDir,
  taskId,
  allFiles,
  contextFiles,
  tokensInfo,
  aiderTotalCost,
  maxInputTokens,
  clearMessages,
  runCommand,
  resetTask,
  mode,
  setAddFileDialogOptions,
  task,
  updateTask,
  refreshAllFiles,
}: Props) =>
⋮----
className=
⋮----
<div onClick=
⋮----
showFileDialog=

================
File: src/renderer/src/components/project/NoProjectsOpen.tsx
================
import { useTranslation } from 'react-i18next';
⋮----
// @ts-expect-error TypeScript is not aware of asset import
import icon from '../../../../../resources/icon.png?asset';
⋮----
type Props = {
  onOpenProject: () => void;
};

================
File: src/renderer/src/components/project/OpenProjectDialog.tsx
================
import { useCallback, useEffect, useState } from 'react';
import { FaFolder } from 'react-icons/fa';
import { useTranslation } from 'react-i18next';
import { ProjectData } from '@common/types';
import { useHotkeys } from 'react-hotkeys-hook';
⋮----
import { useConfiguredHotkeys } from '@/hooks/useConfiguredHotkeys';
import { AutocompletionInput } from '@/components/AutocompletionInput';
import { Accordion } from '@/components/common/Accordion';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { IconButton } from '@/components/common/IconButton';
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  onClose: () => void;
  onAddProject: (baseDir: string) => void;
  openProjects: ProjectData[];
};
⋮----
// eslint-disable-next-line no-console
⋮----
// Browse for folder
⋮----
const loadRecentProjects = async () =>
⋮----
const updateSuggestions = async () =>
⋮----
const handleAddProject = () =>
⋮----
title=
⋮----
onAddProject(path);
onClose();

================
File: src/renderer/src/components/project/ProjectTabs.tsx
================
import { ProjectData } from '@common/types';
import { CSS } from '@dnd-kit/utilities';
import { MouseEvent, useEffect, useMemo, useRef, useState } from 'react';
import { Tab, TabGroup, TabList, Listbox, ListboxButton, ListboxOption, ListboxOptions, Transition } from '@headlessui/react';
import { clsx } from 'clsx';
import { CgSpinner } from 'react-icons/cg';
import { MdAdd, MdClose, MdChevronLeft, MdChevronRight } from 'react-icons/md';
import { DndContext, closestCenter, KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';
import { SortableContext, sortableKeyboardCoordinates, arrayMove, useSortable, horizontalListSortingStrategy } from '@dnd-kit/sortable';
import { useTranslation } from 'react-i18next';
import { HiChevronDown, HiCheck } from 'react-icons/hi2';
⋮----
import type { DragEndEvent } from '@dnd-kit/core';
⋮----
import { MenuOption, useContextMenu } from '@/contexts/ContextMenuContext';
import { useProjectProcessingState } from '@/stores/projectStore';
import { useResponsive } from '@/hooks/useResponsive';
⋮----
type Props = {
  openProjects: ProjectData[];
  activeProject: string | undefined;
  onAddProject: () => void;
  onSetActiveProject: (baseDir: string) => void;
  onCloseProject: (baseDir: string) => void;
  onCloseOtherProjects: (baseDir: string) => void;
  onCloseAllProjects: () => void;
  onReorderProjects: (projects: ProjectData[]) => void;
};
⋮----
const checkScrollButtonsVisibility = () =>
⋮----
const handleScroll = () =>
⋮----
const handleScrollLeft = () =>
⋮----
const handleScrollRight = () =>
⋮----
const handleDragEnd = (event: DragEndEvent) =>
⋮----
// useMemo for project IDs to prevent SortableContext from re-rendering unnecessarily
⋮----
onChange=
⋮----
const handleRightClick = (event: MouseEvent) =>
⋮----
className={clsx(
            'flex items-center justify-center rounded-full p-1 transition-colors duration-200 z-10',
            isActive ? 'hover:bg-bg-fourth' : 'hover:bg-bg-tertiary-strong',
            isProcessing ? 'cursor-default' : '',
          )}
onClick=
⋮----
e.stopPropagation(); // Prevent tab selection/drag initiation

================
File: src/renderer/src/components/project/ProjectView.tsx
================
import { InputHistoryData, ProjectStartMode, TaskCreatedData, TaskData } from '@common/types';
import { useTranslation } from 'react-i18next';
import { Activity, startTransition, useCallback, useEffect, useOptimistic, useRef, useState, useTransition } from 'react';
import { useLocalStorage } from '@reactuses/core';
import { useHotkeys } from 'react-hotkeys-hook';
import { clsx } from 'clsx';
⋮----
import { COLLAPSED_WIDTH, EXPANDED_WIDTH, TaskSidebar } from './TaskSidebar/TaskSidebar';
⋮----
import { useProjectTasks, useProjectStore } from '@/stores/projectStore';
import { useSettings } from '@/contexts/SettingsContext';
import { useProjectSettings } from '@/contexts/ProjectSettingsContext';
import { LoadingOverlay } from '@/components/common/LoadingOverlay';
import { TaskView, TaskViewRef } from '@/components/project/TaskView';
import { useApi } from '@/contexts/ApiContext';
import { TaskProvider } from '@/contexts/TaskContext';
import { useConfiguredHotkeys } from '@/hooks/useConfiguredHotkeys';
import { getSortedVisibleTasks } from '@/utils/task-utils';
import { useResponsive } from '@/hooks/useResponsive';
import { useBooleanState } from '@/hooks/useBooleanState';
import { showNotification } from '@/utils/browser-notifications';
⋮----
type Props = {
  projectDir: string;
  isProjectActive?: boolean;
  showSettingsPage?: (pageId?: string, options?: Record<string, unknown>) => void;
  initialTaskId?: string;
};
⋮----
// eslint-disable-next-line no-console
⋮----
const handleStartupMode = async (tasks: TaskData[]) =>
⋮----
// Check if URL specifies a task to activate
⋮----
const handleProjectStarted = () =>
⋮----
const handleTaskCreated = (
⋮----
const handleTaskInitialized = (taskData: TaskData) =>
⋮----
const handleTaskUpdated = (taskData: TaskData) =>
⋮----
const handleTaskStarted = (taskData: TaskData) =>
⋮----
const handleTaskCompleted = (taskData: TaskData) =>
⋮----
const handleTaskCancelled = (taskData: TaskData) =>
⋮----
const handleTaskDeleted = (taskData: TaskData) =>
⋮----
const handleInputHistoryUpdate = (data: InputHistoryData) =>
⋮----
// Set up listeners
⋮----
const initProject = async () =>
⋮----
// Start project
⋮----
// Load tasks
⋮----
// Handle startup mode
⋮----
// eslint-disable-next-line no-console
⋮----
// Switch to specific task tabs (Ctrl + 1-9)
⋮----
// eslint-disable-next-line no-console
⋮----
// Task will be automatically removed via the existing handleTaskDeleted listener
⋮----
// eslint-disable-next-line no-console
⋮----
// Close current task
⋮----
// eslint-disable-next-line no-console
⋮----
// Optionally switch to the new task
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/components/project/TaskBar.tsx
================
import { AgentProfile, AIDER_MODES, EditFormat, Mode, Model, ModelsData, RawModelInfo, TaskData } from '@common/types';
import React, { ReactNode, useCallback, useImperativeHandle, useMemo, useRef, useState } from 'react';
import { BsCodeSlash, BsFilter, BsLayoutSidebar } from 'react-icons/bs';
import { CgTerminal } from 'react-icons/cg';
import { GoProjectRoadmap } from 'react-icons/go';
import { IoMdClose } from 'react-icons/io';
import { VscLock, VscUnlock } from 'react-icons/vsc';
import { RiRobot2Line, RiMenuUnfold4Line } from 'react-icons/ri';
import { useTranslation } from 'react-i18next';
import { getProviderModelId, AVAILABLE_PROVIDERS } from '@common/agent';
import { clsx } from 'clsx';
import { extractProviderModel } from '@common/utils';
⋮----
import { IconButton } from '@/components/common/IconButton';
import { ModelSelector, ModelSelectorRef } from '@/components/ModelSelector';
import { showErrorNotification } from '@/utils/notifications';
import { EditFormatSelector } from '@/components/PromptField/EditFormatSelector';
import { TaskWorkingMode } from '@/components/PromptField/TaskWorkingMode';
import { Tooltip } from '@/components/ui/Tooltip';
import { useSettings } from '@/contexts/SettingsContext';
import { useApi } from '@/contexts/ApiContext';
import { useResponsive } from '@/hooks/useResponsive';
import { useModelProviders } from '@/contexts/ModelProviderContext';
⋮----
export type TaskBarRef = {
  openMainModelSelector: (model?: string) => void;
  openAgentModelSelector: (model?: string) => void;
};
⋮----
type Props = {
  baseDir: string;
  task: TaskData;
  modelsData: ModelsData | null;
  mode: Mode;
  activeAgentProfile: AgentProfile | null;
  onModelsChange?: (modelsData: ModelsData | null) => void;
  runCommand: (command: string) => void;
  onToggleSidebar: () => void;
  onToggleTaskSidebar?: () => void;
  updateTask: (taskId: string, updates: Partial<TaskData>, useOptimistic?: boolean) => void;
};
⋮----
// Use task provider/model first, fallback to active agent profile
⋮----
// Add the currently selected model if it's not in the known list (custom model)
⋮----
// Create a custom model object for the current model
⋮----
taskModels.unshift(customModel); // Add to the beginning for visibility
⋮----
// optimistic update
⋮----
if (!settings)
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
<div className=
⋮----
{/* Task sidebar toggle for mobile */}
⋮----
// Two-row layout for Agent mode with Aider tools
⋮----
{/* Row 1: AGENT */}
⋮----
{/* Row 2: AIDER */}
⋮----
// Original horizontal layout for other modes
⋮----
<Tooltip content=
⋮----
onSquash=

================
File: src/renderer/src/components/project/TaskView.tsx
================
import { AGENT_MODES, DefaultTaskState, Mode, Model, ModelsData, TaskData, TodoItem } from '@common/types';
import { forwardRef, useCallback, useDeferredValue, useEffect, useImperativeHandle, useMemo, useOptimistic, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { ResizableBox, ResizeCallbackData } from 'react-resizable';
import { clsx } from 'clsx';
import { getProviderModelId } from '@common/agent';
import { RiMenuUnfold4Line } from 'react-icons/ri';
import { useLocalStorage } from '@reactuses/core';
import { useHotkeys } from 'react-hotkeys-hook';
import { v4 as uuidv4 } from 'uuid';
⋮----
import { useSidebarWidth } from './useSidebarWidth';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
import { isLogMessage, isTaskInfoMessage, isUserMessage, Message, TaskInfoMessage, UserMessage } from '@/types/message';
import { Messages, MessagesRef } from '@/components/message/Messages';
import { VirtualizedMessages, VirtualizedMessagesRef } from '@/components/message/VirtualizedMessages';
import { useSettings } from '@/contexts/SettingsContext';
import { useProjectSettings } from '@/contexts/ProjectSettingsContext';
import { AddFileDialog } from '@/components/project/AddFileDialog';
import { TaskBar, TaskBarRef } from '@/components/project/TaskBar';
import { PromptField, PromptFieldRef } from '@/components/PromptField';
import { Button } from '@/components/common/Button';
import { TodoWindow } from '@/components/project/TodoWindow';
import { TerminalView, TerminalViewRef } from '@/components/terminal/TerminalView';
import { MobileSidebar } from '@/components/project/MobileSidebar';
import { FilesContextInfoContent } from '@/components/project/FilesContextInfoContent';
import { WelcomeMessage } from '@/components/project/WelcomeMessage';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { resolveAgentProfile } from '@/utils/agents';
import { useResponsive } from '@/hooks/useResponsive';
import { useModelProviders } from '@/contexts/ModelProviderContext';
import { useTask } from '@/contexts/TaskContext';
import { useAgents } from '@/contexts/AgentsContext';
import { useConfiguredHotkeys } from '@/hooks/useConfiguredHotkeys';
import { LoadingOverlay } from '@/components/common/LoadingOverlay';
import { useTaskMessages, useTaskState } from '@/stores/taskStore';
import { showErrorNotification } from '@/utils/notifications';
import { useSearchText } from '@/hooks/useSearchText';
⋮----
type AddFileDialogOptions = {
  readOnly: boolean;
};
⋮----
export type TaskViewRef = {
  exportMessagesToImage: () => void;
  focusPromptField: () => void;
};
⋮----
type Props = {
  projectDir: string;
  task: TaskData;
  updateTask: (taskId: string, updates: Partial<TaskData>, useOptimistic?: boolean) => void;
  updateOptimisticTaskState: (taskId: string, taskState: string) => void;
  inputHistory: string[];
  isActive?: boolean;
  showSettingsPage?: (pageId?: string, options?: Record<string, unknown>) => void;
  shouldFocusPrompt?: boolean;
  onProceed?: () => void;
  onArchiveTask?: () => void;
  onUnarchiveTask?: () => void;
  onDeleteTask?: () => void;
  onToggleTaskSidebar?: () => void;
};
⋮----
// Focus prompt field
⋮----
// This submission is an edit of a previous message
setEditingMessageIndex(null); // Clear editing state
⋮----
// OPTIMISTIC: Add user message immediately before backend response
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Optimistically remove the messages after it
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Only update task state if we're interrupting the entire task, not a specific agent
⋮----
<div className=
⋮----

⋮----
{/* Expand/Collapse Button */}
⋮----
className=
⋮----
{/* Resizable wrapper for expanded state */}
⋮----
refreshAllFiles=

================
File: src/renderer/src/components/project/TodoListItem.tsx
================
import { useState } from 'react';
import { clsx } from 'clsx';
import { MdEdit, MdDelete, MdCheck, MdClose, MdSwapHoriz } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
import { TodoItem } from '@common/types';
⋮----
import { Checkbox } from '../common/Checkbox';
import { IconButton } from '../common/IconButton';
⋮----
type Props = {
  item: TodoItem;
  onToggle?: (name: string, completed: boolean) => void;
  onUpdate?: (name: string, updates: Partial<TodoItem>) => void;
  onDelete?: (name: string) => void;
  onHandoff?: (name: string) => void;
};
⋮----
const handleToggle = (checked: boolean) =>
⋮----
const handleEdit = () =>
⋮----
const handleSaveEdit = () =>
⋮----
const handleCancelEdit = () =>
⋮----
const handleKeyPress = (e: React.KeyboardEvent) =>
⋮----
const handleDelete = () =>
⋮----
const handleHandoff = () =>
⋮----
onChange=
⋮----
<span className=

================
File: src/renderer/src/components/project/TodoWindow.tsx
================
import { useEffect, useState } from 'react';
import { MdAdd, MdExpandLess, MdOutlineChecklist, MdPlaylistRemove } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
import { TodoItem } from '@common/types';
import { ResizableBox } from 'react-resizable';
⋮----
import { IconButton } from '../common/IconButton';
import { Button } from '../common/Button';
⋮----
import { TodoListItem } from './TodoListItem';
⋮----
import { Input } from '@/components/common/Input';
⋮----
type Props = {
  todos: TodoItem[];
  onToggleTodo?: (name: string, completed: boolean) => void;
  onAddTodo?: (name: string) => void;
  onUpdateTodo?: (name: string, updates: Partial<TodoItem>) => void;
  onDeleteTodo?: (name: string) => void;
  onHandoffTodo?: (name: string) => void;
  onClearAllTodos: () => void;
};
⋮----
const handleToggleExpand = () =>
⋮----
const handleAddTodo = () =>
⋮----
const handleSaveTodo = () =>
⋮----
const handleCancelAdd = () =>
⋮----
const handleKeyPress = (e: React.KeyboardEvent) =>
⋮----
// Auto-collapse when all todo items are completed
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect
⋮----
{/* Header */}
⋮----
{/* Content */}
⋮----
{/* Add Todo Input */}
⋮----
onChange=
⋮----
placeholder=
⋮----
{/* Todo List */}
⋮----
/* Collapsed state */

================
File: src/renderer/src/components/project/useSidebarWidth.ts
================
import { useEffect, useState } from 'react';
import { useDebounceFn } from '@reactuses/core';
⋮----
import { useIndexedDB } from '@/hooks/useIndexedDB';
⋮----
export const useSidebarWidth = (projectBaseDir: string, taskId: string) =>
⋮----
// Sync immediate width with persisted width when it loads
⋮----
const setWidth = (newWidth: number) =>

================
File: src/renderer/src/components/project/WelcomeMessage.tsx
================
import { RiRobot2Line } from 'react-icons/ri';
import { useTranslation } from 'react-i18next';
import { FiCode, FiFile, FiLayers, FiTerminal } from 'react-icons/fi';
import { CgTerminal } from 'react-icons/cg';
⋮----
// @ts-expect-error TypeScript is not aware of asset import
import icon from '../../../../../resources/icon.png?asset';
⋮----
import type { Mode } from '@common/types';
⋮----
import { BmadWorkflowPage } from '@/components/bmad/BmadWorkflowPage';
⋮----
type Props = {
  onModeChange?: (mode: Mode) => void;
  mode?: Mode;
  projectDir?: string;
  taskId?: string;
};
⋮----
const handleModeClick = (mode: Mode) =>

================
File: src/renderer/src/components/project/WorktreeActionDialog.tsx
================
import { ChangeEvent, useEffect, useMemo, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { BranchInfo } from '@common/types';
⋮----
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { useApi } from '@/contexts/ApiContext';
import Select from '@/components/common/Select';
import { Input } from '@/components/common/Input';
⋮----
type Props = {
  baseDir: string;
  title: string;
  message?: string;
  confirmButtonText: string;
  defaultBranch?: string;
  showCommitMessage?: boolean;
  initialCommitMessage?: string;
  onCancel: () => void;
  onConfirm: (branch: string, commitMessage?: string) => void;
};
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect
⋮----
const load = async () =>
⋮----
const handleConfirm = () =>
⋮----
const handleBranchChange = (value: string) =>
⋮----
const handleCommitMessageChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
label=

================
File: src/renderer/src/components/project/WorktreeMergeButton.tsx
================
import { useState, useRef } from 'react';
import { FaArrowsRotate, FaBan, FaCodeMerge, FaCompress, FaDownload, FaFileLines, FaPlay, FaRobot } from 'react-icons/fa6';
import { MdKeyboardArrowDown } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
import { WorktreeIntegrationStatus } from '@common/types';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { WorktreeActionDialog } from '@/components/project/WorktreeActionDialog';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  baseDir: string;
  defaultBranch?: string;
  onMerge: (targetBranch?: string) => void;
  onSquash: (targetBranch?: string, commitMessage?: string) => void;
  onOnlyUncommitted: (targetBranch?: string) => void;
  onRebaseFromBranch: (fromBranch?: string) => void;
  onAbortRebase: () => void;
  onContinueRebase: () => void;
  onResolveConflictsWithAgent: () => void;
  disabled?: boolean;
  canAbortRebase?: boolean;
  canContinueRebase?: boolean;
  canResolveConflictsWithAgent?: boolean;
  status?: WorktreeIntegrationStatus | null;
  taskName?: string;
};
⋮----
const handleToggle = () =>
⋮----
const handleMergeClick = () =>
⋮----
const handleSquashClick = () =>
⋮----
const handleOnlyUncommittedClick = () =>
⋮----
const handleRebaseClick = () =>
⋮----
const handleAbortRebaseClick = () =>
⋮----
const handleContinueRebaseClick = () =>
⋮----
const handleResolveWithAgentClick = () =>
⋮----
const handleAbortRebaseConfirm = () =>
⋮----
const handleContinueRebaseConfirm = () =>
⋮----
const handleResolveWithAgentConfirm = () =>
⋮----
title=
⋮----
confirmButtonText=
⋮----
onConfirm=

================
File: src/renderer/src/components/project/WorktreeRevertButton.tsx
================
import { useState } from 'react';
import { MdUndo } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
import { useLocalStorage } from '@reactuses/core';
⋮----
import { IconButton } from '@/components/common/IconButton';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { Checkbox } from '@/components/common/Checkbox';
⋮----
type Props = {
  onRevert: () => void;
  disabled?: boolean;
};
⋮----
const handleRevertClick = () =>
⋮----
const handleRevertConfirm = () =>
⋮----
tooltip=
⋮----
title=
⋮----
confirmButtonText=

================
File: src/renderer/src/components/project/WorktreeStatusBadges.tsx
================
import { useMemo } from 'react';
import { useTranslation } from 'react-i18next';
import { TiWarning } from 'react-icons/ti';
⋮----
import type { WorktreeIntegrationStatus } from '@common/types';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
const formatTruncatedList = (items: string[]) =>
⋮----
type Props = {
  status: WorktreeIntegrationStatus;
  onRefresh: () => void;
};
⋮----
const renderBadge = (tooltipContent: React.ReactNode, onClick: () => void, children: React.ReactNode) => (
    <Tooltip content={tooltipContent}>
      <span
        className="px-1.5 py-0.5 rounded bg-bg-secondary text-text-primary text-2xs cursor-pointer hover:bg-bg-secondary-light transition-colors"
        onClick={onClick}
      >
        {children}
      </span>
    </Tooltip>
  );
⋮----
const renderButtonBadge = (tooltipContent: string, onClick: () => void, children: React.ReactNode) => (
    <Tooltip content={tooltipContent}>
      <button
        type="button"
        className="px-1.5 py-0.5 rounded bg-bg-secondary text-text-muted-light text-2xs cursor-pointer hover:bg-bg-secondary-light transition-colors"
        onClick={onClick}
      >
        {children}
      </button>
    </Tooltip>
  );

================
File: src/renderer/src/components/PromptField/AudioAnalyzer.tsx
================
import { useEffect, useRef } from 'react';
⋮----
type Props = {
  stream: MediaStream | null;
  barCount?: number;
  width?: number;
};
⋮----
export const AudioAnalyzer = (
⋮----
// fftSize must be a power of 2 between 32 and 32768
// The number of frequency bins is fftSize / 2
// So we need fftSize to be approximately barCount * 2
⋮----
// Find the nearest power of 2
⋮----
// Clamp to valid range
⋮----
const draw = () =>
⋮----
// Try to match the theme color
// We can use the computed style of the canvas element itself or body
⋮----
// Scale the height
⋮----
// Draw bar

================
File: src/renderer/src/components/PromptField/AutoApprove.tsx
================
import { memo } from 'react';
import { useTranslation } from 'react-i18next';
import { MdDoneAll } from 'react-icons/md';
import { VscLock, VscUnlock } from 'react-icons/vsc';
⋮----
import { IconButton } from '@/components/common/IconButton';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  enabled: boolean;
  locked: boolean;
  onChange?: (enabled: boolean) => void;
  onLockChange?: (locked: boolean) => void;
  showLabel?: boolean;
};
⋮----
const handleClick = () =>
⋮----
const handleLockClick = () =>

================
File: src/renderer/src/components/PromptField/CommandSuggestion.tsx
================
import { useTranslation } from 'react-i18next';
import { ReactNode } from 'react';
⋮----
type Props = {
  command: string;
  description?: ReactNode;
};
⋮----
export const CommandSuggestion = (

================
File: src/renderer/src/components/PromptField/EditFormatSelector.tsx
================
import { forwardRef, useImperativeHandle, useRef } from 'react';
import { useTranslation } from 'react-i18next';
import { MdKeyboardArrowUp } from 'react-icons/md';
import { EditFormat } from '@common/types';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
import { useDropdownState } from '@/hooks/useDropdownState';
⋮----
export type EditFormatSelectorRef = {
  open: () => void;
};
⋮----
// Define available edit formats based on the EditFormat type
⋮----
type Props = {
  currentFormat: EditFormat;
  onFormatChange: (format: EditFormat) => void;
};
⋮----
const handleFormatSelected = (format: EditFormat) =>
⋮----
const renderFormatItem = (format: EditFormat, index: number) => (
    <div
      key={format}
      ref={index === state.highlightedIndex ? highlightedItemRef : undefined}
      className={`flex items-center w-full hover:bg-bg-tertiary transition-colors duration-200 ${index === state.highlightedIndex ? 'bg-bg-tertiary' : 'text-text-tertiary'}`}
    >
      <button
        onClick={() => handleFormatSelected(format)}
        className={`flex-grow px-3 py-1 text-left text-xs ${format === currentFormat ? 'text-text-primary font-bold' : ''}`}
      >
        {format}
      </button>
    </div>
  );

================
File: src/renderer/src/components/PromptField/index.ts
================


================
File: src/renderer/src/components/PromptField/InputHistoryMenu.tsx
================
import { useEffect, useRef } from 'react';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
⋮----
type Props = {
  items: string[];
  highlightedIndex: number;
  onSelect: (item: string) => void;
  onClose: () => void;
  onScrollTop?: () => void;
  keepHighlightAtTop?: boolean;
};
⋮----
const handleScroll = () =>

================
File: src/renderer/src/components/PromptField/ModeSelector.tsx
================
import { memo } from 'react';
import { CgTerminal } from 'react-icons/cg';
import { FaRegQuestionCircle } from 'react-icons/fa';
import { AiOutlineFileSearch } from 'react-icons/ai';
import { RiRobot2Line } from 'react-icons/ri';
import { GoProjectRoadmap } from 'react-icons/go';
import { FiLayers } from 'react-icons/fi';
import { Mode } from '@common/types';
⋮----
import { ItemSelector, ItemConfig } from '@/components/common/ItemSelector';
⋮----
type Props = {
  mode: Mode;
  onModeChange: (mode: Mode) => void;
};

================
File: src/renderer/src/components/PromptField/PromptField.tsx
================
import {
  acceptCompletion,
  autocompletion,
  CompletionContext,
  type CompletionResult,
  currentCompletions,
  moveCompletionSelection,
  startCompletion,
} from '@codemirror/autocomplete';
import { EditorView, keymap } from '@codemirror/view';
import { vim } from '@replit/codemirror-vim';
import { AGENT_MODES, Mode, PromptBehavior, QuestionData, SuggestionMode, TaskData } from '@common/types';
import { githubDarkInit } from '@uiw/codemirror-theme-github';
import CodeMirror, { Annotation, Prec, type ReactCodeMirrorRef } from '@uiw/react-codemirror';
import { forwardRef, useCallback, useEffect, useImperativeHandle, useRef, useState } from 'react';
import { useDebounce } from '@reactuses/core';
import { useHotkeys } from 'react-hotkeys-hook';
import { useTranslation } from 'react-i18next';
import { BiSend } from 'react-icons/bi';
import { FaInfoCircle } from 'react-icons/fa';
import { MdPlaylistRemove, MdSave, MdStop, MdMic, MdMicOff } from 'react-icons/md';
import { VscTerminal } from 'react-icons/vsc';
import { clsx } from 'clsx';
⋮----
import { usePromptFieldText } from './usePromptFieldText';
⋮----
import { AgentSelector } from '@/components/AgentSelector';
import { InputHistoryMenu } from '@/components/PromptField/InputHistoryMenu';
import { ModeSelector } from '@/components/PromptField/ModeSelector';
import { showErrorNotification } from '@/utils/notifications';
import { Button } from '@/components/common/Button';
import { useCustomCommands } from '@/hooks/useCustomCommands';
import { useApi } from '@/contexts/ApiContext';
import { useProjectSettings } from '@/contexts/ProjectSettingsContext';
import { Tooltip } from '@/components/ui/Tooltip';
import { useAudioRecorder } from '@/hooks/useAudioRecorder';
import { AudioAnalyzer } from '@/components/PromptField/AudioAnalyzer';
import { AutoApprove } from '@/components/PromptField/AutoApprove';
import { useResponsive } from '@/hooks/useResponsive';
⋮----
const ANSWERS = ['y', 'n', 'a', 'd', 'maybe']; // Added 'maybe' (Branch B)
⋮----
const isPathLike = (input: string): boolean =>
⋮----
export interface PromptFieldRef {
  focus: () => void;
  setText: (text: string) => void;
  appendText: (text: string) => void;
}
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  task: TaskData;
  processing: boolean;
  isActive: boolean;
  allFiles?: string[];
  words?: string[];
  inputHistory?: string[];
  openModelSelector?: (model?: string) => void;
  openAgentModelSelector?: (model?: string) => void;
  mode: Mode;
  onModeChanged: (mode: Mode) => void;
  runPrompt: (prompt: string) => void;
  savePrompt: (prompt: string) => Promise<void>;
  showFileDialog: (readOnly: boolean) => void;
  addFiles?: (filePaths: string[], readOnly?: boolean) => void;
  clearMessages: () => void;
  scrapeWeb: (url: string, filePath?: string) => void;
  question?: QuestionData | null;
  answerQuestion: (answer: string) => void;
  interruptResponse: () => void;
  runCommand: (command: string) => void;
  runTests: (testCmd?: string) => void;
  redoLastUserPrompt: () => void;
  editLastUserMessage: () => void;
  disabled?: boolean;
  promptBehavior: PromptBehavior;
  clearLogMessages: () => void;
  toggleTerminal?: () => void;
  terminalVisible?: boolean;
  scrollToBottom?: () => void;
  onAutoApproveChanged?: (autoApprove: boolean) => void;
  showSettingsPage?: (pageId?: string, options?: Record<string, unknown>) => void;
  showTaskInfo?: () => void;
  handoffConversation?: (focus?: string) => Promise<void>;
};
⋮----
// When recording stops, we reset after a short delay or immediately?
// We want to keep the text.
// We just need to reset the recorder state for next time.
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
const completionSource = async (context: CompletionContext): Promise<CompletionResult | null> =>
⋮----
// Handle @-based file suggestions (exclusive)
⋮----
// Handle command suggestions
⋮----
// Add custom commands to the list
⋮----
// Ensure cursor is at the end after setting text
⋮----
// Ensure cursor is at the end after appending text
⋮----
url = commandArgs; // Only URL provided
⋮----
filePath = undefined; // If only spaces after URL, treat as no filePath
⋮----
const requiresConfirmation = (command: string): boolean =>
⋮----
const handleConfirmCommand = () =>
⋮----
const onChange = (newText: string) =>
⋮----
const handleSubmit = () =>
⋮----
// Check if it's a custom command
⋮----
const handleSavePrompt = async () =>
⋮----
const getAutocompleteDetailLabel = (item: string): [string | null, boolean] =>
⋮----
// Check if it's a custom command
⋮----
const toggleVoice = () =>
⋮----
// On desktop, Shift+Enter inserts a new line
⋮----
// On mobile, Enter inserts a new line (default behavior)
// On desktop, Enter submits the prompt
⋮----
return false; // Allow default behavior (new line)
⋮----
// Desktop behavior: submit or handle special cases
⋮----
onClick=
⋮----
className=
⋮----
paste(event)
⋮----
data-tooltip-content=
⋮----
<div className=
⋮----
onClose=

================
File: src/renderer/src/components/PromptField/TaskWorkingMode.tsx
================
import { TaskData, WorkingMode } from '@common/types';
import { useState, useEffect, useRef, useCallback } from 'react';
import { AiFillFolderOpen } from 'react-icons/ai';
import { IoGitBranch } from 'react-icons/io5';
import { useTranslation } from 'react-i18next';
⋮----
import type { WorktreeIntegrationStatus } from '@common/types';
⋮----
import { ItemConfig, ItemSelector } from '@/components/common/ItemSelector';
import { useResponsive } from '@/hooks/useResponsive';
import { WorktreeMergeButton } from '@/components/project/WorktreeMergeButton';
import { WorktreeRevertButton } from '@/components/project/WorktreeRevertButton';
import { useApi } from '@/contexts/ApiContext';
import { WorktreeStatusBadges } from '@/components/project/WorktreeStatusBadges';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
⋮----
type Props = {
  task: TaskData;
  onMerge: (targetBranch?: string) => void;
  onSquash: (targetBranch?: string, commitMessage?: string) => void;
  onOnlyUncommitted: (targetBranch?: string) => void;
  onRebaseFromBranch: (fromBranch?: string) => void;
  onAbortRebase: () => void;
  onContinueRebase: () => void;
  onResolveConflictsWithAgent: () => void;
  onRevert: () => void;
  isMerging: boolean;
};
⋮----
const handleRefresh = () =>
⋮----
const handleWorkingModeChanged = async (mode: WorkingMode) =>
⋮----
const performSwitch = async (mode: WorkingMode) =>
⋮----
// eslint-disable-next-line no-console
⋮----
const getWarningMessage = () =>
⋮----
title=
⋮----
onCancel=

================
File: src/renderer/src/components/PromptField/usePromptFieldText.ts
================
import { useEffect, useState } from 'react';
import { useDebounceFn } from '@reactuses/core';
⋮----
import { useIndexedDB } from '@/hooks/useIndexedDB';
⋮----
export const usePromptFieldText = (baseDir: string, taskId: string, onLoad?: (value: string) => void) =>
⋮----
// Sync immediate text with persisted text when it loads
⋮----
const setText = (newText: string) =>

================
File: src/renderer/src/components/settings/agent/AgentProfileItem.tsx
================
import { AgentProfile } from '@common/types';
import { BiCopy, BiCut, BiTrash } from 'react-icons/bi';
import { clsx } from 'clsx';
import { useTranslation } from 'react-i18next';
⋮----
import { VerticalDotsMenu, type MenuOption } from '@/components/common/VerticalDotsMenu';
⋮----
type Props = {
  profile: AgentProfile;
  isSelected: boolean;
  onClick: (id: string) => void;
  onCopy?: (profile: AgentProfile) => void;
  onCut?: (profile: AgentProfile) => void;
  onDelete?: (profile: AgentProfile) => void;
  isCut?: boolean;
  isDefaultProfile?: boolean;
};
⋮----
export const AgentProfileItem = (
⋮----
onClick=

================
File: src/renderer/src/components/settings/agent/AgentRules.tsx
================
import { Trans, useTranslation } from 'react-i18next';
import { AgentProfile } from '@common/types';
⋮----
import { TextArea } from '@/components/common/TextArea';
import { CodeInline } from '@/components/common/CodeInline';
⋮----
type AgentRulesProps = {
  profile: AgentProfile;
  handleProfileSettingChange: <K extends keyof AgentProfile>(field: K, value: AgentProfile[K]) => void;
};

================
File: src/renderer/src/components/settings/agent/AgentSettings.tsx
================
import {
  AgentProfile,
  ContextMemoryMode,
  GenericTool,
  InvocationMode,
  McpServerConfig,
  Model,
  ProjectData,
  SettingsData,
  ToolApprovalState,
} from '@common/types';
import React, { ReactNode, useEffect, useMemo, useRef, useState } from 'react';
import { v4 as uuidv4 } from 'uuid';
import { FaChevronLeft, FaChevronRight, FaList, FaPaste, FaPencilAlt, FaPlus, FaSyncAlt, FaTimes, FaBrain } from 'react-icons/fa';
import { MdFlashOn, MdOutlineChecklist, MdOutlineFileCopy, MdOutlineHdrAuto, MdOutlineMap, MdRepeat, MdThermostat, MdPsychology } from 'react-icons/md';
import { DEFAULT_AGENT_PROFILE, DEFAULT_MODEL_TEMPERATURE, AVAILABLE_PROVIDERS, getProviderModelId, DEFAULT_AGENT_PROFILES } from '@common/agent';
import { BiTrash } from 'react-icons/bi';
import { clsx } from 'clsx';
import Sketch from '@uiw/react-color-sketch';
import { closestCenter, DndContext, type DragEndEvent, KeyboardSensor, PointerSensor, useSensor, useSensors } from '@dnd-kit/core';
import { arrayMove, SortableContext, sortableKeyboardCoordinates, verticalListSortingStrategy } from '@dnd-kit/sortable';
import {
  AIDER_TOOL_ADD_CONTEXT_FILES,
  AIDER_TOOL_DESCRIPTIONS,
  AIDER_TOOL_DROP_CONTEXT_FILES,
  AIDER_TOOL_GET_CONTEXT_FILES,
  AIDER_TOOL_GROUP_NAME,
  AIDER_TOOL_RUN_PROMPT,
  POWER_TOOL_BASH,
  POWER_TOOL_DESCRIPTIONS,
  POWER_TOOL_FETCH,
  POWER_TOOL_FILE_EDIT,
  POWER_TOOL_FILE_READ,
  POWER_TOOL_FILE_WRITE,
  POWER_TOOL_GLOB,
  POWER_TOOL_GREP,
  POWER_TOOL_GROUP_NAME,
  POWER_TOOL_SEMANTIC_SEARCH,
  TODO_TOOL_CLEAR_ITEMS,
  TODO_TOOL_DESCRIPTIONS,
  TODO_TOOL_GET_ITEMS,
  TODO_TOOL_GROUP_NAME,
  TODO_TOOL_SET_ITEMS,
  TODO_TOOL_UPDATE_ITEM_COMPLETION,
  TASKS_TOOL_CREATE_TASK,
  TASKS_TOOL_DELETE_TASK,
  TASKS_TOOL_DESCRIPTIONS,
  TASKS_TOOL_GET_TASK,
  TASKS_TOOL_GET_TASK_MESSAGE,
  TASKS_TOOL_GROUP_NAME,
  TASKS_TOOL_LIST_TASKS,
  TASKS_TOOL_SEARCH_TASK,
  MEMORY_TOOL_DELETE,
  MEMORY_TOOL_DESCRIPTIONS,
  MEMORY_TOOL_GROUP_NAME,
  MEMORY_TOOL_LIST,
  MEMORY_TOOL_UPDATE,
  MEMORY_TOOL_RETRIEVE,
  MEMORY_TOOL_STORE,
  SKILLS_TOOL_GROUP_NAME,
} from '@common/tools';
import { useTranslation } from 'react-i18next';
import { FaArrowRightFromBracket } from 'react-icons/fa6';
⋮----
import { McpServer, McpServerForm } from './McpServerForm';
import { McpServerItem } from './McpServerItem';
import { GenericToolGroupItem } from './GenericToolGroupItem';
import { AgentRules } from './AgentRules';
import { SortableAgentProfileItem } from './SortableAgentProfileItem';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { getPathBasename } from '@/utils/path-utils';
import { IconButton } from '@/components/common/IconButton';
import { Button } from '@/components/common/Button';
import { ModelSelector } from '@/components/ModelSelector';
import { Slider } from '@/components/common/Slider';
import { InfoIcon } from '@/components/common/InfoIcon';
import { Accordion } from '@/components/common/Accordion';
import { Input } from '@/components/common/Input';
import { Checkbox } from '@/components/common/Checkbox';
import { Select } from '@/components/common/Select';
import { TextArea } from '@/components/common/TextArea';
import { useModelProviders } from '@/contexts/ModelProviderContext';
import { showErrorNotification } from '@/utils/notifications';
⋮----
// Helper functions for accordion summaries
const getRunSettingsSummary = (profile: AgentProfile) =>
⋮----
// Always show max iterations
⋮----
// Only show temperature if it's overridden
⋮----
// Only show max tokens if it's overridden
⋮----
const getContextSummary = (profile: AgentProfile) =>
⋮----
const getGenericToolsSummary = (profile: AgentProfile) =>
⋮----
const getMcpServersSummary = (profile: AgentProfile, mcpServers: Record<string, McpServerConfig>) =>
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
  agentProfiles: AgentProfile[];
  setAgentProfiles: (profiles: AgentProfile[]) => void;
  initialProfileId?: string;
  openProjects?: ProjectData[];
  selectedProfileContext?: 'global' | string;
};
⋮----
// Profile context state for project-level profiles
⋮----
// Sync internal profileContext with selectedProfileContext prop
⋮----
// Update contextIndex to match the selected context
⋮----
// Handle initial profile ID - set context and select profile
⋮----
// Set the profile context based on the initial profile's projectDir
⋮----
// Update contextIndex to match the target context
⋮----
// Select the initial profile
⋮----
// only listen to initialProfileId change
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// Context navigation logic
const navigateContext = (direction: 'prev' | 'next') =>
⋮----
// Filter profiles based on current context
⋮----
// Calculate missing default profiles (only for global context)
⋮----
// Get context display name
const getContextDisplayName = () =>
⋮----
// Update filtered profiles when context changes
⋮----
const handleDragEnd = (event: DragEndEvent) =>
⋮----
// Get the actual indices in the full agentProfiles array
⋮----
// Update order using the new API
⋮----
// useMemo for project IDs to prevent SortableContext from re-rendering unnecessarily
⋮----
const getSubagentSummary = (profile: AgentProfile) =>
⋮----
const handleCreateNewProfile = () =>
⋮----
}, 0); // Focus the input after the state update
⋮----
const handleDeleteProfile = (agentProfileId: string | null) =>
⋮----
const isDefaultProfile = (profileId: string | null): boolean =>
⋮----
const handleResetProfile = () =>
⋮----
const handleRestoreProfile = (profileId: string) =>
⋮----
const handleCopyProfile = (profile: AgentProfile) =>
⋮----
const handleCutProfile = (profile: AgentProfile) =>
⋮----
const handlePasteProfile = () =>
⋮----
// If this was a cut operation, remove the original and add new one
⋮----
// For copy operation, just add the new profile
⋮----
const handleProfileSettingChange = <K extends keyof AgentProfile>(field: K, value: AgentProfile[K]) =>
⋮----
const handleProfileChange = (profile: AgentProfile) =>
⋮----
const handleRemovePreferredModel = (modelId: string) =>
⋮----
const handleAddPreferredModel = (modelId: string) =>
⋮----
const handleModelChange = (model: Model) =>
⋮----
// Validate provider
⋮----
// Update profile
⋮----
// Add to preferred models
⋮----
// Add custom model if not in list
⋮----
const handleToggleServerEnabled = (serverKey: string, checked: boolean) =>
⋮----
const handleMcpServersReload = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleMcpServerRemove = (serverName: string) =>
⋮----
const handleServersConfigSave = (servers: Record<string, McpServerConfig>) =>
⋮----
// Add new servers to the existing ones
⋮----
// If editing and the server name did not change, preserve the order
⋮----
// Replace the server at the same position
⋮----
// fallback: just replace as before
⋮----
// Remove the old server and add the updated one(s)
⋮----
// Replace all servers with the new set
⋮----
const handleToolApprovalChange = (toolId: string, approval: ToolApprovalState) =>
⋮----
{/* Left List Pane */}
⋮----
{/* Profile Context Header */}
⋮----
onClick=
⋮----
onDelete=
⋮----
{/* Right Details Pane */}
⋮----
<span>
⋮----
{/* Temperature Column */}
⋮----
{/* Max Tokens Column */}
⋮----
onChange=
⋮----
onRemove=
onEdit=
⋮----
<Button onClick=

================
File: src/renderer/src/components/settings/agent/BashToolItem.tsx
================
import { useTranslation } from 'react-i18next';
import { AgentProfile, BashToolSettings, GenericTool, ToolApprovalState } from '@common/types';
import { POWER_TOOL_BASH, POWER_TOOL_GROUP_NAME, TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
⋮----
import { GenericToolItem } from './GenericToolItem';
⋮----
import { Input } from '@/components/common/Input';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  tool: GenericTool;
  profile: AgentProfile;
  onApprovalChange?: (toolId: string, approval: ToolApprovalState) => void;
  onProfileChange: (field: keyof AgentProfile, value: AgentProfile[keyof AgentProfile]) => void;
};
⋮----
<span className="text-2xs">

================
File: src/renderer/src/components/settings/agent/GenericToolGroupItem.tsx
================
import { AgentProfile, GenericTool, ToolApprovalState } from '@common/types';
import { useTranslation } from 'react-i18next';
import { POWER_TOOL_BASH, TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
⋮----
import { GenericToolItem } from './GenericToolItem';
import { BashToolItem } from './BashToolItem';
⋮----
import { Accordion } from '@/components/common/Accordion';
import { Checkbox } from '@/components/common/Checkbox';
⋮----
type Props = {
  name: string;
  tools: GenericTool[];
  profile: AgentProfile;
  onApprovalChange: (toolId: string, approval: ToolApprovalState) => void;
  onProfileChange: (field: keyof AgentProfile, value: AgentProfile[keyof AgentProfile]) => void;
  enabled?: boolean;
  onEnabledChange?: (enabled: boolean) => void;
};
⋮----
<Accordion title=

================
File: src/renderer/src/components/settings/agent/GenericToolItem.tsx
================
import { useTranslation } from 'react-i18next';
import { ReactNode } from 'react';
import { AgentProfile, GenericTool, ToolApprovalState } from '@common/types';
import { TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
⋮----
import { Select } from '@/components/common/Select';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  tool: GenericTool;
  profile: AgentProfile;
  onApprovalChange?: (toolId: string, approval: ToolApprovalState) => void;
  renderToolSettings?: () => ReactNode;
};
⋮----
// Default to 'Always' if approvals are not being managed in this context
⋮----
const handleApprovalChange = (value: string) =>
⋮----
{/* Conditionally render the approval select only if onApprovalChange is provided */}

================
File: src/renderer/src/components/settings/agent/McpServerForm.tsx
================
import { McpServerConfig } from '@common/types';
import { useState, useMemo, ChangeEvent } from 'react';
import { z } from 'zod/v3';
import { useTranslation } from 'react-i18next';
import { MdInfoOutline } from 'react-icons/md';
⋮----
import { TextArea } from '@/components/common/TextArea';
import { Button } from '@/components/common/Button';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
export type McpServer = {
  name: string;
  config: McpServerConfig;
};
⋮----
type Props = {
  onSave: (servers: Record<string, McpServerConfig>) => void;
  onCancel: () => void;
  servers?: McpServer[];
};
⋮----
// If multiple servers, merge them into a single object
⋮----
// Try to parse as JSON, or as a "bare" object (without enclosing {})
const parseConfig = (text: string) =>
⋮----
// Try as full JSON first
⋮----
// Try as "bare" object: wrap in braces and parse
⋮----
const handleAddServer = () =>
⋮----
// Accept both { mcpServers: {...} } and just { ... }
⋮----
const handleChange = (e: ChangeEvent<HTMLTextAreaElement>) =>
⋮----
placeholder=

================
File: src/renderer/src/components/settings/agent/McpServerItem.tsx
================
import { McpServerConfig, McpTool, ToolApprovalState } from '@common/types';
import { extractIpcErrorMessage } from '@common/utils';
import { useEffect, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FaPencilAlt, FaTrash } from 'react-icons/fa';
import { TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
⋮----
import { McpToolItem } from './McpToolItem';
⋮----
import { Accordion } from '@/components/common/Accordion';
import { IconButton } from '@/components/common/IconButton';
import { Checkbox } from '@/components/common/Checkbox';
import { useApi } from '@/contexts/ApiContext';
import { Tooltip } from '@/components/ui/Tooltip';
⋮----
type Props = {
  serverName: string;
  config: McpServerConfig;
  onRemove?: () => void;
  onEdit?: () => void;
  toolApprovals: Record<string, ToolApprovalState>;
  onApprovalChange: (toolId: string, approval: ToolApprovalState) => void;
  reloadTrigger?: number;
  enabled?: boolean;
  onEnabledChange?: (enabled: boolean) => void;
};
⋮----
const loadTools = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
<Accordion title=

================
File: src/renderer/src/components/settings/agent/McpToolItem.tsx
================
import { useTranslation } from 'react-i18next';
import { McpTool, ToolApprovalState } from '@common/types';
import { TOOL_GROUP_NAME_SEPARATOR } from '@common/tools';
⋮----
import { Select } from '@/components/common/Select';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  tool: McpTool;
  serverName: string;
  toolApprovals?: Record<string, ToolApprovalState>;
  onApprovalChange?: (toolId: string, approval: ToolApprovalState) => void;
};
⋮----
// Default to 'Always' if approvals are not being managed in this context
⋮----
const handleApprovalChange = (value: string) =>
⋮----
{/* Conditionally render the approval select only if onApprovalChange is provided */}

================
File: src/renderer/src/components/settings/agent/SortableAgentProfileItem.tsx
================
import { useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
import { AgentProfile } from '@common/types';
⋮----
import { AgentProfileItem } from './AgentProfileItem';
⋮----
type SortableAgentProfileItemProps = {
  profile: AgentProfile;
  isSelected: boolean;
  onClick: (id: string) => void;
  onCopy?: (profile: AgentProfile) => void;
  onCut?: (profile: AgentProfile) => void;
  onDelete?: (profile: AgentProfile) => void;
  isCut?: boolean;
  isDefaultProfile?: boolean;
};
⋮----
export const SortableAgentProfileItem = (

================
File: src/renderer/src/components/settings/AboutSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { toast } from 'react-toastify';
import { SettingsData } from '@common/types';
⋮----
import { Button } from '@/components/common/Button';
import { Checkbox } from '@/components/common/Checkbox';
import { Section } from '@/components/common/Section';
import { useVersions } from '@/hooks/useVersions';
import { useApi } from '@/contexts/ApiContext';
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
};
⋮----
const openLogsDirectory = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleDownloadUpdate = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleTelemetryEnabledChange = (checked: boolean) =>
⋮----
label=
⋮----
onChange=
⋮----
<Section title=
⋮----
<Checkbox label=

================
File: src/renderer/src/components/settings/AiderSettings.tsx
================
import { useState } from 'react';
import { HiEye } from 'react-icons/hi';
import { Trans, useTranslation } from 'react-i18next';
import { SettingsData } from '@common/types';
⋮----
import { Button } from '@/components/common/Button';
import { Input } from '@/components/common/Input';
import { Section } from '@/components/common/Section';
import { TextArea } from '@/components/common/TextArea';
import { Checkbox } from '@/components/common/Checkbox';
import { CodeInline } from '@/components/common/CodeInline';
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
  initialShowEnvVars?: boolean;
};
⋮----
label=
⋮----
setSettings({
                ...settings,
                aider: {
                  ...settings.aider,
                  autoCommits: checked,
                },
              });
⋮----
https://aider.chat/docs/config/options.html
⋮----
https://aider.chat/docs/config/dotenv.html

================
File: src/renderer/src/components/settings/GeneralSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { Font, FONTS, SettingsData, ProjectStartMode, SuggestionMode, Theme, THEMES, DiffViewMode, MessageViewMode } from '@common/types';
⋮----
import { Checkbox } from '../common/Checkbox';
import { RadioButton } from '../common/RadioButton';
import { Select, Option } from '../common/Select';
import { Section } from '../common/Section';
import { Slider } from '../common/Slider';
import { InfoIcon } from '../common/InfoIcon';
⋮----
import { LanguageSelector } from './LanguageSelector';
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
  onLanguageChange: (language: string) => void;
  onZoomChange: (zoomLevel: number) => void;
  onThemeChange: (themeName: Theme) => void;
  onFontChange: (fontName: Font) => void;
  onFontSizeChange: (fontSize: number) => void;
};
⋮----
const handleStartupModeChange = (mode: ProjectStartMode) =>
⋮----
const handleStartupModeClick = (value: string) =>
⋮----
const handleZoomChange = (value: string) =>
⋮----
const handleNotificationsEnabledChange = (checked: boolean) =>
⋮----
const handleThemeChange = (value: string) =>
⋮----
const handleFontChange = (value: string) =>
⋮----
const handleFontSizeChange = (value: string) =>
⋮----
const handleDiffViewModeChange = (value: string) =>
⋮----
const handleMessageViewModeChange = (value: string) =>
⋮----
const handleSuggestionModeChange = (mode: SuggestionMode) =>
⋮----
const handleSuggestionModeClick = (value: string) =>
⋮----
const handleSuggestionDelayChange = (delay: number) =>
⋮----
const handleCommandConfirmationChange = (command: keyof typeof settings.promptBehavior.requireCommandConfirmation, checked: boolean) =>
⋮----
label=
⋮----
setSettings(
⋮----
onChange=
⋮----
{/* Vim key bindings */}
⋮----
<Checkbox label=

================
File: src/renderer/src/components/settings/HotkeyConfig.tsx
================
import { useEffect, useRef, useState, KeyboardEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { FaPlus, FaEdit, FaTimes } from 'react-icons/fa';
import { clsx } from 'clsx';
import { useRecordHotkeys } from 'react-hotkeys-hook';
⋮----
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { Input } from '@/components/common/Input';
import { IconButton } from '@/components/common/IconButton';
⋮----
type Props = {
  label: string;
  value: string;
  onChange: (value: string) => void;
  size?: 'md' | 'sm';
};
⋮----
type RecordingDialogProps = {
  onSave: (hotkey: string) => void;
  onCancel: () => void;
  existingHotkey?: string;
};
⋮----
const handleConfirm = () =>
⋮----
title=
⋮----
// Parse the value into an array of shortcuts
⋮----
const handleAddShortcut = () =>
⋮----
const handleEditShortcut = (index: number) =>
⋮----
const handleClearShortcut = (index: number) =>
⋮----
// If only one shortcut exists, just clear it
⋮----
// Remove the shortcut at the specified index
⋮----
const handleSaveShortcut = (hotkey: string) =>
⋮----
// Edit existing shortcut
⋮----
// Add new shortcut
⋮----
const handleCancelRecording = () =>
⋮----
onClick=

================
File: src/renderer/src/components/settings/HotkeysSettings.tsx
================
import { useTranslation } from 'react-i18next';
import { HotkeyConfig, SettingsData } from '@common/types';
⋮----
import { Section } from '../common/Section';
⋮----
import { HotkeyConfig as HotkeyConfigRow } from './HotkeyConfig';
⋮----
import { Button } from '@/components/common/Button';
import { DEFAULT_HOTKEY_CONFIG } from '@/utils/hotkeys';
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
};
⋮----
const handleChange = (category: keyof HotkeyConfig, key: string, value: string) =>
⋮----
const handleReset = () =>
⋮----
const renderHotkeyConfig = (category: keyof HotkeyConfig, key: string, label: string) =>
⋮----
return <HotkeyConfigRow key=

================
File: src/renderer/src/components/settings/LanguageSelector.tsx
================
import { ReactCountryFlag } from 'react-country-flag';
import { useTranslation } from 'react-i18next';
⋮----
import Select, { Option } from '../common/Select';
⋮----
import { SUPPORTED_LANGUAGES } from '@/i18n';
⋮----
type Props = {
  language: string;
  onChange: (language: string) => void;
  hideLabel?: boolean;
  size?: 'sm' | 'md' | 'lg';
};
⋮----
export const LanguageSelector = (

================
File: src/renderer/src/components/settings/MemorySettings.tsx
================
import { MemoryEmbeddingProgress, MemoryEmbeddingProgressPhase, MemoryEmbeddingProvider, MemoryEntry, SettingsData } from '@common/types';
import { useEffect, useMemo, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FaTrash } from 'react-icons/fa';
⋮----
import { Checkbox } from '../common/Checkbox';
import { Select } from '../common/Select';
import { Section } from '../common/Section';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { Button } from '@/components/common/Button';
import { ConfirmDialog } from '@/components/common/ConfirmDialog';
import { IconButton } from '@/components/common/IconButton';
import { CodeInline } from '@/components/common/CodeInline';
import { Slider } from '@/components/common/Slider';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
};
⋮----
const loadMemories = async () =>
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
const poll = async () =>
⋮----
const handleDeleteMemory = async () =>
⋮----
const handleDeleteProjectMemories = async () =>
⋮----
const handleEnabledChange = (enabled: boolean) =>
⋮----
const handleModelChange = (model: string) =>
⋮----
const handleProviderChange = (provider: string) =>
⋮----
const handleMaxDistanceChange = (value: number) =>
⋮----
label=
⋮----
<span>
⋮----
onClick=
⋮----
title=
⋮----
confirmButtonText=

================
File: src/renderer/src/components/settings/ServerSettings.tsx
================
import { ChangeEvent, useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { SettingsData, CloudflareTunnelStatus } from '@common/types';
import { clsx } from 'clsx';
import { BiCopy } from 'react-icons/bi';
⋮----
import { Input } from '../common/Input';
import { Section } from '../common/Section';
import { Button } from '../common/Button';
import { Checkbox } from '../common/Checkbox';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { IconButton } from '@/components/common/IconButton';
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
};
⋮----
const loadTunnelStatus = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleServerToggle = async () =>
⋮----
// Start server with current credentials if basic auth is enabled
⋮----
// Stop server
⋮----
// Update settings to reflect the new server state
⋮----
// Handle failure (could add toast notification here)
⋮----
// Handle error (could add toast notification here)
⋮----
const handleBasicAuthEnabledChange = (checked: boolean) =>
⋮----
const handleUsernameChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handlePasswordChange = (e: ChangeEvent<HTMLInputElement>) =>
⋮----
const handleTunnelToggle = async () =>
⋮----
// Reload tunnel status
⋮----
// eslint-disable-next-line no-console
⋮----
const getButtonText = () =>
⋮----
const getTunnelButtonText = () =>
⋮----
label=
⋮----
{/* Collapsible Authentication Inputs */}
⋮----
<span className=
⋮----
onClick=
⋮----
await api.writeToClipboard(tunnelStatus.url!);
⋮----
// eslint-disable-next-line no-console
console.error('Failed to copy URL:', error);
⋮----
tooltip=

================
File: src/renderer/src/components/settings/SettingsDialog.tsx
================


================
File: src/renderer/src/components/settings/SettingsPage.tsx
================
import { ProjectData, ProviderProfile, SettingsData } from '@common/types';
import { useCallback, useEffect, useMemo, useState } from 'react';
import { isEqual } from 'lodash';
import { useTranslation } from 'react-i18next';
import { useHotkeys } from 'react-hotkeys-hook';
⋮----
import { Settings } from '@/pages/Settings';
import { useSettings } from '@/contexts/SettingsContext';
import { useAgents } from '@/contexts/AgentsContext';
import { ModalOverlayLayout } from '@/components/common/ModalOverlayLayout';
import { useApi } from '@/contexts/ApiContext';
import { Button } from '@/components/common/Button';
⋮----
type Props = {
  onClose: () => void;
  initialPageId?: string;
  initialOptions?: Record<string, unknown>;
  openProjects?: ProjectData[];
};
⋮----
const loadProviders = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
// Updated to use settings.mcpServers directly
⋮----
const handleSave = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
// Save agent profile changes
⋮----
// Find profiles that were added, updated, or deleted
⋮----
// Handle deleted profiles
⋮----
// Handle added and updated profiles
⋮----
// New profile
⋮----
// Updated profile - check if it actually changed
⋮----
// Update profile order if needed
⋮----
// eslint-disable-next-line no-console
⋮----
const handleLanguageChange = (language: string) =>
⋮----
const handleZoomChange = (zoomLevel: number) =>
⋮----
<ModalOverlayLayout title=

================
File: src/renderer/src/components/settings/TaskSettings.tsx
================
import { SettingsData, ContextCompactionType } from '@common/types';
import { useState } from 'react';
import { useTranslation } from 'react-i18next';
⋮----
import { Chip } from '../common/Chip';
import { Checkbox } from '../common/Checkbox';
import { Section } from '../common/Section';
import { InfoIcon } from '../common/InfoIcon';
import { Button } from '../common/Button';
import { Slider } from '../common/Slider';
⋮----
type Props = {
  settings: SettingsData;
  setSettings: (settings: SettingsData) => void;
};
⋮----
const handleSmartTaskStateChange = (checked: boolean) =>
⋮----
const handleAutoGenerateTaskNameChange = (checked: boolean) =>
⋮----
const handleShowTaskStateActionsChange = (checked: boolean) =>
⋮----
const handleAddSymlinkFolder = () =>
⋮----
const handleRemoveSymlinkFolder = (folder: string) =>
⋮----
const handleCompactingThresholdChange = (value: number) =>
⋮----
const handleCompactionTypeChange = (value: ContextCompactionType) =>
⋮----
<Section title=
⋮----
onChange=
⋮----
onClick=

================
File: src/renderer/src/components/settings/VoiceSettings.tsx
================
import { useEffect, useMemo, useState } from 'react';
import { useLocalStorage } from '@reactuses/core';
import { ProviderProfile } from '@common/types';
import {
  DEFAULT_VOICE_SYSTEM_INSTRUCTIONS,
  GeminiProvider,
  GeminiVoiceModel,
  OpenAiProvider,
  OpenAiVoiceModel,
  isGeminiProvider,
  isOpenAiProvider,
} from '@common/agent';
import { useTranslation } from 'react-i18next';
⋮----
import { useModelProviders } from '@/contexts/ModelProviderContext';
import { Section } from '@/components/common/Section';
import { Select, Option } from '@/components/common/Select';
import { Input } from '@/components/common/Input';
import { TextArea } from '@/components/common/TextArea';
import { Slider } from '@/components/common/Slider';
import { InfoIcon } from '@/components/common/InfoIcon';
⋮----
type AudioDeviceOption = {
  label: string;
  value: string;
};
⋮----
type SupportedVoiceProviderName = 'openai' | 'gemini';
⋮----
type LanguageOption = {
  label: string;
  value: string;
};
⋮----
type Props = {
  providers?: ProviderProfile[];
  setProviders?: (providers: ProviderProfile[]) => void;
  initialProviderId?: string;
};
⋮----
const handleSelectProvider = (providerId: string) =>
⋮----
const handleUpdateProfile = (profile: ProviderProfile) =>
⋮----
const handleIdleTimeoutChangeSeconds = (seconds: number) =>
⋮----
const loadDevices = async () =>
⋮----
const handleDeviceChange = () =>
⋮----
const handleInputDeviceChange = (value: string) =>
⋮----
const handleSystemInstructionsChange = (value: string) =>
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect
⋮----
const handleOpenAiModelChange = (value: string) =>
⋮----
const handleOpenAiLanguageChange = (value: string) =>
⋮----
const handleGeminiModelChange = (value: string) =>
⋮----
const handleGeminiTemperatureChange = (value: number) =>
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect
⋮----
const handleModelChange = (value: string) =>
⋮----
const handleIdleTimeoutChange = (value: string) =>
⋮----
const handleTemperatureChange = (value: number) =>
⋮----
<Select label=
⋮----
label=
⋮----
<span>

================
File: src/renderer/src/components/terminal/Terminal.scss
================
.xterm-viewport {
  @apply scrollbar-thin scrollbar-track-bg-primary scrollbar-thumb-bg-secondary-light hover:scrollbar-thumb-bg-tertiary;
}

.xterm-screen {
  @apply px-3;
}

================
File: src/renderer/src/components/terminal/Terminal.tsx
================
import { forwardRef, useEffect, useImperativeHandle, useRef, useState } from 'react';
import { Terminal as XTerm } from '@xterm/xterm';
import { FitAddon } from '@xterm/addon-fit';
import { WebLinksAddon } from '@xterm/addon-web-links';
import { TerminalData, TerminalExitData } from '@common/types';
import { clsx } from 'clsx';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
export type TerminalRef = {
  focus: () => void;
  clear: () => void;
  resize: () => void;
  getOutput: () => string;
};
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  visible: boolean;
  className?: string;
};
⋮----
// Initialize terminal
⋮----
// Handle terminal input
⋮----
// Handle terminal resize
⋮----
// Create terminal process
⋮----
const createTerminal = async () =>
⋮----
// Always create a new terminal for each Terminal component instance
⋮----
// Handle terminal input
⋮----
// Handle terminal resize
⋮----
// eslint-disable-next-line no-console
⋮----
// Handle terminal data
⋮----
const handleTerminalData = (data: TerminalData) =>
⋮----
const handleTerminalExit = (data: TerminalExitData) =>
⋮----
// Handle resize when visibility changes
⋮----
// Small delay to ensure the container is properly sized
⋮----
// Cleanup on unmount

================
File: src/renderer/src/components/terminal/TerminalView.tsx
================
import { useState, useRef, useEffect, forwardRef, useImperativeHandle } from 'react';
import { IoMdAdd, IoMdClose, IoMdRemove } from 'react-icons/io';
import { BiCopy } from 'react-icons/bi';
import { clsx } from 'clsx';
import { v4 as uuidv4 } from 'uuid';
import { useTranslation } from 'react-i18next';
⋮----
import { Terminal as TerminalComponent, TerminalRef } from '@/components/terminal/Terminal';
import { IconButton } from '@/components/common/IconButton';
⋮----
export type TerminalViewRef = {
  resize: () => void;
};
⋮----
type TerminalTab = {
  id: string;
  terminalId: string | null;
};
⋮----
type Props = {
  baseDir: string;
  taskId: string;
  visible: boolean;
  className?: string;
  onVisibilityChange: (visible: boolean) => void;
  onCopyOutput?: (output: string) => void;
};
⋮----
// Resize all terminal instances
⋮----
// Create a new terminal tab
const addTerminalTab = () =>
⋮----
// Close a terminal tab
const closeTerminalTab = (tabId: string) =>
⋮----
// If we're closing the active tab, activate the previous one
⋮----
// If we're closing the last tab, minimize the terminal
⋮----
// Focus the active terminal when it changes
⋮----
// Small delay to ensure terminal is rendered
⋮----
// Handle copying terminal output
const handleCopyOutput = () =>
⋮----
<div className=
{/* Tab bar */}
⋮----
onClick=
⋮----
{/* Terminal content */}

================
File: src/renderer/src/components/ui/Tooltip.tsx
================
import { ReactNode } from 'react';
import { clsx } from 'clsx';
⋮----
type TooltipProps = {
  content: ReactNode;
  children: ReactNode;
  side?: 'top' | 'right' | 'bottom' | 'left';
  align?: 'start' | 'center' | 'end';
  delayDuration?: number;
  maxWidth?: number | string;
};
⋮----
export const TooltipProvider = ({ children, ...props }: TooltipPrimitive.TooltipProviderProps) => (
  <TooltipPrimitive.Provider delayDuration={200} skipDelayDuration={100} {...props}>
    {children}
  </TooltipPrimitive.Provider>
);
⋮----
// Simple arrow component using Radix's Arrow primitive
const Arrow = ({ side = 'top' }: { side?: string }) => (
  <TooltipPrimitive.Arrow
    asChild
    width={16}
    height={8}
    className={clsx(
      'overflow-visible',
      side === 'top' && 'data-[side=top]',
      side === 'bottom' && 'data-[side=bottom]',
      side === 'left' && 'data-[side=left]',
      side === 'right' && 'data-[side=right]',
    )}
  >
    <svg width="16" height="8" viewBox="0 0 16 8" preserveAspectRatio="none" className="overflow-visible">
      {/* Outer triangle with border color */}
      <polygon points="0,0 16,0 8,8" fill={borderColor} />
      {/* Inner triangle with background color to create border effect */}
      <polygon points="1,0 15,0 8,7" fill="var(--color-bg-primary-light)" />
    </svg>
  </TooltipPrimitive.Arrow>
);
⋮----
className=
⋮----
{/* Outer triangle with border color */}
⋮----
{/* Inner triangle with background color to create border effect */}
⋮----
export const Tooltip = ({ content, children, side, align, delayDuration, maxWidth = '300px' }: TooltipProps) => (
  <TooltipPrimitive.Root delayDuration={delayDuration}>
    <TooltipPrimitive.Trigger asChild>{children}</TooltipPrimitive.Trigger>
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        side={side}
        align={align}
        className={clsx(
          'relative',
          '!bg-bg-primary-light !text-text-secondary !text-2xs !py-1.5 !px-2.5 !opacity-100',
          '!rounded-md z-50 whitespace-pre-wrap select-none',
          // Use CSS border instead of outline
          'border',
        )}
        style={{ borderColor, maxWidth }}
        sideOffset={8}
      >
        {content}
        <Arrow side={side} />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  </TooltipPrimitive.Root>
);
⋮----
// Use CSS border instead of outline

================
File: src/renderer/src/components/usage/CostBreakdownChart.tsx
================
import { useMemo } from 'react';
import { useTranslation } from 'react-i18next';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import { UsageDataRow } from '@common/types';
⋮----
import { generateColorPalette, formatDateByGroup, GroupBy } from './utils';
⋮----
type CostChartDataPoint = {
  date: string;
  [projectKey: string]: string | number; // Dynamic project keys for stacked data
};
⋮----
[projectKey: string]: string | number; // Dynamic project keys for stacked data
⋮----
type Props = {
  data: UsageDataRow[];
  groupBy: GroupBy;
};
⋮----
// Process data for stacked bar chart (aggregate by day and project)
⋮----
// First pass: collect all projects and aggregate data
⋮----
// Convert to array format for Recharts
⋮----
// Generate consistent colors for projects
const projects = Array.from(projectSet).sort(); // Sort for consistency
⋮----
const formatCurrency = (value: number) =>
⋮----
// Limit legend items to prevent overcrowding
⋮----
{/* Render remaining projects without legend */}

================
File: src/renderer/src/components/usage/MessageBreakdownChart.tsx
================
import { useMemo } from 'react';
import { useTranslation } from 'react-i18next';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import { UsageDataRow } from '@common/types';
⋮----
import { generateColorPalette, formatDateByGroup, GroupBy } from './utils';
⋮----
type MessageChartDataPoint = {
  date: string;
  [projectKey: string]: string | number; // Dynamic project keys for stacked data
};
⋮----
[projectKey: string]: string | number; // Dynamic project keys for stacked data
⋮----
type Props = {
  data: UsageDataRow[];
  groupBy: GroupBy;
};
⋮----
// Process data for stacked bar chart (aggregate by day and project)
⋮----
// First pass: collect all projects and aggregate data
⋮----
dateMap.set(projectDisplayName, currentCount + 1); // Each row is one message
⋮----
// Convert to array format for Recharts
⋮----
// Generate consistent colors for projects
const projects = Array.from(projectSet).sort(); // Sort for consistency
⋮----
const formatCount = (value: number) =>
⋮----
// Limit legend items to prevent overcrowding
⋮----
{/* Render remaining projects without legend */}

================
File: src/renderer/src/components/usage/ModelUsageDistributionChart.tsx
================
import { useMemo } from 'react';
import { useTranslation } from 'react-i18next';
import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend } from 'recharts';
import { UsageDataRow } from '@common/types';
⋮----
import { generateColorPalette } from './utils';
⋮----
type ModelDistributionDataPoint = {
  model: string;
  totalTokens: number;
  cost: number;
  percentage: number;
};
⋮----
type Props = {
  data: UsageDataRow[];
};
⋮----
// Process data for pie chart (aggregate by model)
⋮----
// First pass: aggregate data by model
⋮----
// Calculate total tokens for percentage calculation
⋮----
// Convert to array format for Recharts
⋮----
.sort((a, b) => b.totalTokens - a.totalTokens); // Sort by usage (descending)
⋮----
// Generate consistent colors for models
⋮----
const formatTokens = (value: number) =>
⋮----
const formatCurrency = (value: number) =>
⋮----
const formatPercentage = (value: number) =>
⋮----
<Cell key=
⋮----
// Limit legend items to prevent overcrowding
⋮----
{/** @ts-expect-error: payload has model */}

================
File: src/renderer/src/components/usage/TokenUsageTrendChart.tsx
================
import { useMemo } from 'react';
import { useTranslation } from 'react-i18next';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';
import { UsageDataRow } from '@common/types';
⋮----
import { formatDateByGroup, GroupBy } from './utils';
⋮----
type ChartDataPoint = {
  date: string;
  inputTokens: number;
  outputTokens: number;
  totalTokens: number;
};
⋮----
type Props = {
  data: UsageDataRow[];
  groupBy: GroupBy;
};
⋮----
// Process data for trend chart (aggregate by day)
⋮----
const date = formatDateByGroup(row.timestamp, groupBy); // Get YYYY-MM-DD format
⋮----
const formatTokens = (value: number) =>

================
File: src/renderer/src/components/usage/UsageDashboard.tsx
================
import { useCallback, useEffect, useMemo, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { FaSync, FaTable, FaChartBar } from 'react-icons/fa';
import { CgSpinner } from 'react-icons/cg';
import { UsageDataRow } from '@common/types';
import { clsx } from 'clsx';
⋮----
import { Select } from '../common/Select';
import { ModalOverlayLayout } from '../common/ModalOverlayLayout';
⋮----
import { UsageTable } from './UsageTable';
import { TokenUsageTrendChart } from './TokenUsageTrendChart';
import { CostBreakdownChart } from './CostBreakdownChart';
import { MessageBreakdownChart } from './MessageBreakdownChart';
import { ModelUsageDistributionChart } from './ModelUsageDistributionChart';
import { GroupBy } from './utils';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { DatePicker } from '@/components/common/DatePicker';
import { MultiSelect } from '@/components/common/MultiSelect';
import { IconButton } from '@/components/common/IconButton';
⋮----
type Props = {
  onClose: () => void;
};
⋮----
enum DatePeriod {
  All = 'all',
  ThisMonth = 'thisMonth',
  Today = 'today',
  Custom = 'custom',
}
⋮----
enum ViewTab {
  Table = 'table',
  Charts = 'charts',
}
⋮----
const handlePeriodChange = (period: DatePeriod) =>
⋮----
// This month
⋮----
const handleDateRangeChange = (update: [Date | null, Date | null]) =>
⋮----
// Treat empty selections as "all selected"
⋮----
const handleRefresh = () =>
⋮----
<ModalOverlayLayout title=
⋮----
label=
⋮----
className=
⋮----
{/* Tab Navigation */}
⋮----
onClick=

================
File: src/renderer/src/components/usage/UsageTable.tsx
================
import { useMemo } from 'react';
import { useTranslation } from 'react-i18next';
import { UsageDataRow } from '@common/types';
⋮----
import { formatDateByGroup, GroupBy } from './utils';
⋮----
import { Column, FooterColumn, Table } from '@/components/common/Table';
⋮----
type Props = {
  data: UsageDataRow[];
  groupBy: GroupBy;
};

================
File: src/renderer/src/components/usage/utils.ts
================
// Generate a consistent color palette for charts
export const generateColorPalette = (count: number): string[] =>
⋮----
'#3b82f6', // blue
'#ef4444', // red
'#10b981', // green
'#f59e0b', // amber
'#8b5cf6', // purple
'#ec4899', // pink
'#06b6d4', // cyan
'#84cc16', // lime
'#f97316', // orange
'#6366f1', // indigo
⋮----
// Generate additional colors by varying hue
⋮----
const hue = (i * 137.508) % 360; // Golden angle approximation for good distribution
⋮----
export enum GroupBy {
  Year = 'year',
  Month = 'month',
  Day = 'day',
  Hour = 'hour',
}
⋮----
export const formatDateByGroup = (timestamp: string, groupBy: GroupBy): string =>

================
File: src/renderer/src/components/AutocompletionInput.tsx
================
import { useState, useRef, useEffect, ReactNode, ClipboardEvent } from 'react';
import { useTranslation } from 'react-i18next';
import { createPortal } from 'react-dom';
import { clsx } from 'clsx';
⋮----
import { KeyboardKeys } from '@/constants/keyboardKeys';
⋮----
type Props = {
  value: string;
  suggestions: string[];
  onChange: (value: string, isFromSuggestion: boolean, isMultiSelect?: boolean) => void;
  placeholder?: string;
  className?: string;
  inputClassName?: string;
  rightElement?: ReactNode;
  autoFocus?: boolean;
  onPaste?: (pastedText: string) => Promise<boolean>;
  onSubmit?: (isMultiSelect?: boolean) => void;
};
⋮----
const handleKeyDown = (e: React.KeyboardEvent) =>
⋮----
const handleOnPaste = async (e: ClipboardEvent<HTMLInputElement>) =>
⋮----
// Prevent default immediately to stop browser from processing the paste
⋮----
// If onPaste didn't handle the paste (returned false), manually insert the text
⋮----
zIndex: 1000, // Ensure it's above other elements
⋮----
className=
⋮----
placeholder=
⋮----

================
File: src/renderer/src/components/CostInfo.tsx
================
import { Mode, TokensInfoData, TaskData } from '@common/types';
import { ReactNode, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { IoChevronDown, IoChevronUp, IoClose } from 'react-icons/io5';
import { MdOutlineRefresh, MdSettingsBackupRestore } from 'react-icons/md';
⋮----
import { Tooltip } from '@/components/ui/Tooltip';
import { TokenUsageBar } from '@/components/TokenUsageBar';
⋮----
type Props = {
  tokensInfo?: TokensInfoData | null;
  aiderTotalCost: number;
  clearMessages?: () => void;
  refreshRepoMap?: () => void;
  resetTask?: () => void;
  maxInputTokens?: number;
  mode: Mode;
  task: TaskData;
  updateTask: (taskId: string, updates: Partial<TaskData>) => void;
};
⋮----
onClick=
⋮----

================
File: src/renderer/src/components/ModelSelector.tsx
================
import { forwardRef, useImperativeHandle, useRef, KeyboardEvent, MouseEvent, useOptimistic, startTransition } from 'react';
import { useTranslation } from 'react-i18next';
import { MdClose, MdKeyboardArrowUp, MdKeyboardReturn } from 'react-icons/md';
import { useDebounce } from '@reactuses/core';
import { twMerge } from 'tailwind-merge';
import { Model, ProviderProfile } from '@common/types';
import { getProviderModelId } from '@common/agent';
import { extractProviderModel } from '@common/utils';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
import { useDropdownState } from '@/hooks/useDropdownState';
import { KeyboardKeys } from '@/constants/keyboardKeys';
⋮----
export type ModelSelectorRef = {
  open: (model?: string) => void;
};
⋮----
type Props = {
  className?: string;
  models: Model[];
  selectedModelId?: string;
  onChange: (model: Model) => void;
  preferredModelIds: string[];
  removePreferredModel: (modelId: string) => void;
  providers: ProviderProfile[];
};
⋮----
const getProviderName = (providerId: string) =>
⋮----
// Group filtered models by providerId
⋮----
const onModelSelected = (model: Model) =>
⋮----
const onModelSelectorSearchInputKeyDown = (e: KeyboardEvent<HTMLInputElement>) =>
⋮----
const handleRemovePreferredModel = (e: MouseEvent) =>
⋮----
placeholder=
⋮----
onChange=
⋮----

================
File: src/renderer/src/components/TelemetryInfoDialog.tsx
================
import { useState } from 'react';
import { Trans, useTranslation } from 'react-i18next';
⋮----
import { BaseDialog } from '@/components/common/BaseDialog';
import { Button } from '@/components/common/Button';
import { Checkbox } from '@/components/common/Checkbox';
import { useSettings } from '@/contexts/SettingsContext';
⋮----
const handleOk = async () =>
⋮----
title=
⋮----

================
File: src/renderer/src/components/TokenUsageBar.tsx
================
import { AGENT_MODES, Mode, TaskData, TokensInfoData } from '@common/types';
import { MouseEvent, useCallback, useEffect, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
import debounce from 'lodash/debounce';
import { clsx } from 'clsx';
⋮----
import { formatHumanReadable } from '@/utils/string-utils';
⋮----
type Props = {
  task: TaskData;
  tokensInfo?: TokensInfoData | null;
  maxInputTokens?: number;
  mode: Mode;
  updateTask: (taskId: string, updates: Partial<TaskData>) => void;
};
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect
⋮----
className=
⋮----

================
File: src/renderer/src/constants/keyboardKeys.ts
================


================
File: src/renderer/src/contexts/AgentsContext.tsx
================
import { createContext, useContext, useEffect, useOptimistic, startTransition, ReactNode, useCallback, useState } from 'react';
import { AgentProfile } from '@common/types';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
export interface AgentsContextType {
  profiles: AgentProfile[];
  loading: boolean;
  error: string | null;
  getProfiles: (projectDir: string) => AgentProfile[];
  createProfile: (profile: AgentProfile, projectDir?: string) => Promise<void>;
  updateProfile: (profile: AgentProfile, projectDir?: string) => Promise<void>;
  deleteProfile: (profileId: string, projectDir?: string) => Promise<void>;
  refreshProfiles: (projectDir?: string) => Promise<void>;
  updateProfilesOrder: (agentProfiles: AgentProfile[]) => Promise<void>;
}
⋮----
interface AgentsProviderProps {
  children: ReactNode;
}
⋮----
const createProfile = async (profile: AgentProfile, projectDir?: string) =>
⋮----
const updateProfile = async (profile: AgentProfile, projectDir?: string) =>
⋮----
const deleteProfile = async (profileId: string, projectDir?: string) =>
⋮----
const updateProfilesOrder = async (agentProfiles: AgentProfile[]): Promise<void> =>
⋮----
// Register event listener for agent profiles updates
⋮----
export const useAgents = (): AgentsContextType =>

================
File: src/renderer/src/contexts/ApiContext.tsx
================
import { createContext, useMemo, ReactNode, useContext } from 'react';
import { ApplicationAPI } from '@common/api';
import { HotkeysProvider } from 'react-hotkeys-hook';
⋮----
import { BrowserApi } from '@/api/browser-api';
⋮----
export const useApi = (): ApplicationAPI =>

================
File: src/renderer/src/contexts/ContextMenuContext.tsx
================
import { createContext, ReactNode, useCallback, useContext, useEffect, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
⋮----
import { useClickOutside } from '@/hooks/useClickOutside';
import { useApi } from '@/contexts/ApiContext';
⋮----
type ContextMenuContextType = {
  showMenu: (x: number, y: number, options: MenuOption[], targetElement?: Element | null) => void;
  hideMenu: () => void;
};
⋮----
export type MenuOption = {
  label: string;
  action: () => void;
  disabled?: boolean;
};
⋮----
type MenuState = {
  x: number;
  y: number;
  isVisible: boolean;
  options: MenuOption[];
  targetElement?: Element | null;
};
⋮----
type Props = {
  children: ReactNode;
};
⋮----
export const useContextMenu = () =>
⋮----
const handleContextMenu = (params: Electron.ContextMenuParams) =>
⋮----
// Capture the target element when context menu is triggered
⋮----
// Always show copy option
⋮----
// If there's selected text, copy that
⋮----
// Otherwise, use the stored target element
⋮----
// Handle input elements
⋮----
// Handle other elements with text content
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/contexts/ModelProviderContext.tsx
================
import React, { createContext, ReactNode, useCallback, useContext, useEffect, useState, useOptimistic, startTransition } from 'react';
import { Model, ProviderProfile } from '@common/types';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
export type ModelProviderContextType = {
  refresh: () => void;
  models: Model[];
  providers: ProviderProfile[];
  saveProvider: (profile: ProviderProfile) => Promise<void>;
  deleteProvider: (profileId: string) => Promise<void>;
  upsertModel: (providerId: string, modelId: string, model: Model) => Promise<void>;
  deleteModel: (providerId: string, modelId: string) => Promise<void>;
  updateModels: (modelUpdates: Array<{ providerId: string; modelId: string; model: Model }>) => Promise<void>;
  modelsLoading: boolean;
  providersLoading: boolean;
  errors: Record<string, string>;
};
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Create optimistic updates

================
File: src/renderer/src/contexts/ProjectSettingsContext.tsx
================
import { ProjectSettings } from '@common/types';
import { createContext, ReactNode, startTransition, useContext, useEffect, useOptimistic, useState } from 'react';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
type ProjectSettingsContextType = {
  projectSettings: ProjectSettings | null;
  saveProjectSettings: (settings: Partial<ProjectSettings>) => Promise<void>;
};
⋮----
type ProjectSettingsProviderProps = {
  baseDir: string;
  children: ReactNode;
};
⋮----
export const ProjectSettingsProvider = (
⋮----
const saveProjectSettings = async (updated: Partial<ProjectSettings>) =>
⋮----
// Optimistically update the state
⋮----
setProjectSettings(updatedSettings); // Ensure state is in sync with backend
⋮----
// eslint-disable-next-line no-console
⋮----
const loadSettings = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
export const useProjectSettings = () =>

================
File: src/renderer/src/contexts/SettingsContext.tsx
================
import { Font, SettingsData, Theme } from '@common/types';
import { createContext, useContext, useState, useEffect, ReactNode } from 'react';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
type SettingsContextType = {
  settings: SettingsData | null;
  saveSettings: (settings: SettingsData) => Promise<void>;
  theme: Theme | null;
  setTheme: (theme: Theme) => void;
  font: Font | null;
  setFont: (font: Font) => void;
  fontSize: number | null;
  setFontSize: (fontSize: number) => void;
};
⋮----
export const SettingsProvider = (
⋮----
const loadSettings = async () =>
⋮----
const saveSettings = async (updated: SettingsData) =>
⋮----
// eslint-disable-next-line no-console
⋮----
export const useSettings = () =>

================
File: src/renderer/src/contexts/TaskContext.tsx
================
import React, { createContext, memo, ReactNode, useContext, useEffect, useMemo } from 'react';
import { usePrevious } from '@reactuses/core';
import { DefaultTaskState, TaskData, TodoItem, ModelsData } from '@common/types';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import { isLoadingMessage, Message } from '@/types/message';
import { useTaskStore } from '@/stores/taskStore';
import { useTaskResponseHandlers } from '@/hooks/useTaskResponseHandlers';
import { useTaskToolHandlers } from '@/hooks/useTaskToolHandlers';
import { useTaskLogHandlers } from '@/hooks/useTaskLogHandlers';
import { useTaskCommandHandlers } from '@/hooks/useTaskCommandHandlers';
import { useTaskDataHandlers } from '@/hooks/useTaskDataHandlers';
import { useTaskMessageHandlers } from '@/hooks/useTaskMessageHandlers';
import { useTaskLifecycleHandlers } from '@/hooks/useTaskLifecycleHandlers';
import { useTaskActions } from '@/hooks/useTaskActions';
⋮----
interface TaskEventSubscriberProps {
  baseDir: string;
  taskId: string;
  state?: string;
}
⋮----
export interface TaskContextType {
  loadTask: (taskId: string) => void;
  clearSession: (taskId: string, messagesOnly: boolean) => void;
  resetTask: (taskId: string) => void;
  setMessages: (taskId: string, updateMessages: (prevState: Message[]) => Message[]) => void;
  setTodoItems: (taskId: string, updateTodoItems: (prev: TodoItem[]) => TodoItem[]) => void;
  setAiderModelsData: (taskId: string, modelsData: ModelsData | null) => void;
  answerQuestion: (taskId: string, answer: string) => void;
  interruptResponse: (taskId: string, interruptId?: string) => void;
  updateTaskAgentProfile: (taskId: string, agentProfileId: string, provider: string, model: string) => void;
  refreshAllFiles: (taskId: string, useGit?: boolean) => Promise<void>;
}
⋮----
export const useTask = (): TaskContextType =>

================
File: src/renderer/src/hooks/useAudioRecorder.ts
================
import { useCallback, useRef, useState } from 'react';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useModelProviders } from '@/contexts/ModelProviderContext';
import { createGeminiVoiceProvider, createOpenAIVoiceProvider } from '@/voice';
import { VoiceProvider, VoiceSession, VoiceSessionState } from '@/voice/types';
⋮----
export interface UseAudioRecorderType {
  isRecording: boolean;
  isProcessing: boolean;
  startRecording: () => Promise<void>;
  stopRecording: () => Promise<void>;
  transcription: string;
  error: string | null;
  resetTranscription: () => void;
  voiceAvailable: boolean;
  mediaStream: MediaStream | null;
}
⋮----
export const useAudioRecorder = (): UseAudioRecorderType =>
⋮----
// Future providers can be added here
⋮----
// Create voice session first.
// On macOS this is also where we trigger the OS-level microphone permission prompt.
⋮----
// eslint-disable-next-line no-console
⋮----
// Create and configure voice provider
⋮----
// Start voice session
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/hooks/useBooleanState.ts
================
import { useState, useCallback } from 'react';
⋮----
export const useBooleanState = (initialState = false) =>

================
File: src/renderer/src/hooks/useClickOutside.ts
================
import { useEffect, RefObject } from 'react';
⋮----
type RefType =
  | RefObject<HTMLElement | null>
  | RefObject<HTMLDivElement | null>
  | RefObject<HTMLButtonElement | null>
  | RefObject<HTMLAnchorElement | null>
  | RefObject<HTMLInputElement | null>;
⋮----
export const useClickOutside = (refs: RefType | RefType[], handler: (event: MouseEvent) => void) =>
⋮----
const listener = (event: MouseEvent) =>
⋮----
// Check if the click is outside all provided refs
⋮----
// Ignore clicks on null refs or if the ref doesn't contain the target

================
File: src/renderer/src/hooks/useConfiguredHotkeys.ts
================
import { useMemo } from 'react';
⋮----
import { useSettings } from '@/contexts/SettingsContext';
import { getHotkeys } from '@/utils/hotkeys';
⋮----
export const useConfiguredHotkeys = () =>

================
File: src/renderer/src/hooks/useCustomCommands.ts
================
import { CustomCommand } from '@common/types';
import { useEffect, useState } from 'react';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
export const useCustomCommands = (baseDir: string) =>
⋮----
// Load initial commands
⋮----
// Listen for commands updates

================
File: src/renderer/src/hooks/useDropdownState.ts
================
import { useCallback, useState } from 'react';
⋮----
export interface DropdownStateOptions<T> {
  initialState: T;
  onCloseReset?: Partial<T>;
}
⋮----
export const useDropdownState = <T extends Record<string, unknown>>(

================
File: src/renderer/src/hooks/useEffectiveEnvironmentVariable.ts
================
import { EnvironmentVariable } from '@common/types';
import { useEffect, useState } from 'react';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
type UseEffectiveEnvironmentVariableResult = {
  environmentVariable: EnvironmentVariable | null;
  loading: boolean;
  error: string | null;
};
⋮----
export const useEffectiveEnvironmentVariable = (key: string, baseDir?: string): UseEffectiveEnvironmentVariableResult =>
⋮----
const fetchEnvironmentVariable = async () =>

================
File: src/renderer/src/hooks/useIndexedDB.ts
================
import { useState, useEffect, useCallback, useRef } from 'react';
⋮----
import { uiPreferencesDB } from '@/utils/indexedDB';
⋮----
interface UseIndexedDBOptions<T> {
  ttlDays?: number;
  onLoad?: (value: T) => void;
  onExpired?: () => void;
  onError?: (error: Error) => void;
}
⋮----
export const useIndexedDB = <T>(
  storeName: string,
  key: string,
  defaultValue: T,
  options: UseIndexedDBOptions<T> = {},
): [T, (value: T) => Promise<void>, boolean] =>
⋮----
// Clear expired entries first
⋮----
// Load the specific value
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Initialize on mount

================
File: src/renderer/src/hooks/useLmStudioModels.ts
================
import { useEffect, useState } from 'react';
import axios from 'axios';
⋮----
export const useLmStudioModels = (baseUrl: string) =>
⋮----
const loadModels = async () =>
⋮----
const normalized = baseUrl.replace(/\/+$/g, ''); // Remove all trailing slashes

================
File: src/renderer/src/hooks/useOllamaModels.ts
================
import { useEffect, useState } from 'react';
import axios from 'axios';
⋮----
export const useOllamaModels = (baseUrl: string) =>
⋮----
const loadModels = async () =>
⋮----
let normalized = baseUrl.replace(/\/+$/, ''); // Remove all trailing slashes

================
File: src/renderer/src/hooks/useOpenRouterModels.ts
================
import { useEffect, useState } from 'react';
⋮----
interface OpenRouterModel {
  id: string;
  // others not needed
}
⋮----
// others not needed
⋮----
interface OpenRouterResponse {
  data: OpenRouterModel[];
}
⋮----
export const useOpenRouterModels = (apiKey: string) =>
⋮----
const fetchModels = async () =>
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/hooks/useOS.ts
================
import { OS } from '@common/types';
import { useEffect, useState } from 'react';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
export const useOS = (): OS | null =>
⋮----
const fetchOS = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
setOS(null); // Set to null or a default/unknown state in case of error

================
File: src/renderer/src/hooks/useParsedContent.ts
================
import { useMemo } from 'react';
⋮----
import { parseMessageContent } from '@/components/message/utils';
⋮----
export const useParsedContent = (
  baseDir: string,
  content: string | null | undefined,
  allFiles: string[],
  renderMarkdown?: boolean,
  renderThinking?: boolean,
) =>
⋮----
// we use allFiles.length to re-evaluate if the array content might have changed
// even if the array reference itself hasn't.
// eslint-disable-next-line react-hooks/exhaustive-deps

================
File: src/renderer/src/hooks/useRequestyModels.ts
================
import { useEffect, useState } from 'react';
⋮----
interface OpenRouterModel {
  id: string;
  // others not needed
}
⋮----
// others not needed
⋮----
interface OpenRouterResponse {
  data: OpenRouterModel[];
}
⋮----
export const useRequestyModels = (apiKey: string) =>
⋮----
const fetchModels = async () =>
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/hooks/useResponsive.ts
================
import { useState, useEffect } from 'react';
import { debounce } from 'lodash';
⋮----
export const useResponsive = () =>
⋮----
const checkScreenSize = () =>

================
File: src/renderer/src/hooks/useScrollingPaused.ts
================
import { TouchEvent, UIEvent, useCallback, useState, WheelEvent } from 'react';
⋮----
interface UseScrollingPausedOptions {
  onAutoScroll: () => void;
  threshold?: number;
  bottomThreshold?: number;
}
⋮----
interface UseScrollingPausedReturn {
  scrollingPaused: boolean;
  setScrollingPaused: (paused: boolean) => void;
  scrollToBottom: () => void;
  eventHandlers: {
    onScroll: (e: UIEvent<HTMLDivElement>) => void;
    onWheel: (e: WheelEvent<HTMLDivElement>) => void;
    onTouchStart: (e: TouchEvent<HTMLDivElement>) => void;
    onTouchMove: (e: TouchEvent<HTMLDivElement>) => void;
  };
}
⋮----
export const useScrollingPaused = (
⋮----
// Check if content is smaller than scroll area (no scrollbar needed)
⋮----
// If content is smaller than area, never pause scrolling
⋮----
// Only pause when scrolling up (negative deltaY)
⋮----
// Detect swipe up (touch moving up, so current Y is less than start Y)
⋮----
// threshold to avoid accidental triggers

================
File: src/renderer/src/hooks/useSearchText.tsx
================
import { useState, useRef, useEffect, useCallback, useLayoutEffect } from 'react';
import { useTranslation } from 'react-i18next';
import Mark from 'mark.js';
import { IoIosArrowUp, IoIosArrowDown, IoMdClose } from 'react-icons/io';
import { clsx } from 'clsx';
⋮----
import { Input } from '@/components/common/Input';
import { IconButton } from '@/components/common/IconButton';
⋮----
// Remove highlight from previous element
⋮----
const handleKeyDown = (event: KeyboardEvent) =>
⋮----
// Clear previous search when opening
⋮----
markInstance.current.unmark(); // Remove previous highlights
⋮----
setCurrentElementIndex(-1); // Reset index
⋮----
navigateToElement(0); // Navigate to the first result
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect
⋮----
// eslint-disable-next-line
⋮----
<div className=

================
File: src/renderer/src/hooks/useTaskActions.ts
================
import { useCallback } from 'react';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
import { v4 as uuidv4 } from 'uuid';
import { TODO_TOOL_GROUP_NAME } from '@common/tools';
⋮----
import { Message, ReflectedMessage, ResponseMessage, ToolMessage, UserMessage } from '@/types/message';
import { useTaskStore } from '@/stores/taskStore';
import { useApi } from '@/contexts/ApiContext';
⋮----
type UseTaskActionsParams = {
  baseDir: string;
};
⋮----
export const useTaskActions = (
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/hooks/useTaskCommandHandlers.ts
================
import { useCallback, useEffect } from 'react';
import { v4 as uuidv4 } from 'uuid';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import type { CommandOutputData } from '@common/types';
import type { CommandOutputMessage, Message } from '@/types/message';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useTaskStore } from '@/stores/taskStore';
⋮----
const isCommandOutputMessage = (message: Message): message is CommandOutputMessage =>
⋮----
export const useTaskCommandHandlers = (baseDir: string, taskId: string) =>

================
File: src/renderer/src/hooks/useTaskDataHandlers.ts
================
import { useCallback, useEffect } from 'react';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import type { TokensInfoData, QuestionData, AutocompletionData, ModelsData, ContextFilesUpdatedData } from '@common/types';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useTaskStore } from '@/stores/taskStore';
⋮----
export const useTaskDataHandlers = (baseDir: string, taskId: string) =>

================
File: src/renderer/src/hooks/useTaskLifecycleHandlers.ts
================
import { useCallback, useEffect } from 'react';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import type { ClearTaskData } from '@common/types';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useTaskStore } from '@/stores/taskStore';
⋮----
export const useTaskLifecycleHandlers = (baseDir: string, taskId: string) =>

================
File: src/renderer/src/hooks/useTaskLogHandlers.ts
================
import { useCallback, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { v4 as uuidv4 } from 'uuid';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import type { LogData } from '@common/types';
import type { LogMessage, LoadingMessage, Message } from '@/types/message';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useTaskStore } from '@/stores/taskStore';
⋮----
const isLoadingMessage = (message: Message): message is LoadingMessage =>
⋮----
export const useTaskLogHandlers = (baseDir: string, taskId: string) =>

================
File: src/renderer/src/hooks/useTaskMessageHandlers.ts
================
import { useCallback, useEffect } from 'react';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import type { UserMessageData, MessageRemovedData } from '@common/types';
import type { UserMessage } from '@/types/message';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useTaskStore } from '@/stores/taskStore';
⋮----
export const useTaskMessageHandlers = (baseDir: string, taskId: string) =>

================
File: src/renderer/src/hooks/useTaskResponseHandlers.ts
================
import { useCallback, useEffect } from 'react';
import { v4 as uuidv4 } from 'uuid';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import type { ResponseChunkData, ResponseCompletedData } from '@common/types';
import type { Message, ReflectedMessage, ResponseMessage } from '@/types/message';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useTaskStore } from '@/stores/taskStore';
⋮----
export const useTaskResponseHandlers = (baseDir: string, taskId: string) =>

================
File: src/renderer/src/hooks/useTaskToolHandlers.ts
================
import { useCallback, useEffect } from 'react';
import { TODO_TOOL_CLEAR_ITEMS, TODO_TOOL_GET_ITEMS, TODO_TOOL_GROUP_NAME, TODO_TOOL_SET_ITEMS, TODO_TOOL_UPDATE_ITEM_COMPLETION } from '@common/tools';
import { useStoreWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import type { TodoItem, ToolData } from '@common/types';
import type { ToolMessage } from '@/types/message';
⋮----
import { useApi } from '@/contexts/ApiContext';
import { useTaskStore } from '@/stores/taskStore';
⋮----
export const useTaskToolHandlers = (baseDir: string, taskId: string) =>
⋮----
// eslint-disable-next-line no-console
⋮----
const createNewToolMessage = (): ToolMessage =>

================
File: src/renderer/src/hooks/useTypingAnimation.ts
================
import { useEffect, useState } from 'react';
⋮----
export const useTypingAnimation = (text: string, typingSpeed: number = 60, pauseDuration: number = 3000) =>
⋮----
// When we reach end, wait before restarting
⋮----
// Letter-by-letter typing animation

================
File: src/renderer/src/hooks/useUserMessageNavigation.tsx
================
import { ReactNode, useCallback, useEffect, useState } from 'react';
import { MdKeyboardArrowDown, MdKeyboardArrowUp } from 'react-icons/md';
import { useTranslation } from 'react-i18next';
import { clsx } from 'clsx';
⋮----
import { IconButton } from '@/components/common/IconButton';
⋮----
interface UseUserMessageNavigationProps {
  containerRef: React.RefObject<HTMLDivElement | null>;
  userMessageIds: string[];
  scrollToMessageByElement?: (element: HTMLElement) => void;
  scrollToMessageById?: (id: string) => void;
  alwaysVisible?: boolean;
  buttonClassName?: string;
}
⋮----
interface NavigationButton {
  key: string;
  icon: ReactNode;
  onClick: () => void;
  tooltip: string;
  ariaLabel: string;
  disabled: boolean;
  className: string;
}
⋮----
export const useUserMessageNavigation = ({
  containerRef,
  userMessageIds,
  scrollToMessageByElement,
  scrollToMessageById,
  alwaysVisible = false,
  buttonClassName = '',
}: UseUserMessageNavigationProps) =>
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
const handleScroll = () =>
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps
⋮----
// eslint-disable-next-line react-hooks/exhaustive-deps

================
File: src/renderer/src/hooks/useVersions.ts
================
import { VersionsInfo } from '@common/types';
import { useCallback, useEffect, useState } from 'react';
⋮----
import { useApi } from '@/contexts/ApiContext';
⋮----
export const useVersions = () =>
⋮----
// eslint-disable-next-line no-console
⋮----
// Optionally set versions to indicate an error or keep them null
⋮----
// eslint-disable-next-line react-hooks/set-state-in-effect

================
File: src/renderer/src/i18n/index.ts
================
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
// Import your translation files
import en from '@common/locales/en.json';
import zh from '@common/locales/zh.json';
⋮----
// eslint-disable-next-line import/no-named-as-default-member

================
File: src/renderer/src/icons/AnthropicCompatibleIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const AnthropicCompatibleIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Anthropic Compatible"
    className={`flex items-center justify-center rounded-full ${className || ''}`}
    style={{
      backgroundColor: 'rgb(100, 100, 125)',
      boxShadow: 'rgba(255, 255, 255, 0.1) 0px 0px 0px 1px inset',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.7} height={height * 0.7} xmlns="http://www.w3.org/2000/svg">
      <title>Anthropic</title>
      <path d="M13.827 3.52h3.603L24 20h-3.603l-6.57-16.48zm-7.258 0h3.767L16.906 20h-3.674l-1.343-3.461H5.017l-1.344 3.46H0L6.57 3.522zm4.132 9.959L8.453 7.687 6.205 13.48H10.7z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/AnthropicIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const AnthropicIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Anthropic"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(241, 240, 232)',
      color: 'rgb(20, 20, 19)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>Anthropic</title>
      <path d="M13.827 3.52h3.603L24 20h-3.603l-6.57-16.48zm-7.258 0h3.767L16.906 20h-3.674l-1.343-3.461H5.017l-1.344 3.46H0L6.57 3.522zm4.132 9.959L8.453 7.687 6.205 13.48H10.7z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/AzureIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};

================
File: src/renderer/src/icons/BedrockIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const BedrockIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Bedrock"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundImage: 'linear-gradient(45deg, rgb(154, 216, 248), rgb(61, 143, 255), rgb(99, 80, 251))',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>Bedrock</title>
      <path d="M13.05 15.513h3.08c.214 0 .389.177.389.394v1.82a1.704 1.704 0 011.296 1.661c0 .943-.755 1.708-1.685 1.708-.931 0-1.686-.765-1.686-1.708 0-.807.554-1.484 1.297-1.662v-1.425h-2.69v4.663a.395.395 0 01-.188.338l-2.69 1.641a.385.385 0 01-.405-.002l-4.926-3.086a.395.395 0 01-.185-.336V16.3L2.196 14.87A.395.395 0 012 14.555L2 14.528V9.406c0-.14.073-.27.192-.34l2.465-1.462V4.448c0-.129.062-.249.165-.322l.021-.014L9.77 1.058a.385.385 0 01.407 0l2.69 1.675a.395.395 0 01.185.336V7.6h3.856V5.683a1.704 1.704 0 01-1.296-1.662c0-.943.755-1.708 1.685-1.708.931 0 1.685.765 1.685 1.708 0 .807-.553 1.484-1.296 1.662v2.311a.391.391 0 01-.389.394h-4.245v1.806h6.624a1.69 1.69 0 011.64-1.313c.93 0 1.685.764 1.685 1.707 0 .943-.754 1.708-1.685 1.708a1.69 1.69 0 01-1.64-1.314H13.05v1.937h4.953l.915 1.18a1.66 1.66 0 01.84-.227c.931 0 1.685.764 1.685 1.707 0 .943-.754 1.708-1.685 1.708-.93 0-1.685-.765-1.685-1.708 0-.346.102-.668.276-.937l-.724-.935H13.05v1.806zM9.973 1.856L7.93 3.122V6.09h-.778V3.604L5.435 4.669v2.945l2.11 1.36L9.712 7.61V5.334h.778V7.83c0 .136-.07.263-.184.335L7.963 9.638v2.081l1.422 1.009-.446.646-1.406-.998-1.53 1.005-.423-.66 1.605-1.055v-1.99L5.038 8.29l-2.26 1.34v1.676l1.972-1.189.398.677-2.37 1.429V14.3l2.166 1.258 2.27-1.368.397.677-2.176 1.311V19.3l1.876 1.175 2.365-1.426.398.678-2.017 1.216 1.918 1.201 2.298-1.403v-5.78l-4.758 2.893-.4-.675 5.158-3.136V3.289L9.972 1.856zM16.13 18.47a.913.913 0 00-.908.92c0 .507.406.918.908.918a.913.913 0 00.907-.919.913.913 0 00-.907-.92zm3.63-3.81a.913.913 0 00-.908.92c0 .508.406.92.907.92a.913.913 0 00.908-.92.913.913 0 00-.908-.92zm1.555-4.99a.913.913 0 00-.908.92c0 .507.407.918.908.918a.913.913 0 00.907-.919.913.913 0 00-.907-.92zM17.296 3.1a.913.913 0 00-.907.92c0 .508.406.92.907.92a.913.913 0 00.908-.92.913.913 0 00-.908-.92z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/CerebrasIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};

================
File: src/renderer/src/icons/ClaudeAgentSdkIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};

================
File: src/renderer/src/icons/DeepseekIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const DeepseekIcon = ({ width = 48, height = 48, className }: Props) => (
  <div
    aria-label="DeepSeek"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(77, 107, 254)',
      color: 'white',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>DeepSeek</title>
      <path d="M23.748 4.482c-.254-.124-.364.113-.512.234-.051.039-.094.09-.137.136-.372.397-.806.657-1.373.626-.829-.046-1.537.214-2.163.848-.133-.782-.575-1.248-1.247-1.548-.352-.156-.708-.311-.955-.65-.172-.241-.219-.51-.305-.774-.055-.16-.11-.323-.293-.35-.2-.031-.278.136-.356.276-.313.572-.434 1.202-.422 1.84.027 1.436.633 2.58 1.838 3.393.137.093.172.187.129.323-.082.28-.18.552-.266.833-.055.179-.137.217-.329.14a5.526 5.526 0 01-1.736-1.18c-.857-.828-1.631-1.742-2.597-2.458a11.365 11.365 0 00-.689-.471c-.985-.957.13-1.743.388-1.836.27-.098.093-.432-.779-.428-.872.004-1.67.295-2.687.684a3.055 3.055 0 01-.465.137 9.597 9.597 0 00-2.883-.102c-1.885.21-3.39 1.102-4.497 2.623C.082 8.606-.231 10.684.152 12.85c.403 2.284 1.569 4.175 3.36 5.653 1.858 1.533 3.997 2.284 6.438 2.14 1.482-.085 3.133-.284 4.994-1.86.47.234.962.327 1.78.397.63.059 1.236-.03 1.705-.128.735-.156.684-.837.419-.961-2.155-1.004-1.682-.595-2.113-.926 1.096-1.296 2.746-2.642 3.392-7.003.05-.347.007-.565 0-.845-.004-.17.035-.237.23-.256a4.173 4.173 0 001.545-.475c1.396-.763 1.96-2.015 2.093-3.517.02-.23-.004-.467-.247-.588zM11.581 18c-2.089-1.642-3.102-2.183-3.52-2.16-.392.024-.321.471-.235.763.09.288.207.486.371.739.114.167.192.416-.113.603-.673.416-1.842-.14-1.897-.167-1.361-.802-2.5-1.86-3.301-3.307-.774-1.393-1.224-2.887-1.298-4.482-.02-.386.093-.522.477-.592a4.696 4.696 0 011.529-.039c2.132.312 3.946 1.265 5.468 2.774.868.86 1.525 1.887 2.202 2.891.72 1.066 1.494 2.082 2.48 2.914.348.292.625.514.891.677-.802.09-2.14.11-3.054-.614zm1-6.44a.306.306 0 01.415-.287.302.302 0 01.2.288.306.306 0 01-.31.307.303.303 0 01-.304-.308zm3.11 1.596c-.2.081-.399.151-.59.16a1.245 1.245 0 01-.798-.254c-.274-.23-.47-.358-.552-.758a1.73 1.73 0 01.016-.588c.07-.327-.008-.537-.239-.727-.187-.156-.426-.199-.688-.199a.559.559 0 01-.254-.078c-.11-.054-.2-.19-.114-.358.028-.054.16-.186.192-.21.356-.202.767-.136 1.146.016.352.144.618.408 1.001.782.391.451.462.576.685.914.176.265.336.537.445.848.067.195-.019.354-.25.452z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/GeminiIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const GeminiIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Gemini"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(255, 255, 255)',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg height={width * 0.75} viewBox="0 0 24 24" width={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>Gemini</title>
      <path
        d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z"
        fill="#3186FF"
      ></path>
      <path
        d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z"
        fill="url(#lobe-icons-gemini-fill-0)"
      ></path>
      <path
        d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z"
        fill="url(#lobe-icons-gemini-fill-1)"
      ></path>
      <path
        d="M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z"
        fill="url(#lobe-icons-gemini-fill-2)"
      ></path>
      <defs>
        <linearGradient gradientUnits="userSpaceOnUse" id="lobe-icons-gemini-fill-0" x1="7" x2="11" y1="15.5" y2="12">
          <stop stopColor="#08B962"></stop>
          <stop offset="1" stopColor="#08B962" stopOpacity="0"></stop>
        </linearGradient>
        <linearGradient gradientUnits="userSpaceOnUse" id="lobe-icons-gemini-fill-1" x1="8" x2="11.5" y1="5.5" y2="11">
          <stop stopColor="#F94543"></stop>
          <stop offset="1" stopColor="#F94543" stopOpacity="0"></stop>
        </linearGradient>
        <linearGradient gradientUnits="userSpaceOnUse" id="lobe-icons-gemini-fill-2" x1="3.5" x2="17.5" y1="13.5" y2="12">
          <stop stopColor="#FABC12"></stop>
          <stop offset=".46" stopColor="#FABC12" stopOpacity="0"></stop>
        </linearGradient>
      </defs>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/GpustackIcon.tsx
================
import gpustackIcon from './gpustack.png';
⋮----
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const GpustackIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="GPUStack"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'white',
      boxShadow: 'rgba(0, 0, 0, 0.1) 0px 0px 0px 1px inset',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <img src={gpustackIcon} width={width} height={height} className={className} alt="GPUStack" />
  </div>
);

================
File: src/renderer/src/icons/GroqIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const GroqIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Groq"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(245, 80, 54)',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>Groq</title>
      <path d="M12.036 2c-3.853-.035-7 3-7.036 6.781-.035 3.782 3.055 6.872 6.908 6.907h2.42v-2.566h-2.292c-2.407.028-4.38-1.866-4.408-4.23-.029-2.362 1.901-4.298 4.308-4.326h.1c2.407 0 4.358 1.915 4.365 4.278v6.305c0 2.342-1.944 4.25-4.323 4.279a4.375 4.375 0 01-3.033-1.252l-1.851 1.818A7 7 0 0012.029 22h.092c3.803-.056 6.858-3.083 6.879-6.816v-6.5C18.907 4.963 15.817 2 12.036 2z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/index.ts
================


================
File: src/renderer/src/icons/KimiPlanIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const KimiPlanIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Kimi Plan"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: '#000000',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg
      viewBox="0 0 512 512"
      xmlns="http://www.w3.org/2000/svg"
      fillRule="evenodd"
      clipRule="evenodd"
      strokeLinejoin="round"
      strokeMiterlimit="2"
      width={width}
      height={height}
    >
      <path
        d="M342.065 189.759c1.886-2.42 3.541-4.63 5.289-6.77.81-1.007.74-1.771-.046-2.824-7.58-9.965-8.298-21.028-3.935-32.254 3.275-8.448 10.52-12.406 19.373-13.25 5.52-.521 10.936.046 15.959 2.73 6.596 3.53 10.438 8.912 11.688 16.341.995 5.926.81 11.712-.868 17.452-2.974 10.161-10.277 15.427-20.287 16.758-8.31 1.11-16.734 1.25-25.113 1.817-.648.046-1.308 0-2.06 0z"
        fill="#027aff"
      />
      <path
        d="M321.512 144.254h-50.064l-39.637 90.384h-56.036v-89.99H131v232.868h44.787v-98.103h78.973c13.598 0 26.015-7.927 31.744-20.252v118.355h44.787v-98.103c0-23.342-18.239-42.97-41.523-44.671v-.116h-24.593a45.577 45.577 0 0026.884-24.534l29.453-65.838z"
        fill="#fff"
      />
    </svg>
  </div>
);

================
File: src/renderer/src/icons/LitellmIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const LitellmIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="LiteLLM"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: '#181638',
      boxShadow: 'rgba(0, 0, 0, 0.1) 0px 0px 0px 1px inset',
      color: 'rgb(0, 0, 0)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <div style={{ fontSize: `${width * 0.6}px` }}>🚅</div>
  </div>
);

================
File: src/renderer/src/icons/LmStudioIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const LmStudioIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="LM Studio"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundImage: 'linear-gradient(135deg, rgb(108, 120, 239), rgb(79, 20, 190))',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>LM Studio</title>
      <path
        d="M2.84 2a1.273 1.273 0 100 2.547h14.107a1.273 1.273 0 100-2.547H2.84zM7.935 5.33a1.273 1.273 0 000 2.548H22.04a1.274 1.274 0 000-2.547H7.935zM3.624 9.935c0-.704.57-1.274 1.274-1.274h14.106a1.274 1.274 0 010 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM1.273 12.188a1.273 1.273 0 100 2.547H15.38a1.274 1.274 0 000-2.547H1.273zM3.624 16.792c0-.704.57-1.274 1.274-1.274h14.106a1.273 1.273 0 110 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM13.029 18.849a1.273 1.273 0 100 2.547h9.698a1.273 1.273 0 100-2.547h-9.698z"
        fillOpacity=".3"
      ></path>
      <path d="M2.84 2a1.273 1.273 0 100 2.547h10.287a1.274 1.274 0 000-2.547H2.84zM7.935 5.33a1.273 1.273 0 000 2.548H18.22a1.274 1.274 0 000-2.547H7.935zM3.624 9.935c0-.704.57-1.274 1.274-1.274h10.286a1.273 1.273 0 010 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM1.273 12.188a1.273 1.273 0 100 2.547H11.56a1.274 1.274 0 000-2.547H1.273zM3.624 16.792c0-.704.57-1.274 1.274-1.274h10.286a1.273 1.273 0 110 2.547H4.898c-.703 0-1.274-.57-1.274-1.273zM13.029 18.849a1.273 1.273 0 100 2.547h5.78a1.273 1.273 0 100-2.547h-5.78z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/MinimaxIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const MinimaxIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Minimax"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      background: 'linear-gradient(to right, rgb(226, 22, 126), rgb(254, 96, 60))',
      color: 'white',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg
      className="-ml-[2px]"
      fill="currentColor"
      fillRule="evenodd"
      viewBox="0 0 24 24"
      width={width * 0.75}
      height={height * 0.75}
      xmlns="http://www.w3.org/2000/svg"
    >
      <title>Minimax</title>
      <path d="M16.278 2c1.156 0 2.093.927 2.093 2.07v12.501a.74.74 0 00.744.709.74.74 0 00.743-.709V9.099a2.06 2.06 0 012.071-2.049A2.06 2.06 0 0124 9.1v6.561a.649.649 0 01-.652.645.649.649 0 01-.653-.645V9.1a.762.762 0 00-.766-.758.762.762 0 00-.766.758v7.472a2.037 2.037 0 01-2.048 2.026 2.037 2.037 0 01-2.048-2.026v-12.5a.785.785 0 00-.788-.753.785.785 0 00-.789.752l-.001 15.904A2.037 2.037 0 0113.441 22a2.037 2.037 0 01-2.048-2.026V18.04c0-.356.292-.645.652-.645.36 0 .652.289.652.645v1.934c0 .263.142.506.372.638.23.131.514.131.744 0a.734.734 0 00.372-.638V4.07c0-1.143.937-2.07 2.093-2.07zm-5.674 0c1.156 0 2.093.927 2.093 2.07v11.523a.648.648 0 01-.652.645.648.648 0 01-.652-.645V4.07a.785.785 0 00-.789-.78.785.785 0 00-.789.78v14.013a2.06 2.06 0 01-2.07 2.048 2.06 2.06 0 01-2.071-2.048V9.1a.762.762 0 00-.766-.758.762.762 0 00-.766.758v3.8a2.06 2.06 0 01-2.071 2.049A2.06 2.06 0 010 12.9v-1.378c0-.357.292-.646.652-.646.36 0 .653.29.653.646V12.9c0 .418.343.757.766.757s.766-.339.766-.757V9.099a2.06 2.06 0 012.07-2.048 2.06 2.06 0 012.071 2.048v8.984c0 .419.343.758.767.758.423 0 .766-.339.766-.758V4.07c0-1.143.937-2.07 2.093-2.07z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/OllamaIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const OllamaIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Ollama"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(255, 255, 255)',
      color: 'rgb(0, 0, 0)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>Ollama</title>
      <path d="M7.905 1.09c.216.085.411.225.588.41.295.306.544.744.734 1.263.191.522.315 1.1.362 1.68a5.054 5.054 0 012.049-.636l.051-.004c.87-.07 1.73.087 2.48.474.101.053.2.11.297.17.05-.569.172-1.134.36-1.644.19-.52.439-.957.733-1.264a1.67 1.67 0 01.589-.41c.257-.1.53-.118.796-.042.401.114.745.368 1.016.737.248.337.434.769.561 1.287.23.934.27 2.163.115 3.645l.053.04.026.019c.757.576 1.284 1.397 1.563 2.35.435 1.487.216 3.155-.534 4.088l-.018.021.002.003c.417.762.67 1.567.724 2.4l.002.03c.064 1.065-.2 2.137-.814 3.19l-.007.01.01.024c.472 1.157.62 2.322.438 3.486l-.006.039a.651.651 0 01-.747.536.648.648 0 01-.54-.742c.167-1.033.01-2.069-.48-3.123a.643.643 0 01.04-.617l.004-.006c.604-.924.854-1.83.8-2.72-.046-.779-.325-1.544-.8-2.273a.644.644 0 01.18-.886l.009-.006c.243-.159.467-.565.58-1.12a4.229 4.229 0 00-.095-1.974c-.205-.7-.58-1.284-1.105-1.683-.595-.454-1.383-.673-2.38-.61a.653.653 0 01-.632-.371c-.314-.665-.772-1.141-1.343-1.436a3.288 3.288 0 00-1.772-.332c-1.245.099-2.343.801-2.67 1.686a.652.652 0 01-.61.425c-1.067.002-1.893.252-2.497.703-.522.39-.878.935-1.066 1.588a4.07 4.07 0 00-.068 1.886c.112.558.331 1.02.582 1.269l.008.007c.212.207.257.53.109.785-.36.622-.629 1.549-.673 2.44-.05 1.018.186 1.902.719 2.536l.016.019a.643.643 0 01.095.69c-.576 1.236-.753 2.252-.562 3.052a.652.652 0 01-1.269.298c-.243-1.018-.078-2.184.473-3.498l.014-.035-.008-.012a4.339 4.339 0 01-.598-1.309l-.005-.019a5.764 5.764 0 01-.177-1.785c.044-.91.278-1.842.622-2.59l.012-.026-.002-.002c-.293-.418-.51-.953-.63-1.545l-.005-.024a5.352 5.352 0 01.093-2.49c.262-.915.777-1.701 1.536-2.269.06-.045.123-.09.186-.132-.159-1.493-.119-2.73.112-3.67.127-.518.314-.95.562-1.287.27-.368.614-.622 1.015-.737.266-.076.54-.059.797.042zm4.116 9.09c.936 0 1.8.313 2.446.855.63.527 1.005 1.235 1.005 1.94 0 .888-.406 1.58-1.133 2.022-.62.375-1.451.557-2.403.557-1.009 0-1.871-.259-2.493-.734-.617-.47-.963-1.13-.963-1.845 0-.707.398-1.417 1.056-1.946.668-.537 1.55-.849 2.485-.849zm0 .896a3.07 3.07 0 00-1.916.65c-.461.37-.722.835-.722 1.25 0 .428.21.829.61 1.134.455.347 1.124.548 1.943.548.799 0 1.473-.147 1.932-.426.463-.28.7-.686.7-1.257 0-.423-.246-.89-.683-1.256-.484-.405-1.14-.643-1.864-.643zm.662 1.21l.004.004c.12.151.095.37-.056.49l-.292.23v.446a.375.375 0 01-.376.373.375.375 0 01-.376-.373v-.46l-.271-.218a.347.347 0 01-.052-.49.353.353 0 01.494-.051l.215.172.22-.174a.353.353 0 01.49.051zm-5.04-1.919c.478 0 .867.39.867.871a.87.87 0 01-.868.871.87.87 0 01-.867-.87.87.87 0 01.867-.872zm8.706 0c.48 0 .868.39.868.871a.87.87 0 01-.868.871.87.87 0 01-.867-.87.87.87 0 01.867-.872zM7.44 2.3l-.003.002a.659.659 0 00-.285.238l-.005.006c-.138.189-.258.467-.348.832-.17.692-.216 1.631-.124 2.782.43-.128.899-.208 1.404-.237l.01-.001.019-.034c.046-.082.095-.161.148-.239.123-.771.022-1.692-.253-2.444-.134-.364-.297-.65-.453-.813a.628.628 0 00-.107-.09L7.44 2.3zm9.174.04l-.002.001a.628.628 0 00-.107.09c-.156.163-.32.45-.453.814-.29.794-.387 1.776-.23 2.572l.058.097.008.014h.03a5.184 5.184 0 011.466.212c.086-1.124.038-2.043-.128-2.722-.09-.365-.21-.643-.349-.832l-.004-.006a.659.659 0 00-.285-.239h-.004z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/OpenAiCompatibleIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};

================
File: src/renderer/src/icons/OpenAiIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const OpenAiIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="OpenAI"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(0, 0, 0)',
      boxShadow: 'rgba(255, 255, 255, 0.1) 0px 0px 0px 1px inset',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>OpenAI</title>
      <path d="M21.55 10.004a5.416 5.416 0 00-.478-4.501c-1.217-2.09-3.662-3.166-6.05-2.66A5.59 5.59 0 0010.831 1C8.39.995 6.224 2.546 5.473 4.838A5.553 5.553 0 001.76 7.496a5.487 5.487 0 00.691 6.5 5.416 5.416 0 00.477 4.502c1.217 2.09 3.662 3.165 6.05 2.66A5.586 5.586 0 0013.168 23c2.443.006 4.61-1.546 5.361-3.84a5.553 5.553 0 003.715-2.66 5.488 5.488 0 00-.693-6.497v.001zm-8.381 11.558a4.199 4.199 0 01-2.675-.954c.034-.018.093-.05.132-.074l4.44-2.53a.71.71 0 00.364-.623v-6.176l1.877 1.069c.02.01.033.029.036.05v5.115c-.003 2.274-1.87 4.118-4.174 4.123zM4.192 17.78a4.059 4.059 0 01-.498-2.763c.032.02.09.055.131.078l4.44 2.53c.225.13.504.13.73 0l5.42-3.088v2.138a.068.068 0 01-.027.057L9.9 19.288c-1.999 1.136-4.552.46-5.707-1.51h-.001zM3.023 8.216A4.15 4.15 0 015.198 6.41l-.002.151v5.06a.711.711 0 00.364.624l5.42 3.087-1.876 1.07a.067.067 0 01-.063.005l-4.489-2.559c-1.995-1.14-2.679-3.658-1.53-5.63h.001zm15.417 3.54l-5.42-3.088L14.896 7.6a.067.067 0 01.063-.006l4.489 2.557c1.998 1.14 2.683 3.662 1.529 5.633a4.163 4.163 0 01-2.174 1.807V12.38a.71.71 0 00-.363-.623zm1.867-2.773a6.04 6.04 0 00-.132-.078l-4.44-2.53a.731.731 0 00-.729 0l-5.42 3.088V7.325a.068.068 0 01.027-.057L14.1 4.713c2-1.137 4.555-.46 5.707 1.513.487.833.664 1.809.499 2.757h.001zm-11.741 3.81l-1.877-1.068a.065.065 0 01-.036-.051V6.559c.001-2.277 1.873-4.122 4.181-4.12.976 0 1.92.338 2.671.954-.034.018-.092.05-.131.073l-4.44 2.53a.71.71 0 00-.365.623l-.003 6.173v.002zm1.02-2.168L12 9.25l2.414 1.375v2.75L12 14.75l-2.415-1.375v-2.75z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/OpenCodeIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const OpenCodeIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="OpenCode ZEN"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: '#131010',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg width={width * 0.95} height={height * 0.95} viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M320 224V352H192V224H320Z" fill="#5A5858"></path>
      <path fillRule="evenodd" clipRule="evenodd" d="M384 416H128V96H384V416ZM320 160H192V352H320V160Z" fill="white"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/OpenRouterIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const OpenRouterIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="OpenRouter"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(101, 102, 241)',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>OpenRouter</title>
      <path d="M16.804 1.957l7.22 4.105v.087L16.73 10.21l.017-2.117-.821-.03c-1.059-.028-1.611.002-2.268.11-1.064.175-2.038.577-3.147 1.352L8.345 11.03c-.284.195-.495.336-.68.455l-.515.322-.397.234.385.23.53.338c.476.314 1.17.796 2.701 1.866 1.11.775 2.083 1.177 3.147 1.352l.3.045c.694.091 1.375.094 2.825.033l.022-2.159 7.22 4.105v.087L16.589 22l.014-1.862-.635.022c-1.386.042-2.137.002-3.138-.162-1.694-.28-3.26-.926-4.881-2.059l-2.158-1.5a21.997 21.997 0 00-.755-.498l-.467-.28a55.927 55.927 0 00-.76-.43C2.908 14.73.563 14.116 0 14.116V9.888l.14.004c.564-.007 2.91-.622 3.809-1.124l1.016-.58.438-.274c.428-.28 1.072-.726 2.686-1.853 1.621-1.133 3.186-1.78 4.881-2.059 1.152-.19 1.974-.213 3.814-.138l.02-1.907z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/RequestyIcon.tsx
================
import requestyIcon from './requesty.png';
⋮----
type Props = {
  width?: number;
  height?: number;
  className?: string;
};

================
File: src/renderer/src/icons/SyntheticIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const SyntheticIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="Synthetic"
    className={`flex items-center justify-center rounded-md relative ${className || ''}`}
    style={{
      backgroundColor: 'white',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg
      width={width * 0.8}
      height={height * 0.8}
      viewBox="0 0 54 54"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
    >
      <path
        d="M27.8517 26.3314C27.8439 26.1451 27.8371 25.9303 27.8337 25.692C27.8203 24.7571 27.8545 23.4581 28.0457 22.0052C28.4322 19.0688 29.4394 15.6521 31.8222 13.2693C34.205 10.8867 37.6212 9.87992 40.5575 9.49344C42.0107 9.30219 43.3101 9.26734 44.245 9.28076C44.4829 9.28417 44.6968 9.29231 44.883 9.30009C44.8908 9.48595 44.8975 9.69933 44.901 9.93676C44.9144 10.8716 44.8795 12.171 44.6883 13.6242C44.3018 16.5605 43.2958 19.9773 40.9131 22.3602C38.5303 24.743 35.1129 25.7495 32.1765 26.136C30.7234 26.3272 29.4246 26.3614 28.4897 26.348C28.2518 26.3446 28.0378 26.3392 27.8517 26.3314Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
      <path
        d="M27.8916 27.1592C28.0179 27.0219 28.165 26.8653 28.3311 26.6943C28.9826 26.0238 29.9253 25.1295 31.0879 24.2373C33.4375 22.4342 36.5658 20.7305 39.9355 20.7305C43.3051 20.7306 46.4327 22.4343 48.7822 24.2373C49.945 25.1296 50.8885 26.0238 51.54 26.6943C51.7059 26.865 51.8514 27.022 51.9775 27.1592C51.8516 27.2961 51.7055 27.4518 51.54 27.6221C50.8885 28.2926 49.945 29.1868 48.7822 30.0791C46.4327 31.8821 43.3052 33.5868 39.9355 33.5869C36.5657 33.5869 33.4375 31.8822 31.0879 30.0791C29.9252 29.1868 28.9826 28.2926 28.3311 27.6221C28.1652 27.4514 28.0177 27.2963 27.8916 27.1592Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
      <path
        d="M27.4459 27.6915C27.6323 27.6837 27.8471 27.677 28.0854 27.6736C29.0202 27.6602 30.3192 27.6943 31.7721 27.8856C34.7085 28.272 38.1253 29.2793 40.5081 31.6621C42.8906 34.0448 43.8974 37.4611 44.2839 40.3973C44.4752 41.8505 44.51 43.1499 44.4966 44.0848C44.4932 44.3228 44.485 44.5367 44.4773 44.7229C44.2914 44.7306 44.078 44.7374 43.8406 44.7408C42.9057 44.7542 41.6063 44.7194 40.1531 44.5281C37.2168 44.1417 33.8 43.1356 31.4172 40.753C29.0343 38.3701 28.0278 34.9528 27.6413 32.0163C27.4501 30.5633 27.4159 29.2644 27.4294 28.3296C27.4328 28.0916 27.4381 27.8777 27.4459 27.6915Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
      <path
        d="M26.916 28.1289C27.0533 28.2552 27.2099 28.4023 27.3809 28.5684C28.0514 29.2199 28.9457 30.1626 29.8379 31.3252C31.641 33.6748 33.3447 36.8031 33.3447 40.1728C33.3446 43.5424 31.6409 46.67 29.8379 49.0195C28.9456 50.1823 28.0514 51.1258 27.3809 51.7773C27.2102 51.9432 27.0532 52.0887 26.916 52.2148C26.7791 52.0889 26.6234 51.9428 26.4531 51.7773C25.7826 51.1258 24.8884 50.1823 23.9961 49.0195C22.1931 46.67 20.4884 43.5426 20.4883 40.1728C20.4883 36.803 22.193 33.6748 23.9961 31.3252C24.8884 30.1625 25.7826 29.2199 26.4531 28.5684C26.6238 28.4025 26.7789 28.255 26.916 28.1289Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
      <path
        d="M26.2147 27.691C26.2225 27.8774 26.2293 28.0922 26.2327 28.3305C26.2461 29.2653 26.2119 30.5643 26.0207 32.0172C25.6342 34.9536 24.627 38.3704 22.2442 40.7532C19.8614 43.1357 16.4452 44.1425 13.5089 44.529C12.0557 44.7203 10.7563 44.7551 9.82145 44.7417C9.58349 44.7383 9.36957 44.7301 9.1834 44.7224C9.17564 44.5365 9.16886 44.3231 9.16545 44.0857C9.15203 43.1508 9.18689 41.8514 9.37813 40.3982C9.76458 37.4619 10.7706 34.0451 13.1533 31.6623C15.5361 29.2795 18.9535 28.2729 21.8899 27.8865C23.343 27.6952 24.6419 27.6611 25.5767 27.6745C25.8146 27.6779 26.0286 27.6833 26.2147 27.691Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
      <path
        d="M25.7021 27.1602C25.5759 27.2974 25.4288 27.4541 25.2627 27.625C24.6111 28.2955 23.6684 29.1899 22.5059 30.082C20.1562 31.8851 17.028 33.5889 13.6582 33.5889C10.2886 33.5887 7.16105 31.885 4.81153 30.082C3.64873 29.1897 2.70529 28.2955 2.05372 27.625C1.88786 27.4543 1.74236 27.2973 1.61622 27.1602C1.74215 27.0232 1.88824 26.8676 2.05372 26.6973C2.70527 26.0267 3.64874 25.1326 4.81153 24.2402C7.16108 22.4372 10.2885 20.7326 13.6582 20.7324C17.0281 20.7324 20.1562 22.4371 22.5059 24.2402C23.6686 25.1325 24.6112 26.0268 25.2627 26.6973C25.4285 26.8679 25.576 27.023 25.7021 27.1602Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
      <path
        d="M25.7338 25.9813C25.5474 25.9891 25.3326 25.9959 25.0943 25.9993C24.1595 26.0127 22.8605 25.9785 21.4076 25.7873C18.4712 25.4008 15.0544 24.3936 12.6716 22.0108C10.2891 19.628 9.28226 16.2118 8.89579 13.2755C8.70453 11.8223 8.66969 10.5229 8.6831 9.58806C8.68652 9.35009 8.69466 9.13618 8.70244 8.95C8.8883 8.94224 9.10168 8.93546 9.33911 8.93205C10.274 8.91863 11.5734 8.95349 13.0266 9.14473C15.9629 9.53118 19.3797 10.5372 21.7625 12.9199C24.1454 15.3027 25.1519 18.7201 25.5383 21.6565C25.7296 23.1096 25.7638 24.4085 25.7503 25.3433C25.7469 25.5812 25.7415 25.7952 25.7338 25.9813Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
      <path
        d="M26.9121 25.7031C26.7748 25.5769 26.6182 25.4298 26.4473 25.2637C25.7768 24.6121 24.8824 23.6694 23.9902 22.5068C22.1872 20.1572 20.4834 17.029 20.4834 13.6592C20.4835 10.2896 22.1873 7.16203 23.9902 4.8125C24.8826 3.6497 25.7767 2.70627 26.4473 2.05469C26.618 1.88883 26.775 1.74333 26.9121 1.61719C27.049 1.74312 27.2047 1.88921 27.375 2.05469C28.0455 2.70624 28.9397 3.64971 29.832 4.8125C31.6351 7.16206 33.3397 10.2895 33.3398 13.6592C33.3398 17.029 31.6351 20.1572 29.832 22.5068C28.9398 23.6695 28.0455 24.6121 27.375 25.2637C27.2043 25.4295 27.0492 25.577 26.9121 25.7031Z"
        stroke="black"
        strokeWidth="2.5"
      ></path>
    </svg>
    <svg
      width={width * 0.25}
      height={height * 0.25}
      viewBox="0 0 19 19"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"
    >
      <path
        d="M8.56067 1.3799L10.4618 1.34671C10.5492 1.34522 10.6286 1.38935 10.6747 1.45923L10.7093 1.53774L11.045 2.92076C11.1559 3.37707 11.4798 3.75232 11.9152 3.92819C12.3419 4.10041 12.8251 4.0605 13.2183 3.82145L14.3036 3.16178C14.3771 3.11703 14.4662 3.1144 14.5407 3.14983L14.6099 3.19745L15.9965 4.57385C16.0577 4.63461 16.0825 4.72126 16.0659 4.80217L16.035 4.88085L15.4788 5.80573C15.2386 6.20505 15.1867 6.68631 15.3299 7.12299L15.4034 7.30728C15.5966 7.71593 15.9524 8.02086 16.3793 8.15073L16.5666 8.19532L17.4238 8.34639C17.5414 8.36729 17.628 8.46852 17.6302 8.58794L17.6642 10.533C17.6662 10.6479 17.5891 10.7499 17.478 10.7794L16.3785 11.0721C15.9508 11.1859 15.5956 11.4767 15.399 11.8666L15.3249 12.0398C15.1648 12.4858 15.2187 12.9804 15.4714 13.3812L16.0028 14.2246C16.0497 14.2991 16.0532 14.3908 16.0168 14.4666L15.9672 14.5358L14.5394 15.9448C14.4825 16.0008 14.4038 16.025 14.3277 16.0139L14.2531 15.9908L13.2136 15.4747C12.8594 15.2989 12.4528 15.2697 12.0801 15.388L11.9219 15.4474C11.5639 15.6067 11.2838 15.8977 11.1361 16.2562L11.0812 16.4134L10.7617 17.5217C10.7312 17.6271 10.6352 17.7006 10.5255 17.7026L8.58735 17.7364C8.46855 17.7385 8.36456 17.6565 8.33878 17.5405L8.08316 16.3817L8.03422 16.2078C7.91462 15.8694 7.67485 15.5859 7.36105 15.4118L7.19756 15.3345L7.04329 15.2815C6.73077 15.1941 6.39776 15.2128 6.0968 15.3342L5.94955 15.4032L4.77293 16.0371C4.6979 16.0774 4.60969 16.0756 4.53755 16.0373L4.47222 15.9877L3.13752 14.5596C3.0776 14.4954 3.05736 14.4064 3.07873 14.3252L3.11353 14.2484L3.7373 13.3331C3.98342 12.9717 4.04895 12.5208 3.923 12.109L3.85746 11.9353L3.78169 11.7911C3.61486 11.5129 3.35814 11.2998 3.05423 11.1865L2.89807 11.1374L1.49728 10.7907C1.38749 10.7635 1.30969 10.6659 1.30755 10.5528L1.27503 8.6898C1.27334 8.58474 1.33722 8.49154 1.43207 8.45363L1.47385 8.44118L2.69615 8.18641C3.14512 8.09283 3.52318 7.80066 3.72943 7.39873L3.80738 7.2196C3.94662 6.83155 3.92084 6.40585 3.73992 6.04091L3.6523 5.8891L3.04806 4.9581C2.98255 4.85725 2.99751 4.72403 3.08453 4.64101L4.58516 3.20932C4.67146 3.12699 4.80459 3.11666 4.90217 3.18523L5.71797 3.75897C6.12951 4.04818 6.65895 4.11193 7.1274 3.92874C7.53749 3.76829 7.85309 3.43752 7.99657 3.02769L8.04812 2.84707L8.32092 1.57747C8.34533 1.46387 8.44449 1.38193 8.56067 1.3799Z"
        fill="white"
        stroke="black"
        strokeWidth="1.5"
      ></path>
      <circle cx="9.46694" cy="9.5416" r="2.53895" transform="rotate(-1 9.46694 9.5416)" fill="white" stroke="black" strokeWidth="1.5"></circle>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/VertexAiIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};
⋮----
export const VertexAiIcon = ({ width = 64, height = 64, className }: Props) => (
  <div
    aria-label="VertexAI"
    className={`flex items-center justify-center rounded-md ${className || ''}`}
    style={{
      backgroundColor: 'rgb(66, 133, 244)',
      color: 'rgb(255, 255, 255)',
      height: `${height}px`,
      width: `${width}px`,
    }}
  >
    <svg fill="currentColor" fillRule="evenodd" viewBox="0 0 24 24" width={width * 0.75} height={height * 0.75} xmlns="http://www.w3.org/2000/svg">
      <title>VertexAI</title>
      <path d="M11.995 20.216a1.892 1.892 0 100 3.785 1.892 1.892 0 000-3.785zm0 2.806a.927.927 0 11.927-.914.914.914 0 01-.927.914z"></path>
      <path
        clipRule="evenodd"
        d="M21.687 14.144c.237.038.452.16.605.344a.978.978 0 01-.18 1.3l-8.24 6.082a1.892 1.892 0 00-1.147-1.508l8.28-6.08a.991.991 0 01.682-.138z"
      ></path>
      <path clipRule="evenodd" d="M10.122 21.842l-8.217-6.066a.952.952 0 01-.206-1.287.978.978 0 011.287-.206l8.28 6.08a1.893 1.893 0 00-1.144 1.479z"></path>
      <path d="M4.273 4.475a.978.978 0 01-.965-.965V1.09a.978.978 0 111.943 0v2.42a.978.978 0 01-.978.965zM4.247 13.034a.978.978 0 100-1.956.978.978 0 000 1.956zM4.247 10.19a.978.978 0 100-1.956.978.978 0 000 1.956zM4.247 7.332a.978.978 0 100-1.956.978.978 0 000 1.956z"></path>
      <path d="M19.718 7.307a.978.978 0 01-.965-.979v-2.42a.965.965 0 011.93 0v2.42a.964.964 0 01-.965.979zM19.743 13.047a.978.978 0 100-1.956.978.978 0 000 1.956zM19.743 10.151a.978.978 0 100-1.956.978.978 0 000 1.956zM19.743 2.068a.978.978 0 100-1.956.978.978 0 000 1.956z"></path>
      <path d="M11.995 15.917a.978.978 0 01-.965-.965v-2.459a.978.978 0 011.943 0v2.433a.976.976 0 01-.978.991zM11.995 18.762a.978.978 0 100-1.956.978.978 0 000 1.956zM11.995 10.64a.978.978 0 100-1.956.978.978 0 000 1.956zM11.995 7.783a.978.978 0 100-1.956.978.978 0 000 1.956z"></path>
      <path d="M15.856 10.177a.978.978 0 01-.965-.965v-2.42a.977.977 0 011.702-.763.979.979 0 01.241.763v2.42a.978.978 0 01-.978.965zM15.869 4.913a.978.978 0 100-1.956.978.978 0 000 1.956zM15.869 15.853a.978.978 0 100-1.956.978.978 0 000 1.956zM15.869 12.996a.978.978 0 100-1.956.978.978 0 000 1.956z"></path>
      <path d="M8.121 15.853a.978.978 0 100-1.956.978.978 0 000 1.956zM8.121 7.783a.978.978 0 100-1.956.978.978 0 000 1.956zM8.121 4.913a.978.978 0 100-1.957.978.978 0 000 1.957zM8.134 12.996a.978.978 0 01-.978-.94V9.611a.965.965 0 011.93 0v2.445a.966.966 0 01-.952.94z"></path>
    </svg>
  </div>
);

================
File: src/renderer/src/icons/ZaiPlanIcon.tsx
================
type Props = {
  width?: number;
  height?: number;
  className?: string;
};

================
File: src/renderer/src/pages/Home.tsx
================
import { ProjectData } from '@common/types';
import { AnimatePresence, motion } from 'framer-motion';
import { Activity, startTransition, useCallback, useEffect, useOptimistic, useState, useTransition, useRef } from 'react';
import { MdBarChart, MdSettings, MdUpload } from 'react-icons/md';
import { PiNotebookFill } from 'react-icons/pi';
import { useTranslation } from 'react-i18next';
import { useHotkeys } from 'react-hotkeys-hook';
import { useSearchParams } from 'react-router-dom';
⋮----
import { useConfiguredHotkeys } from '@/hooks/useConfiguredHotkeys';
import { UsageDashboard } from '@/components/usage/UsageDashboard';
import { IconButton } from '@/components/common/IconButton';
import { LoadingOverlay } from '@/components/common/LoadingOverlay';
import { NoProjectsOpen } from '@/components/project/NoProjectsOpen';
import { OpenProjectDialog } from '@/components/project/OpenProjectDialog';
import { ProjectTabs } from '@/components/project/ProjectTabs';
import { ProjectView } from '@/components/project/ProjectView';
import { SettingsPage } from '@/components/settings/SettingsPage';
import { useVersions } from '@/hooks/useVersions';
import { HtmlInfoDialog } from '@/components/common/HtmlInfoDialog';
import { ProjectSettingsProvider } from '@/contexts/ProjectSettingsContext';
import { TelemetryInfoDialog } from '@/components/TelemetryInfoDialog';
import { showInfoNotification } from '@/utils/notifications';
import { useApi } from '@/contexts/ApiContext';
import { ModelLibrary } from '@/components/ModelLibrary';
import { URL_PARAMS, encodeBaseDir, decodeBaseDir } from '@/utils/routes';
import { useBooleanState } from '@/hooks/useBooleanState';
⋮----
type ShowSettingsInfo = {
  pageId: string;
  options?: Record<string, unknown>;
};
⋮----
const loadProjects = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleOpenSettings = (pageId: string) =>
⋮----
const checkReleaseNotes = async () =>
⋮----
// Close current project tab
⋮----
// Handle URL parameters for direct project/task navigation
⋮----
const handleUrlNavigation = async () =>
⋮----
// Only update initial task ID on first navigation or when task changes
⋮----
// Only switch if not already active
⋮----
// eslint-disable-next-line no-console
⋮----
// Update URL when project changes from user interaction (not from URL navigation)
⋮----
// Skip if the change came from URL navigation
⋮----
// Open new project dialog
⋮----
// Open usage dashboard
⋮----
// Open model library
⋮----
// Open settings
⋮----
// Close overlays on Escape
⋮----
// Switch to specific project tabs (Alt/Cmd + 1-9)
⋮----
// Ctrl+Tab cycling (forward)
⋮----
// Ctrl+Shift+Tab cycling (backward)
⋮----
// Reset Ctrl+Tab state on Control key up
⋮----
const handleKeyUp = (e: KeyboardEvent) =>
⋮----
const handleAddProject = async (baseDir: string) =>
⋮----
const renderProjectPanels = ()
⋮----
const getUpdateTooltip = () =>
⋮----
return ''; // Should not happen if showUpdateIcon is true
⋮----
const handleCloseReleaseNotes = async () =>
⋮----
tooltip=
⋮----
<OpenProjectDialog onClose=
⋮----
onClose=

================
File: src/renderer/src/pages/Onboarding.tsx
================
import { useCallback, useEffect, useState } from 'react';
import { HiArrowRight, HiArrowLeft } from 'react-icons/hi2';
import { useNavigate } from 'react-router-dom';
import { useTranslation } from 'react-i18next';
import { isEqual } from 'lodash';
import { SettingsData } from '@common/types';
⋮----
import { useSettings } from '@/contexts/SettingsContext';
import { useAgents } from '@/contexts/AgentsContext';
import { AiderSettings } from '@/components/settings/AiderSettings';
import { LanguageSelector } from '@/components/settings/LanguageSelector';
import { OnboardingProviderSetup } from '@/components/onboarding/OnboardingProviderSetup';
import { AgentSettings } from '@/components/settings/agent/AgentSettings';
import { Button } from '@/components/common/Button';
import { OnboardingStepper } from '@/components/onboarding/OnboardingStepper';
import { ROUTES } from '@/utils/routes';
import { showErrorNotification, showInfoNotification } from '@/utils/notifications';
⋮----
const handleNext = async () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleBack = () =>
⋮----
// eslint-disable-next-line no-console
⋮----
const handleFinish = async () =>
⋮----
// Save agent profile changes
⋮----
// Find profiles that were added, updated, or deleted
⋮----
// Handle deleted profiles
⋮----
// Handle added and updated profiles
⋮----
// New profile
⋮----
// Updated profile - check if it actually changed
⋮----
// Update profile order if needed
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
{/* Language Selector in top-right corner */}
⋮----
{/* Stepper */}
⋮----
{/* Step Content */}

⋮----
{/* Navigation Buttons */}

================
File: src/renderer/src/pages/Settings.tsx
================
import { Font, ProjectData, SettingsData, Theme, AgentProfile, ProviderProfile } from '@common/types';
import { ReactNode, useEffect, useRef, useState } from 'react';
import { useTranslation } from 'react-i18next';
import { clsx } from 'clsx';
import { FaChevronDown, FaChevronRight, FaCog, FaInfoCircle, FaRobot, FaServer, FaBrain, FaMicrophone, FaKeyboard } from 'react-icons/fa';
import { MdTerminal } from 'react-icons/md';
import { LuClipboardList } from 'react-icons/lu';
⋮----
import { getPathBasename } from '@/utils/path-utils';
import { useApi } from '@/contexts/ApiContext';
import { AiderSettings } from '@/components/settings/AiderSettings';
import { GeneralSettings } from '@/components/settings/GeneralSettings';
import { AgentSettings } from '@/components/settings/agent/AgentSettings';
import { AboutSettings } from '@/components/settings/AboutSettings';
import { ServerSettings } from '@/components/settings/ServerSettings';
import { MemorySettings } from '@/components/settings/MemorySettings';
import { VoiceSettings } from '@/components/settings/VoiceSettings';
import { HotkeysSettings } from '@/components/settings/HotkeysSettings';
import { TaskSettings } from '@/components/settings/TaskSettings';
⋮----
type Props = {
  settings: SettingsData;
  updateSettings: (settings: SettingsData) => void;
  onLanguageChange: (language: string) => void;
  onZoomChange: (zoomLevel: number) => void;
  onThemeChange: (theme: Theme) => void;
  onFontChange: (fontName: Font) => void;
  onFontSizeChange: (fontSize: number) => void;
  initialPageId?: string;
  initialOptions?: Record<string, unknown>;
  agentProfiles?: AgentProfile[];
  setAgentProfiles?: (profiles: AgentProfile[]) => void;
  openProjects?: ProjectData[];
  providers?: ProviderProfile[];
  setProviders?: (providers: ProviderProfile[]) => void;
};
⋮----
type PageId = 'general' | 'aider' | 'agents' | 'tasks' | 'memory' | 'voice' | 'hotkeys' | 'server' | 'about';
⋮----
interface SidebarItem {
  id: string;
  label: string;
  icon?: ReactNode;
  children?: { id: string; label: string }[];
  pageId: PageId;
}
⋮----
export const Settings = ({
  settings,
  updateSettings,
  onLanguageChange,
  onZoomChange,
  onThemeChange,
  onFontChange,
  onFontSizeChange,
  initialPageId,
  initialOptions,
  agentProfiles,
  setAgentProfiles,
  openProjects,
  providers,
  setProviders,
}: Props) =>
⋮----
const scrollToSection = (sectionId: string) =>
⋮----
const toggleExpand = (id: string) =>
⋮----
const handleItemClick = (item: SidebarItem) =>
⋮----
const handleChildClick = (pageId: PageId, sectionId: string) =>
⋮----
// Handle agent context selection
⋮----
// Extract project baseDir from sectionId (format: agent-{baseDir})
⋮----
const renderContent = () =>
⋮----
{/* Sidebar */}
⋮----
className=
⋮----
e.stopPropagation();
toggleExpand(item.id);
⋮----
{!item.children?.length && <span className="w-6" />} {/* Spacer for items without children */}
⋮----
{/* Children */}
⋮----
{/* Content */}

================
File: src/renderer/src/stores/projectStore.ts
================
import { useShallow } from 'zustand/react/shallow';
import { TaskData, DefaultTaskState } from '@common/types';
import { createWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
interface ProjectStore {
  projectTasksMap: Map<string, TaskData[]>;

  setProjectTasks: (projectBaseDir: string, tasks: TaskData[]) => void;
  updateProjectTask: (projectBaseDir: string, taskData: TaskData) => void;
  addProjectTask: (projectBaseDir: string, taskData: TaskData) => void;
  removeProjectTask: (projectBaseDir: string, taskId: string) => void;
  clearProjectTasks: (projectBaseDir: string) => void;
}
⋮----
export const useProjectTasks = (projectBaseDir: string)
⋮----
export const useProjectProcessingState = (projectBaseDir: string)

================
File: src/renderer/src/stores/taskStore.ts
================
import { useShallow } from 'zustand/react/shallow';
import { ContextFile, ModelsData, QuestionData, TodoItem, TokensInfoData } from '@common/types';
import { createWithEqualityFn } from 'zustand/traditional';
import { shallow } from 'zustand/vanilla/shallow';
⋮----
import { Message } from '@/types/message';
⋮----
export interface TaskState {
  loading: boolean;
  loaded: boolean;
  tokensInfo: TokensInfoData | null;
  question: QuestionData | null;
  todoItems: TodoItem[];
  allFiles: string[];
  autocompletionWords: string[];
  contextFiles: ContextFile[];
  aiderModelsData: ModelsData | null;
  lastActiveAt: Date | null;
}
⋮----
interface TaskStore {
  taskStateMap: Map<string, TaskState>;
  taskMessagesMap: Map<string, Message[]>;

  updateTaskState: (taskId: string, updates: Partial<TaskState>) => void;
  setMessages: (taskId: string, updateMessages: (prev: Message[]) => Message[]) => void;
  setTodoItems: (taskId: string, updateTodoItems: (prev: TodoItem[]) => TodoItem[]) => void;
  setAllFiles: (taskId: string, allFiles: string[]) => void;
  setAutocompletionWords: (taskId: string, autocompletionWords: string[]) => void;
  setTokensInfo: (taskId: string, tokensInfo: TokensInfoData | null) => void;
  setQuestion: (taskId: string, question: QuestionData | null) => void;
  setAiderModelsData: (taskId: string, modelsData: ModelsData | null) => void;
  clearSession: (taskId: string, messagesOnly: boolean) => void;
}
⋮----
// we are already in a pending state, no need to update
⋮----
export const useTaskState = (taskId: string)
⋮----
export const useTaskMessages = (taskId: string)

================
File: src/renderer/src/themes/theme-aurora.scss
================
.theme-aurora {

  --color-bg-primary: #0B1426;
  --color-bg-primary-light: #132038;
  --color-bg-primary-light-strong: #13203880;
  --color-bg-secondary: #1A2C4A;
  --color-bg-secondary-light: #22385C;
  --color-bg-secondary-light-strongest: #22385Cf2;
  --color-bg-tertiary: #2A446E;
  --color-bg-tertiary-emphasis: #D4A57440;
  --color-bg-tertiary-strong: #D4A57460;
  --color-bg-fourth: #345080;
  --color-bg-fourth-muted: #7BC4C433;
  --color-bg-fourth-emphasis: #7BC4C44C;
  --color-bg-fifth: #3E5C92;
  --color-bg-selection: #D4A57450;
  --color-bg-code-block: #08101C;

  --color-bg-diff-viewer-old-primary: #4A2A2A;
  --color-bg-diff-viewer-old-secondary: #3A1F1F;
  --color-bg-diff-viewer-new-primary: #2A4A3A;
  --color-bg-diff-viewer-new-secondary: #1F3A2A;

  --color-text-primary: #F8FBFF;
  --color-text-secondary: #E8F4FF;
  --color-text-tertiary: #D8EDFF;
  --color-text-muted-light: #C8E6FF;
  --color-text-muted: #7BC4C4;
  --color-text-muted-dark: #3E5C92;
  --color-text-dark: #2A446E;

  --color-border-dark: #1A2C4A;
  --color-border-dark-light: #22385C;
  --color-border-dark-light-strong: #22385C80;
  --color-border-default-dark: #2A446E;
  --color-border-default: #345080;
  --color-border-accent: #D4A574;
  --color-border-light: #7BC4C4;

  --color-accent-primary: #D4A574;
  --color-accent-secondary: #7BC4C4;
  --color-accent-light: #E8F4FF;

  --color-success: #7BC4C4;
  --color-success-light: #9DD4D4;
  --color-success-subtle: #7BC4C41a;
  --color-success-muted: #7BC4C433;
  --color-success-emphasis: #7BC4C44c;

  --color-warning: #D4A574;
  --color-warning-subtle: #D4A57419;
  --color-warning-emphasis: #D4A5744c;
  --color-warning-light: #E4B584;
  --color-warning-text: #0B1426;

  --color-error: #E07B7B;
  --color-error-dark: #C06565;
  --color-error-subtle: #E07B7B1a;
  --color-error-muted: #E07B7B26;
  --color-error-emphasis: #E07B7B4c;
  --color-error-strong: #E07B7B80;
  --color-error-light: #E89B9B;
  --color-error-lighter: #F0BBBB;
  --color-error-lightest: #F8DBDB;

  --color-info: #5A8BC4;
  --color-info-light: #7AA5D4;
  --color-info-lighter: #9ABFE4;
  --color-info-lightest: #BAD9F4;
  --color-info-subtle: #5A8BC41a;
  --color-info-light-muted: #5A8BC433;
  --color-info-light-emphasis: #5A8BC44c;

  // Button-specific colors
  --color-button-primary: #D4A574;
  --color-button-primary-light: #E4B584;
  --color-button-primary-subtle: #D4A57419;
  --color-button-primary-emphasis: #D4A5744c;
  --color-button-primary-text: #0B1426;

  --color-button-secondary: #5A8BC4;
  --color-button-secondary-light: #7AA5D4;
  --color-button-secondary-subtle: #5A8BC41a;
  --color-button-secondary-emphasis: #5A8BC44c;
  --color-button-secondary-text: #F8FBFF;

  --color-button-danger: #E07B7B;
  --color-button-danger-light: #E89B9B;
  --color-button-danger-subtle: #E07B7B1a;
  --color-button-danger-emphasis: #E07B7B4c;
  --color-button-danger-text: #F8FBFF;

  --color-input-bg: #132038;
  --color-input-border: #D4A574;
  --color-input-text: #F8FBFF;

  --color-agent-auto-approve: #7BC4C4;
  --color-agent-aider-tools: #D4A574;
  --color-agent-power-tools: #B47BC4;
  --color-agent-todo-tools: #5A8BC4;
  --color-agent-tasks-tools: #7BC4C4;
  --color-agent-memory-tools: #D4A5B4;
  --color-agent-skills-tools: #76cc99;
  --color-agent-context-files: #E4B584;
  --color-agent-repo-map: #9DD4D4;
  --color-agent-ai-request: #E07B7B;
  --color-agent-sub-agent: #7B9DE0;
}

================
File: src/renderer/src/themes/theme-botanical-garden-dark.scss
================
.theme-botanical-garden-dark {

  --color-bg-primary: #121513;
  --color-bg-primary-light: #171c19;
  --color-bg-primary-light-strong: #171c1980;
  --color-bg-secondary: #1c241f;
  --color-bg-secondary-light: #232e27;
  --color-bg-secondary-light-strongest: #232e27f2;
  --color-bg-tertiary: #2a3a30;
  --color-bg-tertiary-emphasis: #2a3a304c;
  --color-bg-tertiary-strong: #2a3a307f;
  --color-bg-fourth: #314738;
  --color-bg-fourth-muted: #31473833;
  --color-bg-fourth-emphasis: #3147384c;
  --color-bg-fifth: #3d5a46;
  --color-bg-selection: #3b4b40;
  --color-bg-code-block: #141616;

  --color-bg-diff-viewer-old-primary: #3a1d16;
  --color-bg-diff-viewer-old-secondary: #2a1510;
  --color-bg-diff-viewer-new-primary: #0c2617;
  --color-bg-diff-viewer-new-secondary: #081c11;

  --color-text-primary: #f5f3ed;
  --color-text-secondary: #c9c6bf;
  --color-text-tertiary: #b5b2ab;
  --color-text-muted-light: #9a9791;
  --color-text-muted: #6a726c;
  --color-text-muted-dark: #3f4d44;
  --color-text-dark: #2a3a30;

  --color-border-dark: #1c241f;
  --color-border-dark-light: #232e27;
  --color-border-dark-light-strong: #232e2780;
  --color-border-default-dark: #2a3a30;
  --color-border-default: #314738;
  --color-border-accent: #4a7c59;
  --color-border-light: #c9c6bf;

  --color-accent-primary: #4a7c59;
  --color-accent-secondary: #5d8a6a;
  --color-accent-light: #83ad8e;

  --color-success: #4a7c59;
  --color-success-light: #83ad8e;
  --color-success-subtle: #4a7c591a;
  --color-success-muted: #4a7c5933;
  --color-success-emphasis: #4a7c594c;

  --color-warning: #f9a620;
  --color-warning-subtle: #f9a62019;
  --color-warning-emphasis: #f9a6204c;
  --color-warning-light: #fbbf4b;
  --color-warning-text: #1a1a1a;

  --color-error: #b7472a;
  --color-error-dark: #7a2a18;
  --color-error-subtle: #b7472a1a;
  --color-error-muted: #b7472a26;
  --color-error-emphasis: #b7472a4c;
  --color-error-strong: #b7472a80;
  --color-error-light: #d26b52;
  --color-error-lighter: #e39a87;
  --color-error-lightest: #f0c3b7;

  --color-info: #3b82f6;
  --color-info-light: #60a5fa;
  --color-info-lighter: #93c5fd;
  --color-info-lightest: #bfdbfe;
  --color-info-subtle: #3b82f61a;
  --color-info-light-muted: #3b82f633;
  --color-info-light-emphasis: #3b82f64c;

  // Button-specific colors
  --color-button-primary: #f9a620;
  --color-button-primary-light: #fbbf4b;
  --color-button-primary-subtle: #f9a62019;
  --color-button-primary-emphasis: #f9a6204c;
  --color-button-primary-text: #1a1a1a;

  --color-button-secondary: #4a7c59;
  --color-button-secondary-light: #83ad8e;
  --color-button-secondary-subtle: #4a7c591a;
  --color-button-secondary-emphasis: #4a7c594c;
  --color-button-secondary-text: #f5f3ed;

  --color-button-danger: #b7472a;
  --color-button-danger-light: #d26b52;
  --color-button-danger-subtle: #b7472a1a;
  --color-button-danger-emphasis: #b7472a4c;
  --color-button-danger-text: #f5f3ed;

  --color-input-bg: #171c19;
  --color-input-border: #314738;
  --color-input-text: #f5f3ed;

  --color-agent-auto-approve: #83ad8e;
  --color-agent-aider-tools: #f9a620;
  --color-agent-power-tools: #c084fc;
  --color-agent-todo-tools: #38bdf8;
  --color-agent-tasks-tools: #10b981;
  --color-agent-memory-tools: #f472b6;
  --color-agent-skills-tools: #c7d392;
  --color-agent-context-files: #f9a620;
  --color-agent-repo-map: #93c5fd;
  --color-agent-ai-request: #b7472a;
  --color-agent-sub-agent: #4a7c59;
}

================
File: src/renderer/src/themes/theme-botanical-garden.scss
================
.theme-botanical-garden {

  --color-bg-primary: #f5f3ed;
  --color-bg-primary-light: #faf8f2;
  --color-bg-primary-light-strong: #faf8f280;
  --color-bg-secondary: #f0ede5;
  --color-bg-secondary-light: #ebe7dd;
  --color-bg-secondary-light-strongest: #ebe7ddf2;
  --color-bg-tertiary: #e8e4da;
  --color-bg-tertiary-emphasis: #e8e4da4c;
  --color-bg-tertiary-strong: #e8e4da7f;
  --color-bg-fourth: #e3dfd4;
  --color-bg-fourth-muted: #e3dfd433;
  --color-bg-fourth-emphasis: #e3dfd44c;
  --color-bg-fifth: #ded9ce;
  --color-bg-selection: #4a7c5933;
  --color-bg-code-block: #2d3a2f;

  --color-bg-diff-viewer-old-primary: #f4e8e6;
  --color-bg-diff-viewer-old-secondary: #f0e0dd;
  --color-bg-diff-viewer-new-primary: #e8f4e8;
  --color-bg-diff-viewer-new-secondary: #ddf0dd;

  --color-text-primary: #2d3a2f;
  --color-text-secondary: #3d4a3f;
  --color-text-tertiary: #4d5a4f;
  --color-text-muted-light: #6d7a6f;
  --color-text-muted: #8d9a8f;
  --color-text-muted-dark: #adbaaf;
  --color-text-dark: #4a7c59;

  --color-border-dark: #d4d0c5;
  --color-border-dark-light: #dad6cb;
  --color-border-dark-light-strong: #dad6cb80;
  --color-border-default-dark: #e0dccf;
  --color-border-default: #e6e2d5;
  --color-border-accent: #4a7c59;
  --color-border-light: #ece8db;

  --color-accent-primary: #4a7c59;
  --color-accent-secondary: #f9a620;
  --color-accent-light: #6d8c79;

  --color-success: #4a7c59;
  --color-success-light: #5d8a6a;
  --color-success-subtle: #4a7c591a;
  --color-success-muted: #4a7c5933;
  --color-success-emphasis: #4a7c594c;

  --color-warning: #f9a620;
  --color-warning-subtle: #f9a62019;
  --color-warning-emphasis: #f9a6204c;
  --color-warning-light: #fab440;
  --color-warning-text: #2d3a2f;

  --color-error: #b7472a;
  --color-error-dark: #953722;
  --color-error-subtle: #b7472a1a;
  --color-error-muted: #b7472a26;
  --color-error-emphasis: #b7472a4c;
  --color-error-strong: #b7472a80;
  --color-error-light: #c75f42;
  --color-error-lighter: #d7775a;
  --color-error-lightest: #e78f72;

  --color-info: #4a7a9a;
  --color-info-light: #5d8fb0;
  --color-info-lighter: #7aa3c2;
  --color-info-lightest: #97b8d4;
  --color-info-subtle: #4a7a9a1a;
  --color-info-light-muted: #4a7a9a33;
  --color-info-light-emphasis: #4a7a9a4c;

  // Button-specific colors
  --color-button-primary: #4a7c59;
  --color-button-primary-light: #5d8a6a;
  --color-button-primary-subtle: #4a7c5919;
  --color-button-primary-emphasis: #4a7c594c;
  --color-button-primary-text: #f5f3ed;

  --color-button-secondary: #f9a620;
  --color-button-secondary-light: #fab440;
  --color-button-secondary-subtle: #f9a6201a;
  --color-button-secondary-emphasis: #f9a6204c;
  --color-button-secondary-text: #2d3a2f;

  --color-button-danger: #b7472a;
  --color-button-danger-light: #c75f42;
  --color-button-danger-subtle: #b7472a1a;
  --color-button-danger-emphasis: #b7472a4c;
  --color-button-danger-text: #f5f3ed;

  --color-input-bg: #faf8f2;
  --color-input-border: #d4d0c5;
  --color-input-text: #2d3a2f;

  --color-agent-auto-approve: #4a7c59;
  --color-agent-aider-tools: #f9a620;
  --color-agent-power-tools: #8a6a9a;
  --color-agent-todo-tools: #4a7a9a;
  --color-agent-context-files: #9a8a4a;
  --color-agent-repo-map: #6a8a9a;
  --color-agent-ai-request: #b7472a;
  --color-agent-sub-agent: #4a6a9a;
}

================
File: src/renderer/src/themes/theme-bw.scss
================
.theme-bw {

  --color-bg-primary: #ffffff;
  --color-bg-primary-light: #f8f8f8;
  --color-bg-primary-light-strong: #f8f8f880;
  --color-bg-secondary: #e0e0e0;
  --color-bg-secondary-light: #d0d0d0;
  --color-bg-secondary-light-strongest: #d0d0d0f2;
  --color-bg-tertiary: #b0b0b0;
  --color-bg-tertiary-emphasis: #b0b0b04c;
  --color-bg-tertiary-strong: #b0b0b07f;
  --color-bg-fourth: #808080;
  --color-bg-fourth-muted: #80808033;
  --color-bg-fourth-emphasis: #8080804c;
  --color-bg-fifth: #404040;
  --color-bg-selection: #b0b0b0;
  --color-bg-code-block: #f0f0f0;

  --color-bg-diff-viewer-old-primary: #e0e0e0;
  --color-bg-diff-viewer-old-secondary: #d0d0d0;
  --color-bg-diff-viewer-new-primary: #f0f0f0;
  --color-bg-diff-viewer-new-secondary: #e8e8e8;

  --color-text-primary: #000000;
  --color-text-secondary: #202020;
  --color-text-tertiary: #404040;
  --color-text-muted-light: #606060;
  --color-text-muted: #808080;
  --color-text-muted-dark: #a0a0a0;
  --color-text-dark: #000000;

  --color-border-dark: #e0e0e0;
  --color-border-dark-light: #d0d0d0;
  --color-border-dark-light-strong: #d0d0d080;
  --color-border-default-dark: #b0b0b0;
  --color-border-default: #808080;
  --color-border-accent: #404040;
  --color-border-light: #000000;

  --color-accent-primary: #404040;
  --color-accent-secondary: #808080;
  --color-accent-light: #000000;

  --color-success: #808080;
  --color-success-light: #a0a0a0;
  --color-success-subtle: #8080801a;
  --color-success-muted: #80808033;
  --color-success-emphasis: #8080804c;

  --color-warning: #606060;
  --color-warning-subtle: #60606019;
  --color-warning-emphasis: #6060604c;
  --color-warning-light: #707070;
  --color-warning-text: #ffffff;

  --color-error: #000000;
  --color-error-dark: #000000;
  --color-error-subtle: #0000001a;
  --color-error-muted: #00000026;
  --color-error-emphasis: #0000004c;
  --color-error-strong: #00000080;
  --color-error-light: #202020;
  --color-error-lighter: #404040;
  --color-error-lightest: #606060;

  --color-info: #404040;
  --color-info-light: #606060;
  --color-info-lighter: #808080;
  --color-info-lightest: #a0a0a0;
  --color-info-subtle: #4040401a;
  --color-info-light-muted: #40404033;
  --color-info-light-emphasis: #4040404c;

  // Button-specific colors
  --color-button-primary: #606060;
  --color-button-primary-light: #707070;
  --color-button-primary-subtle: #60606019;
  --color-button-primary-emphasis: #6060604c;
  --color-button-primary-text: #ffffff;

  --color-button-secondary: #404040;
  --color-button-secondary-light: #606060;
  --color-button-secondary-subtle: #4040401a;
  --color-button-secondary-emphasis: #4040404c;
  --color-button-secondary-text: #000000;

  --color-button-danger: #000000;
  --color-button-danger-light: #202020;
  --color-button-danger-subtle: #0000001a;
  --color-button-danger-emphasis: #0000004c;
  --color-button-danger-text: #000000;

  --color-input-bg: #f8f8f8;
  --color-input-border: #808080;
  --color-input-text: #000000;

  --color-agent-auto-approve: #a0a0a0;
  --color-agent-aider-tools: #808080;
  --color-agent-power-tools: #606060;
  --color-agent-todo-tools: #404040;
  --color-agent-tasks-tools: #707070;
  --color-agent-memory-tools: #505050;
  --color-agent-skills-tools: #404040;
  --color-agent-context-files: #202020;
  --color-agent-repo-map: #000000;
  --color-agent-ai-request: #505050;
  --color-agent-sub-agent: #303030;
}

================
File: src/renderer/src/themes/theme-cappuccino.scss
================
.theme-cappuccino {

  --color-bg-primary: #ede4d3;
  --color-bg-primary-light: #f0e7d6;
  --color-bg-primary-light-strong: #f0e7d680;
  --color-bg-secondary: #e6d7c3;
  --color-bg-secondary-light: #e9dac6;
  --color-bg-secondary-light-strongest: #e9dac6f2;
  --color-bg-tertiary: #dcc9b0;
  --color-bg-tertiary-emphasis: #dcc9b04c;
  --color-bg-tertiary-strong: #dcc9b07f;
  --color-bg-fourth: #d2bb9d;
  --color-bg-fourth-muted: #d2bb9d33;
  --color-bg-fourth-emphasis: #d2bb9d4c;
  --color-bg-fifth: #c4a882;
  --color-bg-selection: #dcc9b0;
  --color-bg-code-block: #f2e9dc;

  --color-bg-diff-viewer-old-primary: #fee2e2;
  --color-bg-diff-viewer-old-secondary: #fecaca;
  --color-bg-diff-viewer-new-primary: #dcfce7;
  --color-bg-diff-viewer-new-secondary: #bbf7d0;

  --color-text-primary: #2d1f16;
  --color-text-secondary: #4a3426;
  --color-text-tertiary: #5d4a36;
  --color-text-muted-light: #8d7a64;
  --color-text-muted: #9d8a74;
  --color-text-muted-dark: #caa590;
  --color-text-dark: #2d1f16;

  --color-border-dark: #dcc9b0;
  --color-border-dark-light: #d2bb9d;
  --color-border-dark-light-strong: #c4a88280;
  --color-border-default-dark: #c4a882;
  --color-border-default: #937865;
  --color-border-accent: #5d4a36;
  --color-border-light: #4a3426;

  --color-accent-primary: #8b4513;
  --color-accent-secondary: #c4a882;
  --color-accent-light: #4a3426;

  --color-success: #22c55e;
  --color-success-light: #4ade80;
  --color-success-subtle: #22c55e1a;
  --color-success-muted: #22c55e33;
  --color-success-emphasis: #22c55e4c;

  --color-warning: #d97706;
  --color-warning-subtle: #d9770619;
  --color-warning-emphasis: #d977064c;
  --color-warning-light: #f59e0b;
  --color-warning-text: #ede4d3;

  --color-error: #ef4444;
  --color-error-dark: #991b1b;
  --color-error-subtle: #ef44441a;
  --color-error-muted: #ef444426;
  --color-error-emphasis: #ef44444c;
  --color-error-strong: #ef444480;
  --color-error-light: #f87171;
  --color-error-lighter: #fca5a5;
  --color-error-lightest: #fecaca;

  --color-info: #2563eb;
  --color-info-light: #3b82f6;
  --color-info-lighter: #60a5fa;
  --color-info-lightest: #93c5fd;
  --color-info-subtle: #2563eb1a;
  --color-info-light-muted: #2563eb33;
  --color-info-light-emphasis: #2563eb4c;

  // Button-specific colors
  --color-button-primary: #8b4513;
  --color-button-primary-light: #9f664f;
  --color-button-primary-subtle: #d9770619;
  --color-button-primary-emphasis: #d977064c;
  --color-button-primary-text: #ede4d3;

  --color-button-secondary: #2563eb;
  --color-button-secondary-light: #3b82f6;
  --color-button-secondary-subtle: #2563eb1a;
  --color-button-secondary-emphasis: #2563eb4c;
  --color-button-secondary-text: #ede4d3;

  --color-button-danger: #ef4444;
  --color-button-danger-light: #f87171;
  --color-button-danger-subtle: #ef44441a;
  --color-button-danger-emphasis: #ef44444c;
  --color-button-danger-text: #ede4d3;

  --color-input-bg: #f2e9dc;
  --color-input-border: #c4a882;
  --color-input-text: #2d1f16;

  --color-agent-auto-approve: #4ade80;
  --color-agent-aider-tools: #fb923c;
  --color-agent-power-tools: #c084fc;
  --color-agent-todo-tools: #38bdf8;
  --color-agent-tasks-tools: #6ee7b7;
  --color-agent-memory-tools: #f9a8d4;
  --color-agent-skills-tools: #79acac;
  --color-agent-context-files: #facc15;
  --color-agent-repo-map: #60a5fa;
  --color-agent-ai-request: #d97706;
  --color-agent-sub-agent: #7c3aed;
}

================
File: src/renderer/src/themes/theme-charcoal.scss
================
.theme-charcoal {

  --color-bg-primary: #1a1a1a;
  --color-bg-primary-light: #242424;
  --color-bg-primary-light-strong: #24242480;
  --color-bg-secondary: #2d2d2d;
  --color-bg-secondary-light: #363636;
  --color-bg-secondary-light-strongest: #363636f2;
  --color-bg-tertiary: #404040;
  --color-bg-tertiary-emphasis: #4040404c;
  --color-bg-tertiary-strong: #4040407f;
  --color-bg-fourth: #4a4a4a;
  --color-bg-fourth-muted: #4a4a4a33;
  --color-bg-fourth-emphasis: #4a4a4a4c;
  --color-bg-fifth: #545454;
  --color-bg-selection: #404040;
  --color-bg-code-block: #141414;

  --color-bg-diff-viewer-old-primary: #3f1d25;
  --color-bg-diff-viewer-old-secondary: #2c141a;
  --color-bg-diff-viewer-new-primary: #022c22;
  --color-bg-diff-viewer-new-secondary: #011f19;

  --color-text-primary: #ffffff;
  --color-text-secondary: #e8e8e8;
  --color-text-tertiary: #cccccc;
  --color-text-muted-light: #a8a8a8;
  --color-text-muted: #808080;
  --color-text-muted-dark: #666666;
  --color-text-dark: #404040;

  --color-border-dark: #2d2d2d;
  --color-border-dark-light: #363636;
  --color-border-dark-light-strong: #36363680;
  --color-border-default-dark: #404040;
  --color-border-default: #4a4a4a;
  --color-border-accent: #545454;
  --color-border-light: #808080;

  --color-accent-primary: #d4af37;
  --color-accent-secondary: #c0c0c0;
  --color-accent-light: #e8e8e8;

  --color-success: #4ade80;
  --color-success-light: #86efac;
  --color-success-subtle: #4ade801a;
  --color-success-muted: #4ade8033;
  --color-success-emphasis: #4ade804c;

  --color-warning: #fbbf24;
  --color-warning-subtle: #fbbf2419;
  --color-warning-emphasis: #fbbf244c;
  --color-warning-light: #fcd34d;
  --color-warning-text: #1a1a1a;

  --color-error: #f87171;
  --color-error-dark: #dc2626;
  --color-error-subtle: #f871711a;
  --color-error-muted: #f8717126;
  --color-error-emphasis: #f871714c;
  --color-error-strong: #f8717180;
  --color-error-light: #fca5a5;
  --color-error-lighter: #fecaca;
  --color-error-lightest: #fee2e2;

  --color-info: #60a5fa;
  --color-info-light: #93c5fd;
  --color-info-lighter: #bfdbfe;
  --color-info-lightest: #dbeafe;
  --color-info-subtle: #60a5fa1a;
  --color-info-light-muted: #60a5fa33;
  --color-info-light-emphasis: #60a5fa4c;

  // Button-specific colors
  --color-button-primary: #fbbf24;
  --color-button-primary-light: #fcd34d;
  --color-button-primary-subtle: #fbbf2419;
  --color-button-primary-emphasis: #fbbf244c;
  --color-button-primary-text: #1a1a1a;

  --color-button-secondary: #60a5fa;
  --color-button-secondary-light: #93c5fd;
  --color-button-secondary-subtle: #60a5fa1a;
  --color-button-secondary-emphasis: #60a5fa4c;
  --color-button-secondary-text: #ffffff;

  --color-button-danger: #f87171;
  --color-button-danger-light: #fca5a5;
  --color-button-danger-subtle: #f871711a;
  --color-button-danger-emphasis: #f871714c;
  --color-button-danger-text: #ffffff;

  --color-input-bg: #242424;
  --color-input-border: #4a4a4a;
  --color-input-text: #ffffff;

  --color-agent-auto-approve: #4ade80;
  --color-agent-aider-tools: #fb923c;
  --color-agent-power-tools: #c084fc;
  --color-agent-todo-tools: #60a5fa;
  --color-agent-tasks-tools: #34d399;
  --color-agent-memory-tools: #f472b6;
  --color-agent-skills-tools: #447da6;
  --color-agent-context-files: #facc15;
  --color-agent-repo-map: #93c5fd;
  --color-agent-ai-request: #ef4444;
  --color-agent-sub-agent: #3b82f6;
}

================
File: src/renderer/src/themes/theme-dark.scss
================
.theme-dark {

  --color-bg-primary: #141417;
  --color-bg-primary-light: #191a22;
  --color-bg-primary-light-strong: #191a2280;
  --color-bg-secondary: #222431;
  --color-bg-secondary-light: #2a2c3f;
  --color-bg-secondary-light-strongest: #2a2c3ff2;
  --color-bg-tertiary: #333652;
  --color-bg-tertiary-emphasis: #3336524C;
  --color-bg-tertiary-strong: #3336527F;
  --color-bg-fourth: #3d4166;
  --color-bg-fourth-muted: #3d416633;
  --color-bg-fourth-emphasis: #3d41664c;
  --color-bg-fifth: #585c75;
  --color-bg-selection: #5d5f6e;
  --color-bg-code-block: #171718;

  --color-bg-diff-viewer-old-primary: #3f1d25;
  --color-bg-diff-viewer-old-secondary: #2c141a;
  --color-bg-diff-viewer-new-primary: #022c22;
  --color-bg-diff-viewer-new-secondary: #011f19;

  --color-text-primary: #f1f3f5;
  --color-text-secondary: #999ba3;
  --color-text-tertiary: #8c8e95;
  --color-text-muted-light: #7b7d86;
  --color-text-muted: #585c75;
  --color-text-muted-dark: #3d4166;
  --color-text-dark: #333652;

  --color-border-dark: #222431;
  --color-border-dark-light: #2a2c3f;
  --color-border-dark-light-strong: #2a2c3f80;
  --color-border-default-dark: #333652;
  --color-border-default: #3d4166;
  --color-border-accent: #585c75;
  --color-border-light: #999ba3;

  --color-accent-primary: #585c75;
  --color-accent-secondary: #7b7d86;
  --color-accent-light: #999ba3;

  --color-success: #22c55e;
  --color-success-light: #4ade80;
  --color-success-subtle: #22c55e1a;
  --color-success-muted: #22c55e33;
  --color-success-emphasis: #22c55e4c;

  --color-warning: #d97706;
  --color-warning-subtle: #d9770619;
  --color-warning-emphasis: #d977064c;
  --color-warning-light: #f59e0b;
  --color-warning-text: #1a1a1a;

  --color-error: #ef4444;
  --color-error-dark: #991b1b;
  --color-error-subtle: #ef44441a;
  --color-error-muted: #ef444426;
  --color-error-emphasis: #ef44444c;
  --color-error-strong: #ef444480;
  --color-error-light: #f87171;
  --color-error-lighter: #fca5a5;
  --color-error-lightest: #fecaca;

  --color-info: #2563eb;
  --color-info-light: #3b82f6;
  --color-info-lighter: #60a5fa;
  --color-info-lightest: #93c5fd;
  --color-info-subtle: #2563eb1a;
  --color-info-light-muted: #2563eb33;
  --color-info-light-emphasis: #2563eb4c;

  // Button-specific colors
  --color-button-primary: #d97706;
  --color-button-primary-light: #f59e0b;
  --color-button-primary-subtle: #d9770619;
  --color-button-primary-emphasis: #d977064c;
  --color-button-primary-text: #1a1a1a;

  --color-button-secondary: #2563eb;
  --color-button-secondary-light: #3b82f6;
  --color-button-secondary-subtle: #2563eb1a;
  --color-button-secondary-emphasis: #2563eb4c;
  --color-button-secondary-text: #f1f3f5;

  --color-button-danger: #ef4444;
  --color-button-danger-light: #f87171;
  --color-button-danger-subtle: #ef44441a;
  --color-button-danger-emphasis: #ef44444c;
  --color-button-danger-text: #f1f3f5;

  --color-input-bg: #191a22;
  --color-input-border: #3d4166;
  --color-input-text: #f1f3f5;

  --color-agent-auto-approve: #4ade80;
  --color-agent-aider-tools: #fb923c;
  --color-agent-power-tools: #c084fc;
  --color-agent-todo-tools: #38bdf8;
  --color-agent-tasks-tools: #10b981;
  --color-agent-memory-tools: #f472b6;
  --color-agent-skills-tools: #c7d392;
  --color-agent-context-files: #facc15;
  --color-agent-repo-map: #60a5fa;
  --color-agent-ai-request: #884239;
  --color-agent-sub-agent: #3368a8;
}

================
File: src/renderer/src/themes/theme-forest.scss
================
.theme-forest {
  
  --color-bg-primary: #0f2419; 
  --color-bg-primary-light: #1a4d2e; 
  --color-bg-primary-light-strong: #1a4d2e80;
  --color-bg-secondary: #2d5a3d; 
  --color-bg-secondary-light: #3d6b4d; 
  --color-bg-secondary-light-strongest: #3d6b4df2;
  --color-bg-tertiary: #4a7c59; 
  --color-bg-tertiary-emphasis: #4a7c594c;
  --color-bg-tertiary-strong: #4a7c597f;
  --color-bg-fourth: #5d8a6a; 
  --color-bg-fourth-muted: #5d8a6a33;
  --color-bg-fourth-emphasis: #5d8a6a4c;
  --color-bg-fifth: #7fb069; 
  --color-bg-selection: #4a7c59;
  --color-bg-code-block: #0a1f14; 

  --color-bg-diff-viewer-old-primary: #4d2a1a; 
  --color-bg-diff-viewer-old-secondary: #3d1f0f; 
  --color-bg-diff-viewer-new-primary: #1a4d2a; 
  --color-bg-diff-viewer-new-secondary: #0f3d1f; 

  --color-text-primary: #f0f7f0; 
  --color-text-secondary: #d4e6d4; 
  --color-text-tertiary: #b8d4b8; 
  --color-text-muted-light: #9cc29c; 
  --color-text-muted: #7fb069; 
  --color-text-muted-dark: #5d8a6a; 
  --color-text-dark: #4a7c59; 

  --color-border-dark: #2d5a3d;
  --color-border-dark-light: #3d6b4d;
  --color-border-dark-light-strong: #3d6b4d80;
  --color-border-default-dark: #4a7c59;
  --color-border-default: #5d8a6a;
  --color-border-accent: #7fb069;
  --color-border-light: #9cc29c;

  --color-accent-primary: #7fb069; 
  --color-accent-secondary: #9cc29c; 
  --color-accent-light: #b8d4b8; 

  --color-success: #4a7c59; 
  --color-success-light: #5d8a6a;
  --color-success-subtle: #4a7c591a;
  --color-success-muted: #4a7c5933;
  --color-success-emphasis: #4a7c594c;

  --color-warning: #8b9a46; 
  --color-warning-subtle: #8b9a4619;
  --color-warning-emphasis: #8b9a464c;
  --color-warning-light: #a6b85c;
  --color-warning-text: #f0f7f0;

  --color-error: #c85a5a; 
  --color-error-dark: #a04040;
  --color-error-subtle: #c85a5a1a;
  --color-error-muted: #c85a5a26;
  --color-error-emphasis: #c85a5a4c;
  --color-error-strong: #c85a5a80;
  --color-error-light: #d47474;
  --color-error-lighter: #e09999;
  --color-error-lightest: #ecbfbf;

  --color-info: #4a7a9a;
  --color-info-light: #5d8fb0;
  --color-info-lighter: #7aa3c2;
  --color-info-lightest: #97b8d4;
  --color-info-subtle: #4a7a9a1a;
  --color-info-light-muted: #4a7a9a33;
  --color-info-light-emphasis: #4a7a9a4c;

  // Button-specific colors
  --color-button-primary: #7fb069;
  --color-button-primary-light: #8fc279;
  --color-button-primary-subtle: #7fb06919;
  --color-button-primary-emphasis: #7fb0694c;
  --color-button-primary-text: #0f2419;

  --color-button-secondary: #4a7a9a;
  --color-button-secondary-light: #5d8fb0;
  --color-button-secondary-subtle: #4a7a9a1a;
  --color-button-secondary-emphasis: #4a7a9a4c;
  --color-button-secondary-text: #f0f7f0;

  --color-button-danger: #c85a5a;
  --color-button-danger-light: #d47474;
  --color-button-danger-subtle: #c85a5a1a;
  --color-button-danger-emphasis: #c85a5a4c;
  --color-button-danger-text: #f0f7f0;

  --color-input-bg: #1a4d2e;
  --color-input-border: #5d8a6a;
  --color-input-text: #f0f7f0;

  --color-agent-auto-approve: #5d8a6a;
  --color-agent-aider-tools: #b8854a;
  --color-agent-power-tools: #8a6a9a;
  --color-agent-todo-tools: #4a7a9a;
  --color-agent-tasks-tools: #6a9a7a;
  --color-agent-memory-tools: #9a7a8a;
  --color-agent-skills-tools: #8b5a6a;
  --color-agent-context-files: #9a8a4a;
  --color-agent-repo-map: #6a8a9a;
  --color-agent-ai-request: #9a4a4a;
  --color-agent-sub-agent: #4a6a9a;
}

================
File: src/renderer/src/themes/theme-fresh.scss
================
.theme-fresh {
  // Background colors
  --color-bg-primary: #f8fafc;
  --color-bg-primary-light: #f1f5f9;
  --color-bg-primary-light-strong: #f1f5f980;
  --color-bg-secondary: #e2e8f0;
  --color-bg-secondary-light: #cbd5e1;
  --color-bg-secondary-light-strongest: #cbd5e1f2;
  --color-bg-tertiary: #94a3b8;
  --color-bg-tertiary-emphasis: #94a3b84c;
  --color-bg-tertiary-strong: #94a3b87f;
  --color-bg-fourth: #64748b;
  --color-bg-fourth-muted: #64748b33;
  --color-bg-fourth-emphasis: #64748b4c;
  --color-bg-fifth: #475569;
  --color-bg-selection: #94a3b8;
  --color-bg-code-block: #f8fafc;

  // Diff viewer colors
  --color-bg-diff-viewer-old-primary: #fee2e2;
  --color-bg-diff-viewer-old-secondary: #fecaca;
  --color-bg-diff-viewer-new-primary: #dcfce7;
  --color-bg-diff-viewer-new-secondary: #bbf7d0;

  // Text colors
  --color-text-primary: #0f172a;
  --color-text-secondary: #334155;
  --color-text-tertiary: #475569;
  --color-text-muted-light: #64748b;
  --color-text-muted: #94a3b8;
  --color-text-muted-dark: #cbd5e1;
  --color-text-dark: #e2e8f0;

  // Border colors
  --color-border-dark: #e2e8f0;
  --color-border-dark-light: #cbd5e1;
  --color-border-dark-light-strong: #cbd5e180;
  --color-border-default-dark: #94a3b8;
  --color-border-default: #64748b;
  --color-border-accent: #10b981;
  --color-border-light: #0f172a;

  // Accent colors
  --color-accent-primary: #10b981;
  --color-accent-secondary: #06b6d4;
  --color-accent-light: #0f172a;

  // Status colors
  --color-success: #10b981;
  --color-success-light: #34d399;
  --color-success-subtle: #10b9811a;
  --color-success-muted: #10b98133;
  --color-success-emphasis: #10b9814c;

  --color-warning: #f59e0b;
  --color-warning-subtle: #f59e0b19;
  --color-warning-emphasis: #f59e0b4c;
  --color-warning-light: #fbbf24;
  --color-warning-text: #0f172a;

  --color-error: #ef4444;
  --color-error-dark: #dc2626;
  --color-error-subtle: #ef44441a;
  --color-error-muted: #ef444426;
  --color-error-emphasis: #ef44444c;
  --color-error-strong: #ef444480;
  --color-error-light: #f87171;
  --color-error-lighter: #fca5a5;
  --color-error-lightest: #fecaca;

  --color-info: #3b82f6;
  --color-info-light: #60a5fa;
  --color-info-lighter: #93c5fd;
  --color-info-lightest: #dbeafe;
  --color-info-subtle: #3b82f61a;
  --color-info-light-muted: #3b82f633;
  --color-info-light-emphasis: #3b82f64c;

  // Button colors
  --color-button-primary: #10b981;
  --color-button-primary-light: #34d399;
  --color-button-primary-subtle: #10b98119;
  --color-button-primary-emphasis: #10b9814c;
  --color-button-primary-text: #ffffff;

  --color-button-secondary: #3b82f6;
  --color-button-secondary-light: #60a5fa;
  --color-button-secondary-subtle: #3b82f61a;
  --color-button-secondary-emphasis: #3b82f64c;
  --color-button-secondary-text: #ffffff;

  --color-button-danger: #ef4444;
  --color-button-danger-light: #f87171;
  --color-button-danger-subtle: #ef44441a;
  --color-button-danger-emphasis: #ef44444c;
  --color-button-danger-text: #ffffff;

  // Input colors
  --color-input-bg: #f8fafc;
  --color-input-border: #cbd5e1;
  --color-input-text: #0f172a;

  // Agent tool colors
  --color-agent-auto-approve: #10b981;
  --color-agent-aider-tools: #f59e0b;
  --color-agent-power-tools: #8b5cf6;
  --color-agent-todo-tools: #3b82f6;
  --color-agent-tasks-tools: #14b8a6;
  --color-agent-memory-tools: #f472b6;
  --color-agent-skills-tools: #a78bfa;
  --color-agent-context-files: #06b6d4;
  --color-agent-repo-map: #10b981;
  --color-agent-ai-request: #ef4444;
  --color-agent-sub-agent: #6366f1;
}

================
File: src/renderer/src/themes/theme-lavender.scss
================
.theme-lavender {
  
  --color-bg-primary: #2d1b4e; 
  --color-bg-primary-light: #3d2a5f; 
  --color-bg-primary-light-strong: #3d2a5f80;
  --color-bg-secondary: #4c3970; 
  --color-bg-secondary-light: #5b4881; 
  --color-bg-secondary-light-strongest: #5b4881f2;
  --color-bg-tertiary: #6a5792; 
  --color-bg-tertiary-emphasis: #6a57924c;
  --color-bg-tertiary-strong: #6a57927f;
  --color-bg-fourth: #7966a3; 
  --color-bg-fourth-muted: #7966a333;
  --color-bg-fourth-emphasis: #7966a34c;
  --color-bg-fifth: #8875b4; 
  --color-bg-selection: #6a5792;
  --color-bg-code-block: #1f0d3a; 

  --color-bg-diff-viewer-old-primary: #5d2a3d; 
  --color-bg-diff-viewer-old-secondary: #4a1f2e; 
  --color-bg-diff-viewer-new-primary: #2a4d3d; 
  --color-bg-diff-viewer-new-secondary: #1f3a2e; 

  --color-text-primary: #faf7ff; 
  --color-text-secondary: #e6d9ff; 
  --color-text-tertiary: #d1bbff; 
  --color-text-muted-light: #bc9dff; 
  --color-text-muted: #8875b4; 
  --color-text-muted-dark: #6a5792; 
  --color-text-dark: #4c3970; 

  --color-border-dark: #4c3970;
  --color-border-dark-light: #5b4881;
  --color-border-dark-light-strong: #5b488180;
  --color-border-default-dark: #6a5792;
  --color-border-default: #7966a3;
  --color-border-accent: #8875b4;
  --color-border-light: #bc9dff;

  --color-accent-primary: #8875b4; 
  --color-accent-secondary: #bc9dff; 
  --color-accent-light: #d1bbff; 

  --color-success: #6b8e5a; 
  --color-success-light: #7fa068;
  --color-success-subtle: #6b8e5a1a;
  --color-success-muted: #6b8e5a33;
  --color-success-emphasis: #6b8e5a4c;

  --color-warning: #b8864a; 
  --color-warning-subtle: #b8864a19;
  --color-warning-emphasis: #b8864a4c;
  --color-warning-light: #c9975c;
  --color-warning-text: #faf7ff;

  --color-error: #c85a7a; 
  --color-error-dark: #a04060;
  --color-error-subtle: #c85a7a1a;
  --color-error-muted: #c85a7a26;
  --color-error-emphasis: #c85a7a4c;
  --color-error-strong: #c85a7a80;
  --color-error-light: #d47490;
  --color-error-lighter: #e099b0;
  --color-error-lightest: #ecbfcf;

  --color-info: #5a7ac8;
  --color-info-light: #6c8cd4;
  --color-info-lighter: #8fa5e0;
  --color-info-lightest: #b2bdec;
  --color-info-subtle: #5a7ac81a;
  --color-info-light-muted: #5a7ac833;
  --color-info-light-emphasis: #5a7ac84c;

  // Button-specific colors
  --color-button-primary: #8875b4;
  --color-button-primary-light: #9a87c4;
  --color-button-primary-subtle: #8875b419;
  --color-button-primary-emphasis: #8875b44c;
  --color-button-primary-text: #faf7ff;

  --color-button-secondary: #5a7ac8;
  --color-button-secondary-light: #6c8cd4;
  --color-button-secondary-subtle: #5a7ac81a;
  --color-button-secondary-emphasis: #5a7ac84c;
  --color-button-secondary-text: #faf7ff;

  --color-button-danger: #c85a7a;
  --color-button-danger-light: #d47490;
  --color-button-danger-subtle: #c85a7a1a;
  --color-button-danger-emphasis: #c85a7a4c;
  --color-button-danger-text: #faf7ff;

  --color-input-bg: #3d2a5f;
  --color-input-border: #7966a3;
  --color-input-text: #faf7ff;

  --color-agent-auto-approve: #7fa068;
  --color-agent-aider-tools: #b8864a;
  --color-agent-power-tools: #8875b4;
  --color-agent-todo-tools: #5a7ac8;
  --color-agent-tasks-tools: #7a9a6a;
  --color-agent-memory-tools: #b48a9a;
  --color-agent-skills-tools: #c084fc;
  --color-agent-context-files: #a68b4a;
  --color-agent-repo-map: #6c8cd4;
  --color-agent-ai-request: #c85a7a;
  --color-agent-sub-agent: #5a7ac8;
}

================
File: src/renderer/src/themes/theme-light.scss
================
.theme-light {

  --color-bg-primary: #ffffff;
  --color-bg-primary-light: #f8f9fa;
  --color-bg-primary-light-strong: #f8f9fa80;
  --color-bg-secondary: #e9ecef;
  --color-bg-secondary-light: #dee2e6;
  --color-bg-secondary-light-strongest: #dee2e6f2;
  --color-bg-tertiary: #ced4da;
  --color-bg-tertiary-emphasis: #ced4da4c;
  --color-bg-tertiary-strong: #ced4da7f;
  --color-bg-fourth: #adb5bd;
  --color-bg-fourth-muted: #adb5bd33;
  --color-bg-fourth-emphasis: #adb5bd4c;
  --color-bg-fifth: #6c757d;
  --color-bg-selection: #ced4da;
  --color-bg-code-block: #f8f9fa;

  --color-bg-diff-viewer-old-primary: #fee2e2;
  --color-bg-diff-viewer-old-secondary: #fecaca;
  --color-bg-diff-viewer-new-primary: #dcfce7;
  --color-bg-diff-viewer-new-secondary: #bbf7d0;

  --color-text-primary: #212529;
  --color-text-secondary: #495057;
  --color-text-tertiary: #6c757d;
  --color-text-muted-light: #adb5bd;
  --color-text-muted: #6c757d;
  --color-text-muted-dark: #495057;
  --color-text-dark: #343a40;

  --color-border-dark: #e9ecef;
  --color-border-dark-light: #dee2e6;
  --color-border-dark-light-strong: #dee2e680;
  --color-border-default-dark: #ced4da;
  --color-border-default: #adb5bd;
  --color-border-accent: #6c757d;
  --color-border-light: #495057;

  --color-accent-primary: #6c757d;
  --color-accent-secondary: #adb5bd;
  --color-accent-light: #495057;

  --color-success: #22c55e;
  --color-success-light: #4ade80;
  --color-success-subtle: #22c55e1a;
  --color-success-muted: #22c55e33;
  --color-success-emphasis: #22c55e4c;

  --color-warning: #0ea5e9;
  --color-warning-subtle: #0ea5e919;
  --color-warning-emphasis: #0ea5e94c;
  --color-warning-light: #38bdf8;
  --color-warning-text: #ffffff;

  --color-error: #ef4444;
  --color-error-dark: #991b1b;
  --color-error-subtle: #ef44441a;
  --color-error-muted: #ef444426;
  --color-error-emphasis: #ef44444c;
  --color-error-strong: #ef444480;
  --color-error-light: #f87171;
  --color-error-lighter: #fca5a5;
  --color-error-lightest: #fecaca;

  --color-info: #2563eb;
  --color-info-light: #3b82f6;
  --color-info-lighter: #60a5fa;
  --color-info-lightest: #93c5fd;
  --color-info-subtle: #2563eb1a;
  --color-info-light-muted: #2563eb33;
  --color-info-light-emphasis: #2563eb4c;

  // Button-specific colors
  --color-button-primary: #0ea5e9;
  --color-button-primary-light: #38bdf8;
  --color-button-primary-subtle: #0ea5e919;
  --color-button-primary-emphasis: #0ea5e94c;
  --color-button-primary-text: #ffffff;

  --color-button-secondary: #2563eb;
  --color-button-secondary-light: #3b82f6;
  --color-button-secondary-subtle: #2563eb1a;
  --color-button-secondary-emphasis: #2563eb4c;
  --color-button-secondary-text: #ffffff;

  --color-button-danger: #ef4444;
  --color-button-danger-light: #f87171;
  --color-button-danger-subtle: #ef44441a;
  --color-button-danger-emphasis: #ef44444c;
  --color-button-danger-text: #ffffff;

  --color-input-bg: #f8f9fa;
  --color-input-border: #adb5bd;
  --color-input-text: #212529;

  --color-agent-auto-approve: #4ade80;
  --color-agent-aider-tools: #fb923c;
  --color-agent-power-tools: #c084fc;
  --color-agent-todo-tools: #38bdf8;
  --color-agent-tasks-tools: #059669;
  --color-agent-memory-tools: #ec4899;
  --color-agent-skills-tools: #9d42f3;
  --color-agent-context-files: #facc15;
  --color-agent-repo-map: #60a5fa;
  --color-agent-ai-request: #dc2626;
  --color-agent-sub-agent: #2563eb;
}

================
File: src/renderer/src/themes/theme-midnight.scss
================
.theme-midnight {

  --color-bg-primary: #000000;
  --color-bg-primary-light: #080808;
  --color-bg-primary-light-strong: #08080880;
  --color-bg-secondary: #101010;
  --color-bg-secondary-light: #181818;
  --color-bg-secondary-light-strongest: #181818f2;
  --color-bg-tertiary: #202020;
  --color-bg-tertiary-emphasis: #2020204c;
  --color-bg-tertiary-strong: #2020207f;
  --color-bg-fourth: #282828;
  --color-bg-fourth-muted: #28282833;
  --color-bg-fourth-emphasis: #2828284c;
  --color-bg-fifth: #303030;
  --color-bg-selection: #303030;
  --color-bg-code-block: #000000;

  --color-bg-diff-viewer-old-primary: #200000;
  --color-bg-diff-viewer-old-secondary: #100000;
  --color-bg-diff-viewer-new-primary: #002000;
  --color-bg-diff-viewer-new-secondary: #001000;

  --color-text-primary: #ffffff;
  --color-text-secondary: #e0e0e0;
  --color-text-tertiary: #c0c0c0;
  --color-text-muted-light: #a0a0a0;
  --color-text-muted: #808080;
  --color-text-muted-dark: #606060;
  --color-text-dark: #404040;

  --color-border-dark: #101010;
  --color-border-dark-light: #181818;
  --color-border-dark-light-strong: #18181880;
  --color-border-default-dark: #202020;
  --color-border-default: #282828;
  --color-border-accent: #303030;
  --color-border-light: #404040;

  --color-accent-primary: #303030;
  --color-accent-secondary: #282828;
  --color-accent-light: #404040;

  --color-success: #00ff00;
  --color-success-light: #40ff40;
  --color-success-subtle: #00ff001a;
  --color-success-muted: #00ff0033;
  --color-success-emphasis: #00ff004c;

  --color-warning: #ffff00;
  --color-warning-subtle: #ffff0019;
  --color-warning-emphasis: #ffff004c;
  --color-warning-light: #ffff40;
  --color-warning-text: #707020;

  --color-error: #ff0000;
  --color-error-dark: #800000;
  --color-error-subtle: #ff00001a;
  --color-error-muted: #ff000026;
  --color-error-emphasis: #ff00004c;
  --color-error-strong: #ff000080;
  --color-error-light: #ff4040;
  --color-error-lighter: #ff8080;
  --color-error-lightest: #ffc0c0;

  --color-info: #0000ff;
  --color-info-light: #4040ff;
  --color-info-lighter: #8080ff;
  --color-info-lightest: #c0c0ff;
  --color-info-subtle: #0000ff1a;
  --color-info-light-muted: #0000ff33;
  --color-info-light-emphasis: #0000ff4c;

  // Button-specific colors
  --color-button-primary: #ffff00;
  --color-button-primary-light: #ffff40;
  --color-button-primary-subtle: #ffff0019;
  --color-button-primary-emphasis: #ffff004c;
  --color-button-primary-text: #000000;

  --color-button-secondary: #0000ff;
  --color-button-secondary-light: #4040ff;
  --color-button-secondary-subtle: #0000ff1a;
  --color-button-secondary-emphasis: #0000ff4c;
  --color-button-secondary-text: #ffffff;

  --color-button-danger: #ff0000;
  --color-button-danger-light: #ff4040;
  --color-button-danger-subtle: #ff00001a;
  --color-button-danger-emphasis: #ff00004c;
  --color-button-danger-text: #ffffff;

  --color-input-bg: #080808;
  --color-input-border: #282828;
  --color-input-text: #ffffff;

  --color-agent-auto-approve: #00ff00;
  --color-agent-aider-tools: #ff8000;
  --color-agent-power-tools: #ff00ff;
  --color-agent-todo-tools: #00ffff;
  --color-agent-tasks-tools: #00ff88;
  --color-agent-memory-tools: #ff00aa;
  --color-agent-skills-tools: #ae7fa3;
  --color-agent-context-files: #ffff00;
  --color-agent-repo-map: #0080ff;
  --color-agent-ai-request: #ff0000;
  --color-agent-sub-agent: #0000ff;
}

================
File: src/renderer/src/themes/theme-neon.scss
================
.theme-neon {

  --color-bg-primary: #0d1117;
  --color-bg-primary-light: #161b22;
  --color-bg-primary-light-strong: #161b2280;
  --color-bg-secondary: #21262d;
  --color-bg-secondary-light: #30363d;
  --color-bg-secondary-light-strongest: #30363df2;
  --color-bg-tertiary: #484f58;
  --color-bg-tertiary-emphasis: #ff006680;
  --color-bg-tertiary-strong: #ff006640;
  --color-bg-fourth: #6e7681;
  --color-bg-fourth-muted: #00ffff33;
  --color-bg-fourth-emphasis: #00ffff4c;
  --color-bg-fifth: #8b949e;
  --color-bg-selection: #ff006640;
  --color-bg-code-block: #0a0e14;

  --color-bg-diff-viewer-old-primary: #67060c;
  --color-bg-diff-viewer-old-secondary: #490202;
  --color-bg-diff-viewer-new-primary: #033a16;
  --color-bg-diff-viewer-new-secondary: #0f2419;

  --color-text-primary: #ffffff;
  --color-text-secondary: #00ffff;
  --color-text-tertiary: #ff6600;
  --color-text-muted-light: #ff0099;
  --color-text-muted: #484f58;
  --color-text-muted-dark: #30363d;
  --color-text-dark: #21262d;

  --color-border-dark: #21262d;
  --color-border-dark-light: #30363d;
  --color-border-dark-light-strong: #30363d80;
  --color-border-default-dark: #484f58;
  --color-border-default: #00ffff;
  --color-border-accent: #ff0066;
  --color-border-light: #ffff00;

  --color-accent-primary: #00ffff;
  --color-accent-secondary: #ff0066;
  --color-accent-light: #ffff00;

  --color-success: #00ff88;
  --color-success-light: #44ff99;
  --color-success-subtle: #00ff881a;
  --color-success-muted: #00ff8833;
  --color-success-emphasis: #00ff884c;

  --color-warning: #ffaa00;
  --color-warning-subtle: #ffaa0019;
  --color-warning-emphasis: #ffaa004c;
  --color-warning-light: #ffcc33;
  --color-warning-text: #0d1117;

  --color-error: #ff3366;
  --color-error-dark: #cc0044;
  --color-error-subtle: #ff33661a;
  --color-error-muted: #ff336626;
  --color-error-emphasis: #ff33664c;
  --color-error-strong: #ff336680;
  --color-error-light: #ff6699;
  --color-error-lighter: #ff99bb;
  --color-error-lightest: #ffccdd;

  --color-info: #3366ff;
  --color-info-light: #6699ff;
  --color-info-lighter: #99ccff;
  --color-info-lightest: #cce6ff;
  --color-info-subtle: #3366ff1a;
  --color-info-light-muted: #3366ff33;
  --color-info-light-emphasis: #3366ff4c;

  // Button-specific colors
  --color-button-primary: #00ffff;
  --color-button-primary-light: #33ffff;
  --color-button-primary-subtle: #00ffff19;
  --color-button-primary-emphasis: #00ffff4c;
  --color-button-primary-text: #0d1117;

  --color-button-secondary: #3366ff;
  --color-button-secondary-light: #6699ff;
  --color-button-secondary-subtle: #3366ff1a;
  --color-button-secondary-emphasis: #3366ff4c;
  --color-button-secondary-text: #ffffff;

  --color-button-danger: #ff3366;
  --color-button-danger-light: #ff6699;
  --color-button-danger-subtle: #ff33661a;
  --color-button-danger-emphasis: #ff33664c;
  --color-button-danger-text: #ffffff;

  --color-input-bg: #161b22;
  --color-input-border: #00ffff;
  --color-input-text: #ffffff;

  --color-agent-auto-approve: #00ff88;
  --color-agent-aider-tools: #ff9900;
  --color-agent-power-tools: #cc66ff;
  --color-agent-todo-tools: #3366ff;
  --color-agent-tasks-tools: #00ffcc;
  --color-agent-memory-tools: #ff66cc;
  --color-agent-skills-tools: #8ac3e1;
  --color-agent-context-files: #ffcc00;
  --color-agent-repo-map: #00ccff;
  --color-agent-ai-request: #ff0066;
  --color-agent-sub-agent: #0099ff;
}

================
File: src/renderer/src/themes/theme-neopunk.scss
================
.theme-neopunk {

  --color-bg-primary: #0a0a0f;
  --color-bg-primary-light: #14141e;
  --color-bg-primary-light-strong: #14141e80;
  --color-bg-secondary: #1a1a2e;
  --color-bg-secondary-light: #16213e;
  --color-bg-secondary-light-strongest: #16213ef2;
  --color-bg-tertiary: #0f3460;
  --color-bg-tertiary-emphasis: #ff00ff4c;
  --color-bg-tertiary-strong: #ff00ff7f;
  --color-bg-fourth: #16213e;
  --color-bg-fourth-muted: #00ffff33;
  --color-bg-fourth-emphasis: #00ffff4c;
  --color-bg-fifth: #e94560;
  --color-bg-selection: #ff00ff40;
  --color-bg-code-block: #050508;

  --color-bg-diff-viewer-old-primary: #4a0e0e;
  --color-bg-diff-viewer-old-secondary: #2a0808;
  --color-bg-diff-viewer-new-primary: #0a4a2a;
  --color-bg-diff-viewer-new-secondary: #062a18;

  --color-text-primary: #ffffff;
  --color-text-secondary: #00ffff;
  --color-text-tertiary: #ff00ff;
  --color-text-muted-light: #00ff88;
  --color-text-muted: #0f3460;
  --color-text-muted-dark: #16213e;
  --color-text-dark: #1a1a2e;

  --color-border-dark: #1a1a2e;
  --color-border-dark-light: #16213e;
  --color-border-dark-light-strong: #16213e80;
  --color-border-default-dark: #0f3460;
  --color-border-default: #00ffff;
  --color-border-accent: #ff00ff;
  --color-border-light: #00ff88;

  --color-accent-primary: #00ffff;
  --color-accent-secondary: #ff00ff;
  --color-accent-light: #00ff88;

  --color-success: #00ff88;
  --color-success-light: #44ff99;
  --color-success-subtle: #00ff881a;
  --color-success-muted: #00ff8833;
  --color-success-emphasis: #00ff884c;

  --color-warning: #ffaa00;
  --color-warning-subtle: #ffaa0019;
  --color-warning-emphasis: #ffaa004c;
  --color-warning-light: #ffcc33;
  --color-warning-text: #0a0a0f;

  --color-error: #ff3366;
  --color-error-dark: #cc0044;
  --color-error-subtle: #ff33661a;
  --color-error-muted: #ff336626;
  --color-error-emphasis: #ff33664c;
  --color-error-strong: #ff336680;
  --color-error-light: #ff6699;
  --color-error-lighter: #ff99bb;
  --color-error-lightest: #ffccdd;

  --color-info: #3366ff;
  --color-info-light: #6699ff;
  --color-info-lighter: #99ccff;
  --color-info-lightest: #cce6ff;
  --color-info-subtle: #3366ff1a;
  --color-info-light-muted: #3366ff33;
  --color-info-light-emphasis: #3366ff4c;

  // Button-specific colors
  --color-button-primary: #ffaa00;
  --color-button-primary-light: #ffcc33;
  --color-button-primary-subtle: #ffaa0019;
  --color-button-primary-emphasis: #ffaa004c;
  --color-button-primary-text: #0a0a0f;

  --color-button-secondary: #3366ff;
  --color-button-secondary-light: #6699ff;
  --color-button-secondary-subtle: #3366ff1a;
  --color-button-secondary-emphasis: #3366ff4c;
  --color-button-secondary-text: #ffffff;

  --color-button-danger: #ff3366;
  --color-button-danger-light: #ff6699;
  --color-button-danger-subtle: #ff33661a;
  --color-button-danger-emphasis: #ff33664c;
  --color-button-danger-text: #ffffff;

  --color-input-bg: #14141e;
  --color-input-border: #00ffff;
  --color-input-text: #ffffff;

  --color-agent-auto-approve: #00ff88;
  --color-agent-aider-tools: #ff6600;
  --color-agent-power-tools: #ff00ff;
  --color-agent-todo-tools: #00ccff;
  --color-agent-tasks-tools: #00ffaa;
  --color-agent-memory-tools: #ff00aa;
  --color-agent-skills-tools: #2bbc20;
  --color-agent-context-files: #ffff00;
  --color-agent-repo-map: #ff0099;
  --color-agent-ai-request: #ff3366;
  --color-agent-sub-agent: #3366ff;
}

================
File: src/renderer/src/themes/theme-ocean.scss
================
.theme-ocean {

  --color-bg-primary: #0c4a6e;
  --color-bg-primary-light: #075985;
  --color-bg-primary-light-strong: #07598580;
  --color-bg-secondary: #0369a1;
  --color-bg-secondary-light: #0284c7;
  --color-bg-secondary-light-strongest: #0284c7f2;
  --color-bg-tertiary: #0ea5e9;
  --color-bg-tertiary-emphasis: #0ea5e94c;
  --color-bg-tertiary-strong: #0ea5e97f;
  --color-bg-fourth: #38bdf8;
  --color-bg-fourth-muted: #38bdf833;
  --color-bg-fourth-emphasis: #38bdf84c;
  --color-bg-fifth: #7dd3fc;
  --color-bg-selection: #0ea5e9;
  --color-bg-code-block: #082f49;

  --color-bg-diff-viewer-old-primary: #7c2d12;
  --color-bg-diff-viewer-old-secondary: #571c0c;
  --color-bg-diff-viewer-new-primary: #134e4a;
  --color-bg-diff-viewer-new-secondary: #0f3027;

  --color-text-primary: #f0f9ff;
  --color-text-secondary: #bae6fd;
  --color-text-tertiary: #7dd3fc;
  --color-text-muted-light: #38bdf8;
  --color-text-muted: #0ea5e9;
  --color-text-muted-dark: #0284c7;
  --color-text-dark: #0369a1;

  --color-border-dark: #0369a1;
  --color-border-dark-light: #0284c7;
  --color-border-dark-light-strong: #0284c780;
  --color-border-default-dark: #0ea5e9;
  --color-border-default: #38bdf8;
  --color-border-accent: #7dd3fc;
  --color-border-light: #bae6fd;

  --color-accent-primary: #7dd3fc;
  --color-accent-secondary: #38bdf8;
  --color-accent-light: #bae6fd;

  --color-success: #06b6d4;
  --color-success-light: #22d3ee;
  --color-success-subtle: #06b6d41a;
  --color-success-muted: #06b6d433;
  --color-success-emphasis: #06b6d44c;

  --color-warning: #f59e0b;
  --color-warning-subtle: #f59e0b19;
  --color-warning-emphasis: #f59e0b4c;
  --color-warning-light: #fbbf24;
  --color-warning-text: #0c4a6e;

  --color-error: #dc2626;
  --color-error-dark: #991b1b;
  --color-error-subtle: #dc26261a;
  --color-error-muted: #dc262626;
  --color-error-emphasis: #dc26264c;
  --color-error-strong: #dc262680;
  --color-error-light: #ef4444;
  --color-error-lighter: #f87171;
  --color-error-lightest: #fecaca;

  --color-info: #0ea5e9;
  --color-info-light: #38bdf8;
  --color-info-lighter: #7dd3fc;
  --color-info-lightest: #bae6fd;
  --color-info-subtle: #0ea5e91a;
  --color-info-light-muted: #0ea5e933;
  --color-info-light-emphasis: #0ea5e94c;

  // Button-specific colors
  --color-button-primary: #7dd3fc;
  --color-button-primary-light: #bae6fd;
  --color-button-primary-subtle: #7dd3fc19;
  --color-button-primary-emphasis: #7dd3fc4c;
  --color-button-primary-text: #0c4a6e;

  --color-button-secondary: #0ea5e9;
  --color-button-secondary-light: #38bdf8;
  --color-button-secondary-subtle: #0ea5e91a;
  --color-button-secondary-emphasis: #0ea5e94c;
  --color-button-secondary-text: #f0f9ff;

  --color-button-danger: #dc2626;
  --color-button-danger-light: #ef4444;
  --color-button-danger-subtle: #dc26261a;
  --color-button-danger-emphasis: #dc26264c;
  --color-button-danger-text: #f0f9ff;

  --color-input-bg: #075985;
  --color-input-border: #38bdf8;
  --color-input-text: #f0f9ff;

  --color-agent-auto-approve: #22d3ee;
  --color-agent-aider-tools: #f59e0b;
  --color-agent-power-tools: #8b5cf6;
  --color-agent-todo-tools: #38bdf8;
  --color-agent-tasks-tools: #14b8a6;
  --color-agent-memory-tools: #a78bfa;
  --color-agent-skills-tools: #3d92cd;
  --color-agent-context-files: #06b6d4;
  --color-agent-repo-map: #60a5fa;
  --color-agent-ai-request: #dc2626;
  --color-agent-sub-agent: #1d4ed8;
}

================
File: src/renderer/src/themes/theme-serenity.scss
================
.theme-serenity {

  --color-bg-primary: #e8e6e3;
  --color-bg-primary-light: #e2e0dc;
  --color-bg-primary-light-strong: #e2e0dc80;
  --color-bg-secondary: #d9d6d1;
  --color-bg-secondary-light: #cfc9c2;
  --color-bg-secondary-light-strongest: #cfc9c2f2;
  --color-bg-tertiary: #c4bdb4;
  --color-bg-tertiary-emphasis: #c4bdb44c;
  --color-bg-tertiary-strong: #c4bdb47f;
  --color-bg-fourth: #b5aca0;
  --color-bg-fourth-muted: #b5aca033;
  --color-bg-fourth-emphasis: #b5aca04c;
  --color-bg-fifth: #9d9186;
  --color-bg-selection: #c4bdb4;
  --color-bg-code-block: #f8f3ee;

  --color-bg-diff-viewer-old-primary: #fee2e2;
  --color-bg-diff-viewer-old-secondary: #fecaca;
  --color-bg-diff-viewer-new-primary: #dcfce7;
  --color-bg-diff-viewer-new-secondary: #bbf7d0;

  --color-text-primary: #3a3530;
  --color-text-secondary: #4a453f;
  --color-text-tertiary: #5a544d;
  --color-text-muted-light: #8a7f73;
  --color-text-muted: #6a5f53;
  --color-text-muted-dark: #4a453f;
  --color-text-dark: #2a251f;

  --color-border-dark: #d9d6d1;
  --color-border-dark-light: #cfc9c2;
  --color-border-dark-light-strong: #cfc9c280;
  --color-border-default-dark: #c4bdb4;
  --color-border-default: #b5aca0;
  --color-border-accent: #9d9186;
  --color-border-light: #5a544d;

  --color-accent-primary: #7a6b5d;
  --color-accent-secondary: #9d8b7a;
  --color-accent-light: #b5a394;

  --color-success: #6b8e5a;
  --color-success-light: #8ba876;
  --color-success-subtle: #6b8e5a1a;
  --color-success-muted: #6b8e5a33;
  --color-success-emphasis: #6b8e5a4c;

  --color-warning: #b8956a;
  --color-warning-subtle: #b8956a19;
  --color-warning-emphasis: #b8956a4c;
  --color-warning-light: #d4b887;
  --color-warning-text: #ffffff;

  --color-error: #a66b5b;
  --color-error-dark: #8b5a4a;
  --color-error-subtle: #a66b5b1a;
  --color-error-muted: #a66b5b26;
  --color-error-emphasis: #a66b5b4c;
  --color-error-strong: #a66b5b80;
  --color-error-light: #c18a7a;
  --color-error-lighter: #d4a394;
  --color-error-lightest: #e8c4b8;

  --color-info: #7a8ba6;
  --color-info-light: #9aa8bd;
  --color-info-lighter: #b5c2d1;
  --color-info-lightest: #d1dae6;
  --color-info-subtle: #7a8ba61a;
  --color-info-light-muted: #7a8ba633;
  --color-info-light-emphasis: #7a8ba64c;

  // Button-specific colors
  --color-button-primary: #7a6b5d;
  --color-button-primary-light: #9d8b7a;
  --color-button-primary-subtle: #7a6b5d1a;
  --color-button-primary-emphasis: #7a6b5d4c;
  --color-button-primary-text: #f5f2ed;

  --color-button-secondary: #5a544d;
  --color-button-secondary-light: #6a5f53;
  --color-button-secondary-subtle: #5a544d1a;
  --color-button-secondary-emphasis: #5a544d4c;
  --color-button-secondary-text: #f5f2ed;

  --color-button-danger: #a66b5b;
  --color-button-danger-light: #c18a7a;
  --color-button-danger-subtle: #a66b5b1a;
  --color-button-danger-emphasis: #a66b5b4c;
  --color-button-danger-text: #f5f2ed;

  --color-input-bg: #ddd9d4;
  --color-input-border: #b5aca0;
  --color-input-text: #3a3530;

  --color-agent-auto-approve: #8ba876;
  --color-agent-aider-tools: #d4b887;
  --color-agent-power-tools: #b5a394;
  --color-agent-todo-tools: #9aa8bd;
  --color-agent-tasks-tools: #8a7f73;
  --color-agent-memory-tools: #9d8b7a;
  --color-agent-skills-tools: #a68a7a;
  --color-agent-context-files: #c9b896;
  --color-agent-repo-map: #b5c2d1;
  --color-agent-ai-request: #a66b5b;
  --color-agent-sub-agent: #7a8ba6;
}

================
File: src/renderer/src/themes/themes.scss
================
@use 'theme-dark.scss';
@use 'theme-light.scss';
@use 'theme-bw.scss';
@use 'theme-midnight.scss';
@use 'theme-neon.scss';
@use 'theme-ocean.scss';
@use 'theme-forest.scss';
@use 'theme-charcoal.scss';
@use 'theme-lavender.scss';
@use 'theme-neopunk.scss';
@use 'theme-aurora.scss';
@use 'theme-serenity.scss';
@use 'theme-cappuccino.scss';
@use 'theme-fresh.scss';
@use 'theme-botanical-garden.scss';
@use 'theme-botanical-garden-dark.scss';

================
File: src/renderer/src/types/message.ts
================
import { Group, PromptContext, TaskData, TokensInfoData, UsageReportData } from '@common/types';
⋮----
export interface Message {
  id: string;
  type: 'user' | 'response' | 'loading' | 'reflected-message' | 'command-output' | 'log' | 'tokens-info' | 'tool' | 'group' | 'task-info' | 'assistant-group';
  content: string;
  promptContext?: PromptContext;
  children?: Message[];
}
⋮----
export interface UserMessage extends Message {
  type: 'user';
  isOptimistic?: boolean;
}
⋮----
export interface ResponseMessage extends Message {
  type: 'response';
  usageReport?: UsageReportData;
}
⋮----
export interface ReflectedMessage extends Message {
  type: 'reflected-message';
  responseMessageId: string;
}
⋮----
export interface LogMessage extends Message {
  type: 'log';
  level: 'info' | 'warning' | 'error';
  actionIds?: string[];
}
⋮----
export interface LoadingMessage extends Message {
  type: 'loading';
  actionIds?: string[];
}
⋮----
export interface CommandOutputMessage extends Message {
  type: 'command-output';
  command: string;
}
⋮----
export interface TokensInfoMessage extends Message {
  type: 'tokens-info';
  info: TokensInfoData;
}
⋮----
export interface ToolMessage extends Message {
  type: 'tool';
  serverName: string;
  toolName: string;
  args: Record<string, unknown>;
  content: string; // Empty while executing, contains result when complete
  usageReport?: UsageReportData;
  finished?: boolean;
}
⋮----
content: string; // Empty while executing, contains result when complete
⋮----
export const isUserMessage = (message: Message): message is UserMessage =>
⋮----
export const isResponseMessage = (message: Message): message is ResponseMessage =>
⋮----
export const isLogMessage = (message: Message): message is LogMessage =>
⋮----
export const isLoadingMessage = (message: Message): message is LoadingMessage =>
⋮----
export const isReflectedMessage = (message: Message): message is ReflectedMessage =>
⋮----
export const isCommandOutputMessage = (message: Message): message is CommandOutputMessage =>
⋮----
export const isTokensInfoMessage = (message: Message): message is TokensInfoMessage =>
⋮----
export const isToolMessage = (message: Message): message is ToolMessage =>
⋮----
export interface GroupMessage extends Message {
  type: 'group';
  group: Group;
  children: Message[];
}
⋮----
export const isGroupMessage = (message: Message): message is GroupMessage =>
⋮----
export interface TaskInfoMessage extends Message {
  type: 'task-info';
  task: TaskData;
  messageCount: number;
}
⋮----
export const isTaskInfoMessage = (message: Message): message is TaskInfoMessage =>
⋮----
export interface AssistantGroupMessage extends Message {
  type: 'assistant-group';
  responseMessage: ResponseMessage;
  toolMessages: ToolMessage[];
}
⋮----
export const isAssistantGroupMessage = (message: Message): message is AssistantGroupMessage =>

================
File: src/renderer/src/utils/agents.ts
================
import { AgentProfile, TaskData } from '@common/types';
⋮----
/**
 * Resolves the active agent profile for a task following the correct hierarchy:
 * 1. Task-level agent profile ID
 * 2. Project-level agent profile ID (fallback)
 * 3. Creates temporary profile if task has provider/model
 */
export const resolveAgentProfile = (task: TaskData | undefined, projectAgentProfileId: string | undefined, profiles: AgentProfile[]): AgentProfile | null =>
⋮----
// Check task-level agent profile first
⋮----
// If no task-level profile, fall back to project-level
⋮----
// Create a profile with task-level overrides

================
File: src/renderer/src/utils/bmad-suggestions.ts
================
import { BMAD_WORKFLOWS } from '@common/bmad-workflows';
import { WorkflowArtifacts, SprintStatusData, StoryStatus, WorkflowMetadata, WorkflowPhase } from '@common/bmad-types';
⋮----
/**
 * Simple glob pattern matching for artifact paths
 */
const matchesPattern = (pathToMatch: string, pattern: string): boolean =>
⋮----
// Convert glob pattern to regex
⋮----
.replace(/\./g, '\\.') // Escape dots
.replace(/\*/g, '.*'); // Replace * with .*
⋮----
/**
 * Calculate prerequisite satisfaction score for a workflow
 * Higher score = more prerequisites satisfied
 */
const getPrerequisiteScore = (workflow: WorkflowMetadata | undefined, detectedArtifacts: WorkflowArtifacts['detectedArtifacts']): number =>
⋮----
// No prerequisites = high priority
⋮----
// Check how many prerequisites are satisfied
⋮----
// Check if any detected artifact matches the required pattern
⋮----
// Return percentage of satisfied prerequisites
⋮----
/**
 * Get workflow suggestions based on story statuses in sprint-status.yaml
 */
const getSprintStatusSuggestions = (sprintStatus: SprintStatusData | undefined): string[] =>
⋮----
/**
 * Determine if the user is on the Quick Flow path based on completed workflows
 */
const isOnQuickPath = (completedWorkflows: string[]): boolean =>
⋮----
/**
 * Determine if the user is on the Full Workflow path based on completed workflows
 */
const isOnFullPath = (completedWorkflows: string[]): boolean =>
⋮----
/**
 * Generate smart workflow suggestions based on completed workflows, detected artifacts, and task metadata
 * Implements greenfield/brownfield detection and prerequisite checking
 * Ensures suggestions include next steps from both Full and Quick paths
 * Prioritizes follow-ups from the currently executing workflow
 */
export const generateSuggestions = (
  completedWorkflows: string[],
  detectedArtifacts: WorkflowArtifacts['detectedArtifacts'],
  sprintStatus?: SprintStatusData,
  taskMetadata?: Record<string, unknown>,
): string[] =>
⋮----
// No workflows completed - suggest entry points for both paths
⋮----
// Get the currently executing workflow ID from metadata (if available)
⋮----
// Collect followUps from completed workflows
⋮----
// Collect follow-ups from all completed workflows
⋮----
// Add suggestions based on story statuses in sprint-status.yaml
⋮----
// Ensure both paths are represented in suggestions
⋮----
// If on Quick path, also suggest Full path entry point if not already suggested/completed
⋮----
// If on Full path, also suggest Quick path entry point if not already suggested/completed
⋮----
// If we have a current workflow, filter to only include its follow-ups
⋮----
// Filter out already completed workflows
⋮----
// Sort suggestions: prioritize follow-ups from current workflow, then by satisfied prerequisites
⋮----
// If current workflow has follow-ups, prioritize them
⋮----
// Higher score first (more prerequisites satisfied)

================
File: src/renderer/src/utils/browser-notifications.ts
================
export const requestNotificationPermission = async (): Promise<boolean> =>
⋮----
// eslint-disable-next-line no-console
⋮----
export const showNotification = async (title: string, body: string): Promise<void> =>

================
File: src/renderer/src/utils/highlighter.tsx
================
import { common, createLowlight } from 'lowlight';
import { refractor } from 'refractor/all';
import { ReactNode, Fragment } from 'react';
import { toJsxRuntime } from 'hast-util-to-jsx-runtime';
import { jsx, jsxs } from 'react/jsx-runtime';
import { Nodes, Root, Element, Text, Comment, Doctype } from 'hast';
import { map } from 'unist-util-map';
⋮----
// Create lowlight instance with common languages
⋮----
/**
 * Maps standard highlighting classes to Prism-compatible token classes.
 * These mappings ensure that Highlight.js (lowlight) classes are translated
 * to the classes expected by the Prism-based theme.css.
 */
const mapToPrismClass = (className: string): string =>
⋮----
/**
 * Converts HAST nodes to React elements using hast-util-to-jsx-runtime
 * This is more performant and robust than manual conversion.
 */
export const renderHast = (nodes: Nodes | Nodes[], usePrismClasses = false): ReactNode =>
⋮----
// If the class is already 'token', don't duplicate it
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
⋮----
// eslint-disable-next-line @typescript-eslint/no-explicit-any
⋮----
/**
 * Highlights code using lowlight (best for auto-detection)
 */
export const highlightWithLowlight = (code: string, language?: string): ReactNode =>
⋮----
// Fallback to auto-detection
⋮----
// eslint-disable-next-line no-console
⋮----
/**
 * Highlights code using refractor (best for diffs/Prism compatibility)
 */
export const highlightWithRefractor = (code: string, language: string): ReactNode =>
⋮----
// refractor.highlight returns a Root node
⋮----
// eslint-disable-next-line no-console

================
File: src/renderer/src/utils/hotkeys.ts
================
import { HotkeyConfig } from '@common/types';
⋮----
export const getHotkeys = (config?: HotkeyConfig) =>

================
File: src/renderer/src/utils/indexedDB.ts
================
interface DBEntry<T> {
  id: string;
  data: T;
  createdAt: number;
  updatedAt: number;
}
⋮----
interface IndexedDBConfig {
  dbName: string;
  version: number;
  stores: Record<string, string>;
}
⋮----
class IndexedDBManager
⋮----
constructor(private config: IndexedDBConfig)
⋮----
private async init(): Promise<void>
⋮----
// Create object stores
⋮----
// Create indexes for common queries
⋮----
private async getStore(storeName: string, mode: IDBTransactionMode = 'readonly'): Promise<IDBObjectStore>
⋮----
async get<T>(storeName: string, id: string): Promise<T | null>
⋮----
// eslint-disable-next-line no-console
⋮----
async set<T>(storeName: string, id: string, data: T): Promise<void>
⋮----
// eslint-disable-next-line no-console
⋮----
async remove(storeName: string, id: string): Promise<void>
⋮----
// eslint-disable-next-line no-console
⋮----
async clearExpired(storeName: string, ttlMs: number): Promise<void>
⋮----
// eslint-disable-next-line no-console
⋮----
async getAll<T>(storeName: string): Promise<Array<
⋮----
// eslint-disable-next-line no-console
⋮----
// Create a singleton instance for UI preferences

================
File: src/renderer/src/utils/notifications.ts
================
import { toast } from 'react-toastify';
⋮----
import type { ToastOptions } from 'react-toastify';
⋮----
const getOptions = (): ToastOptions => (
⋮----
export const showSuccessNotification = (message: string) =>
⋮----
export const showErrorNotification = (message: string, autoClose: number | false = 3000) =>
⋮----
export const showInfoNotification = (message: string) =>
⋮----
export const showWarningNotification = (message: string) =>

================
File: src/renderer/src/utils/path-utils.ts
================
export const getPathBasename = (inputPath: string): string =>

================
File: src/renderer/src/utils/routes.ts
================
// URL parameter utilities for direct project/task navigation
⋮----
/**
 * Encodes a baseDir for use in URL parameters
 * @param baseDir - The project base directory path
 * @returns URL-encoded baseDir
 */
export const encodeBaseDir = (baseDir: string): string =>
⋮----
/**
 * Decodes a baseDir from URL parameters
 * @param encodedBaseDir - The URL-encoded baseDir
 * @returns Decoded baseDir path
 */
export const decodeBaseDir = (encodedBaseDir: string): string =>

================
File: src/renderer/src/utils/string-utils.ts
================
import type { TFunction } from 'i18next';
⋮----
export const formatHumanReadable = (t: TFunction, value: number): string =>

================
File: src/renderer/src/utils/task-utils.ts
================
import { TaskData } from '@common/types';
⋮----
const getMostRecentUpdatedAt = (task: TaskData, allTasks: TaskData[]): string | undefined =>
⋮----
export const getSortedVisibleTasks = (tasks: TaskData[], showArchived: boolean = false, searchQuery: string = ''): TaskData[] =>
⋮----
// When showArchived is false, exclude tasks whose parent is archived
// Check each task's parent exists in the original tasks and is not archived
⋮----
// Find the parent in the original tasks array
⋮----
// Include the task if:
// - showArchived is true (show everything), OR
// - parent doesn't exist (orphan), OR
// - parent exists and is not archived
⋮----
const sortFn = (a: TaskData, b: TaskData) =>
⋮----
// Pinned tasks come first
⋮----
// Then sort by most recent updatedAt (including subtasks, descending)
⋮----
const addTaskWithChildren = (task: TaskData) =>

================
File: src/renderer/src/voice/gemini.ts
================
import { GoogleGenAI, LiveServerMessage, Session } from '@google/genai';
⋮----
import { VoiceProvider, VoiceSession, VoiceSessionConfig, VoiceSessionState } from './types';
⋮----
export class GeminiVoiceProvider implements VoiceProvider
⋮----
// Silence detection refs
⋮----
// Session management refs
⋮----
async startSession(config: VoiceSessionConfig): Promise<VoiceSession>
⋮----
// Setup audio processing once and keep it alive
⋮----
private async createGeminiSession(config: VoiceSessionConfig): Promise<VoiceSession>
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
// Initialize silence detection
⋮----
async stopSession(): Promise<void>
⋮----
// Clear session timer
⋮----
// Clear silence detection timeout
⋮----
// Close Gemini session
⋮----
// Cleanup audio processing
⋮----
// Clear audio queue
⋮----
private async closeGeminiSession(): Promise<void>
⋮----
// eslint-disable-next-line no-console
⋮----
private async setupAudioProcessing(stream: MediaStream): Promise<void>
⋮----
// Calculate RMS to detect audio level
⋮----
// Check if audio level is above threshold (adjust as needed)
const audioThreshold = 0.01; // Threshold for detecting audio input
⋮----
// Reset the silence timer when audio is detected
⋮----
// Clear existing timeout
⋮----
// Check for silence
⋮----
// Send directly to active session
⋮----
// Queue audio when session is inactive but audio processing is active
⋮----
private handleMessage(message: LiveServerMessage): void
⋮----
private convertFloat32ToInt16(float32Array: Float32Array): Int16Array
⋮----
private arrayBufferToBase64(buffer: ArrayBuffer): string
⋮----
private setState(newState: VoiceSessionState): void
⋮----
private startSessionTimer(): void
⋮----
// Restart session every 30 seconds
⋮----
private async restartSession(): Promise<void>
⋮----
// Don't set external state to INACTIVE - keep it as ACTIVE from user perspective
⋮----
// eslint-disable-next-line no-console
⋮----
// Close current session but keep audio processing
⋮----
// Start new session without tearing down audio processing
⋮----
private queueAudioData(base64Audio: string): void
⋮----
// Limit queue size to prevent memory issues
⋮----
this.audioQueue.shift(); // Remove oldest
⋮----
private flushAudioQueue(): void
⋮----
// Factory function
export const createGeminiVoiceProvider = (): VoiceProvider =>

================
File: src/renderer/src/voice/index.ts
================
// Future exports: export * from './anthropic';

================
File: src/renderer/src/voice/openai.ts
================
import { VoiceProvider, VoiceSession, VoiceSessionConfig, VoiceSessionState } from './types';
⋮----
export class OpenAIVoiceProvider implements VoiceProvider
⋮----
async startSession(config: VoiceSessionConfig): Promise<VoiceSession>
⋮----
private async connectWebRTC(): Promise<void>
⋮----
// Create a peer connection
⋮----
// Add local audio track for microphone input in the browser
⋮----
// Set up data channel for sending and receiving events
⋮----
// Start the session using the Session Description Protocol (SDP)
⋮----
// eslint-disable-next-line no-console
⋮----
// Listen for server events
⋮----
// eslint-disable-next-line no-console
⋮----
// eslint-disable-next-line no-console
⋮----
async stopSession(): Promise<void>
⋮----
private setState(newState: VoiceSessionState): void
⋮----
// Factory function
export const createOpenAIVoiceProvider = (): VoiceProvider =>

================
File: src/renderer/src/voice/types.ts
================
export interface VoiceProvider {
  name: string;
  startSession(config: VoiceSessionConfig): Promise<VoiceSession>;
  stopSession(): Promise<void>;
  onTranscription?: (text: string) => void;
  onError?: (error: Error) => void;
  onSessionStateChange?: (state: VoiceSessionState) => void;
}
⋮----
startSession(config: VoiceSessionConfig): Promise<VoiceSession>;
stopSession(): Promise<void>;
⋮----
export interface VoiceSessionConfig {
  token: string;
  model: string;
  mediaStream: MediaStream;
  idleTimeoutMs: number;
  onTranscription: (text: string) => void;
  onError: (error: Error) => void;
  onSessionStateChange?: (state: VoiceSessionState) => void;
  onStopRecording?: () => void;
}
⋮----
export interface VoiceSession {
  isActive: boolean;
  provider: VoiceProvider;
}
⋮----
export enum VoiceSessionState {
  IDLE = 'idle',
  CONNECTING = 'connecting',
  ACTIVE = 'active',
  ERROR = 'error',
  CLOSED = 'closed',
}

================
File: src/renderer/src/App.tsx
================
import { AnimatePresence, motion } from 'framer-motion';
import { useEffect, useState } from 'react';
import { HashRouter as Router, Navigate, Route, Routes, useLocation } from 'react-router-dom';
import { ToastContainer } from 'react-toastify';
import { useTranslation } from 'react-i18next';
import { THEMES } from '@common/types';
import { IconContext } from 'react-icons';
⋮----
import { Onboarding } from '@/pages/Onboarding';
import { Home } from '@/pages/Home';
import { ContextMenuProvider, useContextMenu } from '@/contexts/ContextMenuContext';
import { SettingsProvider, useSettings } from '@/contexts/SettingsContext';
⋮----
import { ROUTES } from '@/utils/routes';
⋮----
import { TooltipProvider } from '@/components/ui/Tooltip';
import { ApiProvider } from '@/contexts/ApiContext';
import { ModelProviderProvider } from '@/contexts/ModelProviderContext';
import { AgentsProvider } from '@/contexts/AgentsContext';
⋮----
const ThemeAndFontManager = () =>
⋮----
// Remove all theme classes first
⋮----
// Add the current theme class, default to dark
⋮----
const App = () =>

================
File: src/renderer/src/env.d.ts
================
/// <reference types="vite/client" />
⋮----
import { ApplicationAPI } from '@common/api';
⋮----
interface Window {
    api: ApplicationAPI;
  }

================
File: src/renderer/src/fonts.css
================
@font-face {

================
File: src/renderer/src/main.css
================
@tailwind base;
@tailwind components;
@tailwind utilities;
⋮----
.react-resizable {
⋮----
.react-resizable-handle {
⋮----
.react-resizable-handle::before {
⋮----
@layer base {
⋮----
html {
⋮----
:root {
⋮----
body {
⋮----
* {
⋮----
code {
⋮----
.cm-fat-cursor {
⋮----
.cm-placeholder {
⋮----
.cm-line {
⋮----
.cm-tooltip-autocomplete {
⋮----
.cm-tooltip-autocomplete > ul {
⋮----
.cm-tooltip-autocomplete > ul > li {
⋮----
.cm-tooltip-autocomplete-detail {
⋮----
.cm-tooltip-autocomplete-chip {
⋮----
.cm-tooltip-autocomplete > ul > li:hover {
⋮----
.cm-tooltip-autocomplete > ul > li[aria-selected] {
⋮----
/* Scrollbar styles for Webkit browsers */
.cm-tooltip-autocomplete::-webkit-scrollbar {
⋮----
.cm-tooltip-autocomplete::-webkit-scrollbar-track {
⋮----
.cm-tooltip-autocomplete::-webkit-scrollbar-thumb {
⋮----
.cm-tooltip-autocomplete::-webkit-scrollbar-thumb:hover {
⋮----
::selection {

================
File: src/renderer/src/main.tsx
================
import ReactDOM from 'react-dom/client';
⋮----
import App from './App';

================
File: src/renderer/index.html
================
<!doctype html>
<html>
  <head>
<!--    <script-->
<!--      crossOrigin="anonymous"-->
<!--      src="https://unpkg.com/react-scan/dist/auto.global.js"-->
<!--    ></script>-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>AiderDesk</title>
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; img-src 'self' data: file:; font-src 'self' https://fonts.gstatic.com; connect-src 'self' http: https: ws: wss:;"
    />
    <link rel="stylesheet" href="/src/fonts.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AiderDesk">
    <link rel="apple-touch-icon" href="/icon-192.png">
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // Register service worker for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(() => {
            // Silently fail if service worker registration fails
          });
        });
      }
    </script>
  </body>
</html>

================
File: src/renderer/progress.html
================
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Starting AiderDesk...</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background-color: #222431;
      color: #f1f3f5;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      box-sizing: border-box;
    }
    .text {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .subtitle {
      font-size: 11px;
      color: #999ba3;
      margin-bottom: 4px;
      display: none;
    }

    .detail {
      font-size: 12px;
      color: #999ba3;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .spinner {
      width: 14px;
      height: 14px;
      border: 2px solid rgba(88, 92, 117, 0.3);
      border-top-color: #585c75;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      flex-shrink: 0;
      display: none;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .progress-container {
      height: 16px;
      background-color: #191a22;
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      background-color: #3d4166;
      border-radius: 2px;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.3s ease;
    }
    .completed .progress-bar {
      width: 100% !important;
      background-color: #3b82f6;
    }
  </style>
</head>
<body>
  <div class="text" id="text">Starting AiderDesk...</div>
  <div class="detail" id="detail">
    <span id="detail-text">Initializing...</span>
    <div class="spinner" id="spinner"></div>
  </div>
  <div class="subtitle" id="subtitle">This may take a while...</div>
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    ipcRenderer.on('set-title', (_, title) => {
      document.getElementById('text').textContent = title;
    });

    ipcRenderer.on('set-detail', (_, value, subtitle) => {
      const messageEl = document.getElementById('detail-text');
      const spinnerEl = document.getElementById('spinner');
      const infoEl = document.getElementById('subtitle');

      messageEl.textContent = value;
      const showSpinner = /installing|package|aider|connector|requirements|python|uv|venv/i.test(value.toLowerCase());
      spinnerEl.style.display = showSpinner ? 'block' : 'none';

      infoEl.textContent = subtitle || '';
      infoEl.style.display = subtitle ? 'block' : 'none';
    });

    ipcRenderer.on('set-completed', () => {
      document.body.classList.add('completed');
    });

    const progressBar = document.getElementById('progress-bar');

    ipcRenderer.on('set-progress', (_, progress) => {
      progressBar.style.width = `${Math.min(100, Math.max(0, progress))}%`;
    });
  </script>
</body>
</html>

================
File: electron-builder.yml
================
appId: com.hotovo.aider-desk
productName: aider-desk
directories:
  buildResources: build
files:
  - '!**/.vscode/*'
  - '!src/*'
  - '!resources/*'
  - '!docs-site/*'
  - '!electron.vite.config.{js,ts,mjs,cjs}'
  - '!{.eslintignore,.eslintrc.cjs,.prettierignore,.prettierrc.yaml,dev-app-update.yml,CHANGELOG.md,README.md}'
  - '!{.env,.env.*,.npmrc,pnpm-lock.yaml}'
  - '!{tsconfig.json,tsconfig.node.json,tsconfig.web.json}'
  - '!.aider-desk/*'
  - '!llms.txt'
extraResources:
  - from: ./resources/connector
    to: connector
    filter:
      - '**/*'
  - from: ./out/mcp-server
    to: mcp-server
    filter:
      - '**/*'
  - from: ./resources/prompts
    to: prompts
    filter:
      - '**/*'
asarUnpack:
  - '**/node_modules/sharp/**/*'
  - '**/node_modules/@img/**/*'
beforePack: scripts/before-pack.js
win:
  executableName: aider-desk
  icon: resources/icon.png
  extraResources:
    - from: ./resources/win
      to: win
      filter:
        - '**/*'
nsis:
  artifactName: ${name}-${version}-setup.${ext}
  shortcutName: ${productName}
  uninstallDisplayName: ${productName}
  createDesktopShortcut: always
mac:
  category: public.app-category.developer-tools
  target:
    - target: default
  artifactName: ${productName}-${version}-macos-${arch}.${ext}
  type: distribution
  hardenedRuntime: true
  entitlements: build/entitlements.mac.plist
  entitlementsInherit: build/entitlements.mac.plist
  extendInfo:
    - NSMicrophoneUsageDescription: Application requests access to the device's microphone.
  gatekeeperAssess: false
  notarize: true
  extraResources:
    - from: ./resources/macos
      to: macos
      filter:
        - '**/*'
dmg:
  artifactName: ${name}-${version}-macos-${arch}.${ext}
linux:
  target:
    - target: AppImage
    - target: deb
    - target: rpm
  maintainer: Hotovo
  category: Utility
  extraResources:
    - from: ./resources/linux
      to: linux
      filter:
        - '**/*'
appImage:
  artifactName: ${name}-${version}-${arch}.${ext}
deb:
  compression: 'gz'
npmRebuild: true
publish:
  provider: github
  releaseType: draft
  vPrefixedTagName: true
  publishAutoUpdate: true

================
File: electron.vite.config.ts
================
import { resolve } from 'path';
⋮----
import { defineConfig, externalizeDepsPlugin } from 'electron-vite';
import react from '@vitejs/plugin-react';
import tsconfigPaths from 'vite-tsconfig-paths';

================
File: package.json
================
{
  "name": "aider-desk",
  "version": "0.53.0-dev",
  "description": "Aider desktop application wrapper",
  "main": "./out/main/index.js",
  "author": "Hotovo",
  "homepage": "https://aiderdesk.hotovo.com",
  "repository": {
    "type": "git",
    "url": "https://github.com/hotovo/aider-desk.git"
  },
  "scripts": {
    "format": "prettier --write .",
    "lint": "eslint src --fix --cache",
    "lint:check": "eslint src --cache",
    "typecheck:node": "tsc --noEmit -p tsconfig.node.json --composite false",
    "typecheck:web": "tsc --noEmit -p tsconfig.web.json --composite false",
    "typecheck:mcp": "tsc --noEmit -p tsconfig.mcp-server.json --composite false",
    "typecheck": "npm run typecheck:node && npm run typecheck:web && npm run typecheck:mcp",
    "start": "electron-vite preview",
    "dev": "electron-vite dev",
    "dev:no-hmr": "NO_HMR=true electron-vite dev",
    "build:mcp": "esbuild src/mcp-server/aider-desk-mcp-server.ts --bundle --platform=node --outdir=out/mcp-server",
    "prebuild:server": "electron-vite build && npm run build:mcp",
    "build:server": "vite build --config vite.config.server.ts && mkdir -p out/resources && cp -r resources/* out/resources",
    "postbuild:server": "npm rebuild",
    "build": "npm run typecheck && electron-vite build && npm run build:mcp",
    "postinstall": "electron-builder install-app-deps && node scripts/download-uv.mjs && node scripts/download-probe.mjs && patch-package",
    "build:unpack": "npm run build && electron-builder --dir",
    "build:win": "npm run build && electron-builder --win",
    "build:mac": "npm run build && electron-builder --mac",
    "build:linux": "npm run build && electron-builder --linux",
    "prepare": "husky",
    "start:server": "node out/server/runner.js",
    "test": "npm run test:node && npm run test:web",
    "test:node": "NODE_ENV=test vitest run --config vitest.config.node.ts",
    "test:web": "NODE_ENV=test vitest run --config vitest.config.web.ts",
    "test:mcp": "NODE_ENV=test vitest run --config vitest.config.mcp.ts",
    "test:watch": "concurrently \"npm run test:node -- --watch\" \"npm run test:web -- --watch\"",
    "test:coverage": "npm run test:node -- --coverage && npm run test:web -- --coverage",
    "test:ui": "vitest --config vitest.config.web.ts --ui"
  },
  "dependencies": {
    "@ai-sdk/amazon-bedrock": "^3.0.73",
    "@ai-sdk/anthropic": "^2.0.57",
    "@ai-sdk/azure": "^2.0.91",
    "@ai-sdk/cerebras": "^1.0.34",
    "@ai-sdk/deepseek": "^1.0.33",
    "@ai-sdk/google": "^2.0.52",
    "@ai-sdk/google-vertex": "^3.0.97",
    "@ai-sdk/groq": "^2.0.34",
    "@ai-sdk/openai": "^2.0.89",
    "@ai-sdk/provider": "^2.0.1",
    "@aws-crypto/sha256-js": "^5.0.0",
    "@aws-sdk/client-bedrock": "^3.887.0",
    "@aws-sdk/credential-provider-node": "^3.772.0",
    "@aws-sdk/credential-providers": "^3.782.0",
    "@aws-sdk/types": "^3.540.0",
    "@codemirror/autocomplete": "^6.18.7",
    "@dmitryrechkin/json-schema-to-zod": "^1.0.1",
    "@dnd-kit/core": "^6.3.1",
    "@dnd-kit/sortable": "^10.0.0",
    "@dotenvx/dotenvx": "^1.24.5",
    "@electron-toolkit/preload": "^3.0.2",
    "@electron-toolkit/utils": "^4.0.0",
    "@google-cloud/aiplatform": "^5.7.0",
    "@google-cloud/speech": "^7.2.1",
    "@google/genai": "^1.30.0",
    "@headlessui/react": "^2.2.0",
    "@homebridge/node-pty-prebuilt-multiarch": "^0.13.1",
    "@huggingface/transformers": "^3.8.1",
    "@lancedb/lancedb": "^0.22.3",
    "@openrouter/ai-sdk-provider": "^1.5.4",
    "@opentelemetry/auto-instrumentations-node": "^0.62.0",
    "@opentelemetry/sdk-node": "^0.203.0",
    "@opentelemetry/sdk-trace-base": "^2.0.1",
    "@probelabs/probe": "0.6.0-rc161",
    "@radix-ui/react-tooltip": "^1.2.8",
    "@reactuses/core": "^6.0.6",
    "@replit/codemirror-vim": "^6.3.0",
    "@requesty/ai-sdk": "^2.1.2",
    "@smithy/eventstream-codec": "^2.0.0",
    "@smithy/protocol-http": "^3.3.0",
    "@smithy/signature-v4": "^2.0.0",
    "@smithy/util-utf8": "^2.0.0",
    "@tanstack/react-table": "^8.21.3",
    "@tanstack/react-virtual": "^3.13.12",
    "@types/cors": "^2.8.17",
    "@types/express": "^5.0.0",
    "@types/hast": "^3.0.4",
    "@uiw/codemirror-theme-github": "^4.23.12",
    "@uiw/react-codemirror": "4.25.1",
    "@uiw/react-color-sketch": "^2.8.0",
    "@xterm/addon-fit": "^0.10.0",
    "@xterm/addon-web-links": "^0.11.0",
    "@xterm/xterm": "^5.5.0",
    "ai": "^5.0.119",
    "ai-sdk-provider-claude-code": "^2.3.0",
    "apache-arrow": "18.1.0",
    "axios": "^1.8.3",
    "babel-plugin-react-compiler": "^19.1.0-rc.3",
    "better-sqlite3": "^12.0.0",
    "cheerio": "^1.0.0",
    "chokidar": "^4.0.3",
    "cloudflared": "^0.7.1",
    "clsx": "^2.1.1",
    "conf": "^15.0.2",
    "cors": "^2.8.5",
    "diff": "^8.0.2",
    "electron-updater": "^6.6.2",
    "env-paths": "^3.0.0",
    "express": "^4.21.2",
    "file-type": "^21.0.0",
    "filenamify": "^7.0.1",
    "fix-path": "^4.0.0",
    "focus-trap-react": "^11.0.3",
    "framer-motion": "^11.18.2",
    "gitdiff-parser": "^0.3.1",
    "glob": "^11.0.2",
    "google-auth-library": "^10.3.0",
    "gpt-tokenizer": "^2.9.0",
    "handlebars": "^4.7.8",
    "hast-util-to-jsx-runtime": "^2.3.6",
    "html-to-image": "^1.11.13",
    "i18next": "^24.2.3",
    "i18next-browser-languagedetector": "^8.0.4",
    "istextorbinary": "^9.5.0",
    "js-tiktoken": "^1.0.20",
    "langfuse-vercel": "^3.38.4",
    "lodash": "^4.17.21",
    "lowlight": "^3.3.0",
    "mark.js": "^8.11.1",
    "match-sorter": "^8.0.0",
    "mermaid": "^11.12.2",
    "object-hash": "^3.0.0",
    "ollama-ai-provider-v2": "^1.5.5",
    "openai": "^6.9.1",
    "os-name": "^6.0.0",
    "patch-package": "^8.0.0",
    "posthog-node": "^4.18.0",
    "prismjs": "^1.30.0",
    "react-complex-tree": "^2.4.5",
    "react-country-flag": "^3.1.0",
    "react-datepicker": "^8.4.0",
    "react-diff-view": "^3.3.2",
    "react-hotkeys-hook": "^4.6.2",
    "react-i18next": "^15.4.1",
    "react-icons": "^5.5.0",
    "react-markdown": "^10.1.0",
    "react-resizable": "^3.0.5",
    "react-router-dom": "^7.0.1",
    "react-textarea-autosize": "^8.5.6",
    "react-toastify": "^10.0.6",
    "recharts": "^3.0.2",
    "refractor": "^5.0.0",
    "rehype-autolink-headings": "^7.1.0",
    "rehype-slug": "^6.0.0",
    "remark-gfm": "^4.0.1",
    "sharp": "0.34.5",
    "simple-git": "^3.27.0",
    "slugify": "^1.6.6",
    "socket.io": "^4.8.1",
    "socket.io-client": "^4.8.1",
    "tailwind-merge": "^3.3.1",
    "textarea-caret": "^3.1.0",
    "tmp": "^0.2.3",
    "tree-kill": "^1.2.2",
    "turndown": "^7.2.1",
    "unidiff": "^1.0.4",
    "unist-util-map": "^4.0.0",
    "use-sync-external-store": "^1.6.0",
    "uuid": "^11.0.2",
    "vite-plugin-prismjs": "^0.0.11",
    "winston": "^3.17.0",
    "winston-daily-rotate-file": "^5.0.0",
    "ws": "^8.18.0",
    "yaml": "^2.8.0",
    "yaml-front-matter": "^4.1.1",
    "zod": "^4.1.11",
    "zustand": "^5.0.9"
  },
  "devDependencies": {
    "@electron-toolkit/tsconfig": "^2.0.0",
    "@electron/notarize": "^3.0.2",
    "@eslint/js": "^9.33.0",
    "@modelcontextprotocol/sdk": "^1.20.0",
    "@tailwindcss/typography": "^0.5.16",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.1",
    "@testing-library/user-event": "^14.6.1",
    "@types/better-sqlite3": "^7.6.13",
    "@types/handlebars": "^4.0.40",
    "@types/lodash": "^4.17.17",
    "@types/node": "^20.14.8",
    "@types/object-hash": "^3.0.6",
    "@types/prismjs": "^1.26.5",
    "@types/react": "^19.2.2",
    "@types/react-dom": "^19.2.2",
    "@types/react-resizable": "^3.0.8",
    "@types/refractor": "^3.4.1",
    "@types/socket.io": "^3.0.1",
    "@types/textarea-caret": "^3.0.3",
    "@types/tmp": "^0.2.6",
    "@types/yaml-front-matter": "^4.1.3",
    "@vitejs/plugin-react": "^5.0.4",
    "@vitest/coverage-v8": "^4.0.16",
    "@vitest/ui": "^4.0.16",
    "adm-zip": "^0.5.16",
    "autoprefixer": "^10.4.20",
    "concurrently": "^9.2.1",
    "electron": "^37.6.0",
    "electron-builder": "^26.0.12",
    "electron-vite": "^4.0.1",
    "esbuild": "^0.25.9",
    "eslint": "^9.18.0",
    "eslint-config-prettier": "^9.1.0",
    "eslint-import-resolver-typescript": "^3.7.0",
    "eslint-plugin-import": "^2.31.0",
    "eslint-plugin-prettier": "^5.2.1",
    "eslint-plugin-react": "^7.37.2",
    "eslint-plugin-react-hooks": "^7.0.0",
    "globals": "^15.9.0",
    "husky": "^9.1.7",
    "jsdom": "^27.3.0",
    "lint-staged": "^15.4.1",
    "node-fetch": "^3.3.2",
    "prettier": "^3.3.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "sass-embedded": "^1.89.0",
    "tailwind-scrollbar": "^3.1.0",
    "tailwindcss": "^3.4.14",
    "tar": "^7.4.3",
    "typescript": "^5.9.3",
    "typescript-eslint": "^8.46.1",
    "vite": "^7.1.10",
    "vite-tsconfig-paths": "^5.1.4",
    "vitest": "^4.0.16"
  },
  "lint-staged": {
    "*.{ts,tsx}": "eslint --fix"
  }
}

================
File: tailwind.config.js
================
/** @type {import('tailwindcss').Config} */
⋮----
// Theme-based colors
⋮----
const extractColorVars = (colorObj, colorGroup = '') =>





================================================================
End of Codebase
================================================================
